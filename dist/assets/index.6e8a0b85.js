const R3=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const _ of d)if(_.type==="childList")for(const w of _.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&l(w)}).observe(document,{childList:!0,subtree:!0});function n(d){const _={};return d.integrity&&(_.integrity=d.integrity),d.referrerpolicy&&(_.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?_.credentials="include":d.crossorigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(d){if(d.ep)return;d.ep=!0;const _=n(d);fetch(d.href,_)}};R3();var F3=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},si={exports:{}},$n={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sp=Symbol.for("react.element"),B3=Symbol.for("react.portal"),O3=Symbol.for("react.fragment"),N3=Symbol.for("react.strict_mode"),U3=Symbol.for("react.profiler"),V3=Symbol.for("react.provider"),G3=Symbol.for("react.context"),j3=Symbol.for("react.forward_ref"),W3=Symbol.for("react.suspense"),H3=Symbol.for("react.memo"),$3=Symbol.for("react.lazy"),xS=Symbol.iterator;function q3(i){return i===null||typeof i!="object"?null:(i=xS&&i[xS]||i["@@iterator"],typeof i=="function"?i:null)}var cT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uT=Object.assign,hT={};function nd(i,e,n){this.props=i,this.context=e,this.refs=hT,this.updater=n||cT}nd.prototype.isReactComponent={};nd.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};nd.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function dT(){}dT.prototype=nd.prototype;function Wv(i,e,n){this.props=i,this.context=e,this.refs=hT,this.updater=n||cT}var Hv=Wv.prototype=new dT;Hv.constructor=Wv;uT(Hv,nd.prototype);Hv.isPureReactComponent=!0;var vS=Array.isArray,fT=Object.prototype.hasOwnProperty,$v={current:null},pT={key:!0,ref:!0,__self:!0,__source:!0};function mT(i,e,n){var l,d={},_=null,w=null;if(e!=null)for(l in e.ref!==void 0&&(w=e.ref),e.key!==void 0&&(_=""+e.key),e)fT.call(e,l)&&!pT.hasOwnProperty(l)&&(d[l]=e[l]);var a=arguments.length-2;if(a===1)d.children=n;else if(1<a){for(var T=Array(a),A=0;A<a;A++)T[A]=arguments[A+2];d.children=T}if(i&&i.defaultProps)for(l in a=i.defaultProps,a)d[l]===void 0&&(d[l]=a[l]);return{$$typeof:Sp,type:i,key:_,ref:w,props:d,_owner:$v.current}}function Z3(i,e){return{$$typeof:Sp,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function qv(i){return typeof i=="object"&&i!==null&&i.$$typeof===Sp}function X3(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(n){return e[n]})}var wS=/\/+/g;function I0(i,e){return typeof i=="object"&&i!==null&&i.key!=null?X3(""+i.key):e.toString(36)}function K_(i,e,n,l,d){var _=typeof i;(_==="undefined"||_==="boolean")&&(i=null);var w=!1;if(i===null)w=!0;else switch(_){case"string":case"number":w=!0;break;case"object":switch(i.$$typeof){case Sp:case B3:w=!0}}if(w)return w=i,d=d(w),i=l===""?"."+I0(w,0):l,vS(d)?(n="",i!=null&&(n=i.replace(wS,"$&/")+"/"),K_(d,e,n,"",function(A){return A})):d!=null&&(qv(d)&&(d=Z3(d,n+(!d.key||w&&w.key===d.key?"":(""+d.key).replace(wS,"$&/")+"/")+i)),e.push(d)),1;if(w=0,l=l===""?".":l+":",vS(i))for(var a=0;a<i.length;a++){_=i[a];var T=l+I0(_,a);w+=K_(_,e,n,T,d)}else if(T=q3(i),typeof T=="function")for(i=T.call(i),a=0;!(_=i.next()).done;)_=_.value,T=l+I0(_,a++),w+=K_(_,e,n,T,d);else if(_==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return w}function h_(i,e,n){if(i==null)return i;var l=[],d=0;return K_(i,l,"","",function(_){return e.call(n,_,d++)}),l}function Y3(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(n){(i._status===0||i._status===-1)&&(i._status=1,i._result=n)},function(n){(i._status===0||i._status===-1)&&(i._status=2,i._result=n)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var Wr={current:null},J_={transition:null},K3={ReactCurrentDispatcher:Wr,ReactCurrentBatchConfig:J_,ReactCurrentOwner:$v};$n.Children={map:h_,forEach:function(i,e,n){h_(i,function(){e.apply(this,arguments)},n)},count:function(i){var e=0;return h_(i,function(){e++}),e},toArray:function(i){return h_(i,function(e){return e})||[]},only:function(i){if(!qv(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};$n.Component=nd;$n.Fragment=O3;$n.Profiler=U3;$n.PureComponent=Wv;$n.StrictMode=N3;$n.Suspense=W3;$n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K3;$n.cloneElement=function(i,e,n){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var l=uT({},i.props),d=i.key,_=i.ref,w=i._owner;if(e!=null){if(e.ref!==void 0&&(_=e.ref,w=$v.current),e.key!==void 0&&(d=""+e.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(T in e)fT.call(e,T)&&!pT.hasOwnProperty(T)&&(l[T]=e[T]===void 0&&a!==void 0?a[T]:e[T])}var T=arguments.length-2;if(T===1)l.children=n;else if(1<T){a=Array(T);for(var A=0;A<T;A++)a[A]=arguments[A+2];l.children=a}return{$$typeof:Sp,type:i.type,key:d,ref:_,props:l,_owner:w}};$n.createContext=function(i){return i={$$typeof:G3,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:V3,_context:i},i.Consumer=i};$n.createElement=mT;$n.createFactory=function(i){var e=mT.bind(null,i);return e.type=i,e};$n.createRef=function(){return{current:null}};$n.forwardRef=function(i){return{$$typeof:j3,render:i}};$n.isValidElement=qv;$n.lazy=function(i){return{$$typeof:$3,_payload:{_status:-1,_result:i},_init:Y3}};$n.memo=function(i,e){return{$$typeof:H3,type:i,compare:e===void 0?null:e}};$n.startTransition=function(i){var e=J_.transition;J_.transition={};try{i()}finally{J_.transition=e}};$n.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};$n.useCallback=function(i,e){return Wr.current.useCallback(i,e)};$n.useContext=function(i){return Wr.current.useContext(i)};$n.useDebugValue=function(){};$n.useDeferredValue=function(i){return Wr.current.useDeferredValue(i)};$n.useEffect=function(i,e){return Wr.current.useEffect(i,e)};$n.useId=function(){return Wr.current.useId()};$n.useImperativeHandle=function(i,e,n){return Wr.current.useImperativeHandle(i,e,n)};$n.useInsertionEffect=function(i,e){return Wr.current.useInsertionEffect(i,e)};$n.useLayoutEffect=function(i,e){return Wr.current.useLayoutEffect(i,e)};$n.useMemo=function(i,e){return Wr.current.useMemo(i,e)};$n.useReducer=function(i,e,n){return Wr.current.useReducer(i,e,n)};$n.useRef=function(i){return Wr.current.useRef(i)};$n.useState=function(i){return Wr.current.useState(i)};$n.useSyncExternalStore=function(i,e,n){return Wr.current.useSyncExternalStore(i,e,n)};$n.useTransition=function(){return Wr.current.useTransition()};$n.version="18.2.0";si.exports=$n;var J3=si.exports,Fx={},_T={exports:{}},Mo={},gT={exports:{}},yT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(Be,Ne){var Ze=Be.length;Be.push(Ne);e:for(;0<Ze;){var pt=Ze-1>>>1,et=Be[pt];if(0<d(et,Ne))Be[pt]=Ne,Be[Ze]=et,Ze=pt;else break e}}function n(Be){return Be.length===0?null:Be[0]}function l(Be){if(Be.length===0)return null;var Ne=Be[0],Ze=Be.pop();if(Ze!==Ne){Be[0]=Ze;e:for(var pt=0,et=Be.length,gt=et>>>1;pt<gt;){var jt=2*(pt+1)-1,Xt=Be[jt],ot=jt+1,Tn=Be[ot];if(0>d(Xt,Ze))ot<et&&0>d(Tn,Xt)?(Be[pt]=Tn,Be[ot]=Ze,pt=ot):(Be[pt]=Xt,Be[jt]=Ze,pt=jt);else if(ot<et&&0>d(Tn,Ze))Be[pt]=Tn,Be[ot]=Ze,pt=ot;else break e}}return Ne}function d(Be,Ne){var Ze=Be.sortIndex-Ne.sortIndex;return Ze!==0?Ze:Be.id-Ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;i.unstable_now=function(){return _.now()}}else{var w=Date,a=w.now();i.unstable_now=function(){return w.now()-a}}var T=[],A=[],D=1,P=null,k=3,W=!1,Z=!1,F=!1,B=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate!="undefined"?setImmediate:null;typeof navigator!="undefined"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(Be){for(var Ne=n(A);Ne!==null;){if(Ne.callback===null)l(A);else if(Ne.startTime<=Be)l(A),Ne.sortIndex=Ne.expirationTime,e(T,Ne);else break;Ne=n(A)}}function me(Be){if(F=!1,ne(Be),!Z)if(n(T)!==null)Z=!0,tt(K);else{var Ne=n(A);Ne!==null&&ct(me,Ne.startTime-Be)}}function K(Be,Ne){Z=!1,F&&(F=!1,G(ee),ee=-1),W=!0;var Ze=k;try{for(ne(Ne),P=n(T);P!==null&&(!(P.expirationTime>Ne)||Be&&!qe());){var pt=P.callback;if(typeof pt=="function"){P.callback=null,k=P.priorityLevel;var et=pt(P.expirationTime<=Ne);Ne=i.unstable_now(),typeof et=="function"?P.callback=et:P===n(T)&&l(T),ne(Ne)}else l(T);P=n(T)}if(P!==null)var gt=!0;else{var jt=n(A);jt!==null&&ct(me,jt.startTime-Ne),gt=!1}return gt}finally{P=null,k=Ze,W=!1}}var Ee=!1,Te=null,ee=-1,Ae=5,Fe=-1;function qe(){return!(i.unstable_now()-Fe<Ae)}function Pt(){if(Te!==null){var Be=i.unstable_now();Fe=Be;var Ne=!0;try{Ne=Te(!0,Be)}finally{Ne?xt():(Ee=!1,Te=null)}}else Ee=!1}var xt;if(typeof $=="function")xt=function(){$(Pt)};else if(typeof MessageChannel!="undefined"){var je=new MessageChannel,ut=je.port2;je.port1.onmessage=Pt,xt=function(){ut.postMessage(null)}}else xt=function(){B(Pt,0)};function tt(Be){Te=Be,Ee||(Ee=!0,xt())}function ct(Be,Ne){ee=B(function(){Be(i.unstable_now())},Ne)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Be){Be.callback=null},i.unstable_continueExecution=function(){Z||W||(Z=!0,tt(K))},i.unstable_forceFrameRate=function(Be){0>Be||125<Be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ae=0<Be?Math.floor(1e3/Be):5},i.unstable_getCurrentPriorityLevel=function(){return k},i.unstable_getFirstCallbackNode=function(){return n(T)},i.unstable_next=function(Be){switch(k){case 1:case 2:case 3:var Ne=3;break;default:Ne=k}var Ze=k;k=Ne;try{return Be()}finally{k=Ze}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Be,Ne){switch(Be){case 1:case 2:case 3:case 4:case 5:break;default:Be=3}var Ze=k;k=Be;try{return Ne()}finally{k=Ze}},i.unstable_scheduleCallback=function(Be,Ne,Ze){var pt=i.unstable_now();switch(typeof Ze=="object"&&Ze!==null?(Ze=Ze.delay,Ze=typeof Ze=="number"&&0<Ze?pt+Ze:pt):Ze=pt,Be){case 1:var et=-1;break;case 2:et=250;break;case 5:et=1073741823;break;case 4:et=1e4;break;default:et=5e3}return et=Ze+et,Be={id:D++,callback:Ne,priorityLevel:Be,startTime:Ze,expirationTime:et,sortIndex:-1},Ze>pt?(Be.sortIndex=Ze,e(A,Be),n(T)===null&&Be===n(A)&&(F?(G(ee),ee=-1):F=!0,ct(me,Ze-pt))):(Be.sortIndex=et,e(T,Be),Z||W||(Z=!0,tt(K))),Be},i.unstable_shouldYield=qe,i.unstable_wrapCallback=function(Be){var Ne=k;return function(){var Ze=k;k=Ne;try{return Be.apply(this,arguments)}finally{k=Ze}}}})(yT);gT.exports=yT;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xT=si.exports,So=gT.exports;function Dt(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vT=new Set,tp={};function qc(i,e){Wh(i,e),Wh(i+"Capture",e)}function Wh(i,e){for(tp[i]=e,i=0;i<e.length;i++)vT.add(e[i])}var xa=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Bx=Object.prototype.hasOwnProperty,Q3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bS={},SS={};function eP(i){return Bx.call(SS,i)?!0:Bx.call(bS,i)?!1:Q3.test(i)?SS[i]=!0:(bS[i]=!0,!1)}function tP(i,e,n,l){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return l?!1:n!==null?!n.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function nP(i,e,n,l){if(e===null||typeof e=="undefined"||tP(i,e,n,l))return!0;if(l)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Hr(i,e,n,l,d,_,w){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=l,this.attributeNamespace=d,this.mustUseProperty=n,this.propertyName=i,this.type=e,this.sanitizeURL=_,this.removeEmptyString=w}var br={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){br[i]=new Hr(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];br[e]=new Hr(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){br[i]=new Hr(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){br[i]=new Hr(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){br[i]=new Hr(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){br[i]=new Hr(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){br[i]=new Hr(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){br[i]=new Hr(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){br[i]=new Hr(i,5,!1,i.toLowerCase(),null,!1,!1)});var Zv=/[\-:]([a-z])/g;function Xv(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(Zv,Xv);br[e]=new Hr(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(Zv,Xv);br[e]=new Hr(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(Zv,Xv);br[e]=new Hr(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){br[i]=new Hr(i,1,!1,i.toLowerCase(),null,!1,!1)});br.xlinkHref=new Hr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){br[i]=new Hr(i,1,!1,i.toLowerCase(),null,!0,!0)});function Yv(i,e,n,l){var d=br.hasOwnProperty(e)?br[e]:null;(d!==null?d.type!==0:l||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nP(e,n,d,l)&&(n=null),l||d===null?eP(e)&&(n===null?i.removeAttribute(e):i.setAttribute(e,""+n)):d.mustUseProperty?i[d.propertyName]=n===null?d.type===3?!1:"":n:(e=d.attributeName,l=d.attributeNamespace,n===null?i.removeAttribute(e):(d=d.type,n=d===3||d===4&&n===!0?"":""+n,l?i.setAttributeNS(l,e,n):i.setAttribute(e,n))))}var Ma=xT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d_=Symbol.for("react.element"),wh=Symbol.for("react.portal"),bh=Symbol.for("react.fragment"),Kv=Symbol.for("react.strict_mode"),Ox=Symbol.for("react.profiler"),wT=Symbol.for("react.provider"),bT=Symbol.for("react.context"),Jv=Symbol.for("react.forward_ref"),Nx=Symbol.for("react.suspense"),Ux=Symbol.for("react.suspense_list"),Qv=Symbol.for("react.memo"),hl=Symbol.for("react.lazy"),ST=Symbol.for("react.offscreen"),MS=Symbol.iterator;function bf(i){return i===null||typeof i!="object"?null:(i=MS&&i[MS]||i["@@iterator"],typeof i=="function"?i:null)}var Ui=Object.assign,P0;function Ff(i){if(P0===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);P0=e&&e[1]||""}return`
`+P0+i}var L0=!1;function D0(i,e){if(!i||L0)return"";L0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(A){var l=A}Reflect.construct(i,[],e)}else{try{e.call()}catch(A){l=A}i.call(e.prototype)}else{try{throw Error()}catch(A){l=A}i()}}catch(A){if(A&&l&&typeof A.stack=="string"){for(var d=A.stack.split(`
`),_=l.stack.split(`
`),w=d.length-1,a=_.length-1;1<=w&&0<=a&&d[w]!==_[a];)a--;for(;1<=w&&0<=a;w--,a--)if(d[w]!==_[a]){if(w!==1||a!==1)do if(w--,a--,0>a||d[w]!==_[a]){var T=`
`+d[w].replace(" at new "," at ");return i.displayName&&T.includes("<anonymous>")&&(T=T.replace("<anonymous>",i.displayName)),T}while(1<=w&&0<=a);break}}}finally{L0=!1,Error.prepareStackTrace=n}return(i=i?i.displayName||i.name:"")?Ff(i):""}function iP(i){switch(i.tag){case 5:return Ff(i.type);case 16:return Ff("Lazy");case 13:return Ff("Suspense");case 19:return Ff("SuspenseList");case 0:case 2:case 15:return i=D0(i.type,!1),i;case 11:return i=D0(i.type.render,!1),i;case 1:return i=D0(i.type,!0),i;default:return""}}function Vx(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case bh:return"Fragment";case wh:return"Portal";case Ox:return"Profiler";case Kv:return"StrictMode";case Nx:return"Suspense";case Ux:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case bT:return(i.displayName||"Context")+".Consumer";case wT:return(i._context.displayName||"Context")+".Provider";case Jv:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Qv:return e=i.displayName||null,e!==null?e:Vx(i.type)||"Memo";case hl:e=i._payload,i=i._init;try{return Vx(i(e))}catch{}}return null}function rP(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vx(e);case 8:return e===Kv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Cl(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function MT(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function oP(i){var e=MT(i)?"checked":"value",n=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),l=""+i[e];if(!i.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var d=n.get,_=n.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return d.call(this)},set:function(w){l=""+w,_.call(this,w)}}),Object.defineProperty(i,e,{enumerable:n.enumerable}),{getValue:function(){return l},setValue:function(w){l=""+w},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function f_(i){i._valueTracker||(i._valueTracker=oP(i))}function TT(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var n=e.getValue(),l="";return i&&(l=MT(i)?i.checked?"true":"false":i.value),i=l,i!==n?(e.setValue(i),!0):!1}function dg(i){if(i=i||(typeof document!="undefined"?document:void 0),typeof i=="undefined")return null;try{return i.activeElement||i.body}catch{return i.body}}function Gx(i,e){var n=e.checked;return Ui({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:i._wrapperState.initialChecked})}function TS(i,e){var n=e.defaultValue==null?"":e.defaultValue,l=e.checked!=null?e.checked:e.defaultChecked;n=Cl(e.value!=null?e.value:n),i._wrapperState={initialChecked:l,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ET(i,e){e=e.checked,e!=null&&Yv(i,"checked",e,!1)}function jx(i,e){ET(i,e);var n=Cl(e.value),l=e.type;if(n!=null)l==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+n):i.value!==""+n&&(i.value=""+n);else if(l==="submit"||l==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?Wx(i,e.type,n):e.hasOwnProperty("defaultValue")&&Wx(i,e.type,Cl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function ES(i,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var l=e.type;if(!(l!=="submit"&&l!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,n||e===i.value||(i.value=e),i.defaultValue=e}n=i.name,n!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,n!==""&&(i.name=n)}function Wx(i,e,n){(e!=="number"||dg(i.ownerDocument)!==i)&&(n==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+n&&(i.defaultValue=""+n))}var Bf=Array.isArray;function Rh(i,e,n,l){if(i=i.options,e){e={};for(var d=0;d<n.length;d++)e["$"+n[d]]=!0;for(n=0;n<i.length;n++)d=e.hasOwnProperty("$"+i[n].value),i[n].selected!==d&&(i[n].selected=d),d&&l&&(i[n].defaultSelected=!0)}else{for(n=""+Cl(n),e=null,d=0;d<i.length;d++){if(i[d].value===n){i[d].selected=!0,l&&(i[d].defaultSelected=!0);return}e!==null||i[d].disabled||(e=i[d])}e!==null&&(e.selected=!0)}}function Hx(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Dt(91));return Ui({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function CS(i,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Dt(92));if(Bf(n)){if(1<n.length)throw Error(Dt(93));n=n[0]}e=n}e==null&&(e=""),n=e}i._wrapperState={initialValue:Cl(n)}}function CT(i,e){var n=Cl(e.value),l=Cl(e.defaultValue);n!=null&&(n=""+n,n!==i.value&&(i.value=n),e.defaultValue==null&&i.defaultValue!==n&&(i.defaultValue=n)),l!=null&&(i.defaultValue=""+l)}function AS(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function AT(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $x(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?AT(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var p_,IT=function(i){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,l,d){MSApp.execUnsafeLocalFunction(function(){return i(e,n,l,d)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(p_=p_||document.createElement("div"),p_.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=p_.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function np(i,e){if(e){var n=i.firstChild;if(n&&n===i.lastChild&&n.nodeType===3){n.nodeValue=e;return}}i.textContent=e}var jf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sP=["Webkit","ms","Moz","O"];Object.keys(jf).forEach(function(i){sP.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),jf[e]=jf[i]})});function PT(i,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||jf.hasOwnProperty(i)&&jf[i]?(""+e).trim():e+"px"}function LT(i,e){i=i.style;for(var n in e)if(e.hasOwnProperty(n)){var l=n.indexOf("--")===0,d=PT(n,e[n],l);n==="float"&&(n="cssFloat"),l?i.setProperty(n,d):i[n]=d}}var aP=Ui({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qx(i,e){if(e){if(aP[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Dt(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Dt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Dt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Dt(62))}}function Zx(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xx=null;function e1(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Yx=null,Fh=null,Bh=null;function IS(i){if(i=Ep(i)){if(typeof Yx!="function")throw Error(Dt(280));var e=i.stateNode;e&&(e=jg(e),Yx(i.stateNode,i.type,e))}}function DT(i){Fh?Bh?Bh.push(i):Bh=[i]:Fh=i}function zT(){if(Fh){var i=Fh,e=Bh;if(Bh=Fh=null,IS(i),e)for(i=0;i<e.length;i++)IS(e[i])}}function kT(i,e){return i(e)}function RT(){}var z0=!1;function FT(i,e,n){if(z0)return i(e,n);z0=!0;try{return kT(i,e,n)}finally{z0=!1,(Fh!==null||Bh!==null)&&(RT(),zT())}}function ip(i,e){var n=i.stateNode;if(n===null)return null;var l=jg(n);if(l===null)return null;n=l[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(i=i.type,l=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!l;break e;default:i=!1}if(i)return null;if(n&&typeof n!="function")throw Error(Dt(231,e,typeof n));return n}var Kx=!1;if(xa)try{var Sf={};Object.defineProperty(Sf,"passive",{get:function(){Kx=!0}}),window.addEventListener("test",Sf,Sf),window.removeEventListener("test",Sf,Sf)}catch{Kx=!1}function lP(i,e,n,l,d,_,w,a,T){var A=Array.prototype.slice.call(arguments,3);try{e.apply(n,A)}catch(D){this.onError(D)}}var Wf=!1,fg=null,pg=!1,Jx=null,cP={onError:function(i){Wf=!0,fg=i}};function uP(i,e,n,l,d,_,w,a,T){Wf=!1,fg=null,lP.apply(cP,arguments)}function hP(i,e,n,l,d,_,w,a,T){if(uP.apply(this,arguments),Wf){if(Wf){var A=fg;Wf=!1,fg=null}else throw Error(Dt(198));pg||(pg=!0,Jx=A)}}function Zc(i){var e=i,n=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,(e.flags&4098)!==0&&(n=e.return),i=e.return;while(i)}return e.tag===3?n:null}function BT(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function PS(i){if(Zc(i)!==i)throw Error(Dt(188))}function dP(i){var e=i.alternate;if(!e){if(e=Zc(i),e===null)throw Error(Dt(188));return e!==i?null:i}for(var n=i,l=e;;){var d=n.return;if(d===null)break;var _=d.alternate;if(_===null){if(l=d.return,l!==null){n=l;continue}break}if(d.child===_.child){for(_=d.child;_;){if(_===n)return PS(d),i;if(_===l)return PS(d),e;_=_.sibling}throw Error(Dt(188))}if(n.return!==l.return)n=d,l=_;else{for(var w=!1,a=d.child;a;){if(a===n){w=!0,n=d,l=_;break}if(a===l){w=!0,l=d,n=_;break}a=a.sibling}if(!w){for(a=_.child;a;){if(a===n){w=!0,n=_,l=d;break}if(a===l){w=!0,l=_,n=d;break}a=a.sibling}if(!w)throw Error(Dt(189))}}if(n.alternate!==l)throw Error(Dt(190))}if(n.tag!==3)throw Error(Dt(188));return n.stateNode.current===n?i:e}function OT(i){return i=dP(i),i!==null?NT(i):null}function NT(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=NT(i);if(e!==null)return e;i=i.sibling}return null}var UT=So.unstable_scheduleCallback,LS=So.unstable_cancelCallback,fP=So.unstable_shouldYield,pP=So.unstable_requestPaint,qi=So.unstable_now,mP=So.unstable_getCurrentPriorityLevel,t1=So.unstable_ImmediatePriority,VT=So.unstable_UserBlockingPriority,mg=So.unstable_NormalPriority,_P=So.unstable_LowPriority,GT=So.unstable_IdlePriority,Ng=null,Os=null;function gP(i){if(Os&&typeof Os.onCommitFiberRoot=="function")try{Os.onCommitFiberRoot(Ng,i,void 0,(i.current.flags&128)===128)}catch{}}var us=Math.clz32?Math.clz32:vP,yP=Math.log,xP=Math.LN2;function vP(i){return i>>>=0,i===0?32:31-(yP(i)/xP|0)|0}var m_=64,__=4194304;function Of(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function _g(i,e){var n=i.pendingLanes;if(n===0)return 0;var l=0,d=i.suspendedLanes,_=i.pingedLanes,w=n&268435455;if(w!==0){var a=w&~d;a!==0?l=Of(a):(_&=w,_!==0&&(l=Of(_)))}else w=n&~d,w!==0?l=Of(w):_!==0&&(l=Of(_));if(l===0)return 0;if(e!==0&&e!==l&&(e&d)===0&&(d=l&-l,_=e&-e,d>=_||d===16&&(_&4194240)!==0))return e;if((l&4)!==0&&(l|=n&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=l;0<e;)n=31-us(e),d=1<<n,l|=i[n],e&=~d;return l}function wP(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bP(i,e){for(var n=i.suspendedLanes,l=i.pingedLanes,d=i.expirationTimes,_=i.pendingLanes;0<_;){var w=31-us(_),a=1<<w,T=d[w];T===-1?((a&n)===0||(a&l)!==0)&&(d[w]=wP(a,e)):T<=e&&(i.expiredLanes|=a),_&=~a}}function Qx(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function jT(){var i=m_;return m_<<=1,(m_&4194240)===0&&(m_=64),i}function k0(i){for(var e=[],n=0;31>n;n++)e.push(i);return e}function Mp(i,e,n){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-us(e),i[e]=n}function SP(i,e){var n=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var l=i.eventTimes;for(i=i.expirationTimes;0<n;){var d=31-us(n),_=1<<d;e[d]=0,l[d]=-1,i[d]=-1,n&=~_}}function n1(i,e){var n=i.entangledLanes|=e;for(i=i.entanglements;n;){var l=31-us(n),d=1<<l;d&e|i[l]&e&&(i[l]|=e),n&=~d}}var ai=0;function WT(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var HT,i1,$T,qT,ZT,ev=!1,g_=[],gl=null,yl=null,xl=null,rp=new Map,op=new Map,fl=[],MP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function DS(i,e){switch(i){case"focusin":case"focusout":gl=null;break;case"dragenter":case"dragleave":yl=null;break;case"mouseover":case"mouseout":xl=null;break;case"pointerover":case"pointerout":rp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":op.delete(e.pointerId)}}function Mf(i,e,n,l,d,_){return i===null||i.nativeEvent!==_?(i={blockedOn:e,domEventName:n,eventSystemFlags:l,nativeEvent:_,targetContainers:[d]},e!==null&&(e=Ep(e),e!==null&&i1(e)),i):(i.eventSystemFlags|=l,e=i.targetContainers,d!==null&&e.indexOf(d)===-1&&e.push(d),i)}function TP(i,e,n,l,d){switch(e){case"focusin":return gl=Mf(gl,i,e,n,l,d),!0;case"dragenter":return yl=Mf(yl,i,e,n,l,d),!0;case"mouseover":return xl=Mf(xl,i,e,n,l,d),!0;case"pointerover":var _=d.pointerId;return rp.set(_,Mf(rp.get(_)||null,i,e,n,l,d)),!0;case"gotpointercapture":return _=d.pointerId,op.set(_,Mf(op.get(_)||null,i,e,n,l,d)),!0}return!1}function XT(i){var e=Cc(i.target);if(e!==null){var n=Zc(e);if(n!==null){if(e=n.tag,e===13){if(e=BT(n),e!==null){i.blockedOn=e,ZT(i.priority,function(){$T(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){i.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Q_(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var n=tv(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(n===null){n=i.nativeEvent;var l=new n.constructor(n.type,n);Xx=l,n.target.dispatchEvent(l),Xx=null}else return e=Ep(n),e!==null&&i1(e),i.blockedOn=n,!1;e.shift()}return!0}function zS(i,e,n){Q_(i)&&n.delete(e)}function EP(){ev=!1,gl!==null&&Q_(gl)&&(gl=null),yl!==null&&Q_(yl)&&(yl=null),xl!==null&&Q_(xl)&&(xl=null),rp.forEach(zS),op.forEach(zS)}function Tf(i,e){i.blockedOn===e&&(i.blockedOn=null,ev||(ev=!0,So.unstable_scheduleCallback(So.unstable_NormalPriority,EP)))}function sp(i){function e(d){return Tf(d,i)}if(0<g_.length){Tf(g_[0],i);for(var n=1;n<g_.length;n++){var l=g_[n];l.blockedOn===i&&(l.blockedOn=null)}}for(gl!==null&&Tf(gl,i),yl!==null&&Tf(yl,i),xl!==null&&Tf(xl,i),rp.forEach(e),op.forEach(e),n=0;n<fl.length;n++)l=fl[n],l.blockedOn===i&&(l.blockedOn=null);for(;0<fl.length&&(n=fl[0],n.blockedOn===null);)XT(n),n.blockedOn===null&&fl.shift()}var Oh=Ma.ReactCurrentBatchConfig,gg=!0;function CP(i,e,n,l){var d=ai,_=Oh.transition;Oh.transition=null;try{ai=1,r1(i,e,n,l)}finally{ai=d,Oh.transition=_}}function AP(i,e,n,l){var d=ai,_=Oh.transition;Oh.transition=null;try{ai=4,r1(i,e,n,l)}finally{ai=d,Oh.transition=_}}function r1(i,e,n,l){if(gg){var d=tv(i,e,n,l);if(d===null)W0(i,e,l,yg,n),DS(i,l);else if(TP(d,i,e,n,l))l.stopPropagation();else if(DS(i,l),e&4&&-1<MP.indexOf(i)){for(;d!==null;){var _=Ep(d);if(_!==null&&HT(_),_=tv(i,e,n,l),_===null&&W0(i,e,l,yg,n),_===d)break;d=_}d!==null&&l.stopPropagation()}else W0(i,e,l,null,n)}}var yg=null;function tv(i,e,n,l){if(yg=null,i=e1(l),i=Cc(i),i!==null)if(e=Zc(i),e===null)i=null;else if(n=e.tag,n===13){if(i=BT(e),i!==null)return i;i=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return yg=i,null}function YT(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mP()){case t1:return 1;case VT:return 4;case mg:case _P:return 16;case GT:return 536870912;default:return 16}default:return 16}}var ml=null,o1=null,eg=null;function KT(){if(eg)return eg;var i,e=o1,n=e.length,l,d="value"in ml?ml.value:ml.textContent,_=d.length;for(i=0;i<n&&e[i]===d[i];i++);var w=n-i;for(l=1;l<=w&&e[n-l]===d[_-l];l++);return eg=d.slice(i,1<l?1-l:void 0)}function tg(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function y_(){return!0}function kS(){return!1}function To(i){function e(n,l,d,_,w){this._reactName=n,this._targetInst=d,this.type=l,this.nativeEvent=_,this.target=w,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(n=i[a],this[a]=n?n(_):_[a]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?y_:kS,this.isPropagationStopped=kS,this}return Ui(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=y_)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=y_)},persist:function(){},isPersistent:y_}),e}var id={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},s1=To(id),Tp=Ui({},id,{view:0,detail:0}),IP=To(Tp),R0,F0,Ef,Ug=Ui({},Tp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:a1,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ef&&(Ef&&i.type==="mousemove"?(R0=i.screenX-Ef.screenX,F0=i.screenY-Ef.screenY):F0=R0=0,Ef=i),R0)},movementY:function(i){return"movementY"in i?i.movementY:F0}}),RS=To(Ug),PP=Ui({},Ug,{dataTransfer:0}),LP=To(PP),DP=Ui({},Tp,{relatedTarget:0}),B0=To(DP),zP=Ui({},id,{animationName:0,elapsedTime:0,pseudoElement:0}),kP=To(zP),RP=Ui({},id,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),FP=To(RP),BP=Ui({},id,{data:0}),FS=To(BP),OP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},NP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VP(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=UP[i])?!!e[i]:!1}function a1(){return VP}var GP=Ui({},Tp,{key:function(i){if(i.key){var e=OP[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=tg(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?NP[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:a1,charCode:function(i){return i.type==="keypress"?tg(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?tg(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),jP=To(GP),WP=Ui({},Ug,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),BS=To(WP),HP=Ui({},Tp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:a1}),$P=To(HP),qP=Ui({},id,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZP=To(qP),XP=Ui({},Ug,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),YP=To(XP),KP=[9,13,27,32],l1=xa&&"CompositionEvent"in window,Hf=null;xa&&"documentMode"in document&&(Hf=document.documentMode);var JP=xa&&"TextEvent"in window&&!Hf,JT=xa&&(!l1||Hf&&8<Hf&&11>=Hf),OS=String.fromCharCode(32),NS=!1;function QT(i,e){switch(i){case"keyup":return KP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eE(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Sh=!1;function QP(i,e){switch(i){case"compositionend":return eE(e);case"keypress":return e.which!==32?null:(NS=!0,OS);case"textInput":return i=e.data,i===OS&&NS?null:i;default:return null}}function eL(i,e){if(Sh)return i==="compositionend"||!l1&&QT(i,e)?(i=KT(),eg=o1=ml=null,Sh=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return JT&&e.locale!=="ko"?null:e.data;default:return null}}var tL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function US(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!tL[i.type]:e==="textarea"}function tE(i,e,n,l){DT(l),e=xg(e,"onChange"),0<e.length&&(n=new s1("onChange","change",null,n,l),i.push({event:n,listeners:e}))}var $f=null,ap=null;function nL(i){dE(i,0)}function Vg(i){var e=Eh(i);if(TT(e))return i}function iL(i,e){if(i==="change")return e}var nE=!1;if(xa){var O0;if(xa){var N0="oninput"in document;if(!N0){var VS=document.createElement("div");VS.setAttribute("oninput","return;"),N0=typeof VS.oninput=="function"}O0=N0}else O0=!1;nE=O0&&(!document.documentMode||9<document.documentMode)}function GS(){$f&&($f.detachEvent("onpropertychange",iE),ap=$f=null)}function iE(i){if(i.propertyName==="value"&&Vg(ap)){var e=[];tE(e,ap,i,e1(i)),FT(nL,e)}}function rL(i,e,n){i==="focusin"?(GS(),$f=e,ap=n,$f.attachEvent("onpropertychange",iE)):i==="focusout"&&GS()}function oL(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Vg(ap)}function sL(i,e){if(i==="click")return Vg(e)}function aL(i,e){if(i==="input"||i==="change")return Vg(e)}function lL(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var fs=typeof Object.is=="function"?Object.is:lL;function lp(i,e){if(fs(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var n=Object.keys(i),l=Object.keys(e);if(n.length!==l.length)return!1;for(l=0;l<n.length;l++){var d=n[l];if(!Bx.call(e,d)||!fs(i[d],e[d]))return!1}return!0}function jS(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function WS(i,e){var n=jS(i);i=0;for(var l;n;){if(n.nodeType===3){if(l=i+n.textContent.length,i<=e&&l>=e)return{node:n,offset:e-i};i=l}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=jS(n)}}function rE(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?rE(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function oE(){for(var i=window,e=dg();e instanceof i.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)i=e.contentWindow;else break;e=dg(i.document)}return e}function c1(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function cL(i){var e=oE(),n=i.focusedElem,l=i.selectionRange;if(e!==n&&n&&n.ownerDocument&&rE(n.ownerDocument.documentElement,n)){if(l!==null&&c1(n)){if(e=l.start,i=l.end,i===void 0&&(i=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(i,n.value.length);else if(i=(e=n.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var d=n.textContent.length,_=Math.min(l.start,d);l=l.end===void 0?_:Math.min(l.end,d),!i.extend&&_>l&&(d=l,l=_,_=d),d=WS(n,_);var w=WS(n,l);d&&w&&(i.rangeCount!==1||i.anchorNode!==d.node||i.anchorOffset!==d.offset||i.focusNode!==w.node||i.focusOffset!==w.offset)&&(e=e.createRange(),e.setStart(d.node,d.offset),i.removeAllRanges(),_>l?(i.addRange(e),i.extend(w.node,w.offset)):(e.setEnd(w.node,w.offset),i.addRange(e)))}}for(e=[],i=n;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)i=e[n],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var uL=xa&&"documentMode"in document&&11>=document.documentMode,Mh=null,nv=null,qf=null,iv=!1;function HS(i,e,n){var l=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;iv||Mh==null||Mh!==dg(l)||(l=Mh,"selectionStart"in l&&c1(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),qf&&lp(qf,l)||(qf=l,l=xg(nv,"onSelect"),0<l.length&&(e=new s1("onSelect","select",null,e,n),i.push({event:e,listeners:l}),e.target=Mh)))}function x_(i,e){var n={};return n[i.toLowerCase()]=e.toLowerCase(),n["Webkit"+i]="webkit"+e,n["Moz"+i]="moz"+e,n}var Th={animationend:x_("Animation","AnimationEnd"),animationiteration:x_("Animation","AnimationIteration"),animationstart:x_("Animation","AnimationStart"),transitionend:x_("Transition","TransitionEnd")},U0={},sE={};xa&&(sE=document.createElement("div").style,"AnimationEvent"in window||(delete Th.animationend.animation,delete Th.animationiteration.animation,delete Th.animationstart.animation),"TransitionEvent"in window||delete Th.transitionend.transition);function Gg(i){if(U0[i])return U0[i];if(!Th[i])return i;var e=Th[i],n;for(n in e)if(e.hasOwnProperty(n)&&n in sE)return U0[i]=e[n];return i}var aE=Gg("animationend"),lE=Gg("animationiteration"),cE=Gg("animationstart"),uE=Gg("transitionend"),hE=new Map,$S="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ll(i,e){hE.set(i,e),qc(e,[i])}for(var V0=0;V0<$S.length;V0++){var G0=$S[V0],hL=G0.toLowerCase(),dL=G0[0].toUpperCase()+G0.slice(1);Ll(hL,"on"+dL)}Ll(aE,"onAnimationEnd");Ll(lE,"onAnimationIteration");Ll(cE,"onAnimationStart");Ll("dblclick","onDoubleClick");Ll("focusin","onFocus");Ll("focusout","onBlur");Ll(uE,"onTransitionEnd");Wh("onMouseEnter",["mouseout","mouseover"]);Wh("onMouseLeave",["mouseout","mouseover"]);Wh("onPointerEnter",["pointerout","pointerover"]);Wh("onPointerLeave",["pointerout","pointerover"]);qc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qc("onBeforeInput",["compositionend","keypress","textInput","paste"]);qc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nf));function qS(i,e,n){var l=i.type||"unknown-event";i.currentTarget=n,hP(l,e,void 0,i),i.currentTarget=null}function dE(i,e){e=(e&4)!==0;for(var n=0;n<i.length;n++){var l=i[n],d=l.event;l=l.listeners;e:{var _=void 0;if(e)for(var w=l.length-1;0<=w;w--){var a=l[w],T=a.instance,A=a.currentTarget;if(a=a.listener,T!==_&&d.isPropagationStopped())break e;qS(d,a,A),_=T}else for(w=0;w<l.length;w++){if(a=l[w],T=a.instance,A=a.currentTarget,a=a.listener,T!==_&&d.isPropagationStopped())break e;qS(d,a,A),_=T}}}if(pg)throw i=Jx,pg=!1,Jx=null,i}function Si(i,e){var n=e[lv];n===void 0&&(n=e[lv]=new Set);var l=i+"__bubble";n.has(l)||(fE(e,i,2,!1),n.add(l))}function j0(i,e,n){var l=0;e&&(l|=4),fE(n,i,l,e)}var v_="_reactListening"+Math.random().toString(36).slice(2);function cp(i){if(!i[v_]){i[v_]=!0,vT.forEach(function(n){n!=="selectionchange"&&(fL.has(n)||j0(n,!1,i),j0(n,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[v_]||(e[v_]=!0,j0("selectionchange",!1,e))}}function fE(i,e,n,l){switch(YT(e)){case 1:var d=CP;break;case 4:d=AP;break;default:d=r1}n=d.bind(null,e,n,i),d=void 0,!Kx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(d=!0),l?d!==void 0?i.addEventListener(e,n,{capture:!0,passive:d}):i.addEventListener(e,n,!0):d!==void 0?i.addEventListener(e,n,{passive:d}):i.addEventListener(e,n,!1)}function W0(i,e,n,l,d){var _=l;if((e&1)===0&&(e&2)===0&&l!==null)e:for(;;){if(l===null)return;var w=l.tag;if(w===3||w===4){var a=l.stateNode.containerInfo;if(a===d||a.nodeType===8&&a.parentNode===d)break;if(w===4)for(w=l.return;w!==null;){var T=w.tag;if((T===3||T===4)&&(T=w.stateNode.containerInfo,T===d||T.nodeType===8&&T.parentNode===d))return;w=w.return}for(;a!==null;){if(w=Cc(a),w===null)return;if(T=w.tag,T===5||T===6){l=_=w;continue e}a=a.parentNode}}l=l.return}FT(function(){var A=_,D=e1(n),P=[];e:{var k=hE.get(i);if(k!==void 0){var W=s1,Z=i;switch(i){case"keypress":if(tg(n)===0)break e;case"keydown":case"keyup":W=jP;break;case"focusin":Z="focus",W=B0;break;case"focusout":Z="blur",W=B0;break;case"beforeblur":case"afterblur":W=B0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=RS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=LP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=$P;break;case aE:case lE:case cE:W=kP;break;case uE:W=ZP;break;case"scroll":W=IP;break;case"wheel":W=YP;break;case"copy":case"cut":case"paste":W=FP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=BS}var F=(e&4)!==0,B=!F&&i==="scroll",G=F?k!==null?k+"Capture":null:k;F=[];for(var $=A,ne;$!==null;){ne=$;var me=ne.stateNode;if(ne.tag===5&&me!==null&&(ne=me,G!==null&&(me=ip($,G),me!=null&&F.push(up($,me,ne)))),B)break;$=$.return}0<F.length&&(k=new W(k,Z,null,n,D),P.push({event:k,listeners:F}))}}if((e&7)===0){e:{if(k=i==="mouseover"||i==="pointerover",W=i==="mouseout"||i==="pointerout",k&&n!==Xx&&(Z=n.relatedTarget||n.fromElement)&&(Cc(Z)||Z[va]))break e;if((W||k)&&(k=D.window===D?D:(k=D.ownerDocument)?k.defaultView||k.parentWindow:window,W?(Z=n.relatedTarget||n.toElement,W=A,Z=Z?Cc(Z):null,Z!==null&&(B=Zc(Z),Z!==B||Z.tag!==5&&Z.tag!==6)&&(Z=null)):(W=null,Z=A),W!==Z)){if(F=RS,me="onMouseLeave",G="onMouseEnter",$="mouse",(i==="pointerout"||i==="pointerover")&&(F=BS,me="onPointerLeave",G="onPointerEnter",$="pointer"),B=W==null?k:Eh(W),ne=Z==null?k:Eh(Z),k=new F(me,$+"leave",W,n,D),k.target=B,k.relatedTarget=ne,me=null,Cc(D)===A&&(F=new F(G,$+"enter",Z,n,D),F.target=ne,F.relatedTarget=B,me=F),B=me,W&&Z)t:{for(F=W,G=Z,$=0,ne=F;ne;ne=eh(ne))$++;for(ne=0,me=G;me;me=eh(me))ne++;for(;0<$-ne;)F=eh(F),$--;for(;0<ne-$;)G=eh(G),ne--;for(;$--;){if(F===G||G!==null&&F===G.alternate)break t;F=eh(F),G=eh(G)}F=null}else F=null;W!==null&&ZS(P,k,W,F,!1),Z!==null&&B!==null&&ZS(P,B,Z,F,!0)}}e:{if(k=A?Eh(A):window,W=k.nodeName&&k.nodeName.toLowerCase(),W==="select"||W==="input"&&k.type==="file")var K=iL;else if(US(k))if(nE)K=aL;else{K=oL;var Ee=rL}else(W=k.nodeName)&&W.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(K=sL);if(K&&(K=K(i,A))){tE(P,K,n,D);break e}Ee&&Ee(i,k,A),i==="focusout"&&(Ee=k._wrapperState)&&Ee.controlled&&k.type==="number"&&Wx(k,"number",k.value)}switch(Ee=A?Eh(A):window,i){case"focusin":(US(Ee)||Ee.contentEditable==="true")&&(Mh=Ee,nv=A,qf=null);break;case"focusout":qf=nv=Mh=null;break;case"mousedown":iv=!0;break;case"contextmenu":case"mouseup":case"dragend":iv=!1,HS(P,n,D);break;case"selectionchange":if(uL)break;case"keydown":case"keyup":HS(P,n,D)}var Te;if(l1)e:{switch(i){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else Sh?QT(i,n)&&(ee="onCompositionEnd"):i==="keydown"&&n.keyCode===229&&(ee="onCompositionStart");ee&&(JT&&n.locale!=="ko"&&(Sh||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&Sh&&(Te=KT()):(ml=D,o1="value"in ml?ml.value:ml.textContent,Sh=!0)),Ee=xg(A,ee),0<Ee.length&&(ee=new FS(ee,i,null,n,D),P.push({event:ee,listeners:Ee}),Te?ee.data=Te:(Te=eE(n),Te!==null&&(ee.data=Te)))),(Te=JP?QP(i,n):eL(i,n))&&(A=xg(A,"onBeforeInput"),0<A.length&&(D=new FS("onBeforeInput","beforeinput",null,n,D),P.push({event:D,listeners:A}),D.data=Te))}dE(P,e)})}function up(i,e,n){return{instance:i,listener:e,currentTarget:n}}function xg(i,e){for(var n=e+"Capture",l=[];i!==null;){var d=i,_=d.stateNode;d.tag===5&&_!==null&&(d=_,_=ip(i,n),_!=null&&l.unshift(up(i,_,d)),_=ip(i,e),_!=null&&l.push(up(i,_,d))),i=i.return}return l}function eh(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function ZS(i,e,n,l,d){for(var _=e._reactName,w=[];n!==null&&n!==l;){var a=n,T=a.alternate,A=a.stateNode;if(T!==null&&T===l)break;a.tag===5&&A!==null&&(a=A,d?(T=ip(n,_),T!=null&&w.unshift(up(n,T,a))):d||(T=ip(n,_),T!=null&&w.push(up(n,T,a)))),n=n.return}w.length!==0&&i.push({event:e,listeners:w})}var pL=/\r\n?/g,mL=/\u0000|\uFFFD/g;function XS(i){return(typeof i=="string"?i:""+i).replace(pL,`
`).replace(mL,"")}function w_(i,e,n){if(e=XS(e),XS(i)!==e&&n)throw Error(Dt(425))}function vg(){}var rv=null,ov=null;function sv(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var av=typeof setTimeout=="function"?setTimeout:void 0,_L=typeof clearTimeout=="function"?clearTimeout:void 0,YS=typeof Promise=="function"?Promise:void 0,gL=typeof queueMicrotask=="function"?queueMicrotask:typeof YS!="undefined"?function(i){return YS.resolve(null).then(i).catch(yL)}:av;function yL(i){setTimeout(function(){throw i})}function H0(i,e){var n=e,l=0;do{var d=n.nextSibling;if(i.removeChild(n),d&&d.nodeType===8)if(n=d.data,n==="/$"){if(l===0){i.removeChild(d),sp(e);return}l--}else n!=="$"&&n!=="$?"&&n!=="$!"||l++;n=d}while(n);sp(e)}function vl(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function KS(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var n=i.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return i;e--}else n==="/$"&&e++}i=i.previousSibling}return null}var rd=Math.random().toString(36).slice(2),Rs="__reactFiber$"+rd,hp="__reactProps$"+rd,va="__reactContainer$"+rd,lv="__reactEvents$"+rd,xL="__reactListeners$"+rd,vL="__reactHandles$"+rd;function Cc(i){var e=i[Rs];if(e)return e;for(var n=i.parentNode;n;){if(e=n[va]||n[Rs]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(i=KS(i);i!==null;){if(n=i[Rs])return n;i=KS(i)}return e}i=n,n=i.parentNode}return null}function Ep(i){return i=i[Rs]||i[va],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Eh(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Dt(33))}function jg(i){return i[hp]||null}var cv=[],Ch=-1;function Dl(i){return{current:i}}function Ti(i){0>Ch||(i.current=cv[Ch],cv[Ch]=null,Ch--)}function xi(i,e){Ch++,cv[Ch]=i.current,i.current=e}var Al={},Rr=Dl(Al),ao=Dl(!1),Nc=Al;function Hh(i,e){var n=i.type.contextTypes;if(!n)return Al;var l=i.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===e)return l.__reactInternalMemoizedMaskedChildContext;var d={},_;for(_ in n)d[_]=e[_];return l&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=d),d}function lo(i){return i=i.childContextTypes,i!=null}function wg(){Ti(ao),Ti(Rr)}function JS(i,e,n){if(Rr.current!==Al)throw Error(Dt(168));xi(Rr,e),xi(ao,n)}function pE(i,e,n){var l=i.stateNode;if(e=e.childContextTypes,typeof l.getChildContext!="function")return n;l=l.getChildContext();for(var d in l)if(!(d in e))throw Error(Dt(108,rP(i)||"Unknown",d));return Ui({},n,l)}function bg(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Al,Nc=Rr.current,xi(Rr,i),xi(ao,ao.current),!0}function QS(i,e,n){var l=i.stateNode;if(!l)throw Error(Dt(169));n?(i=pE(i,e,Nc),l.__reactInternalMemoizedMergedChildContext=i,Ti(ao),Ti(Rr),xi(Rr,i)):Ti(ao),xi(ao,n)}var fa=null,Wg=!1,$0=!1;function mE(i){fa===null?fa=[i]:fa.push(i)}function wL(i){Wg=!0,mE(i)}function zl(){if(!$0&&fa!==null){$0=!0;var i=0,e=ai;try{var n=fa;for(ai=1;i<n.length;i++){var l=n[i];do l=l(!0);while(l!==null)}fa=null,Wg=!1}catch(d){throw fa!==null&&(fa=fa.slice(i+1)),UT(t1,zl),d}finally{ai=e,$0=!1}}return null}var Ah=[],Ih=0,Sg=null,Mg=0,Fo=[],Bo=0,Uc=null,pa=1,ma="";function bc(i,e){Ah[Ih++]=Mg,Ah[Ih++]=Sg,Sg=i,Mg=e}function _E(i,e,n){Fo[Bo++]=pa,Fo[Bo++]=ma,Fo[Bo++]=Uc,Uc=i;var l=pa;i=ma;var d=32-us(l)-1;l&=~(1<<d),n+=1;var _=32-us(e)+d;if(30<_){var w=d-d%5;_=(l&(1<<w)-1).toString(32),l>>=w,d-=w,pa=1<<32-us(e)+d|n<<d|l,ma=_+i}else pa=1<<_|n<<d|l,ma=i}function u1(i){i.return!==null&&(bc(i,1),_E(i,1,0))}function h1(i){for(;i===Sg;)Sg=Ah[--Ih],Ah[Ih]=null,Mg=Ah[--Ih],Ah[Ih]=null;for(;i===Uc;)Uc=Fo[--Bo],Fo[Bo]=null,ma=Fo[--Bo],Fo[Bo]=null,pa=Fo[--Bo],Fo[Bo]=null}var bo=null,wo=null,Di=!1,as=null;function gE(i,e){var n=No(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=i,e=i.deletions,e===null?(i.deletions=[n],i.flags|=16):e.push(n)}function eM(i,e){switch(i.tag){case 5:var n=i.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,bo=i,wo=vl(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,bo=i,wo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Uc!==null?{id:pa,overflow:ma}:null,i.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=No(18,null,null,0),n.stateNode=e,n.return=i,i.child=n,bo=i,wo=null,!0):!1;default:return!1}}function uv(i){return(i.mode&1)!==0&&(i.flags&128)===0}function hv(i){if(Di){var e=wo;if(e){var n=e;if(!eM(i,e)){if(uv(i))throw Error(Dt(418));e=vl(n.nextSibling);var l=bo;e&&eM(i,e)?gE(l,n):(i.flags=i.flags&-4097|2,Di=!1,bo=i)}}else{if(uv(i))throw Error(Dt(418));i.flags=i.flags&-4097|2,Di=!1,bo=i}}}function tM(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;bo=i}function b_(i){if(i!==bo)return!1;if(!Di)return tM(i),Di=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!sv(i.type,i.memoizedProps)),e&&(e=wo)){if(uv(i))throw yE(),Error(Dt(418));for(;e;)gE(i,e),e=vl(e.nextSibling)}if(tM(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Dt(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var n=i.data;if(n==="/$"){if(e===0){wo=vl(i.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}i=i.nextSibling}wo=null}}else wo=bo?vl(i.stateNode.nextSibling):null;return!0}function yE(){for(var i=wo;i;)i=vl(i.nextSibling)}function $h(){wo=bo=null,Di=!1}function d1(i){as===null?as=[i]:as.push(i)}var bL=Ma.ReactCurrentBatchConfig;function os(i,e){if(i&&i.defaultProps){e=Ui({},e),i=i.defaultProps;for(var n in i)e[n]===void 0&&(e[n]=i[n]);return e}return e}var Tg=Dl(null),Eg=null,Ph=null,f1=null;function p1(){f1=Ph=Eg=null}function m1(i){var e=Tg.current;Ti(Tg),i._currentValue=e}function dv(i,e,n){for(;i!==null;){var l=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,l!==null&&(l.childLanes|=e)):l!==null&&(l.childLanes&e)!==e&&(l.childLanes|=e),i===n)break;i=i.return}}function Nh(i,e){Eg=i,f1=Ph=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&e)!==0&&(so=!0),i.firstContext=null)}function Vo(i){var e=i._currentValue;if(f1!==i)if(i={context:i,memoizedValue:e,next:null},Ph===null){if(Eg===null)throw Error(Dt(308));Ph=i,Eg.dependencies={lanes:0,firstContext:i}}else Ph=Ph.next=i;return e}var Ac=null;function _1(i){Ac===null?Ac=[i]:Ac.push(i)}function xE(i,e,n,l){var d=e.interleaved;return d===null?(n.next=n,_1(e)):(n.next=d.next,d.next=n),e.interleaved=n,wa(i,l)}function wa(i,e){i.lanes|=e;var n=i.alternate;for(n!==null&&(n.lanes|=e),n=i,i=i.return;i!==null;)i.childLanes|=e,n=i.alternate,n!==null&&(n.childLanes|=e),n=i,i=i.return;return n.tag===3?n.stateNode:null}var dl=!1;function g1(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vE(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function ga(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function wl(i,e,n){var l=i.updateQueue;if(l===null)return null;if(l=l.shared,(Jn&2)!==0){var d=l.pending;return d===null?e.next=e:(e.next=d.next,d.next=e),l.pending=e,wa(i,n)}return d=l.interleaved,d===null?(e.next=e,_1(l)):(e.next=d.next,d.next=e),l.interleaved=e,wa(i,n)}function ng(i,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var l=e.lanes;l&=i.pendingLanes,n|=l,e.lanes=n,n1(i,n)}}function nM(i,e){var n=i.updateQueue,l=i.alternate;if(l!==null&&(l=l.updateQueue,n===l)){var d=null,_=null;if(n=n.firstBaseUpdate,n!==null){do{var w={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};_===null?d=_=w:_=_.next=w,n=n.next}while(n!==null);_===null?d=_=e:_=_.next=e}else d=_=e;n={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:_,shared:l.shared,effects:l.effects},i.updateQueue=n;return}i=n.lastBaseUpdate,i===null?n.firstBaseUpdate=e:i.next=e,n.lastBaseUpdate=e}function Cg(i,e,n,l){var d=i.updateQueue;dl=!1;var _=d.firstBaseUpdate,w=d.lastBaseUpdate,a=d.shared.pending;if(a!==null){d.shared.pending=null;var T=a,A=T.next;T.next=null,w===null?_=A:w.next=A,w=T;var D=i.alternate;D!==null&&(D=D.updateQueue,a=D.lastBaseUpdate,a!==w&&(a===null?D.firstBaseUpdate=A:a.next=A,D.lastBaseUpdate=T))}if(_!==null){var P=d.baseState;w=0,D=A=T=null,a=_;do{var k=a.lane,W=a.eventTime;if((l&k)===k){D!==null&&(D=D.next={eventTime:W,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var Z=i,F=a;switch(k=e,W=n,F.tag){case 1:if(Z=F.payload,typeof Z=="function"){P=Z.call(W,P,k);break e}P=Z;break e;case 3:Z.flags=Z.flags&-65537|128;case 0:if(Z=F.payload,k=typeof Z=="function"?Z.call(W,P,k):Z,k==null)break e;P=Ui({},P,k);break e;case 2:dl=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,k=d.effects,k===null?d.effects=[a]:k.push(a))}else W={eventTime:W,lane:k,tag:a.tag,payload:a.payload,callback:a.callback,next:null},D===null?(A=D=W,T=P):D=D.next=W,w|=k;if(a=a.next,a===null){if(a=d.shared.pending,a===null)break;k=a,a=k.next,k.next=null,d.lastBaseUpdate=k,d.shared.pending=null}}while(1);if(D===null&&(T=P),d.baseState=T,d.firstBaseUpdate=A,d.lastBaseUpdate=D,e=d.shared.interleaved,e!==null){d=e;do w|=d.lane,d=d.next;while(d!==e)}else _===null&&(d.shared.lanes=0);Gc|=w,i.lanes=w,i.memoizedState=P}}function iM(i,e,n){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var l=i[e],d=l.callback;if(d!==null){if(l.callback=null,l=n,typeof d!="function")throw Error(Dt(191,d));d.call(l)}}}var wE=new xT.Component().refs;function fv(i,e,n,l){e=i.memoizedState,n=n(l,e),n=n==null?e:Ui({},e,n),i.memoizedState=n,i.lanes===0&&(i.updateQueue.baseState=n)}var Hg={isMounted:function(i){return(i=i._reactInternals)?Zc(i)===i:!1},enqueueSetState:function(i,e,n){i=i._reactInternals;var l=Vr(),d=Sl(i),_=ga(l,d);_.payload=e,n!=null&&(_.callback=n),e=wl(i,_,d),e!==null&&(hs(e,i,d,l),ng(e,i,d))},enqueueReplaceState:function(i,e,n){i=i._reactInternals;var l=Vr(),d=Sl(i),_=ga(l,d);_.tag=1,_.payload=e,n!=null&&(_.callback=n),e=wl(i,_,d),e!==null&&(hs(e,i,d,l),ng(e,i,d))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var n=Vr(),l=Sl(i),d=ga(n,l);d.tag=2,e!=null&&(d.callback=e),e=wl(i,d,l),e!==null&&(hs(e,i,l,n),ng(e,i,l))}};function rM(i,e,n,l,d,_,w){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(l,_,w):e.prototype&&e.prototype.isPureReactComponent?!lp(n,l)||!lp(d,_):!0}function bE(i,e,n){var l=!1,d=Al,_=e.contextType;return typeof _=="object"&&_!==null?_=Vo(_):(d=lo(e)?Nc:Rr.current,l=e.contextTypes,_=(l=l!=null)?Hh(i,d):Al),e=new e(n,_),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Hg,i.stateNode=e,e._reactInternals=i,l&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=d,i.__reactInternalMemoizedMaskedChildContext=_),e}function oM(i,e,n,l){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,l),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,l),e.state!==i&&Hg.enqueueReplaceState(e,e.state,null)}function pv(i,e,n,l){var d=i.stateNode;d.props=n,d.state=i.memoizedState,d.refs=wE,g1(i);var _=e.contextType;typeof _=="object"&&_!==null?d.context=Vo(_):(_=lo(e)?Nc:Rr.current,d.context=Hh(i,_)),d.state=i.memoizedState,_=e.getDerivedStateFromProps,typeof _=="function"&&(fv(i,e,_,n),d.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(e=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),e!==d.state&&Hg.enqueueReplaceState(d,d.state,null),Cg(i,n,d,l),d.state=i.memoizedState),typeof d.componentDidMount=="function"&&(i.flags|=4194308)}function Cf(i,e,n){if(i=n.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Dt(309));var l=n.stateNode}if(!l)throw Error(Dt(147,i));var d=l,_=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===_?e.ref:(e=function(w){var a=d.refs;a===wE&&(a=d.refs={}),w===null?delete a[_]:a[_]=w},e._stringRef=_,e)}if(typeof i!="string")throw Error(Dt(284));if(!n._owner)throw Error(Dt(290,i))}return i}function S_(i,e){throw i=Object.prototype.toString.call(e),Error(Dt(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function sM(i){var e=i._init;return e(i._payload)}function SE(i){function e(G,$){if(i){var ne=G.deletions;ne===null?(G.deletions=[$],G.flags|=16):ne.push($)}}function n(G,$){if(!i)return null;for(;$!==null;)e(G,$),$=$.sibling;return null}function l(G,$){for(G=new Map;$!==null;)$.key!==null?G.set($.key,$):G.set($.index,$),$=$.sibling;return G}function d(G,$){return G=Ml(G,$),G.index=0,G.sibling=null,G}function _(G,$,ne){return G.index=ne,i?(ne=G.alternate,ne!==null?(ne=ne.index,ne<$?(G.flags|=2,$):ne):(G.flags|=2,$)):(G.flags|=1048576,$)}function w(G){return i&&G.alternate===null&&(G.flags|=2),G}function a(G,$,ne,me){return $===null||$.tag!==6?($=Q0(ne,G.mode,me),$.return=G,$):($=d($,ne),$.return=G,$)}function T(G,$,ne,me){var K=ne.type;return K===bh?D(G,$,ne.props.children,me,ne.key):$!==null&&($.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===hl&&sM(K)===$.type)?(me=d($,ne.props),me.ref=Cf(G,$,ne),me.return=G,me):(me=lg(ne.type,ne.key,ne.props,null,G.mode,me),me.ref=Cf(G,$,ne),me.return=G,me)}function A(G,$,ne,me){return $===null||$.tag!==4||$.stateNode.containerInfo!==ne.containerInfo||$.stateNode.implementation!==ne.implementation?($=ex(ne,G.mode,me),$.return=G,$):($=d($,ne.children||[]),$.return=G,$)}function D(G,$,ne,me,K){return $===null||$.tag!==7?($=Rc(ne,G.mode,me,K),$.return=G,$):($=d($,ne),$.return=G,$)}function P(G,$,ne){if(typeof $=="string"&&$!==""||typeof $=="number")return $=Q0(""+$,G.mode,ne),$.return=G,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case d_:return ne=lg($.type,$.key,$.props,null,G.mode,ne),ne.ref=Cf(G,null,$),ne.return=G,ne;case wh:return $=ex($,G.mode,ne),$.return=G,$;case hl:var me=$._init;return P(G,me($._payload),ne)}if(Bf($)||bf($))return $=Rc($,G.mode,ne,null),$.return=G,$;S_(G,$)}return null}function k(G,$,ne,me){var K=$!==null?$.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number")return K!==null?null:a(G,$,""+ne,me);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case d_:return ne.key===K?T(G,$,ne,me):null;case wh:return ne.key===K?A(G,$,ne,me):null;case hl:return K=ne._init,k(G,$,K(ne._payload),me)}if(Bf(ne)||bf(ne))return K!==null?null:D(G,$,ne,me,null);S_(G,ne)}return null}function W(G,$,ne,me,K){if(typeof me=="string"&&me!==""||typeof me=="number")return G=G.get(ne)||null,a($,G,""+me,K);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case d_:return G=G.get(me.key===null?ne:me.key)||null,T($,G,me,K);case wh:return G=G.get(me.key===null?ne:me.key)||null,A($,G,me,K);case hl:var Ee=me._init;return W(G,$,ne,Ee(me._payload),K)}if(Bf(me)||bf(me))return G=G.get(ne)||null,D($,G,me,K,null);S_($,me)}return null}function Z(G,$,ne,me){for(var K=null,Ee=null,Te=$,ee=$=0,Ae=null;Te!==null&&ee<ne.length;ee++){Te.index>ee?(Ae=Te,Te=null):Ae=Te.sibling;var Fe=k(G,Te,ne[ee],me);if(Fe===null){Te===null&&(Te=Ae);break}i&&Te&&Fe.alternate===null&&e(G,Te),$=_(Fe,$,ee),Ee===null?K=Fe:Ee.sibling=Fe,Ee=Fe,Te=Ae}if(ee===ne.length)return n(G,Te),Di&&bc(G,ee),K;if(Te===null){for(;ee<ne.length;ee++)Te=P(G,ne[ee],me),Te!==null&&($=_(Te,$,ee),Ee===null?K=Te:Ee.sibling=Te,Ee=Te);return Di&&bc(G,ee),K}for(Te=l(G,Te);ee<ne.length;ee++)Ae=W(Te,G,ee,ne[ee],me),Ae!==null&&(i&&Ae.alternate!==null&&Te.delete(Ae.key===null?ee:Ae.key),$=_(Ae,$,ee),Ee===null?K=Ae:Ee.sibling=Ae,Ee=Ae);return i&&Te.forEach(function(qe){return e(G,qe)}),Di&&bc(G,ee),K}function F(G,$,ne,me){var K=bf(ne);if(typeof K!="function")throw Error(Dt(150));if(ne=K.call(ne),ne==null)throw Error(Dt(151));for(var Ee=K=null,Te=$,ee=$=0,Ae=null,Fe=ne.next();Te!==null&&!Fe.done;ee++,Fe=ne.next()){Te.index>ee?(Ae=Te,Te=null):Ae=Te.sibling;var qe=k(G,Te,Fe.value,me);if(qe===null){Te===null&&(Te=Ae);break}i&&Te&&qe.alternate===null&&e(G,Te),$=_(qe,$,ee),Ee===null?K=qe:Ee.sibling=qe,Ee=qe,Te=Ae}if(Fe.done)return n(G,Te),Di&&bc(G,ee),K;if(Te===null){for(;!Fe.done;ee++,Fe=ne.next())Fe=P(G,Fe.value,me),Fe!==null&&($=_(Fe,$,ee),Ee===null?K=Fe:Ee.sibling=Fe,Ee=Fe);return Di&&bc(G,ee),K}for(Te=l(G,Te);!Fe.done;ee++,Fe=ne.next())Fe=W(Te,G,ee,Fe.value,me),Fe!==null&&(i&&Fe.alternate!==null&&Te.delete(Fe.key===null?ee:Fe.key),$=_(Fe,$,ee),Ee===null?K=Fe:Ee.sibling=Fe,Ee=Fe);return i&&Te.forEach(function(Pt){return e(G,Pt)}),Di&&bc(G,ee),K}function B(G,$,ne,me){if(typeof ne=="object"&&ne!==null&&ne.type===bh&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case d_:e:{for(var K=ne.key,Ee=$;Ee!==null;){if(Ee.key===K){if(K=ne.type,K===bh){if(Ee.tag===7){n(G,Ee.sibling),$=d(Ee,ne.props.children),$.return=G,G=$;break e}}else if(Ee.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===hl&&sM(K)===Ee.type){n(G,Ee.sibling),$=d(Ee,ne.props),$.ref=Cf(G,Ee,ne),$.return=G,G=$;break e}n(G,Ee);break}else e(G,Ee);Ee=Ee.sibling}ne.type===bh?($=Rc(ne.props.children,G.mode,me,ne.key),$.return=G,G=$):(me=lg(ne.type,ne.key,ne.props,null,G.mode,me),me.ref=Cf(G,$,ne),me.return=G,G=me)}return w(G);case wh:e:{for(Ee=ne.key;$!==null;){if($.key===Ee)if($.tag===4&&$.stateNode.containerInfo===ne.containerInfo&&$.stateNode.implementation===ne.implementation){n(G,$.sibling),$=d($,ne.children||[]),$.return=G,G=$;break e}else{n(G,$);break}else e(G,$);$=$.sibling}$=ex(ne,G.mode,me),$.return=G,G=$}return w(G);case hl:return Ee=ne._init,B(G,$,Ee(ne._payload),me)}if(Bf(ne))return Z(G,$,ne,me);if(bf(ne))return F(G,$,ne,me);S_(G,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"?(ne=""+ne,$!==null&&$.tag===6?(n(G,$.sibling),$=d($,ne),$.return=G,G=$):(n(G,$),$=Q0(ne,G.mode,me),$.return=G,G=$),w(G)):n(G,$)}return B}var qh=SE(!0),ME=SE(!1),Cp={},Ns=Dl(Cp),dp=Dl(Cp),fp=Dl(Cp);function Ic(i){if(i===Cp)throw Error(Dt(174));return i}function y1(i,e){switch(xi(fp,e),xi(dp,i),xi(Ns,Cp),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$x(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=$x(e,i)}Ti(Ns),xi(Ns,e)}function Zh(){Ti(Ns),Ti(dp),Ti(fp)}function TE(i){Ic(fp.current);var e=Ic(Ns.current),n=$x(e,i.type);e!==n&&(xi(dp,i),xi(Ns,n))}function x1(i){dp.current===i&&(Ti(Ns),Ti(dp))}var Oi=Dl(0);function Ag(i){for(var e=i;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var q0=[];function v1(){for(var i=0;i<q0.length;i++)q0[i]._workInProgressVersionPrimary=null;q0.length=0}var ig=Ma.ReactCurrentDispatcher,Z0=Ma.ReactCurrentBatchConfig,Vc=0,Ni=null,rr=null,dr=null,Ig=!1,Zf=!1,pp=0,SL=0;function Lr(){throw Error(Dt(321))}function w1(i,e){if(e===null)return!1;for(var n=0;n<e.length&&n<i.length;n++)if(!fs(i[n],e[n]))return!1;return!0}function b1(i,e,n,l,d,_){if(Vc=_,Ni=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ig.current=i===null||i.memoizedState===null?CL:AL,i=n(l,d),Zf){_=0;do{if(Zf=!1,pp=0,25<=_)throw Error(Dt(301));_+=1,dr=rr=null,e.updateQueue=null,ig.current=IL,i=n(l,d)}while(Zf)}if(ig.current=Pg,e=rr!==null&&rr.next!==null,Vc=0,dr=rr=Ni=null,Ig=!1,e)throw Error(Dt(300));return i}function S1(){var i=pp!==0;return pp=0,i}function zs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dr===null?Ni.memoizedState=dr=i:dr=dr.next=i,dr}function Go(){if(rr===null){var i=Ni.alternate;i=i!==null?i.memoizedState:null}else i=rr.next;var e=dr===null?Ni.memoizedState:dr.next;if(e!==null)dr=e,rr=i;else{if(i===null)throw Error(Dt(310));rr=i,i={memoizedState:rr.memoizedState,baseState:rr.baseState,baseQueue:rr.baseQueue,queue:rr.queue,next:null},dr===null?Ni.memoizedState=dr=i:dr=dr.next=i}return dr}function mp(i,e){return typeof e=="function"?e(i):e}function X0(i){var e=Go(),n=e.queue;if(n===null)throw Error(Dt(311));n.lastRenderedReducer=i;var l=rr,d=l.baseQueue,_=n.pending;if(_!==null){if(d!==null){var w=d.next;d.next=_.next,_.next=w}l.baseQueue=d=_,n.pending=null}if(d!==null){_=d.next,l=l.baseState;var a=w=null,T=null,A=_;do{var D=A.lane;if((Vc&D)===D)T!==null&&(T=T.next={lane:0,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),l=A.hasEagerState?A.eagerState:i(l,A.action);else{var P={lane:D,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null};T===null?(a=T=P,w=l):T=T.next=P,Ni.lanes|=D,Gc|=D}A=A.next}while(A!==null&&A!==_);T===null?w=l:T.next=a,fs(l,e.memoizedState)||(so=!0),e.memoizedState=l,e.baseState=w,e.baseQueue=T,n.lastRenderedState=l}if(i=n.interleaved,i!==null){d=i;do _=d.lane,Ni.lanes|=_,Gc|=_,d=d.next;while(d!==i)}else d===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Y0(i){var e=Go(),n=e.queue;if(n===null)throw Error(Dt(311));n.lastRenderedReducer=i;var l=n.dispatch,d=n.pending,_=e.memoizedState;if(d!==null){n.pending=null;var w=d=d.next;do _=i(_,w.action),w=w.next;while(w!==d);fs(_,e.memoizedState)||(so=!0),e.memoizedState=_,e.baseQueue===null&&(e.baseState=_),n.lastRenderedState=_}return[_,l]}function EE(){}function CE(i,e){var n=Ni,l=Go(),d=e(),_=!fs(l.memoizedState,d);if(_&&(l.memoizedState=d,so=!0),l=l.queue,M1(PE.bind(null,n,l,i),[i]),l.getSnapshot!==e||_||dr!==null&&dr.memoizedState.tag&1){if(n.flags|=2048,_p(9,IE.bind(null,n,l,d,e),void 0,null),fr===null)throw Error(Dt(349));(Vc&30)!==0||AE(n,e,d)}return d}function AE(i,e,n){i.flags|=16384,i={getSnapshot:e,value:n},e=Ni.updateQueue,e===null?(e={lastEffect:null,stores:null},Ni.updateQueue=e,e.stores=[i]):(n=e.stores,n===null?e.stores=[i]:n.push(i))}function IE(i,e,n,l){e.value=n,e.getSnapshot=l,LE(e)&&DE(i)}function PE(i,e,n){return n(function(){LE(e)&&DE(i)})}function LE(i){var e=i.getSnapshot;i=i.value;try{var n=e();return!fs(i,n)}catch{return!0}}function DE(i){var e=wa(i,1);e!==null&&hs(e,i,1,-1)}function aM(i){var e=zs();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mp,lastRenderedState:i},e.queue=i,i=i.dispatch=EL.bind(null,Ni,i),[e.memoizedState,i]}function _p(i,e,n,l){return i={tag:i,create:e,destroy:n,deps:l,next:null},e=Ni.updateQueue,e===null?(e={lastEffect:null,stores:null},Ni.updateQueue=e,e.lastEffect=i.next=i):(n=e.lastEffect,n===null?e.lastEffect=i.next=i:(l=n.next,n.next=i,i.next=l,e.lastEffect=i)),i}function zE(){return Go().memoizedState}function rg(i,e,n,l){var d=zs();Ni.flags|=i,d.memoizedState=_p(1|e,n,void 0,l===void 0?null:l)}function $g(i,e,n,l){var d=Go();l=l===void 0?null:l;var _=void 0;if(rr!==null){var w=rr.memoizedState;if(_=w.destroy,l!==null&&w1(l,w.deps)){d.memoizedState=_p(e,n,_,l);return}}Ni.flags|=i,d.memoizedState=_p(1|e,n,_,l)}function lM(i,e){return rg(8390656,8,i,e)}function M1(i,e){return $g(2048,8,i,e)}function kE(i,e){return $g(4,2,i,e)}function RE(i,e){return $g(4,4,i,e)}function FE(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function BE(i,e,n){return n=n!=null?n.concat([i]):null,$g(4,4,FE.bind(null,e,i),n)}function T1(){}function OE(i,e){var n=Go();e=e===void 0?null:e;var l=n.memoizedState;return l!==null&&e!==null&&w1(e,l[1])?l[0]:(n.memoizedState=[i,e],i)}function NE(i,e){var n=Go();e=e===void 0?null:e;var l=n.memoizedState;return l!==null&&e!==null&&w1(e,l[1])?l[0]:(i=i(),n.memoizedState=[i,e],i)}function UE(i,e,n){return(Vc&21)===0?(i.baseState&&(i.baseState=!1,so=!0),i.memoizedState=n):(fs(n,e)||(n=jT(),Ni.lanes|=n,Gc|=n,i.baseState=!0),e)}function ML(i,e){var n=ai;ai=n!==0&&4>n?n:4,i(!0);var l=Z0.transition;Z0.transition={};try{i(!1),e()}finally{ai=n,Z0.transition=l}}function VE(){return Go().memoizedState}function TL(i,e,n){var l=Sl(i);if(n={lane:l,action:n,hasEagerState:!1,eagerState:null,next:null},GE(i))jE(e,n);else if(n=xE(i,e,n,l),n!==null){var d=Vr();hs(n,i,l,d),WE(n,e,l)}}function EL(i,e,n){var l=Sl(i),d={lane:l,action:n,hasEagerState:!1,eagerState:null,next:null};if(GE(i))jE(e,d);else{var _=i.alternate;if(i.lanes===0&&(_===null||_.lanes===0)&&(_=e.lastRenderedReducer,_!==null))try{var w=e.lastRenderedState,a=_(w,n);if(d.hasEagerState=!0,d.eagerState=a,fs(a,w)){var T=e.interleaved;T===null?(d.next=d,_1(e)):(d.next=T.next,T.next=d),e.interleaved=d;return}}catch{}finally{}n=xE(i,e,d,l),n!==null&&(d=Vr(),hs(n,i,l,d),WE(n,e,l))}}function GE(i){var e=i.alternate;return i===Ni||e!==null&&e===Ni}function jE(i,e){Zf=Ig=!0;var n=i.pending;n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e}function WE(i,e,n){if((n&4194240)!==0){var l=e.lanes;l&=i.pendingLanes,n|=l,e.lanes=n,n1(i,n)}}var Pg={readContext:Vo,useCallback:Lr,useContext:Lr,useEffect:Lr,useImperativeHandle:Lr,useInsertionEffect:Lr,useLayoutEffect:Lr,useMemo:Lr,useReducer:Lr,useRef:Lr,useState:Lr,useDebugValue:Lr,useDeferredValue:Lr,useTransition:Lr,useMutableSource:Lr,useSyncExternalStore:Lr,useId:Lr,unstable_isNewReconciler:!1},CL={readContext:Vo,useCallback:function(i,e){return zs().memoizedState=[i,e===void 0?null:e],i},useContext:Vo,useEffect:lM,useImperativeHandle:function(i,e,n){return n=n!=null?n.concat([i]):null,rg(4194308,4,FE.bind(null,e,i),n)},useLayoutEffect:function(i,e){return rg(4194308,4,i,e)},useInsertionEffect:function(i,e){return rg(4,2,i,e)},useMemo:function(i,e){var n=zs();return e=e===void 0?null:e,i=i(),n.memoizedState=[i,e],i},useReducer:function(i,e,n){var l=zs();return e=n!==void 0?n(e):e,l.memoizedState=l.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},l.queue=i,i=i.dispatch=TL.bind(null,Ni,i),[l.memoizedState,i]},useRef:function(i){var e=zs();return i={current:i},e.memoizedState=i},useState:aM,useDebugValue:T1,useDeferredValue:function(i){return zs().memoizedState=i},useTransition:function(){var i=aM(!1),e=i[0];return i=ML.bind(null,i[1]),zs().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,n){var l=Ni,d=zs();if(Di){if(n===void 0)throw Error(Dt(407));n=n()}else{if(n=e(),fr===null)throw Error(Dt(349));(Vc&30)!==0||AE(l,e,n)}d.memoizedState=n;var _={value:n,getSnapshot:e};return d.queue=_,lM(PE.bind(null,l,_,i),[i]),l.flags|=2048,_p(9,IE.bind(null,l,_,n,e),void 0,null),n},useId:function(){var i=zs(),e=fr.identifierPrefix;if(Di){var n=ma,l=pa;n=(l&~(1<<32-us(l)-1)).toString(32)+n,e=":"+e+"R"+n,n=pp++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=SL++,e=":"+e+"r"+n.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},AL={readContext:Vo,useCallback:OE,useContext:Vo,useEffect:M1,useImperativeHandle:BE,useInsertionEffect:kE,useLayoutEffect:RE,useMemo:NE,useReducer:X0,useRef:zE,useState:function(){return X0(mp)},useDebugValue:T1,useDeferredValue:function(i){var e=Go();return UE(e,rr.memoizedState,i)},useTransition:function(){var i=X0(mp)[0],e=Go().memoizedState;return[i,e]},useMutableSource:EE,useSyncExternalStore:CE,useId:VE,unstable_isNewReconciler:!1},IL={readContext:Vo,useCallback:OE,useContext:Vo,useEffect:M1,useImperativeHandle:BE,useInsertionEffect:kE,useLayoutEffect:RE,useMemo:NE,useReducer:Y0,useRef:zE,useState:function(){return Y0(mp)},useDebugValue:T1,useDeferredValue:function(i){var e=Go();return rr===null?e.memoizedState=i:UE(e,rr.memoizedState,i)},useTransition:function(){var i=Y0(mp)[0],e=Go().memoizedState;return[i,e]},useMutableSource:EE,useSyncExternalStore:CE,useId:VE,unstable_isNewReconciler:!1};function Xh(i,e){try{var n="",l=e;do n+=iP(l),l=l.return;while(l);var d=n}catch(_){d=`
Error generating stack: `+_.message+`
`+_.stack}return{value:i,source:e,stack:d,digest:null}}function K0(i,e,n){return{value:i,source:null,stack:n!=null?n:null,digest:e!=null?e:null}}function mv(i,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var PL=typeof WeakMap=="function"?WeakMap:Map;function HE(i,e,n){n=ga(-1,n),n.tag=3,n.payload={element:null};var l=e.value;return n.callback=function(){Dg||(Dg=!0,Tv=l),mv(i,e)},n}function $E(i,e,n){n=ga(-1,n),n.tag=3;var l=i.type.getDerivedStateFromError;if(typeof l=="function"){var d=e.value;n.payload=function(){return l(d)},n.callback=function(){mv(i,e)}}var _=i.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(n.callback=function(){mv(i,e),typeof l!="function"&&(bl===null?bl=new Set([this]):bl.add(this));var w=e.stack;this.componentDidCatch(e.value,{componentStack:w!==null?w:""})}),n}function cM(i,e,n){var l=i.pingCache;if(l===null){l=i.pingCache=new PL;var d=new Set;l.set(e,d)}else d=l.get(e),d===void 0&&(d=new Set,l.set(e,d));d.has(n)||(d.add(n),i=WL.bind(null,i,e,n),e.then(i,i))}function uM(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function hM(i,e,n,l,d){return(i.mode&1)===0?(i===e?i.flags|=65536:(i.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ga(-1,1),e.tag=2,wl(n,e,1))),n.lanes|=1),i):(i.flags|=65536,i.lanes=d,i)}var LL=Ma.ReactCurrentOwner,so=!1;function Nr(i,e,n,l){e.child=i===null?ME(e,null,n,l):qh(e,i.child,n,l)}function dM(i,e,n,l,d){n=n.render;var _=e.ref;return Nh(e,d),l=b1(i,e,n,l,_,d),n=S1(),i!==null&&!so?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~d,ba(i,e,d)):(Di&&n&&u1(e),e.flags|=1,Nr(i,e,l,d),e.child)}function fM(i,e,n,l,d){if(i===null){var _=n.type;return typeof _=="function"&&!z1(_)&&_.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=_,qE(i,e,_,l,d)):(i=lg(n.type,null,l,e,e.mode,d),i.ref=e.ref,i.return=e,e.child=i)}if(_=i.child,(i.lanes&d)===0){var w=_.memoizedProps;if(n=n.compare,n=n!==null?n:lp,n(w,l)&&i.ref===e.ref)return ba(i,e,d)}return e.flags|=1,i=Ml(_,l),i.ref=e.ref,i.return=e,e.child=i}function qE(i,e,n,l,d){if(i!==null){var _=i.memoizedProps;if(lp(_,l)&&i.ref===e.ref)if(so=!1,e.pendingProps=l=_,(i.lanes&d)!==0)(i.flags&131072)!==0&&(so=!0);else return e.lanes=i.lanes,ba(i,e,d)}return _v(i,e,n,l,d)}function ZE(i,e,n){var l=e.pendingProps,d=l.children,_=i!==null?i.memoizedState:null;if(l.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},xi(Dh,xo),xo|=n;else{if((n&1073741824)===0)return i=_!==null?_.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,xi(Dh,xo),xo|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=_!==null?_.baseLanes:n,xi(Dh,xo),xo|=l}else _!==null?(l=_.baseLanes|n,e.memoizedState=null):l=n,xi(Dh,xo),xo|=l;return Nr(i,e,d,n),e.child}function XE(i,e){var n=e.ref;(i===null&&n!==null||i!==null&&i.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function _v(i,e,n,l,d){var _=lo(n)?Nc:Rr.current;return _=Hh(e,_),Nh(e,d),n=b1(i,e,n,l,_,d),l=S1(),i!==null&&!so?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~d,ba(i,e,d)):(Di&&l&&u1(e),e.flags|=1,Nr(i,e,n,d),e.child)}function pM(i,e,n,l,d){if(lo(n)){var _=!0;bg(e)}else _=!1;if(Nh(e,d),e.stateNode===null)og(i,e),bE(e,n,l),pv(e,n,l,d),l=!0;else if(i===null){var w=e.stateNode,a=e.memoizedProps;w.props=a;var T=w.context,A=n.contextType;typeof A=="object"&&A!==null?A=Vo(A):(A=lo(n)?Nc:Rr.current,A=Hh(e,A));var D=n.getDerivedStateFromProps,P=typeof D=="function"||typeof w.getSnapshotBeforeUpdate=="function";P||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(a!==l||T!==A)&&oM(e,w,l,A),dl=!1;var k=e.memoizedState;w.state=k,Cg(e,l,w,d),T=e.memoizedState,a!==l||k!==T||ao.current||dl?(typeof D=="function"&&(fv(e,n,D,l),T=e.memoizedState),(a=dl||rM(e,n,a,l,k,T,A))?(P||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(e.flags|=4194308)):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=l,e.memoizedState=T),w.props=l,w.state=T,w.context=A,l=a):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),l=!1)}else{w=e.stateNode,vE(i,e),a=e.memoizedProps,A=e.type===e.elementType?a:os(e.type,a),w.props=A,P=e.pendingProps,k=w.context,T=n.contextType,typeof T=="object"&&T!==null?T=Vo(T):(T=lo(n)?Nc:Rr.current,T=Hh(e,T));var W=n.getDerivedStateFromProps;(D=typeof W=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(a!==P||k!==T)&&oM(e,w,l,T),dl=!1,k=e.memoizedState,w.state=k,Cg(e,l,w,d);var Z=e.memoizedState;a!==P||k!==Z||ao.current||dl?(typeof W=="function"&&(fv(e,n,W,l),Z=e.memoizedState),(A=dl||rM(e,n,A,l,k,Z,T)||!1)?(D||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(l,Z,T),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(l,Z,T)),typeof w.componentDidUpdate=="function"&&(e.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof w.componentDidUpdate!="function"||a===i.memoizedProps&&k===i.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&k===i.memoizedState||(e.flags|=1024),e.memoizedProps=l,e.memoizedState=Z),w.props=l,w.state=Z,w.context=T,l=A):(typeof w.componentDidUpdate!="function"||a===i.memoizedProps&&k===i.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&k===i.memoizedState||(e.flags|=1024),l=!1)}return gv(i,e,n,l,_,d)}function gv(i,e,n,l,d,_){XE(i,e);var w=(e.flags&128)!==0;if(!l&&!w)return d&&QS(e,n,!1),ba(i,e,_);l=e.stateNode,LL.current=e;var a=w&&typeof n.getDerivedStateFromError!="function"?null:l.render();return e.flags|=1,i!==null&&w?(e.child=qh(e,i.child,null,_),e.child=qh(e,null,a,_)):Nr(i,e,a,_),e.memoizedState=l.state,d&&QS(e,n,!0),e.child}function YE(i){var e=i.stateNode;e.pendingContext?JS(i,e.pendingContext,e.pendingContext!==e.context):e.context&&JS(i,e.context,!1),y1(i,e.containerInfo)}function mM(i,e,n,l,d){return $h(),d1(d),e.flags|=256,Nr(i,e,n,l),e.child}var yv={dehydrated:null,treeContext:null,retryLane:0};function xv(i){return{baseLanes:i,cachePool:null,transitions:null}}function KE(i,e,n){var l=e.pendingProps,d=Oi.current,_=!1,w=(e.flags&128)!==0,a;if((a=w)||(a=i!==null&&i.memoizedState===null?!1:(d&2)!==0),a?(_=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(d|=1),xi(Oi,d&1),i===null)return hv(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((e.mode&1)===0?e.lanes=1:i.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(w=l.children,i=l.fallback,_?(l=e.mode,_=e.child,w={mode:"hidden",children:w},(l&1)===0&&_!==null?(_.childLanes=0,_.pendingProps=w):_=Xg(w,l,0,null),i=Rc(i,l,n,null),_.return=e,i.return=e,_.sibling=i,e.child=_,e.child.memoizedState=xv(n),e.memoizedState=yv,i):E1(e,w));if(d=i.memoizedState,d!==null&&(a=d.dehydrated,a!==null))return DL(i,e,w,l,a,d,n);if(_){_=l.fallback,w=e.mode,d=i.child,a=d.sibling;var T={mode:"hidden",children:l.children};return(w&1)===0&&e.child!==d?(l=e.child,l.childLanes=0,l.pendingProps=T,e.deletions=null):(l=Ml(d,T),l.subtreeFlags=d.subtreeFlags&14680064),a!==null?_=Ml(a,_):(_=Rc(_,w,n,null),_.flags|=2),_.return=e,l.return=e,l.sibling=_,e.child=l,l=_,_=e.child,w=i.child.memoizedState,w=w===null?xv(n):{baseLanes:w.baseLanes|n,cachePool:null,transitions:w.transitions},_.memoizedState=w,_.childLanes=i.childLanes&~n,e.memoizedState=yv,l}return _=i.child,i=_.sibling,l=Ml(_,{mode:"visible",children:l.children}),(e.mode&1)===0&&(l.lanes=n),l.return=e,l.sibling=null,i!==null&&(n=e.deletions,n===null?(e.deletions=[i],e.flags|=16):n.push(i)),e.child=l,e.memoizedState=null,l}function E1(i,e){return e=Xg({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function M_(i,e,n,l){return l!==null&&d1(l),qh(e,i.child,null,n),i=E1(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function DL(i,e,n,l,d,_,w){if(n)return e.flags&256?(e.flags&=-257,l=K0(Error(Dt(422))),M_(i,e,w,l)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(_=l.fallback,d=e.mode,l=Xg({mode:"visible",children:l.children},d,0,null),_=Rc(_,d,w,null),_.flags|=2,l.return=e,_.return=e,l.sibling=_,e.child=l,(e.mode&1)!==0&&qh(e,i.child,null,w),e.child.memoizedState=xv(w),e.memoizedState=yv,_);if((e.mode&1)===0)return M_(i,e,w,null);if(d.data==="$!"){if(l=d.nextSibling&&d.nextSibling.dataset,l)var a=l.dgst;return l=a,_=Error(Dt(419)),l=K0(_,l,void 0),M_(i,e,w,l)}if(a=(w&i.childLanes)!==0,so||a){if(l=fr,l!==null){switch(w&-w){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=(d&(l.suspendedLanes|w))!==0?0:d,d!==0&&d!==_.retryLane&&(_.retryLane=d,wa(i,d),hs(l,i,d,-1))}return D1(),l=K0(Error(Dt(421))),M_(i,e,w,l)}return d.data==="$?"?(e.flags|=128,e.child=i.child,e=HL.bind(null,i),d._reactRetry=e,null):(i=_.treeContext,wo=vl(d.nextSibling),bo=e,Di=!0,as=null,i!==null&&(Fo[Bo++]=pa,Fo[Bo++]=ma,Fo[Bo++]=Uc,pa=i.id,ma=i.overflow,Uc=e),e=E1(e,l.children),e.flags|=4096,e)}function _M(i,e,n){i.lanes|=e;var l=i.alternate;l!==null&&(l.lanes|=e),dv(i.return,e,n)}function J0(i,e,n,l,d){var _=i.memoizedState;_===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:l,tail:n,tailMode:d}:(_.isBackwards=e,_.rendering=null,_.renderingStartTime=0,_.last=l,_.tail=n,_.tailMode=d)}function JE(i,e,n){var l=e.pendingProps,d=l.revealOrder,_=l.tail;if(Nr(i,e,l.children,n),l=Oi.current,(l&2)!==0)l=l&1|2,e.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&_M(i,n,e);else if(i.tag===19)_M(i,n,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}l&=1}if(xi(Oi,l),(e.mode&1)===0)e.memoizedState=null;else switch(d){case"forwards":for(n=e.child,d=null;n!==null;)i=n.alternate,i!==null&&Ag(i)===null&&(d=n),n=n.sibling;n=d,n===null?(d=e.child,e.child=null):(d=n.sibling,n.sibling=null),J0(e,!1,d,n,_);break;case"backwards":for(n=null,d=e.child,e.child=null;d!==null;){if(i=d.alternate,i!==null&&Ag(i)===null){e.child=d;break}i=d.sibling,d.sibling=n,n=d,d=i}J0(e,!0,n,null,_);break;case"together":J0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function og(i,e){(e.mode&1)===0&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function ba(i,e,n){if(i!==null&&(e.dependencies=i.dependencies),Gc|=e.lanes,(n&e.childLanes)===0)return null;if(i!==null&&e.child!==i.child)throw Error(Dt(153));if(e.child!==null){for(i=e.child,n=Ml(i,i.pendingProps),e.child=n,n.return=e;i.sibling!==null;)i=i.sibling,n=n.sibling=Ml(i,i.pendingProps),n.return=e;n.sibling=null}return e.child}function zL(i,e,n){switch(e.tag){case 3:YE(e),$h();break;case 5:TE(e);break;case 1:lo(e.type)&&bg(e);break;case 4:y1(e,e.stateNode.containerInfo);break;case 10:var l=e.type._context,d=e.memoizedProps.value;xi(Tg,l._currentValue),l._currentValue=d;break;case 13:if(l=e.memoizedState,l!==null)return l.dehydrated!==null?(xi(Oi,Oi.current&1),e.flags|=128,null):(n&e.child.childLanes)!==0?KE(i,e,n):(xi(Oi,Oi.current&1),i=ba(i,e,n),i!==null?i.sibling:null);xi(Oi,Oi.current&1);break;case 19:if(l=(n&e.childLanes)!==0,(i.flags&128)!==0){if(l)return JE(i,e,n);e.flags|=128}if(d=e.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),xi(Oi,Oi.current),l)break;return null;case 22:case 23:return e.lanes=0,ZE(i,e,n)}return ba(i,e,n)}var QE,vv,eC,tC;QE=function(i,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)i.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};vv=function(){};eC=function(i,e,n,l){var d=i.memoizedProps;if(d!==l){i=e.stateNode,Ic(Ns.current);var _=null;switch(n){case"input":d=Gx(i,d),l=Gx(i,l),_=[];break;case"select":d=Ui({},d,{value:void 0}),l=Ui({},l,{value:void 0}),_=[];break;case"textarea":d=Hx(i,d),l=Hx(i,l),_=[];break;default:typeof d.onClick!="function"&&typeof l.onClick=="function"&&(i.onclick=vg)}qx(n,l);var w;n=null;for(A in d)if(!l.hasOwnProperty(A)&&d.hasOwnProperty(A)&&d[A]!=null)if(A==="style"){var a=d[A];for(w in a)a.hasOwnProperty(w)&&(n||(n={}),n[w]="")}else A!=="dangerouslySetInnerHTML"&&A!=="children"&&A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(tp.hasOwnProperty(A)?_||(_=[]):(_=_||[]).push(A,null));for(A in l){var T=l[A];if(a=d!=null?d[A]:void 0,l.hasOwnProperty(A)&&T!==a&&(T!=null||a!=null))if(A==="style")if(a){for(w in a)!a.hasOwnProperty(w)||T&&T.hasOwnProperty(w)||(n||(n={}),n[w]="");for(w in T)T.hasOwnProperty(w)&&a[w]!==T[w]&&(n||(n={}),n[w]=T[w])}else n||(_||(_=[]),_.push(A,n)),n=T;else A==="dangerouslySetInnerHTML"?(T=T?T.__html:void 0,a=a?a.__html:void 0,T!=null&&a!==T&&(_=_||[]).push(A,T)):A==="children"?typeof T!="string"&&typeof T!="number"||(_=_||[]).push(A,""+T):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&(tp.hasOwnProperty(A)?(T!=null&&A==="onScroll"&&Si("scroll",i),_||a===T||(_=[])):(_=_||[]).push(A,T))}n&&(_=_||[]).push("style",n);var A=_;(e.updateQueue=A)&&(e.flags|=4)}};tC=function(i,e,n,l){n!==l&&(e.flags|=4)};function Af(i,e){if(!Di)switch(i.tailMode){case"hidden":e=i.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?i.tail=null:n.sibling=null;break;case"collapsed":n=i.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:l.sibling=null}}function Dr(i){var e=i.alternate!==null&&i.alternate.child===i.child,n=0,l=0;if(e)for(var d=i.child;d!==null;)n|=d.lanes|d.childLanes,l|=d.subtreeFlags&14680064,l|=d.flags&14680064,d.return=i,d=d.sibling;else for(d=i.child;d!==null;)n|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=i,d=d.sibling;return i.subtreeFlags|=l,i.childLanes=n,e}function kL(i,e,n){var l=e.pendingProps;switch(h1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dr(e),null;case 1:return lo(e.type)&&wg(),Dr(e),null;case 3:return l=e.stateNode,Zh(),Ti(ao),Ti(Rr),v1(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(b_(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,as!==null&&(Av(as),as=null))),vv(i,e),Dr(e),null;case 5:x1(e);var d=Ic(fp.current);if(n=e.type,i!==null&&e.stateNode!=null)eC(i,e,n,l,d),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!l){if(e.stateNode===null)throw Error(Dt(166));return Dr(e),null}if(i=Ic(Ns.current),b_(e)){l=e.stateNode,n=e.type;var _=e.memoizedProps;switch(l[Rs]=e,l[hp]=_,i=(e.mode&1)!==0,n){case"dialog":Si("cancel",l),Si("close",l);break;case"iframe":case"object":case"embed":Si("load",l);break;case"video":case"audio":for(d=0;d<Nf.length;d++)Si(Nf[d],l);break;case"source":Si("error",l);break;case"img":case"image":case"link":Si("error",l),Si("load",l);break;case"details":Si("toggle",l);break;case"input":TS(l,_),Si("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!_.multiple},Si("invalid",l);break;case"textarea":CS(l,_),Si("invalid",l)}qx(n,_),d=null;for(var w in _)if(_.hasOwnProperty(w)){var a=_[w];w==="children"?typeof a=="string"?l.textContent!==a&&(_.suppressHydrationWarning!==!0&&w_(l.textContent,a,i),d=["children",a]):typeof a=="number"&&l.textContent!==""+a&&(_.suppressHydrationWarning!==!0&&w_(l.textContent,a,i),d=["children",""+a]):tp.hasOwnProperty(w)&&a!=null&&w==="onScroll"&&Si("scroll",l)}switch(n){case"input":f_(l),ES(l,_,!0);break;case"textarea":f_(l),AS(l);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(l.onclick=vg)}l=d,e.updateQueue=l,l!==null&&(e.flags|=4)}else{w=d.nodeType===9?d:d.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=AT(n)),i==="http://www.w3.org/1999/xhtml"?n==="script"?(i=w.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof l.is=="string"?i=w.createElement(n,{is:l.is}):(i=w.createElement(n),n==="select"&&(w=i,l.multiple?w.multiple=!0:l.size&&(w.size=l.size))):i=w.createElementNS(i,n),i[Rs]=e,i[hp]=l,QE(i,e,!1,!1),e.stateNode=i;e:{switch(w=Zx(n,l),n){case"dialog":Si("cancel",i),Si("close",i),d=l;break;case"iframe":case"object":case"embed":Si("load",i),d=l;break;case"video":case"audio":for(d=0;d<Nf.length;d++)Si(Nf[d],i);d=l;break;case"source":Si("error",i),d=l;break;case"img":case"image":case"link":Si("error",i),Si("load",i),d=l;break;case"details":Si("toggle",i),d=l;break;case"input":TS(i,l),d=Gx(i,l),Si("invalid",i);break;case"option":d=l;break;case"select":i._wrapperState={wasMultiple:!!l.multiple},d=Ui({},l,{value:void 0}),Si("invalid",i);break;case"textarea":CS(i,l),d=Hx(i,l),Si("invalid",i);break;default:d=l}qx(n,d),a=d;for(_ in a)if(a.hasOwnProperty(_)){var T=a[_];_==="style"?LT(i,T):_==="dangerouslySetInnerHTML"?(T=T?T.__html:void 0,T!=null&&IT(i,T)):_==="children"?typeof T=="string"?(n!=="textarea"||T!=="")&&np(i,T):typeof T=="number"&&np(i,""+T):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(tp.hasOwnProperty(_)?T!=null&&_==="onScroll"&&Si("scroll",i):T!=null&&Yv(i,_,T,w))}switch(n){case"input":f_(i),ES(i,l,!1);break;case"textarea":f_(i),AS(i);break;case"option":l.value!=null&&i.setAttribute("value",""+Cl(l.value));break;case"select":i.multiple=!!l.multiple,_=l.value,_!=null?Rh(i,!!l.multiple,_,!1):l.defaultValue!=null&&Rh(i,!!l.multiple,l.defaultValue,!0);break;default:typeof d.onClick=="function"&&(i.onclick=vg)}switch(n){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Dr(e),null;case 6:if(i&&e.stateNode!=null)tC(i,e,i.memoizedProps,l);else{if(typeof l!="string"&&e.stateNode===null)throw Error(Dt(166));if(n=Ic(fp.current),Ic(Ns.current),b_(e)){if(l=e.stateNode,n=e.memoizedProps,l[Rs]=e,(_=l.nodeValue!==n)&&(i=bo,i!==null))switch(i.tag){case 3:w_(l.nodeValue,n,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&w_(l.nodeValue,n,(i.mode&1)!==0)}_&&(e.flags|=4)}else l=(n.nodeType===9?n:n.ownerDocument).createTextNode(l),l[Rs]=e,e.stateNode=l}return Dr(e),null;case 13:if(Ti(Oi),l=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Di&&wo!==null&&(e.mode&1)!==0&&(e.flags&128)===0)yE(),$h(),e.flags|=98560,_=!1;else if(_=b_(e),l!==null&&l.dehydrated!==null){if(i===null){if(!_)throw Error(Dt(318));if(_=e.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(Dt(317));_[Rs]=e}else $h(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Dr(e),_=!1}else as!==null&&(Av(as),as=null),_=!0;if(!_)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=n,e):(l=l!==null,l!==(i!==null&&i.memoizedState!==null)&&l&&(e.child.flags|=8192,(e.mode&1)!==0&&(i===null||(Oi.current&1)!==0?or===0&&(or=3):D1())),e.updateQueue!==null&&(e.flags|=4),Dr(e),null);case 4:return Zh(),vv(i,e),i===null&&cp(e.stateNode.containerInfo),Dr(e),null;case 10:return m1(e.type._context),Dr(e),null;case 17:return lo(e.type)&&wg(),Dr(e),null;case 19:if(Ti(Oi),_=e.memoizedState,_===null)return Dr(e),null;if(l=(e.flags&128)!==0,w=_.rendering,w===null)if(l)Af(_,!1);else{if(or!==0||i!==null&&(i.flags&128)!==0)for(i=e.child;i!==null;){if(w=Ag(i),w!==null){for(e.flags|=128,Af(_,!1),l=w.updateQueue,l!==null&&(e.updateQueue=l,e.flags|=4),e.subtreeFlags=0,l=n,n=e.child;n!==null;)_=n,i=l,_.flags&=14680066,w=_.alternate,w===null?(_.childLanes=0,_.lanes=i,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=w.childLanes,_.lanes=w.lanes,_.child=w.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=w.memoizedProps,_.memoizedState=w.memoizedState,_.updateQueue=w.updateQueue,_.type=w.type,i=w.dependencies,_.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),n=n.sibling;return xi(Oi,Oi.current&1|2),e.child}i=i.sibling}_.tail!==null&&qi()>Yh&&(e.flags|=128,l=!0,Af(_,!1),e.lanes=4194304)}else{if(!l)if(i=Ag(w),i!==null){if(e.flags|=128,l=!0,n=i.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Af(_,!0),_.tail===null&&_.tailMode==="hidden"&&!w.alternate&&!Di)return Dr(e),null}else 2*qi()-_.renderingStartTime>Yh&&n!==1073741824&&(e.flags|=128,l=!0,Af(_,!1),e.lanes=4194304);_.isBackwards?(w.sibling=e.child,e.child=w):(n=_.last,n!==null?n.sibling=w:e.child=w,_.last=w)}return _.tail!==null?(e=_.tail,_.rendering=e,_.tail=e.sibling,_.renderingStartTime=qi(),e.sibling=null,n=Oi.current,xi(Oi,l?n&1|2:n&1),e):(Dr(e),null);case 22:case 23:return L1(),l=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==l&&(e.flags|=8192),l&&(e.mode&1)!==0?(xo&1073741824)!==0&&(Dr(e),e.subtreeFlags&6&&(e.flags|=8192)):Dr(e),null;case 24:return null;case 25:return null}throw Error(Dt(156,e.tag))}function RL(i,e){switch(h1(e),e.tag){case 1:return lo(e.type)&&wg(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Zh(),Ti(ao),Ti(Rr),v1(),i=e.flags,(i&65536)!==0&&(i&128)===0?(e.flags=i&-65537|128,e):null;case 5:return x1(e),null;case 13:if(Ti(Oi),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(Dt(340));$h()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return Ti(Oi),null;case 4:return Zh(),null;case 10:return m1(e.type._context),null;case 22:case 23:return L1(),null;case 24:return null;default:return null}}var T_=!1,kr=!1,FL=typeof WeakSet=="function"?WeakSet:Set,tn=null;function Lh(i,e){var n=i.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(l){Wi(i,e,l)}else n.current=null}function wv(i,e,n){try{n()}catch(l){Wi(i,e,l)}}var gM=!1;function BL(i,e){if(rv=gg,i=oE(),c1(i)){if("selectionStart"in i)var n={start:i.selectionStart,end:i.selectionEnd};else e:{n=(n=i.ownerDocument)&&n.defaultView||window;var l=n.getSelection&&n.getSelection();if(l&&l.rangeCount!==0){n=l.anchorNode;var d=l.anchorOffset,_=l.focusNode;l=l.focusOffset;try{n.nodeType,_.nodeType}catch{n=null;break e}var w=0,a=-1,T=-1,A=0,D=0,P=i,k=null;t:for(;;){for(var W;P!==n||d!==0&&P.nodeType!==3||(a=w+d),P!==_||l!==0&&P.nodeType!==3||(T=w+l),P.nodeType===3&&(w+=P.nodeValue.length),(W=P.firstChild)!==null;)k=P,P=W;for(;;){if(P===i)break t;if(k===n&&++A===d&&(a=w),k===_&&++D===l&&(T=w),(W=P.nextSibling)!==null)break;P=k,k=P.parentNode}P=W}n=a===-1||T===-1?null:{start:a,end:T}}else n=null}n=n||{start:0,end:0}}else n=null;for(ov={focusedElem:i,selectionRange:n},gg=!1,tn=e;tn!==null;)if(e=tn,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,tn=i;else for(;tn!==null;){e=tn;try{var Z=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Z!==null){var F=Z.memoizedProps,B=Z.memoizedState,G=e.stateNode,$=G.getSnapshotBeforeUpdate(e.elementType===e.type?F:os(e.type,F),B);G.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var ne=e.stateNode.containerInfo;ne.nodeType===1?ne.textContent="":ne.nodeType===9&&ne.documentElement&&ne.removeChild(ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Dt(163))}}catch(me){Wi(e,e.return,me)}if(i=e.sibling,i!==null){i.return=e.return,tn=i;break}tn=e.return}return Z=gM,gM=!1,Z}function Xf(i,e,n){var l=e.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var d=l=l.next;do{if((d.tag&i)===i){var _=d.destroy;d.destroy=void 0,_!==void 0&&wv(e,n,_)}d=d.next}while(d!==l)}}function qg(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&i)===i){var l=n.create;n.destroy=l()}n=n.next}while(n!==e)}}function bv(i){var e=i.ref;if(e!==null){var n=i.stateNode;switch(i.tag){case 5:i=n;break;default:i=n}typeof e=="function"?e(i):e.current=i}}function nC(i){var e=i.alternate;e!==null&&(i.alternate=null,nC(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Rs],delete e[hp],delete e[lv],delete e[xL],delete e[vL])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function iC(i){return i.tag===5||i.tag===3||i.tag===4}function yM(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||iC(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Sv(i,e,n){var l=i.tag;if(l===5||l===6)i=i.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(i,e):n.insertBefore(i,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(i,n)):(e=n,e.appendChild(i)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=vg));else if(l!==4&&(i=i.child,i!==null))for(Sv(i,e,n),i=i.sibling;i!==null;)Sv(i,e,n),i=i.sibling}function Mv(i,e,n){var l=i.tag;if(l===5||l===6)i=i.stateNode,e?n.insertBefore(i,e):n.appendChild(i);else if(l!==4&&(i=i.child,i!==null))for(Mv(i,e,n),i=i.sibling;i!==null;)Mv(i,e,n),i=i.sibling}var xr=null,ss=!1;function il(i,e,n){for(n=n.child;n!==null;)rC(i,e,n),n=n.sibling}function rC(i,e,n){if(Os&&typeof Os.onCommitFiberUnmount=="function")try{Os.onCommitFiberUnmount(Ng,n)}catch{}switch(n.tag){case 5:kr||Lh(n,e);case 6:var l=xr,d=ss;xr=null,il(i,e,n),xr=l,ss=d,xr!==null&&(ss?(i=xr,n=n.stateNode,i.nodeType===8?i.parentNode.removeChild(n):i.removeChild(n)):xr.removeChild(n.stateNode));break;case 18:xr!==null&&(ss?(i=xr,n=n.stateNode,i.nodeType===8?H0(i.parentNode,n):i.nodeType===1&&H0(i,n),sp(i)):H0(xr,n.stateNode));break;case 4:l=xr,d=ss,xr=n.stateNode.containerInfo,ss=!0,il(i,e,n),xr=l,ss=d;break;case 0:case 11:case 14:case 15:if(!kr&&(l=n.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){d=l=l.next;do{var _=d,w=_.destroy;_=_.tag,w!==void 0&&((_&2)!==0||(_&4)!==0)&&wv(n,e,w),d=d.next}while(d!==l)}il(i,e,n);break;case 1:if(!kr&&(Lh(n,e),l=n.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=n.memoizedProps,l.state=n.memoizedState,l.componentWillUnmount()}catch(a){Wi(n,e,a)}il(i,e,n);break;case 21:il(i,e,n);break;case 22:n.mode&1?(kr=(l=kr)||n.memoizedState!==null,il(i,e,n),kr=l):il(i,e,n);break;default:il(i,e,n)}}function xM(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var n=i.stateNode;n===null&&(n=i.stateNode=new FL),e.forEach(function(l){var d=$L.bind(null,i,l);n.has(l)||(n.add(l),l.then(d,d))})}}function es(i,e){var n=e.deletions;if(n!==null)for(var l=0;l<n.length;l++){var d=n[l];try{var _=i,w=e,a=w;e:for(;a!==null;){switch(a.tag){case 5:xr=a.stateNode,ss=!1;break e;case 3:xr=a.stateNode.containerInfo,ss=!0;break e;case 4:xr=a.stateNode.containerInfo,ss=!0;break e}a=a.return}if(xr===null)throw Error(Dt(160));rC(_,w,d),xr=null,ss=!1;var T=d.alternate;T!==null&&(T.return=null),d.return=null}catch(A){Wi(d,e,A)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oC(e,i),e=e.sibling}function oC(i,e){var n=i.alternate,l=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(es(e,i),Is(i),l&4){try{Xf(3,i,i.return),qg(3,i)}catch(F){Wi(i,i.return,F)}try{Xf(5,i,i.return)}catch(F){Wi(i,i.return,F)}}break;case 1:es(e,i),Is(i),l&512&&n!==null&&Lh(n,n.return);break;case 5:if(es(e,i),Is(i),l&512&&n!==null&&Lh(n,n.return),i.flags&32){var d=i.stateNode;try{np(d,"")}catch(F){Wi(i,i.return,F)}}if(l&4&&(d=i.stateNode,d!=null)){var _=i.memoizedProps,w=n!==null?n.memoizedProps:_,a=i.type,T=i.updateQueue;if(i.updateQueue=null,T!==null)try{a==="input"&&_.type==="radio"&&_.name!=null&&ET(d,_),Zx(a,w);var A=Zx(a,_);for(w=0;w<T.length;w+=2){var D=T[w],P=T[w+1];D==="style"?LT(d,P):D==="dangerouslySetInnerHTML"?IT(d,P):D==="children"?np(d,P):Yv(d,D,P,A)}switch(a){case"input":jx(d,_);break;case"textarea":CT(d,_);break;case"select":var k=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!_.multiple;var W=_.value;W!=null?Rh(d,!!_.multiple,W,!1):k!==!!_.multiple&&(_.defaultValue!=null?Rh(d,!!_.multiple,_.defaultValue,!0):Rh(d,!!_.multiple,_.multiple?[]:"",!1))}d[hp]=_}catch(F){Wi(i,i.return,F)}}break;case 6:if(es(e,i),Is(i),l&4){if(i.stateNode===null)throw Error(Dt(162));d=i.stateNode,_=i.memoizedProps;try{d.nodeValue=_}catch(F){Wi(i,i.return,F)}}break;case 3:if(es(e,i),Is(i),l&4&&n!==null&&n.memoizedState.isDehydrated)try{sp(e.containerInfo)}catch(F){Wi(i,i.return,F)}break;case 4:es(e,i),Is(i);break;case 13:es(e,i),Is(i),d=i.child,d.flags&8192&&(_=d.memoizedState!==null,d.stateNode.isHidden=_,!_||d.alternate!==null&&d.alternate.memoizedState!==null||(I1=qi())),l&4&&xM(i);break;case 22:if(D=n!==null&&n.memoizedState!==null,i.mode&1?(kr=(A=kr)||D,es(e,i),kr=A):es(e,i),Is(i),l&8192){if(A=i.memoizedState!==null,(i.stateNode.isHidden=A)&&!D&&(i.mode&1)!==0)for(tn=i,D=i.child;D!==null;){for(P=tn=D;tn!==null;){switch(k=tn,W=k.child,k.tag){case 0:case 11:case 14:case 15:Xf(4,k,k.return);break;case 1:Lh(k,k.return);var Z=k.stateNode;if(typeof Z.componentWillUnmount=="function"){l=k,n=k.return;try{e=l,Z.props=e.memoizedProps,Z.state=e.memoizedState,Z.componentWillUnmount()}catch(F){Wi(l,n,F)}}break;case 5:Lh(k,k.return);break;case 22:if(k.memoizedState!==null){wM(P);continue}}W!==null?(W.return=k,tn=W):wM(P)}D=D.sibling}e:for(D=null,P=i;;){if(P.tag===5){if(D===null){D=P;try{d=P.stateNode,A?(_=d.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(a=P.stateNode,T=P.memoizedProps.style,w=T!=null&&T.hasOwnProperty("display")?T.display:null,a.style.display=PT("display",w))}catch(F){Wi(i,i.return,F)}}}else if(P.tag===6){if(D===null)try{P.stateNode.nodeValue=A?"":P.memoizedProps}catch(F){Wi(i,i.return,F)}}else if((P.tag!==22&&P.tag!==23||P.memoizedState===null||P===i)&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===i)break e;for(;P.sibling===null;){if(P.return===null||P.return===i)break e;D===P&&(D=null),P=P.return}D===P&&(D=null),P.sibling.return=P.return,P=P.sibling}}break;case 19:es(e,i),Is(i),l&4&&xM(i);break;case 21:break;default:es(e,i),Is(i)}}function Is(i){var e=i.flags;if(e&2){try{e:{for(var n=i.return;n!==null;){if(iC(n)){var l=n;break e}n=n.return}throw Error(Dt(160))}switch(l.tag){case 5:var d=l.stateNode;l.flags&32&&(np(d,""),l.flags&=-33);var _=yM(i);Mv(i,_,d);break;case 3:case 4:var w=l.stateNode.containerInfo,a=yM(i);Sv(i,a,w);break;default:throw Error(Dt(161))}}catch(T){Wi(i,i.return,T)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function OL(i,e,n){tn=i,sC(i)}function sC(i,e,n){for(var l=(i.mode&1)!==0;tn!==null;){var d=tn,_=d.child;if(d.tag===22&&l){var w=d.memoizedState!==null||T_;if(!w){var a=d.alternate,T=a!==null&&a.memoizedState!==null||kr;a=T_;var A=kr;if(T_=w,(kr=T)&&!A)for(tn=d;tn!==null;)w=tn,T=w.child,w.tag===22&&w.memoizedState!==null?bM(d):T!==null?(T.return=w,tn=T):bM(d);for(;_!==null;)tn=_,sC(_),_=_.sibling;tn=d,T_=a,kr=A}vM(i)}else(d.subtreeFlags&8772)!==0&&_!==null?(_.return=d,tn=_):vM(i)}}function vM(i){for(;tn!==null;){var e=tn;if((e.flags&8772)!==0){var n=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:kr||qg(5,e);break;case 1:var l=e.stateNode;if(e.flags&4&&!kr)if(n===null)l.componentDidMount();else{var d=e.elementType===e.type?n.memoizedProps:os(e.type,n.memoizedProps);l.componentDidUpdate(d,n.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var _=e.updateQueue;_!==null&&iM(e,_,l);break;case 3:var w=e.updateQueue;if(w!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}iM(e,w,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var T=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":T.autoFocus&&n.focus();break;case"img":T.src&&(n.src=T.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var A=e.alternate;if(A!==null){var D=A.memoizedState;if(D!==null){var P=D.dehydrated;P!==null&&sp(P)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Dt(163))}kr||e.flags&512&&bv(e)}catch(k){Wi(e,e.return,k)}}if(e===i){tn=null;break}if(n=e.sibling,n!==null){n.return=e.return,tn=n;break}tn=e.return}}function wM(i){for(;tn!==null;){var e=tn;if(e===i){tn=null;break}var n=e.sibling;if(n!==null){n.return=e.return,tn=n;break}tn=e.return}}function bM(i){for(;tn!==null;){var e=tn;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{qg(4,e)}catch(T){Wi(e,n,T)}break;case 1:var l=e.stateNode;if(typeof l.componentDidMount=="function"){var d=e.return;try{l.componentDidMount()}catch(T){Wi(e,d,T)}}var _=e.return;try{bv(e)}catch(T){Wi(e,_,T)}break;case 5:var w=e.return;try{bv(e)}catch(T){Wi(e,w,T)}}}catch(T){Wi(e,e.return,T)}if(e===i){tn=null;break}var a=e.sibling;if(a!==null){a.return=e.return,tn=a;break}tn=e.return}}var NL=Math.ceil,Lg=Ma.ReactCurrentDispatcher,C1=Ma.ReactCurrentOwner,Uo=Ma.ReactCurrentBatchConfig,Jn=0,fr=null,Yi=null,wr=0,xo=0,Dh=Dl(0),or=0,gp=null,Gc=0,Zg=0,A1=0,Yf=null,ro=null,I1=0,Yh=1/0,ha=null,Dg=!1,Tv=null,bl=null,E_=!1,_l=null,zg=0,Kf=0,Ev=null,sg=-1,ag=0;function Vr(){return(Jn&6)!==0?qi():sg!==-1?sg:sg=qi()}function Sl(i){return(i.mode&1)===0?1:(Jn&2)!==0&&wr!==0?wr&-wr:bL.transition!==null?(ag===0&&(ag=jT()),ag):(i=ai,i!==0||(i=window.event,i=i===void 0?16:YT(i.type)),i)}function hs(i,e,n,l){if(50<Kf)throw Kf=0,Ev=null,Error(Dt(185));Mp(i,n,l),((Jn&2)===0||i!==fr)&&(i===fr&&((Jn&2)===0&&(Zg|=n),or===4&&pl(i,wr)),co(i,l),n===1&&Jn===0&&(e.mode&1)===0&&(Yh=qi()+500,Wg&&zl()))}function co(i,e){var n=i.callbackNode;bP(i,e);var l=_g(i,i===fr?wr:0);if(l===0)n!==null&&LS(n),i.callbackNode=null,i.callbackPriority=0;else if(e=l&-l,i.callbackPriority!==e){if(n!=null&&LS(n),e===1)i.tag===0?wL(SM.bind(null,i)):mE(SM.bind(null,i)),gL(function(){(Jn&6)===0&&zl()}),n=null;else{switch(WT(l)){case 1:n=t1;break;case 4:n=VT;break;case 16:n=mg;break;case 536870912:n=GT;break;default:n=mg}n=pC(n,aC.bind(null,i))}i.callbackPriority=e,i.callbackNode=n}}function aC(i,e){if(sg=-1,ag=0,(Jn&6)!==0)throw Error(Dt(327));var n=i.callbackNode;if(Uh()&&i.callbackNode!==n)return null;var l=_g(i,i===fr?wr:0);if(l===0)return null;if((l&30)!==0||(l&i.expiredLanes)!==0||e)e=kg(i,l);else{e=l;var d=Jn;Jn|=2;var _=cC();(fr!==i||wr!==e)&&(ha=null,Yh=qi()+500,kc(i,e));do try{GL();break}catch(a){lC(i,a)}while(1);p1(),Lg.current=_,Jn=d,Yi!==null?e=0:(fr=null,wr=0,e=or)}if(e!==0){if(e===2&&(d=Qx(i),d!==0&&(l=d,e=Cv(i,d))),e===1)throw n=gp,kc(i,0),pl(i,l),co(i,qi()),n;if(e===6)pl(i,l);else{if(d=i.current.alternate,(l&30)===0&&!UL(d)&&(e=kg(i,l),e===2&&(_=Qx(i),_!==0&&(l=_,e=Cv(i,_))),e===1))throw n=gp,kc(i,0),pl(i,l),co(i,qi()),n;switch(i.finishedWork=d,i.finishedLanes=l,e){case 0:case 1:throw Error(Dt(345));case 2:Sc(i,ro,ha);break;case 3:if(pl(i,l),(l&130023424)===l&&(e=I1+500-qi(),10<e)){if(_g(i,0)!==0)break;if(d=i.suspendedLanes,(d&l)!==l){Vr(),i.pingedLanes|=i.suspendedLanes&d;break}i.timeoutHandle=av(Sc.bind(null,i,ro,ha),e);break}Sc(i,ro,ha);break;case 4:if(pl(i,l),(l&4194240)===l)break;for(e=i.eventTimes,d=-1;0<l;){var w=31-us(l);_=1<<w,w=e[w],w>d&&(d=w),l&=~_}if(l=d,l=qi()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*NL(l/1960))-l,10<l){i.timeoutHandle=av(Sc.bind(null,i,ro,ha),l);break}Sc(i,ro,ha);break;case 5:Sc(i,ro,ha);break;default:throw Error(Dt(329))}}}return co(i,qi()),i.callbackNode===n?aC.bind(null,i):null}function Cv(i,e){var n=Yf;return i.current.memoizedState.isDehydrated&&(kc(i,e).flags|=256),i=kg(i,e),i!==2&&(e=ro,ro=n,e!==null&&Av(e)),i}function Av(i){ro===null?ro=i:ro.push.apply(ro,i)}function UL(i){for(var e=i;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var l=0;l<n.length;l++){var d=n[l],_=d.getSnapshot;d=d.value;try{if(!fs(_(),d))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function pl(i,e){for(e&=~A1,e&=~Zg,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var n=31-us(e),l=1<<n;i[n]=-1,e&=~l}}function SM(i){if((Jn&6)!==0)throw Error(Dt(327));Uh();var e=_g(i,0);if((e&1)===0)return co(i,qi()),null;var n=kg(i,e);if(i.tag!==0&&n===2){var l=Qx(i);l!==0&&(e=l,n=Cv(i,l))}if(n===1)throw n=gp,kc(i,0),pl(i,e),co(i,qi()),n;if(n===6)throw Error(Dt(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,Sc(i,ro,ha),co(i,qi()),null}function P1(i,e){var n=Jn;Jn|=1;try{return i(e)}finally{Jn=n,Jn===0&&(Yh=qi()+500,Wg&&zl())}}function jc(i){_l!==null&&_l.tag===0&&(Jn&6)===0&&Uh();var e=Jn;Jn|=1;var n=Uo.transition,l=ai;try{if(Uo.transition=null,ai=1,i)return i()}finally{ai=l,Uo.transition=n,Jn=e,(Jn&6)===0&&zl()}}function L1(){xo=Dh.current,Ti(Dh)}function kc(i,e){i.finishedWork=null,i.finishedLanes=0;var n=i.timeoutHandle;if(n!==-1&&(i.timeoutHandle=-1,_L(n)),Yi!==null)for(n=Yi.return;n!==null;){var l=n;switch(h1(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&wg();break;case 3:Zh(),Ti(ao),Ti(Rr),v1();break;case 5:x1(l);break;case 4:Zh();break;case 13:Ti(Oi);break;case 19:Ti(Oi);break;case 10:m1(l.type._context);break;case 22:case 23:L1()}n=n.return}if(fr=i,Yi=i=Ml(i.current,null),wr=xo=e,or=0,gp=null,A1=Zg=Gc=0,ro=Yf=null,Ac!==null){for(e=0;e<Ac.length;e++)if(n=Ac[e],l=n.interleaved,l!==null){n.interleaved=null;var d=l.next,_=n.pending;if(_!==null){var w=_.next;_.next=d,l.next=w}n.pending=l}Ac=null}return i}function lC(i,e){do{var n=Yi;try{if(p1(),ig.current=Pg,Ig){for(var l=Ni.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}Ig=!1}if(Vc=0,dr=rr=Ni=null,Zf=!1,pp=0,C1.current=null,n===null||n.return===null){or=1,gp=e,Yi=null;break}e:{var _=i,w=n.return,a=n,T=e;if(e=wr,a.flags|=32768,T!==null&&typeof T=="object"&&typeof T.then=="function"){var A=T,D=a,P=D.tag;if((D.mode&1)===0&&(P===0||P===11||P===15)){var k=D.alternate;k?(D.updateQueue=k.updateQueue,D.memoizedState=k.memoizedState,D.lanes=k.lanes):(D.updateQueue=null,D.memoizedState=null)}var W=uM(w);if(W!==null){W.flags&=-257,hM(W,w,a,_,e),W.mode&1&&cM(_,A,e),e=W,T=A;var Z=e.updateQueue;if(Z===null){var F=new Set;F.add(T),e.updateQueue=F}else Z.add(T);break e}else{if((e&1)===0){cM(_,A,e),D1();break e}T=Error(Dt(426))}}else if(Di&&a.mode&1){var B=uM(w);if(B!==null){(B.flags&65536)===0&&(B.flags|=256),hM(B,w,a,_,e),d1(Xh(T,a));break e}}_=T=Xh(T,a),or!==4&&(or=2),Yf===null?Yf=[_]:Yf.push(_),_=w;do{switch(_.tag){case 3:_.flags|=65536,e&=-e,_.lanes|=e;var G=HE(_,T,e);nM(_,G);break e;case 1:a=T;var $=_.type,ne=_.stateNode;if((_.flags&128)===0&&(typeof $.getDerivedStateFromError=="function"||ne!==null&&typeof ne.componentDidCatch=="function"&&(bl===null||!bl.has(ne)))){_.flags|=65536,e&=-e,_.lanes|=e;var me=$E(_,a,e);nM(_,me);break e}}_=_.return}while(_!==null)}hC(n)}catch(K){e=K,Yi===n&&n!==null&&(Yi=n=n.return);continue}break}while(1)}function cC(){var i=Lg.current;return Lg.current=Pg,i===null?Pg:i}function D1(){(or===0||or===3||or===2)&&(or=4),fr===null||(Gc&268435455)===0&&(Zg&268435455)===0||pl(fr,wr)}function kg(i,e){var n=Jn;Jn|=2;var l=cC();(fr!==i||wr!==e)&&(ha=null,kc(i,e));do try{VL();break}catch(d){lC(i,d)}while(1);if(p1(),Jn=n,Lg.current=l,Yi!==null)throw Error(Dt(261));return fr=null,wr=0,or}function VL(){for(;Yi!==null;)uC(Yi)}function GL(){for(;Yi!==null&&!fP();)uC(Yi)}function uC(i){var e=fC(i.alternate,i,xo);i.memoizedProps=i.pendingProps,e===null?hC(i):Yi=e,C1.current=null}function hC(i){var e=i;do{var n=e.alternate;if(i=e.return,(e.flags&32768)===0){if(n=kL(n,e,xo),n!==null){Yi=n;return}}else{if(n=RL(n,e),n!==null){n.flags&=32767,Yi=n;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{or=6,Yi=null;return}}if(e=e.sibling,e!==null){Yi=e;return}Yi=e=i}while(e!==null);or===0&&(or=5)}function Sc(i,e,n){var l=ai,d=Uo.transition;try{Uo.transition=null,ai=1,jL(i,e,n,l)}finally{Uo.transition=d,ai=l}return null}function jL(i,e,n,l){do Uh();while(_l!==null);if((Jn&6)!==0)throw Error(Dt(327));n=i.finishedWork;var d=i.finishedLanes;if(n===null)return null;if(i.finishedWork=null,i.finishedLanes=0,n===i.current)throw Error(Dt(177));i.callbackNode=null,i.callbackPriority=0;var _=n.lanes|n.childLanes;if(SP(i,_),i===fr&&(Yi=fr=null,wr=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||E_||(E_=!0,pC(mg,function(){return Uh(),null})),_=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||_){_=Uo.transition,Uo.transition=null;var w=ai;ai=1;var a=Jn;Jn|=4,C1.current=null,BL(i,n),oC(n,i),cL(ov),gg=!!rv,ov=rv=null,i.current=n,OL(n),pP(),Jn=a,ai=w,Uo.transition=_}else i.current=n;if(E_&&(E_=!1,_l=i,zg=d),_=i.pendingLanes,_===0&&(bl=null),gP(n.stateNode),co(i,qi()),e!==null)for(l=i.onRecoverableError,n=0;n<e.length;n++)d=e[n],l(d.value,{componentStack:d.stack,digest:d.digest});if(Dg)throw Dg=!1,i=Tv,Tv=null,i;return(zg&1)!==0&&i.tag!==0&&Uh(),_=i.pendingLanes,(_&1)!==0?i===Ev?Kf++:(Kf=0,Ev=i):Kf=0,zl(),null}function Uh(){if(_l!==null){var i=WT(zg),e=Uo.transition,n=ai;try{if(Uo.transition=null,ai=16>i?16:i,_l===null)var l=!1;else{if(i=_l,_l=null,zg=0,(Jn&6)!==0)throw Error(Dt(331));var d=Jn;for(Jn|=4,tn=i.current;tn!==null;){var _=tn,w=_.child;if((tn.flags&16)!==0){var a=_.deletions;if(a!==null){for(var T=0;T<a.length;T++){var A=a[T];for(tn=A;tn!==null;){var D=tn;switch(D.tag){case 0:case 11:case 15:Xf(8,D,_)}var P=D.child;if(P!==null)P.return=D,tn=P;else for(;tn!==null;){D=tn;var k=D.sibling,W=D.return;if(nC(D),D===A){tn=null;break}if(k!==null){k.return=W,tn=k;break}tn=W}}}var Z=_.alternate;if(Z!==null){var F=Z.child;if(F!==null){Z.child=null;do{var B=F.sibling;F.sibling=null,F=B}while(F!==null)}}tn=_}}if((_.subtreeFlags&2064)!==0&&w!==null)w.return=_,tn=w;else e:for(;tn!==null;){if(_=tn,(_.flags&2048)!==0)switch(_.tag){case 0:case 11:case 15:Xf(9,_,_.return)}var G=_.sibling;if(G!==null){G.return=_.return,tn=G;break e}tn=_.return}}var $=i.current;for(tn=$;tn!==null;){w=tn;var ne=w.child;if((w.subtreeFlags&2064)!==0&&ne!==null)ne.return=w,tn=ne;else e:for(w=$;tn!==null;){if(a=tn,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:qg(9,a)}}catch(K){Wi(a,a.return,K)}if(a===w){tn=null;break e}var me=a.sibling;if(me!==null){me.return=a.return,tn=me;break e}tn=a.return}}if(Jn=d,zl(),Os&&typeof Os.onPostCommitFiberRoot=="function")try{Os.onPostCommitFiberRoot(Ng,i)}catch{}l=!0}return l}finally{ai=n,Uo.transition=e}}return!1}function MM(i,e,n){e=Xh(n,e),e=HE(i,e,1),i=wl(i,e,1),e=Vr(),i!==null&&(Mp(i,1,e),co(i,e))}function Wi(i,e,n){if(i.tag===3)MM(i,i,n);else for(;e!==null;){if(e.tag===3){MM(e,i,n);break}else if(e.tag===1){var l=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(bl===null||!bl.has(l))){i=Xh(n,i),i=$E(e,i,1),e=wl(e,i,1),i=Vr(),e!==null&&(Mp(e,1,i),co(e,i));break}}e=e.return}}function WL(i,e,n){var l=i.pingCache;l!==null&&l.delete(e),e=Vr(),i.pingedLanes|=i.suspendedLanes&n,fr===i&&(wr&n)===n&&(or===4||or===3&&(wr&130023424)===wr&&500>qi()-I1?kc(i,0):A1|=n),co(i,e)}function dC(i,e){e===0&&((i.mode&1)===0?e=1:(e=__,__<<=1,(__&130023424)===0&&(__=4194304)));var n=Vr();i=wa(i,e),i!==null&&(Mp(i,e,n),co(i,n))}function HL(i){var e=i.memoizedState,n=0;e!==null&&(n=e.retryLane),dC(i,n)}function $L(i,e){var n=0;switch(i.tag){case 13:var l=i.stateNode,d=i.memoizedState;d!==null&&(n=d.retryLane);break;case 19:l=i.stateNode;break;default:throw Error(Dt(314))}l!==null&&l.delete(e),dC(i,n)}var fC;fC=function(i,e,n){if(i!==null)if(i.memoizedProps!==e.pendingProps||ao.current)so=!0;else{if((i.lanes&n)===0&&(e.flags&128)===0)return so=!1,zL(i,e,n);so=(i.flags&131072)!==0}else so=!1,Di&&(e.flags&1048576)!==0&&_E(e,Mg,e.index);switch(e.lanes=0,e.tag){case 2:var l=e.type;og(i,e),i=e.pendingProps;var d=Hh(e,Rr.current);Nh(e,n),d=b1(null,e,l,i,d,n);var _=S1();return e.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,lo(l)?(_=!0,bg(e)):_=!1,e.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,g1(e),d.updater=Hg,e.stateNode=d,d._reactInternals=e,pv(e,l,i,n),e=gv(null,e,l,!0,_,n)):(e.tag=0,Di&&_&&u1(e),Nr(null,e,d,n),e=e.child),e;case 16:l=e.elementType;e:{switch(og(i,e),i=e.pendingProps,d=l._init,l=d(l._payload),e.type=l,d=e.tag=ZL(l),i=os(l,i),d){case 0:e=_v(null,e,l,i,n);break e;case 1:e=pM(null,e,l,i,n);break e;case 11:e=dM(null,e,l,i,n);break e;case 14:e=fM(null,e,l,os(l.type,i),n);break e}throw Error(Dt(306,l,""))}return e;case 0:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:os(l,d),_v(i,e,l,d,n);case 1:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:os(l,d),pM(i,e,l,d,n);case 3:e:{if(YE(e),i===null)throw Error(Dt(387));l=e.pendingProps,_=e.memoizedState,d=_.element,vE(i,e),Cg(e,l,null,n);var w=e.memoizedState;if(l=w.element,_.isDehydrated)if(_={element:l,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},e.updateQueue.baseState=_,e.memoizedState=_,e.flags&256){d=Xh(Error(Dt(423)),e),e=mM(i,e,l,n,d);break e}else if(l!==d){d=Xh(Error(Dt(424)),e),e=mM(i,e,l,n,d);break e}else for(wo=vl(e.stateNode.containerInfo.firstChild),bo=e,Di=!0,as=null,n=ME(e,null,l,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if($h(),l===d){e=ba(i,e,n);break e}Nr(i,e,l,n)}e=e.child}return e;case 5:return TE(e),i===null&&hv(e),l=e.type,d=e.pendingProps,_=i!==null?i.memoizedProps:null,w=d.children,sv(l,d)?w=null:_!==null&&sv(l,_)&&(e.flags|=32),XE(i,e),Nr(i,e,w,n),e.child;case 6:return i===null&&hv(e),null;case 13:return KE(i,e,n);case 4:return y1(e,e.stateNode.containerInfo),l=e.pendingProps,i===null?e.child=qh(e,null,l,n):Nr(i,e,l,n),e.child;case 11:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:os(l,d),dM(i,e,l,d,n);case 7:return Nr(i,e,e.pendingProps,n),e.child;case 8:return Nr(i,e,e.pendingProps.children,n),e.child;case 12:return Nr(i,e,e.pendingProps.children,n),e.child;case 10:e:{if(l=e.type._context,d=e.pendingProps,_=e.memoizedProps,w=d.value,xi(Tg,l._currentValue),l._currentValue=w,_!==null)if(fs(_.value,w)){if(_.children===d.children&&!ao.current){e=ba(i,e,n);break e}}else for(_=e.child,_!==null&&(_.return=e);_!==null;){var a=_.dependencies;if(a!==null){w=_.child;for(var T=a.firstContext;T!==null;){if(T.context===l){if(_.tag===1){T=ga(-1,n&-n),T.tag=2;var A=_.updateQueue;if(A!==null){A=A.shared;var D=A.pending;D===null?T.next=T:(T.next=D.next,D.next=T),A.pending=T}}_.lanes|=n,T=_.alternate,T!==null&&(T.lanes|=n),dv(_.return,n,e),a.lanes|=n;break}T=T.next}}else if(_.tag===10)w=_.type===e.type?null:_.child;else if(_.tag===18){if(w=_.return,w===null)throw Error(Dt(341));w.lanes|=n,a=w.alternate,a!==null&&(a.lanes|=n),dv(w,n,e),w=_.sibling}else w=_.child;if(w!==null)w.return=_;else for(w=_;w!==null;){if(w===e){w=null;break}if(_=w.sibling,_!==null){_.return=w.return,w=_;break}w=w.return}_=w}Nr(i,e,d.children,n),e=e.child}return e;case 9:return d=e.type,l=e.pendingProps.children,Nh(e,n),d=Vo(d),l=l(d),e.flags|=1,Nr(i,e,l,n),e.child;case 14:return l=e.type,d=os(l,e.pendingProps),d=os(l.type,d),fM(i,e,l,d,n);case 15:return qE(i,e,e.type,e.pendingProps,n);case 17:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:os(l,d),og(i,e),e.tag=1,lo(l)?(i=!0,bg(e)):i=!1,Nh(e,n),bE(e,l,d),pv(e,l,d,n),gv(null,e,l,!0,i,n);case 19:return JE(i,e,n);case 22:return ZE(i,e,n)}throw Error(Dt(156,e.tag))};function pC(i,e){return UT(i,e)}function qL(i,e,n,l){this.tag=i,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function No(i,e,n,l){return new qL(i,e,n,l)}function z1(i){return i=i.prototype,!(!i||!i.isReactComponent)}function ZL(i){if(typeof i=="function")return z1(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Jv)return 11;if(i===Qv)return 14}return 2}function Ml(i,e){var n=i.alternate;return n===null?(n=No(i.tag,e,i.key,i.mode),n.elementType=i.elementType,n.type=i.type,n.stateNode=i.stateNode,n.alternate=i,i.alternate=n):(n.pendingProps=e,n.type=i.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=i.flags&14680064,n.childLanes=i.childLanes,n.lanes=i.lanes,n.child=i.child,n.memoizedProps=i.memoizedProps,n.memoizedState=i.memoizedState,n.updateQueue=i.updateQueue,e=i.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=i.sibling,n.index=i.index,n.ref=i.ref,n}function lg(i,e,n,l,d,_){var w=2;if(l=i,typeof i=="function")z1(i)&&(w=1);else if(typeof i=="string")w=5;else e:switch(i){case bh:return Rc(n.children,d,_,e);case Kv:w=8,d|=8;break;case Ox:return i=No(12,n,e,d|2),i.elementType=Ox,i.lanes=_,i;case Nx:return i=No(13,n,e,d),i.elementType=Nx,i.lanes=_,i;case Ux:return i=No(19,n,e,d),i.elementType=Ux,i.lanes=_,i;case ST:return Xg(n,d,_,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case wT:w=10;break e;case bT:w=9;break e;case Jv:w=11;break e;case Qv:w=14;break e;case hl:w=16,l=null;break e}throw Error(Dt(130,i==null?i:typeof i,""))}return e=No(w,n,e,d),e.elementType=i,e.type=l,e.lanes=_,e}function Rc(i,e,n,l){return i=No(7,i,l,e),i.lanes=n,i}function Xg(i,e,n,l){return i=No(22,i,l,e),i.elementType=ST,i.lanes=n,i.stateNode={isHidden:!1},i}function Q0(i,e,n){return i=No(6,i,null,e),i.lanes=n,i}function ex(i,e,n){return e=No(4,i.children!==null?i.children:[],i.key,e),e.lanes=n,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function XL(i,e,n,l,d){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=k0(0),this.expirationTimes=k0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=k0(0),this.identifierPrefix=l,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function k1(i,e,n,l,d,_,w,a,T){return i=new XL(i,e,n,a,T),e===1?(e=1,_===!0&&(e|=8)):e=0,_=No(3,null,null,e),i.current=_,_.stateNode=i,_.memoizedState={element:l,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},g1(_),i}function YL(i,e,n){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wh,key:l==null?null:""+l,children:i,containerInfo:e,implementation:n}}function mC(i){if(!i)return Al;i=i._reactInternals;e:{if(Zc(i)!==i||i.tag!==1)throw Error(Dt(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(lo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Dt(171))}if(i.tag===1){var n=i.type;if(lo(n))return pE(i,n,e)}return e}function _C(i,e,n,l,d,_,w,a,T){return i=k1(n,l,!0,i,d,_,w,a,T),i.context=mC(null),n=i.current,l=Vr(),d=Sl(n),_=ga(l,d),_.callback=e!=null?e:null,wl(n,_,d),i.current.lanes=d,Mp(i,d,l),co(i,l),i}function Yg(i,e,n,l){var d=e.current,_=Vr(),w=Sl(d);return n=mC(n),e.context===null?e.context=n:e.pendingContext=n,e=ga(_,w),e.payload={element:i},l=l===void 0?null:l,l!==null&&(e.callback=l),i=wl(d,e,w),i!==null&&(hs(i,d,w,_),ng(i,d,w)),w}function Rg(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function TM(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var n=i.retryLane;i.retryLane=n!==0&&n<e?n:e}}function R1(i,e){TM(i,e),(i=i.alternate)&&TM(i,e)}function KL(){return null}var gC=typeof reportError=="function"?reportError:function(i){console.error(i)};function F1(i){this._internalRoot=i}Kg.prototype.render=F1.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(Dt(409));Yg(i,e,null,null)};Kg.prototype.unmount=F1.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;jc(function(){Yg(null,i,null,null)}),e[va]=null}};function Kg(i){this._internalRoot=i}Kg.prototype.unstable_scheduleHydration=function(i){if(i){var e=qT();i={blockedOn:null,target:i,priority:e};for(var n=0;n<fl.length&&e!==0&&e<fl[n].priority;n++);fl.splice(n,0,i),n===0&&XT(i)}};function B1(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Jg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function EM(){}function JL(i,e,n,l,d){if(d){if(typeof l=="function"){var _=l;l=function(){var A=Rg(w);_.call(A)}}var w=_C(e,l,i,0,null,!1,!1,"",EM);return i._reactRootContainer=w,i[va]=w.current,cp(i.nodeType===8?i.parentNode:i),jc(),w}for(;d=i.lastChild;)i.removeChild(d);if(typeof l=="function"){var a=l;l=function(){var A=Rg(T);a.call(A)}}var T=k1(i,0,!1,null,null,!1,!1,"",EM);return i._reactRootContainer=T,i[va]=T.current,cp(i.nodeType===8?i.parentNode:i),jc(function(){Yg(e,T,n,l)}),T}function Qg(i,e,n,l,d){var _=n._reactRootContainer;if(_){var w=_;if(typeof d=="function"){var a=d;d=function(){var T=Rg(w);a.call(T)}}Yg(e,w,i,d)}else w=JL(n,e,i,d,l);return Rg(w)}HT=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var n=Of(e.pendingLanes);n!==0&&(n1(e,n|1),co(e,qi()),(Jn&6)===0&&(Yh=qi()+500,zl()))}break;case 13:jc(function(){var l=wa(i,1);if(l!==null){var d=Vr();hs(l,i,1,d)}}),R1(i,1)}};i1=function(i){if(i.tag===13){var e=wa(i,134217728);if(e!==null){var n=Vr();hs(e,i,134217728,n)}R1(i,134217728)}};$T=function(i){if(i.tag===13){var e=Sl(i),n=wa(i,e);if(n!==null){var l=Vr();hs(n,i,e,l)}R1(i,e)}};qT=function(){return ai};ZT=function(i,e){var n=ai;try{return ai=i,e()}finally{ai=n}};Yx=function(i,e,n){switch(e){case"input":if(jx(i,n),e=n.name,n.type==="radio"&&e!=null){for(n=i;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var l=n[e];if(l!==i&&l.form===i.form){var d=jg(l);if(!d)throw Error(Dt(90));TT(l),jx(l,d)}}}break;case"textarea":CT(i,n);break;case"select":e=n.value,e!=null&&Rh(i,!!n.multiple,e,!1)}};kT=P1;RT=jc;var QL={usingClientEntryPoint:!1,Events:[Ep,Eh,jg,DT,zT,P1]},If={findFiberByHostInstance:Cc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},eD={bundleType:If.bundleType,version:If.version,rendererPackageName:If.rendererPackageName,rendererConfig:If.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ma.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=OT(i),i===null?null:i.stateNode},findFiberByHostInstance:If.findFiberByHostInstance||KL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var C_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!C_.isDisabled&&C_.supportsFiber)try{Ng=C_.inject(eD),Os=C_}catch{}}Mo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QL;Mo.createPortal=function(i,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B1(e))throw Error(Dt(200));return YL(i,e,null,n)};Mo.createRoot=function(i,e){if(!B1(i))throw Error(Dt(299));var n=!1,l="",d=gC;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(l=e.identifierPrefix),e.onRecoverableError!==void 0&&(d=e.onRecoverableError)),e=k1(i,1,!1,null,null,n,!1,l,d),i[va]=e.current,cp(i.nodeType===8?i.parentNode:i),new F1(e)};Mo.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(Dt(188)):(i=Object.keys(i).join(","),Error(Dt(268,i)));return i=OT(e),i=i===null?null:i.stateNode,i};Mo.flushSync=function(i){return jc(i)};Mo.hydrate=function(i,e,n){if(!Jg(e))throw Error(Dt(200));return Qg(null,i,e,!0,n)};Mo.hydrateRoot=function(i,e,n){if(!B1(i))throw Error(Dt(405));var l=n!=null&&n.hydratedSources||null,d=!1,_="",w=gC;if(n!=null&&(n.unstable_strictMode===!0&&(d=!0),n.identifierPrefix!==void 0&&(_=n.identifierPrefix),n.onRecoverableError!==void 0&&(w=n.onRecoverableError)),e=_C(e,null,i,1,n!=null?n:null,d,!1,_,w),i[va]=e.current,cp(i),l)for(i=0;i<l.length;i++)n=l[i],d=n._getVersion,d=d(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,d]:e.mutableSourceEagerHydrationData.push(n,d);return new Kg(e)};Mo.render=function(i,e,n){if(!Jg(e))throw Error(Dt(200));return Qg(null,i,e,!1,n)};Mo.unmountComponentAtNode=function(i){if(!Jg(i))throw Error(Dt(40));return i._reactRootContainer?(jc(function(){Qg(null,null,i,!1,function(){i._reactRootContainer=null,i[va]=null})}),!0):!1};Mo.unstable_batchedUpdates=P1;Mo.unstable_renderSubtreeIntoContainer=function(i,e,n,l){if(!Jg(n))throw Error(Dt(200));if(i==null||i._reactInternals===void 0)throw Error(Dt(38));return Qg(i,e,n,!1,l)};Mo.version="18.2.0-next-9e3b772b8-20220608";function yC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(yC)}catch(i){console.error(i)}}yC(),_T.exports=Mo;var CM=_T.exports;Fx.createRoot=CM.createRoot,Fx.hydrateRoot=CM.hydrateRoot;function Fg(){return Fg=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(i[l]=n[l])}return i},Fg.apply(this,arguments)}var Pc;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Pc||(Pc={}));var AM=function(i){return i},IM="beforeunload",tD="popstate";function nD(i){i===void 0&&(i={});var e=i,n=e.window,l=n===void 0?document.defaultView:n,d=l.history;function _(){var Te=l.location,ee=Te.pathname,Ae=Te.search,Fe=Te.hash,qe=d.state||{};return[qe.idx,AM({pathname:ee,search:Ae,hash:Fe,state:qe.usr||null,key:qe.key||"default"})]}var w=null;function a(){if(w)W.call(w),w=null;else{var Te=Pc.Pop,ee=_(),Ae=ee[0],Fe=ee[1];if(W.length){if(Ae!=null){var qe=D-Ae;qe&&(w={action:Te,location:Fe,retry:function(){K(qe*-1)}},K(qe))}}else $(Te)}}l.addEventListener(tD,a);var T=Pc.Pop,A=_(),D=A[0],P=A[1],k=LM(),W=LM();D==null&&(D=0,d.replaceState(Fg({},d.state,{idx:D}),""));function Z(Te){return typeof Te=="string"?Te:rD(Te)}function F(Te,ee){return ee===void 0&&(ee=null),AM(Fg({pathname:P.pathname,hash:"",search:""},typeof Te=="string"?ey(Te):Te,{state:ee,key:iD()}))}function B(Te,ee){return[{usr:Te.state,key:Te.key,idx:ee},Z(Te)]}function G(Te,ee,Ae){return!W.length||(W.call({action:Te,location:ee,retry:Ae}),!1)}function $(Te){T=Te;var ee=_();D=ee[0],P=ee[1],k.call({action:T,location:P})}function ne(Te,ee){var Ae=Pc.Push,Fe=F(Te,ee);function qe(){ne(Te,ee)}if(G(Ae,Fe,qe)){var Pt=B(Fe,D+1),xt=Pt[0],je=Pt[1];try{d.pushState(xt,"",je)}catch{l.location.assign(je)}$(Ae)}}function me(Te,ee){var Ae=Pc.Replace,Fe=F(Te,ee);function qe(){me(Te,ee)}if(G(Ae,Fe,qe)){var Pt=B(Fe,D),xt=Pt[0],je=Pt[1];d.replaceState(xt,"",je),$(Ae)}}function K(Te){d.go(Te)}var Ee={get action(){return T},get location(){return P},createHref:Z,push:ne,replace:me,go:K,back:function(){K(-1)},forward:function(){K(1)},listen:function(ee){return k.push(ee)},block:function(ee){var Ae=W.push(ee);return W.length===1&&l.addEventListener(IM,PM),function(){Ae(),W.length||l.removeEventListener(IM,PM)}}};return Ee}function PM(i){i.preventDefault(),i.returnValue=""}function LM(){var i=[];return{get length(){return i.length},push:function(n){return i.push(n),function(){i=i.filter(function(l){return l!==n})}},call:function(n){i.forEach(function(l){return l&&l(n)})}}}function iD(){return Math.random().toString(36).substr(2,8)}function rD(i){var e=i.pathname,n=e===void 0?"/":e,l=i.search,d=l===void 0?"":l,_=i.hash,w=_===void 0?"":_;return d&&d!=="?"&&(n+=d.charAt(0)==="?"?d:"?"+d),w&&w!=="#"&&(n+=w.charAt(0)==="#"?w:"#"+w),n}function ey(i){var e={};if(i){var n=i.indexOf("#");n>=0&&(e.hash=i.substr(n),i=i.substr(0,n));var l=i.indexOf("?");l>=0&&(e.search=i.substr(l),i=i.substr(0,l)),i&&(e.pathname=i)}return e}/**
 * React Router v6.3.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const oD=si.exports.createContext(null),O1=si.exports.createContext(null),xC=si.exports.createContext({outlet:null,matches:[]});function Il(i,e){if(!i)throw new Error(e)}function sD(i,e,n){n===void 0&&(n="/");let l=typeof e=="string"?ey(e):e,d=wC(l.pathname||"/",n);if(d==null)return null;let _=vC(i);aD(_);let w=null;for(let a=0;w==null&&a<_.length;++a)w=_D(_[a],d);return w}function vC(i,e,n,l){return e===void 0&&(e=[]),n===void 0&&(n=[]),l===void 0&&(l=""),i.forEach((d,_)=>{let w={relativePath:d.path||"",caseSensitive:d.caseSensitive===!0,childrenIndex:_,route:d};w.relativePath.startsWith("/")&&(w.relativePath.startsWith(l)||Il(!1),w.relativePath=w.relativePath.slice(l.length));let a=Vh([l,w.relativePath]),T=n.concat(w);d.children&&d.children.length>0&&(d.index===!0&&Il(!1),vC(d.children,e,T,a)),!(d.path==null&&!d.index)&&e.push({path:a,score:pD(a,d.index),routesMeta:T})}),e}function aD(i){i.sort((e,n)=>e.score!==n.score?n.score-e.score:mD(e.routesMeta.map(l=>l.childrenIndex),n.routesMeta.map(l=>l.childrenIndex)))}const lD=/^:\w+$/,cD=3,uD=2,hD=1,dD=10,fD=-2,DM=i=>i==="*";function pD(i,e){let n=i.split("/"),l=n.length;return n.some(DM)&&(l+=fD),e&&(l+=uD),n.filter(d=>!DM(d)).reduce((d,_)=>d+(lD.test(_)?cD:_===""?hD:dD),l)}function mD(i,e){return i.length===e.length&&i.slice(0,-1).every((l,d)=>l===e[d])?i[i.length-1]-e[e.length-1]:0}function _D(i,e){let{routesMeta:n}=i,l={},d="/",_=[];for(let w=0;w<n.length;++w){let a=n[w],T=w===n.length-1,A=d==="/"?e:e.slice(d.length)||"/",D=gD({path:a.relativePath,caseSensitive:a.caseSensitive,end:T},A);if(!D)return null;Object.assign(l,D.params);let P=a.route;_.push({params:l,pathname:Vh([d,D.pathname]),pathnameBase:bC(Vh([d,D.pathnameBase])),route:P}),D.pathnameBase!=="/"&&(d=Vh([d,D.pathnameBase]))}return _}function gD(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[n,l]=yD(i.path,i.caseSensitive,i.end),d=e.match(n);if(!d)return null;let _=d[0],w=_.replace(/(.)\/+$/,"$1"),a=d.slice(1);return{params:l.reduce((A,D,P)=>{if(D==="*"){let k=a[P]||"";w=_.slice(0,_.length-k.length).replace(/(.)\/+$/,"$1")}return A[D]=xD(a[P]||""),A},{}),pathname:_,pathnameBase:w,pattern:i}}function yD(i,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0);let l=[],d="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(w,a)=>(l.push(a),"([^\\/]+)"));return i.endsWith("*")?(l.push("*"),d+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d+=n?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)",[new RegExp(d,e?void 0:"i"),l]}function xD(i,e){try{return decodeURIComponent(i)}catch{return i}}function wC(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let n=i.charAt(e.length);return n&&n!=="/"?null:i.slice(e.length)||"/"}const Vh=i=>i.join("/").replace(/\/\/+/g,"/"),bC=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/");function N1(){return si.exports.useContext(O1)!=null}function vD(){return N1()||Il(!1),si.exports.useContext(O1).location}function wD(i,e){N1()||Il(!1);let{matches:n}=si.exports.useContext(xC),l=n[n.length-1],d=l?l.params:{};l&&l.pathname;let _=l?l.pathnameBase:"/";l&&l.route;let w=vD(),a;if(e){var T;let k=typeof e=="string"?ey(e):e;_==="/"||((T=k.pathname)==null?void 0:T.startsWith(_))||Il(!1),a=k}else a=w;let A=a.pathname||"/",D=_==="/"?A:A.slice(_.length)||"/",P=sD(i,{pathname:D});return bD(P&&P.map(k=>Object.assign({},k,{params:Object.assign({},d,k.params),pathname:Vh([_,k.pathname]),pathnameBase:k.pathnameBase==="/"?_:Vh([_,k.pathnameBase])})),n)}function bD(i,e){return e===void 0&&(e=[]),i==null?null:i.reduceRight((n,l,d)=>si.exports.createElement(xC.Provider,{children:l.route.element!==void 0?l.route.element:n,value:{outlet:n,matches:e.concat(i.slice(0,d+1))}}),null)}function cg(i){Il(!1)}function SD(i){let{basename:e="/",children:n=null,location:l,navigationType:d=Pc.Pop,navigator:_,static:w=!1}=i;N1()&&Il(!1);let a=bC(e),T=si.exports.useMemo(()=>({basename:a,navigator:_,static:w}),[a,_,w]);typeof l=="string"&&(l=ey(l));let{pathname:A="/",search:D="",hash:P="",state:k=null,key:W="default"}=l,Z=si.exports.useMemo(()=>{let F=wC(A,a);return F==null?null:{pathname:F,search:D,hash:P,state:k,key:W}},[a,A,D,P,k,W]);return Z==null?null:si.exports.createElement(oD.Provider,{value:T},si.exports.createElement(O1.Provider,{children:n,value:{location:Z,navigationType:d}}))}function MD(i){let{children:e,location:n}=i;return wD(Iv(e),n)}function Iv(i){let e=[];return si.exports.Children.forEach(i,n=>{if(!si.exports.isValidElement(n))return;if(n.type===si.exports.Fragment){e.push.apply(e,Iv(n.props.children));return}n.type!==cg&&Il(!1);let l={caseSensitive:n.props.caseSensitive,element:n.props.element,index:n.props.index,path:n.props.path};n.props.children&&(l.children=Iv(n.props.children)),e.push(l)}),e}/**
 * React Router DOM v6.3.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function TD(i){let{basename:e,children:n,window:l}=i,d=si.exports.useRef();d.current==null&&(d.current=nD({window:l}));let _=d.current,[w,a]=si.exports.useState({action:_.action,location:_.location});return si.exports.useLayoutEffect(()=>_.listen(a),[_]),si.exports.createElement(SD,{basename:e,children:n,location:w.location,navigationType:w.action,navigator:_})}const ED="_header_de33u_7",CD="_subHeader_de33u_17",AD="_introBox_de33u_30",ID="_footer_de33u_39",PD="_subText_de33u_70";var Pf={header:ED,subHeader:CD,introBox:AD,footer:ID,subText:PD};/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const U1="141",th={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},nh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},LD=0,zM=1,DD=2,SC=1,zD=2,Uf=3,yp=0,ds=1,Kh=2,kD=1,Tl=0,Gh=1,kM=2,RM=3,FM=4,RD=5,gh=100,FD=101,BD=102,BM=103,OM=104,OD=200,ND=201,UD=202,VD=203,MC=204,TC=205,GD=206,jD=207,WD=208,HD=209,$D=210,qD=0,ZD=1,XD=2,Pv=3,YD=4,KD=5,JD=6,QD=7,ty=0,ez=1,tz=2,ya=0,nz=1,iz=2,rz=3,oz=4,sz=5,EC=300,Jh=301,Qh=302,Lv=303,Dv=304,ny=306,xp=1e3,ls=1001,zv=1002,oo=1003,NM=1004,UM=1005,Oo=1006,az=1007,iy=1008,Wc=1009,lz=1010,cz=1011,CC=1012,uz=1013,Lc=1014,Dc=1015,vp=1016,hz=1017,dz=1018,jh=1020,fz=1021,pz=1022,cs=1023,mz=1024,_z=1025,Fc=1026,ed=1027,gz=1028,yz=1029,xz=1030,vz=1031,wz=1033,tx=33776,nx=33777,ix=33778,rx=33779,VM=35840,GM=35841,jM=35842,WM=35843,bz=36196,HM=37492,$M=37496,qM=37808,ZM=37809,XM=37810,YM=37811,KM=37812,JM=37813,QM=37814,e2=37815,t2=37816,n2=37817,i2=37818,r2=37819,o2=37820,s2=37821,a2=36492,Hc=3e3,Bi=3001,Sz=3200,Mz=3201,od=0,Tz=1,da="srgb",zc="srgb-linear",ox=7680,Ez=519,l2=35044,c2="300 es",kv=1035;class Xc{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const l=this._listeners;l[e]===void 0&&(l[e]=[]),l[e].indexOf(n)===-1&&l[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const l=this._listeners;return l[e]!==void 0&&l[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const d=this._listeners[e];if(d!==void 0){const _=d.indexOf(n);_!==-1&&d.splice(_,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const l=this._listeners[e.type];if(l!==void 0){e.target=this;const d=l.slice(0);for(let _=0,w=d.length;_<w;_++)d[_].call(this,e);e.target=null}}}const yr=[];for(let i=0;i<256;i++)yr[i]=(i<16?"0":"")+i.toString(16);const sx=Math.PI/180,Rv=180/Math.PI;function Ap(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,l=Math.random()*4294967295|0;return(yr[i&255]+yr[i>>8&255]+yr[i>>16&255]+yr[i>>24&255]+"-"+yr[e&255]+yr[e>>8&255]+"-"+yr[e>>16&15|64]+yr[e>>24&255]+"-"+yr[n&63|128]+yr[n>>8&255]+"-"+yr[n>>16&255]+yr[n>>24&255]+yr[l&255]+yr[l>>8&255]+yr[l>>16&255]+yr[l>>24&255]).toLowerCase()}function Ur(i,e,n){return Math.max(e,Math.min(n,i))}function Cz(i,e){return(i%e+e)%e}function ax(i,e,n){return(1-n)*i+n*e}function u2(i){return(i&i-1)===0&&i!==0}function Fv(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}class In{constructor(e=0,n=0){this.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,n){return n!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e,n){return n!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,l=this.y,d=e.elements;return this.x=d[0]*n+d[3]*l+d[6],this.y=d[1]*n+d[4]*l+d[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(e,Math.min(n,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,l=this.y-e.y;return n*n+l*l}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,l){return this.x=e.x+(n.x-e.x)*l,this.y=e.y+(n.y-e.y)*l,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n,l){return l!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const l=Math.cos(n),d=Math.sin(n),_=this.x-e.x,w=this.y-e.y;return this.x=_*l-w*d+e.x,this.y=_*d+w*l+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Bs{constructor(){this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,n,l,d,_,w,a,T,A){const D=this.elements;return D[0]=e,D[1]=d,D[2]=a,D[3]=n,D[4]=_,D[5]=T,D[6]=l,D[7]=w,D[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,l=e.elements;return n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=l[3],n[4]=l[4],n[5]=l[5],n[6]=l[6],n[7]=l[7],n[8]=l[8],this}extractBasis(e,n,l){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),l.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const l=e.elements,d=n.elements,_=this.elements,w=l[0],a=l[3],T=l[6],A=l[1],D=l[4],P=l[7],k=l[2],W=l[5],Z=l[8],F=d[0],B=d[3],G=d[6],$=d[1],ne=d[4],me=d[7],K=d[2],Ee=d[5],Te=d[8];return _[0]=w*F+a*$+T*K,_[3]=w*B+a*ne+T*Ee,_[6]=w*G+a*me+T*Te,_[1]=A*F+D*$+P*K,_[4]=A*B+D*ne+P*Ee,_[7]=A*G+D*me+P*Te,_[2]=k*F+W*$+Z*K,_[5]=k*B+W*ne+Z*Ee,_[8]=k*G+W*me+Z*Te,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],l=e[1],d=e[2],_=e[3],w=e[4],a=e[5],T=e[6],A=e[7],D=e[8];return n*w*D-n*a*A-l*_*D+l*a*T+d*_*A-d*w*T}invert(){const e=this.elements,n=e[0],l=e[1],d=e[2],_=e[3],w=e[4],a=e[5],T=e[6],A=e[7],D=e[8],P=D*w-a*A,k=a*T-D*_,W=A*_-w*T,Z=n*P+l*k+d*W;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0);const F=1/Z;return e[0]=P*F,e[1]=(d*A-D*l)*F,e[2]=(a*l-d*w)*F,e[3]=k*F,e[4]=(D*n-d*T)*F,e[5]=(d*_-a*n)*F,e[6]=W*F,e[7]=(l*T-A*n)*F,e[8]=(w*n-l*_)*F,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,l,d,_,w,a){const T=Math.cos(_),A=Math.sin(_);return this.set(l*T,l*A,-l*(T*w+A*a)+w+e,-d*A,d*T,-d*(-A*w+T*a)+a+n,0,0,1),this}scale(e,n){const l=this.elements;return l[0]*=e,l[3]*=e,l[6]*=e,l[1]*=n,l[4]*=n,l[7]*=n,this}rotate(e){const n=Math.cos(e),l=Math.sin(e),d=this.elements,_=d[0],w=d[3],a=d[6],T=d[1],A=d[4],D=d[7];return d[0]=n*_+l*T,d[3]=n*w+l*A,d[6]=n*a+l*D,d[1]=-l*_+n*T,d[4]=-l*w+n*A,d[7]=-l*a+n*D,this}translate(e,n){const l=this.elements;return l[0]+=e*l[2],l[3]+=e*l[5],l[6]+=e*l[8],l[1]+=n*l[2],l[4]+=n*l[5],l[7]+=n*l[8],this}equals(e){const n=this.elements,l=e.elements;for(let d=0;d<9;d++)if(n[d]!==l[d])return!1;return!0}fromArray(e,n=0){for(let l=0;l<9;l++)this.elements[l]=e[l+n];return this}toArray(e=[],n=0){const l=this.elements;return e[n]=l[0],e[n+1]=l[1],e[n+2]=l[2],e[n+3]=l[3],e[n+4]=l[4],e[n+5]=l[5],e[n+6]=l[6],e[n+7]=l[7],e[n+8]=l[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function AC(i){for(let e=i.length-1;e>=0;--e)if(i[e]>65535)return!0;return!1}function wp(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function Bc(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function ug(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const lx={[da]:{[zc]:Bc},[zc]:{[da]:ug}},ts={legacyMode:!0,get workingColorSpace(){return zc},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,n){if(this.legacyMode||e===n||!e||!n)return i;if(lx[e]&&lx[e][n]!==void 0){const l=lx[e][n];return i.r=l(i.r),i.g=l(i.g),i.b=l(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}},IC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ir={r:0,g:0,b:0},ns={h:0,s:0,l:0},A_={h:0,s:0,l:0};function cx(i,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?i+(e-i)*6*n:n<1/2?e:n<2/3?i+(e-i)*6*(2/3-n):i}function I_(i,e){return e.r=i.r,e.g=i.g,e.b=i.b,e}class Ln{constructor(e,n,l){return this.isColor=!0,this.r=1,this.g=1,this.b=1,n===void 0&&l===void 0?this.set(e):this.setRGB(e,n,l)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=da){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ts.toWorkingColorSpace(this,n),this}setRGB(e,n,l,d=zc){return this.r=e,this.g=n,this.b=l,ts.toWorkingColorSpace(this,d),this}setHSL(e,n,l,d=zc){if(e=Cz(e,1),n=Ur(n,0,1),l=Ur(l,0,1),n===0)this.r=this.g=this.b=l;else{const _=l<=.5?l*(1+n):l+n-l*n,w=2*l-_;this.r=cx(w,_,e+1/3),this.g=cx(w,_,e),this.b=cx(w,_,e-1/3)}return ts.toWorkingColorSpace(this,d),this}setStyle(e,n=da){function l(_){_!==void 0&&parseFloat(_)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let d;if(d=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let _;const w=d[1],a=d[2];switch(w){case"rgb":case"rgba":if(_=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(_[1],10))/255,this.g=Math.min(255,parseInt(_[2],10))/255,this.b=Math.min(255,parseInt(_[3],10))/255,ts.toWorkingColorSpace(this,n),l(_[4]),this;if(_=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(_[1],10))/100,this.g=Math.min(100,parseInt(_[2],10))/100,this.b=Math.min(100,parseInt(_[3],10))/100,ts.toWorkingColorSpace(this,n),l(_[4]),this;break;case"hsl":case"hsla":if(_=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const T=parseFloat(_[1])/360,A=parseInt(_[2],10)/100,D=parseInt(_[3],10)/100;return l(_[4]),this.setHSL(T,A,D,n)}break}}else if(d=/^\#([A-Fa-f\d]+)$/.exec(e)){const _=d[1],w=_.length;if(w===3)return this.r=parseInt(_.charAt(0)+_.charAt(0),16)/255,this.g=parseInt(_.charAt(1)+_.charAt(1),16)/255,this.b=parseInt(_.charAt(2)+_.charAt(2),16)/255,ts.toWorkingColorSpace(this,n),this;if(w===6)return this.r=parseInt(_.charAt(0)+_.charAt(1),16)/255,this.g=parseInt(_.charAt(2)+_.charAt(3),16)/255,this.b=parseInt(_.charAt(4)+_.charAt(5),16)/255,ts.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}setColorName(e,n=da){const l=IC[e.toLowerCase()];return l!==void 0?this.setHex(l,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Bc(e.r),this.g=Bc(e.g),this.b=Bc(e.b),this}copyLinearToSRGB(e){return this.r=ug(e.r),this.g=ug(e.g),this.b=ug(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=da){return ts.fromWorkingColorSpace(I_(this,ir),e),Ur(ir.r*255,0,255)<<16^Ur(ir.g*255,0,255)<<8^Ur(ir.b*255,0,255)<<0}getHexString(e=da){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=zc){ts.fromWorkingColorSpace(I_(this,ir),n);const l=ir.r,d=ir.g,_=ir.b,w=Math.max(l,d,_),a=Math.min(l,d,_);let T,A;const D=(a+w)/2;if(a===w)T=0,A=0;else{const P=w-a;switch(A=D<=.5?P/(w+a):P/(2-w-a),w){case l:T=(d-_)/P+(d<_?6:0);break;case d:T=(_-l)/P+2;break;case _:T=(l-d)/P+4;break}T/=6}return e.h=T,e.s=A,e.l=D,e}getRGB(e,n=zc){return ts.fromWorkingColorSpace(I_(this,ir),n),e.r=ir.r,e.g=ir.g,e.b=ir.b,e}getStyle(e=da){return ts.fromWorkingColorSpace(I_(this,ir),e),e!==da?`color(${e} ${ir.r} ${ir.g} ${ir.b})`:`rgb(${ir.r*255|0},${ir.g*255|0},${ir.b*255|0})`}offsetHSL(e,n,l){return this.getHSL(ns),ns.h+=e,ns.s+=n,ns.l+=l,this.setHSL(ns.h,ns.s,ns.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,l){return this.r=e.r+(n.r-e.r)*l,this.g=e.g+(n.g-e.g)*l,this.b=e.b+(n.b-e.b)*l,this}lerpHSL(e,n){this.getHSL(ns),e.getHSL(A_);const l=ax(ns.h,A_.h,n),d=ax(ns.s,A_.s,n),_=ax(ns.l,A_.l,n);return this.setHSL(l,d,_),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Ln.NAMES=IC;let ih;class PC{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{ih===void 0&&(ih=wp("canvas")),ih.width=e.width,ih.height=e.height;const l=ih.getContext("2d");e instanceof ImageData?l.putImageData(e,0,0):l.drawImage(e,0,0,e.width,e.height),n=ih}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const n=wp("canvas");n.width=e.width,n.height=e.height;const l=n.getContext("2d");l.drawImage(e,0,0,e.width,e.height);const d=l.getImageData(0,0,e.width,e.height),_=d.data;for(let w=0;w<_.length;w++)_[w]=Bc(_[w]/255)*255;return l.putImageData(d,0,0),n}else if(e.data){const n=e.data.slice(0);for(let l=0;l<n.length;l++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[l]=Math.floor(Bc(n[l]/255)*255):n[l]=Bc(n[l]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class LC{constructor(e=null){this.isSource=!0,this.uuid=Ap(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const l={uuid:this.uuid,url:""},d=this.data;if(d!==null){let _;if(Array.isArray(d)){_=[];for(let w=0,a=d.length;w<a;w++)d[w].isDataTexture?_.push(ux(d[w].image)):_.push(ux(d[w]))}else _=ux(d);l.url=_}return n||(e.images[this.uuid]=l),l}}function ux(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?PC.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Az=0;class jo extends Xc{constructor(e=jo.DEFAULT_IMAGE,n=jo.DEFAULT_MAPPING,l=ls,d=ls,_=Oo,w=iy,a=cs,T=Wc,A=1,D=Hc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Az++}),this.uuid=Ap(),this.name="",this.source=new LC(e),this.mipmaps=[],this.mapping=n,this.wrapS=l,this.wrapT=d,this.magFilter=_,this.minFilter=w,this.anisotropy=A,this.format=a,this.internalFormat=null,this.type=T,this.offset=new In(0,0),this.repeat=new In(1,1),this.center=new In(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Bs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=D,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const l={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),n||(e.textures[this.uuid]=l),l}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==EC)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case xp:e.x=e.x-Math.floor(e.x);break;case ls:e.x=e.x<0?0:1;break;case zv:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case xp:e.y=e.y-Math.floor(e.y);break;case ls:e.y=e.y<0?0:1;break;case zv:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}jo.DEFAULT_IMAGE=null;jo.DEFAULT_MAPPING=EC;class vr{constructor(e=0,n=0,l=0,d=1){this.isVector4=!0,this.x=e,this.y=n,this.z=l,this.w=d}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,l,d){return this.x=e,this.y=n,this.z=l,this.w=d,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,n){return n!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e,n){return n!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,l=this.y,d=this.z,_=this.w,w=e.elements;return this.x=w[0]*n+w[4]*l+w[8]*d+w[12]*_,this.y=w[1]*n+w[5]*l+w[9]*d+w[13]*_,this.z=w[2]*n+w[6]*l+w[10]*d+w[14]*_,this.w=w[3]*n+w[7]*l+w[11]*d+w[15]*_,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,l,d,_;const T=e.elements,A=T[0],D=T[4],P=T[8],k=T[1],W=T[5],Z=T[9],F=T[2],B=T[6],G=T[10];if(Math.abs(D-k)<.01&&Math.abs(P-F)<.01&&Math.abs(Z-B)<.01){if(Math.abs(D+k)<.1&&Math.abs(P+F)<.1&&Math.abs(Z+B)<.1&&Math.abs(A+W+G-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const ne=(A+1)/2,me=(W+1)/2,K=(G+1)/2,Ee=(D+k)/4,Te=(P+F)/4,ee=(Z+B)/4;return ne>me&&ne>K?ne<.01?(l=0,d=.707106781,_=.707106781):(l=Math.sqrt(ne),d=Ee/l,_=Te/l):me>K?me<.01?(l=.707106781,d=0,_=.707106781):(d=Math.sqrt(me),l=Ee/d,_=ee/d):K<.01?(l=.707106781,d=.707106781,_=0):(_=Math.sqrt(K),l=Te/_,d=ee/_),this.set(l,d,_,n),this}let $=Math.sqrt((B-Z)*(B-Z)+(P-F)*(P-F)+(k-D)*(k-D));return Math.abs($)<.001&&($=1),this.x=(B-Z)/$,this.y=(P-F)/$,this.z=(k-D)/$,this.w=Math.acos((A+W+G-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(e,Math.min(n,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,l){return this.x=e.x+(n.x-e.x)*l,this.y=e.y+(n.y-e.y)*l,this.z=e.z+(n.z-e.z)*l,this.w=e.w+(n.w-e.w)*l,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n,l){return l!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class El extends Xc{constructor(e,n,l={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new vr(0,0,e,n),this.scissorTest=!1,this.viewport=new vr(0,0,e,n);const d={width:e,height:n,depth:1};this.texture=new jo(d,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=l.generateMipmaps!==void 0?l.generateMipmaps:!1,this.texture.internalFormat=l.internalFormat!==void 0?l.internalFormat:null,this.texture.minFilter=l.minFilter!==void 0?l.minFilter:Oo,this.depthBuffer=l.depthBuffer!==void 0?l.depthBuffer:!0,this.stencilBuffer=l.stencilBuffer!==void 0?l.stencilBuffer:!1,this.depthTexture=l.depthTexture!==void 0?l.depthTexture:null,this.samples=l.samples!==void 0?l.samples:0}setSize(e,n,l=1){(this.width!==e||this.height!==n||this.depth!==l)&&(this.width=e,this.height=n,this.depth=l,this.texture.image.width=e,this.texture.image.height=n,this.texture.image.depth=l,this.dispose()),this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new LC(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class DC extends jo{constructor(e=null,n=1,l=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:l,depth:d},this.magFilter=oo,this.minFilter=oo,this.wrapR=ls,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Iz extends jo{constructor(e=null,n=1,l=1,d=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:l,depth:d},this.magFilter=oo,this.minFilter=oo,this.wrapR=ls,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $c{constructor(e=0,n=0,l=0,d=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=l,this._w=d}static slerp(e,n,l,d){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),l.slerpQuaternions(e,n,d)}static slerpFlat(e,n,l,d,_,w,a){let T=l[d+0],A=l[d+1],D=l[d+2],P=l[d+3];const k=_[w+0],W=_[w+1],Z=_[w+2],F=_[w+3];if(a===0){e[n+0]=T,e[n+1]=A,e[n+2]=D,e[n+3]=P;return}if(a===1){e[n+0]=k,e[n+1]=W,e[n+2]=Z,e[n+3]=F;return}if(P!==F||T!==k||A!==W||D!==Z){let B=1-a;const G=T*k+A*W+D*Z+P*F,$=G>=0?1:-1,ne=1-G*G;if(ne>Number.EPSILON){const K=Math.sqrt(ne),Ee=Math.atan2(K,G*$);B=Math.sin(B*Ee)/K,a=Math.sin(a*Ee)/K}const me=a*$;if(T=T*B+k*me,A=A*B+W*me,D=D*B+Z*me,P=P*B+F*me,B===1-a){const K=1/Math.sqrt(T*T+A*A+D*D+P*P);T*=K,A*=K,D*=K,P*=K}}e[n]=T,e[n+1]=A,e[n+2]=D,e[n+3]=P}static multiplyQuaternionsFlat(e,n,l,d,_,w){const a=l[d],T=l[d+1],A=l[d+2],D=l[d+3],P=_[w],k=_[w+1],W=_[w+2],Z=_[w+3];return e[n]=a*Z+D*P+T*W-A*k,e[n+1]=T*Z+D*k+A*P-a*W,e[n+2]=A*Z+D*W+a*k-T*P,e[n+3]=D*Z-a*P-T*k-A*W,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,l,d){return this._x=e,this._y=n,this._z=l,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const l=e._x,d=e._y,_=e._z,w=e._order,a=Math.cos,T=Math.sin,A=a(l/2),D=a(d/2),P=a(_/2),k=T(l/2),W=T(d/2),Z=T(_/2);switch(w){case"XYZ":this._x=k*D*P+A*W*Z,this._y=A*W*P-k*D*Z,this._z=A*D*Z+k*W*P,this._w=A*D*P-k*W*Z;break;case"YXZ":this._x=k*D*P+A*W*Z,this._y=A*W*P-k*D*Z,this._z=A*D*Z-k*W*P,this._w=A*D*P+k*W*Z;break;case"ZXY":this._x=k*D*P-A*W*Z,this._y=A*W*P+k*D*Z,this._z=A*D*Z+k*W*P,this._w=A*D*P-k*W*Z;break;case"ZYX":this._x=k*D*P-A*W*Z,this._y=A*W*P+k*D*Z,this._z=A*D*Z-k*W*P,this._w=A*D*P+k*W*Z;break;case"YZX":this._x=k*D*P+A*W*Z,this._y=A*W*P+k*D*Z,this._z=A*D*Z-k*W*P,this._w=A*D*P-k*W*Z;break;case"XZY":this._x=k*D*P-A*W*Z,this._y=A*W*P-k*D*Z,this._z=A*D*Z+k*W*P,this._w=A*D*P+k*W*Z;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+w)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const l=n/2,d=Math.sin(l);return this._x=e.x*d,this._y=e.y*d,this._z=e.z*d,this._w=Math.cos(l),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,l=n[0],d=n[4],_=n[8],w=n[1],a=n[5],T=n[9],A=n[2],D=n[6],P=n[10],k=l+a+P;if(k>0){const W=.5/Math.sqrt(k+1);this._w=.25/W,this._x=(D-T)*W,this._y=(_-A)*W,this._z=(w-d)*W}else if(l>a&&l>P){const W=2*Math.sqrt(1+l-a-P);this._w=(D-T)/W,this._x=.25*W,this._y=(d+w)/W,this._z=(_+A)/W}else if(a>P){const W=2*Math.sqrt(1+a-l-P);this._w=(_-A)/W,this._x=(d+w)/W,this._y=.25*W,this._z=(T+D)/W}else{const W=2*Math.sqrt(1+P-l-a);this._w=(w-d)/W,this._x=(_+A)/W,this._y=(T+D)/W,this._z=.25*W}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let l=e.dot(n)+1;return l<Number.EPSILON?(l=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=l):(this._x=0,this._y=-e.z,this._z=e.y,this._w=l)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=l),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ur(this.dot(e),-1,1)))}rotateTowards(e,n){const l=this.angleTo(e);if(l===0)return this;const d=Math.min(1,n/l);return this.slerp(e,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,n){return n!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,n)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const l=e._x,d=e._y,_=e._z,w=e._w,a=n._x,T=n._y,A=n._z,D=n._w;return this._x=l*D+w*a+d*A-_*T,this._y=d*D+w*T+_*a-l*A,this._z=_*D+w*A+l*T-d*a,this._w=w*D-l*a-d*T-_*A,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const l=this._x,d=this._y,_=this._z,w=this._w;let a=w*e._w+l*e._x+d*e._y+_*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=w,this._x=l,this._y=d,this._z=_,this;const T=1-a*a;if(T<=Number.EPSILON){const W=1-n;return this._w=W*w+n*this._w,this._x=W*l+n*this._x,this._y=W*d+n*this._y,this._z=W*_+n*this._z,this.normalize(),this._onChangeCallback(),this}const A=Math.sqrt(T),D=Math.atan2(A,a),P=Math.sin((1-n)*D)/A,k=Math.sin(n*D)/A;return this._w=w*P+this._w*k,this._x=l*P+this._x*k,this._y=d*P+this._y*k,this._z=_*P+this._z*k,this._onChangeCallback(),this}slerpQuaternions(e,n,l){return this.copy(e).slerp(n,l)}random(){const e=Math.random(),n=Math.sqrt(1-e),l=Math.sqrt(e),d=2*Math.PI*Math.random(),_=2*Math.PI*Math.random();return this.set(n*Math.cos(d),l*Math.sin(_),l*Math.cos(_),n*Math.sin(d))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ye{constructor(e=0,n=0,l=0){this.isVector3=!0,this.x=e,this.y=n,this.z=l}set(e,n,l){return l===void 0&&(l=this.z),this.x=e,this.y=n,this.z=l,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,n){return n!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e,n){return n!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e,n){return n!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,n)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(h2.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(h2.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,l=this.y,d=this.z,_=e.elements;return this.x=_[0]*n+_[3]*l+_[6]*d,this.y=_[1]*n+_[4]*l+_[7]*d,this.z=_[2]*n+_[5]*l+_[8]*d,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,l=this.y,d=this.z,_=e.elements,w=1/(_[3]*n+_[7]*l+_[11]*d+_[15]);return this.x=(_[0]*n+_[4]*l+_[8]*d+_[12])*w,this.y=(_[1]*n+_[5]*l+_[9]*d+_[13])*w,this.z=(_[2]*n+_[6]*l+_[10]*d+_[14])*w,this}applyQuaternion(e){const n=this.x,l=this.y,d=this.z,_=e.x,w=e.y,a=e.z,T=e.w,A=T*n+w*d-a*l,D=T*l+a*n-_*d,P=T*d+_*l-w*n,k=-_*n-w*l-a*d;return this.x=A*T+k*-_+D*-a-P*-w,this.y=D*T+k*-w+P*-_-A*-a,this.z=P*T+k*-a+A*-w-D*-_,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,l=this.y,d=this.z,_=e.elements;return this.x=_[0]*n+_[4]*l+_[8]*d,this.y=_[1]*n+_[5]*l+_[9]*d,this.z=_[2]*n+_[6]*l+_[10]*d,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(e,Math.min(n,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,l){return this.x=e.x+(n.x-e.x)*l,this.y=e.y+(n.y-e.y)*l,this.z=e.z+(n.z-e.z)*l,this}cross(e,n){return n!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,n)):this.crossVectors(this,e)}crossVectors(e,n){const l=e.x,d=e.y,_=e.z,w=n.x,a=n.y,T=n.z;return this.x=d*T-_*a,this.y=_*w-l*T,this.z=l*a-d*w,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const l=e.dot(this)/n;return this.copy(e).multiplyScalar(l)}projectOnPlane(e){return hx.copy(this).projectOnVector(e),this.sub(hx)}reflect(e){return this.sub(hx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const l=this.dot(e)/n;return Math.acos(Ur(l,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,l=this.y-e.y,d=this.z-e.z;return n*n+l*l+d*d}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,l){const d=Math.sin(n)*e;return this.x=d*Math.sin(l),this.y=Math.cos(n)*e,this.z=d*Math.cos(l),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,l){return this.x=e*Math.sin(n),this.y=l,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),l=this.setFromMatrixColumn(e,1).length(),d=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=l,this.z=d,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n,l){return l!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,n=Math.random()*Math.PI*2,l=Math.sqrt(1-e**2);return this.x=l*Math.cos(n),this.y=l*Math.sin(n),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const hx=new Ye,h2=new $c;class Ip{constructor(e=new Ye(1/0,1/0,1/0),n=new Ye(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){let n=1/0,l=1/0,d=1/0,_=-1/0,w=-1/0,a=-1/0;for(let T=0,A=e.length;T<A;T+=3){const D=e[T],P=e[T+1],k=e[T+2];D<n&&(n=D),P<l&&(l=P),k<d&&(d=k),D>_&&(_=D),P>w&&(w=P),k>a&&(a=k)}return this.min.set(n,l,d),this.max.set(_,w,a),this}setFromBufferAttribute(e){let n=1/0,l=1/0,d=1/0,_=-1/0,w=-1/0,a=-1/0;for(let T=0,A=e.count;T<A;T++){const D=e.getX(T),P=e.getY(T),k=e.getZ(T);D<n&&(n=D),P<l&&(l=P),k<d&&(d=k),D>_&&(_=D),P>w&&(w=P),k>a&&(a=k)}return this.min.set(n,l,d),this.max.set(_,w,a),this}setFromPoints(e){this.makeEmpty();for(let n=0,l=e.length;n<l;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const l=xc.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(l),this.max.copy(e).add(l),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const l=e.geometry;if(l!==void 0)if(n&&l.attributes!=null&&l.attributes.position!==void 0){const _=l.attributes.position;for(let w=0,a=_.count;w<a;w++)xc.fromBufferAttribute(_,w).applyMatrix4(e.matrixWorld),this.expandByPoint(xc)}else l.boundingBox===null&&l.computeBoundingBox(),dx.copy(l.boundingBox),dx.applyMatrix4(e.matrixWorld),this.union(dx);const d=e.children;for(let _=0,w=d.length;_<w;_++)this.expandByObject(d[_],n);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,xc),xc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,l;return e.normal.x>0?(n=e.normal.x*this.min.x,l=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,l=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,l+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,l+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,l+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,l+=e.normal.z*this.min.z),n<=-e.constant&&l>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Lf),P_.subVectors(this.max,Lf),rh.subVectors(e.a,Lf),oh.subVectors(e.b,Lf),sh.subVectors(e.c,Lf),rl.subVectors(oh,rh),ol.subVectors(sh,oh),vc.subVectors(rh,sh);let n=[0,-rl.z,rl.y,0,-ol.z,ol.y,0,-vc.z,vc.y,rl.z,0,-rl.x,ol.z,0,-ol.x,vc.z,0,-vc.x,-rl.y,rl.x,0,-ol.y,ol.x,0,-vc.y,vc.x,0];return!fx(n,rh,oh,sh,P_)||(n=[1,0,0,0,1,0,0,0,1],!fx(n,rh,oh,sh,P_))?!1:(L_.crossVectors(rl,ol),n=[L_.x,L_.y,L_.z],fx(n,rh,oh,sh,P_))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return xc.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(xc).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(sa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),sa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),sa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),sa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),sa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),sa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),sa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),sa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(sa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const sa=[new Ye,new Ye,new Ye,new Ye,new Ye,new Ye,new Ye,new Ye],xc=new Ye,dx=new Ip,rh=new Ye,oh=new Ye,sh=new Ye,rl=new Ye,ol=new Ye,vc=new Ye,Lf=new Ye,P_=new Ye,L_=new Ye,wc=new Ye;function fx(i,e,n,l,d){for(let _=0,w=i.length-3;_<=w;_+=3){wc.fromArray(i,_);const a=d.x*Math.abs(wc.x)+d.y*Math.abs(wc.y)+d.z*Math.abs(wc.z),T=e.dot(wc),A=n.dot(wc),D=l.dot(wc);if(Math.max(-Math.max(T,A,D),Math.min(T,A,D))>a)return!1}return!0}const Pz=new Ip,d2=new Ye,D_=new Ye,px=new Ye;class V1{constructor(e=new Ye,n=-1){this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const l=this.center;n!==void 0?l.copy(n):Pz.setFromPoints(e).getCenter(l);let d=0;for(let _=0,w=e.length;_<w;_++)d=Math.max(d,l.distanceToSquared(e[_]));return this.radius=Math.sqrt(d),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const l=this.center.distanceToSquared(e);return n.copy(e),l>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){px.subVectors(e,this.center);const n=px.lengthSq();if(n>this.radius*this.radius){const l=Math.sqrt(n),d=(l-this.radius)*.5;this.center.add(px.multiplyScalar(d/l)),this.radius+=d}return this}union(e){return this.center.equals(e.center)===!0?D_.set(0,0,1).multiplyScalar(e.radius):D_.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(d2.copy(e.center).add(D_)),this.expandByPoint(d2.copy(e.center).sub(D_)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const aa=new Ye,mx=new Ye,z_=new Ye,sl=new Ye,_x=new Ye,k_=new Ye,gx=new Ye;class Lz{constructor(e=new Ye,n=new Ye(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,aa)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const l=n.dot(this.direction);return l<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(l).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=aa.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(aa.copy(this.direction).multiplyScalar(n).add(this.origin),aa.distanceToSquared(e))}distanceSqToSegment(e,n,l,d){mx.copy(e).add(n).multiplyScalar(.5),z_.copy(n).sub(e).normalize(),sl.copy(this.origin).sub(mx);const _=e.distanceTo(n)*.5,w=-this.direction.dot(z_),a=sl.dot(this.direction),T=-sl.dot(z_),A=sl.lengthSq(),D=Math.abs(1-w*w);let P,k,W,Z;if(D>0)if(P=w*T-a,k=w*a-T,Z=_*D,P>=0)if(k>=-Z)if(k<=Z){const F=1/D;P*=F,k*=F,W=P*(P+w*k+2*a)+k*(w*P+k+2*T)+A}else k=_,P=Math.max(0,-(w*k+a)),W=-P*P+k*(k+2*T)+A;else k=-_,P=Math.max(0,-(w*k+a)),W=-P*P+k*(k+2*T)+A;else k<=-Z?(P=Math.max(0,-(-w*_+a)),k=P>0?-_:Math.min(Math.max(-_,-T),_),W=-P*P+k*(k+2*T)+A):k<=Z?(P=0,k=Math.min(Math.max(-_,-T),_),W=k*(k+2*T)+A):(P=Math.max(0,-(w*_+a)),k=P>0?_:Math.min(Math.max(-_,-T),_),W=-P*P+k*(k+2*T)+A);else k=w>0?-_:_,P=Math.max(0,-(w*k+a)),W=-P*P+k*(k+2*T)+A;return l&&l.copy(this.direction).multiplyScalar(P).add(this.origin),d&&d.copy(z_).multiplyScalar(k).add(mx),W}intersectSphere(e,n){aa.subVectors(e.center,this.origin);const l=aa.dot(this.direction),d=aa.dot(aa)-l*l,_=e.radius*e.radius;if(d>_)return null;const w=Math.sqrt(_-d),a=l-w,T=l+w;return a<0&&T<0?null:a<0?this.at(T,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const l=-(this.origin.dot(e.normal)+e.constant)/n;return l>=0?l:null}intersectPlane(e,n){const l=this.distanceToPlane(e);return l===null?null:this.at(l,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let l,d,_,w,a,T;const A=1/this.direction.x,D=1/this.direction.y,P=1/this.direction.z,k=this.origin;return A>=0?(l=(e.min.x-k.x)*A,d=(e.max.x-k.x)*A):(l=(e.max.x-k.x)*A,d=(e.min.x-k.x)*A),D>=0?(_=(e.min.y-k.y)*D,w=(e.max.y-k.y)*D):(_=(e.max.y-k.y)*D,w=(e.min.y-k.y)*D),l>w||_>d||((_>l||l!==l)&&(l=_),(w<d||d!==d)&&(d=w),P>=0?(a=(e.min.z-k.z)*P,T=(e.max.z-k.z)*P):(a=(e.max.z-k.z)*P,T=(e.min.z-k.z)*P),l>T||a>d)||((a>l||l!==l)&&(l=a),(T<d||d!==d)&&(d=T),d<0)?null:this.at(l>=0?l:d,n)}intersectsBox(e){return this.intersectBox(e,aa)!==null}intersectTriangle(e,n,l,d,_){_x.subVectors(n,e),k_.subVectors(l,e),gx.crossVectors(_x,k_);let w=this.direction.dot(gx),a;if(w>0){if(d)return null;a=1}else if(w<0)a=-1,w=-w;else return null;sl.subVectors(this.origin,e);const T=a*this.direction.dot(k_.crossVectors(sl,k_));if(T<0)return null;const A=a*this.direction.dot(_x.cross(sl));if(A<0||T+A>w)return null;const D=-a*sl.dot(gx);return D<0?null:this.at(D/w,_)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pr{constructor(){this.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,n,l,d,_,w,a,T,A,D,P,k,W,Z,F,B){const G=this.elements;return G[0]=e,G[4]=n,G[8]=l,G[12]=d,G[1]=_,G[5]=w,G[9]=a,G[13]=T,G[2]=A,G[6]=D,G[10]=P,G[14]=k,G[3]=W,G[7]=Z,G[11]=F,G[15]=B,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pr().fromArray(this.elements)}copy(e){const n=this.elements,l=e.elements;return n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=l[3],n[4]=l[4],n[5]=l[5],n[6]=l[6],n[7]=l[7],n[8]=l[8],n[9]=l[9],n[10]=l[10],n[11]=l[11],n[12]=l[12],n[13]=l[13],n[14]=l[14],n[15]=l[15],this}copyPosition(e){const n=this.elements,l=e.elements;return n[12]=l[12],n[13]=l[13],n[14]=l[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,l){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),l.setFromMatrixColumn(this,2),this}makeBasis(e,n,l){return this.set(e.x,n.x,l.x,0,e.y,n.y,l.y,0,e.z,n.z,l.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,l=e.elements,d=1/ah.setFromMatrixColumn(e,0).length(),_=1/ah.setFromMatrixColumn(e,1).length(),w=1/ah.setFromMatrixColumn(e,2).length();return n[0]=l[0]*d,n[1]=l[1]*d,n[2]=l[2]*d,n[3]=0,n[4]=l[4]*_,n[5]=l[5]*_,n[6]=l[6]*_,n[7]=0,n[8]=l[8]*w,n[9]=l[9]*w,n[10]=l[10]*w,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const n=this.elements,l=e.x,d=e.y,_=e.z,w=Math.cos(l),a=Math.sin(l),T=Math.cos(d),A=Math.sin(d),D=Math.cos(_),P=Math.sin(_);if(e.order==="XYZ"){const k=w*D,W=w*P,Z=a*D,F=a*P;n[0]=T*D,n[4]=-T*P,n[8]=A,n[1]=W+Z*A,n[5]=k-F*A,n[9]=-a*T,n[2]=F-k*A,n[6]=Z+W*A,n[10]=w*T}else if(e.order==="YXZ"){const k=T*D,W=T*P,Z=A*D,F=A*P;n[0]=k+F*a,n[4]=Z*a-W,n[8]=w*A,n[1]=w*P,n[5]=w*D,n[9]=-a,n[2]=W*a-Z,n[6]=F+k*a,n[10]=w*T}else if(e.order==="ZXY"){const k=T*D,W=T*P,Z=A*D,F=A*P;n[0]=k-F*a,n[4]=-w*P,n[8]=Z+W*a,n[1]=W+Z*a,n[5]=w*D,n[9]=F-k*a,n[2]=-w*A,n[6]=a,n[10]=w*T}else if(e.order==="ZYX"){const k=w*D,W=w*P,Z=a*D,F=a*P;n[0]=T*D,n[4]=Z*A-W,n[8]=k*A+F,n[1]=T*P,n[5]=F*A+k,n[9]=W*A-Z,n[2]=-A,n[6]=a*T,n[10]=w*T}else if(e.order==="YZX"){const k=w*T,W=w*A,Z=a*T,F=a*A;n[0]=T*D,n[4]=F-k*P,n[8]=Z*P+W,n[1]=P,n[5]=w*D,n[9]=-a*D,n[2]=-A*D,n[6]=W*P+Z,n[10]=k-F*P}else if(e.order==="XZY"){const k=w*T,W=w*A,Z=a*T,F=a*A;n[0]=T*D,n[4]=-P,n[8]=A*D,n[1]=k*P+F,n[5]=w*D,n[9]=W*P-Z,n[2]=Z*P-W,n[6]=a*D,n[10]=F*P+k}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Dz,e,zz)}lookAt(e,n,l){const d=this.elements;return go.subVectors(e,n),go.lengthSq()===0&&(go.z=1),go.normalize(),al.crossVectors(l,go),al.lengthSq()===0&&(Math.abs(l.z)===1?go.x+=1e-4:go.z+=1e-4,go.normalize(),al.crossVectors(l,go)),al.normalize(),R_.crossVectors(go,al),d[0]=al.x,d[4]=R_.x,d[8]=go.x,d[1]=al.y,d[5]=R_.y,d[9]=go.y,d[2]=al.z,d[6]=R_.z,d[10]=go.z,this}multiply(e,n){return n!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,n)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const l=e.elements,d=n.elements,_=this.elements,w=l[0],a=l[4],T=l[8],A=l[12],D=l[1],P=l[5],k=l[9],W=l[13],Z=l[2],F=l[6],B=l[10],G=l[14],$=l[3],ne=l[7],me=l[11],K=l[15],Ee=d[0],Te=d[4],ee=d[8],Ae=d[12],Fe=d[1],qe=d[5],Pt=d[9],xt=d[13],je=d[2],ut=d[6],tt=d[10],ct=d[14],Be=d[3],Ne=d[7],Ze=d[11],pt=d[15];return _[0]=w*Ee+a*Fe+T*je+A*Be,_[4]=w*Te+a*qe+T*ut+A*Ne,_[8]=w*ee+a*Pt+T*tt+A*Ze,_[12]=w*Ae+a*xt+T*ct+A*pt,_[1]=D*Ee+P*Fe+k*je+W*Be,_[5]=D*Te+P*qe+k*ut+W*Ne,_[9]=D*ee+P*Pt+k*tt+W*Ze,_[13]=D*Ae+P*xt+k*ct+W*pt,_[2]=Z*Ee+F*Fe+B*je+G*Be,_[6]=Z*Te+F*qe+B*ut+G*Ne,_[10]=Z*ee+F*Pt+B*tt+G*Ze,_[14]=Z*Ae+F*xt+B*ct+G*pt,_[3]=$*Ee+ne*Fe+me*je+K*Be,_[7]=$*Te+ne*qe+me*ut+K*Ne,_[11]=$*ee+ne*Pt+me*tt+K*Ze,_[15]=$*Ae+ne*xt+me*ct+K*pt,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],l=e[4],d=e[8],_=e[12],w=e[1],a=e[5],T=e[9],A=e[13],D=e[2],P=e[6],k=e[10],W=e[14],Z=e[3],F=e[7],B=e[11],G=e[15];return Z*(+_*T*P-d*A*P-_*a*k+l*A*k+d*a*W-l*T*W)+F*(+n*T*W-n*A*k+_*w*k-d*w*W+d*A*D-_*T*D)+B*(+n*A*P-n*a*W-_*w*P+l*w*W+_*a*D-l*A*D)+G*(-d*a*D-n*T*P+n*a*k+d*w*P-l*w*k+l*T*D)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,l){const d=this.elements;return e.isVector3?(d[12]=e.x,d[13]=e.y,d[14]=e.z):(d[12]=e,d[13]=n,d[14]=l),this}invert(){const e=this.elements,n=e[0],l=e[1],d=e[2],_=e[3],w=e[4],a=e[5],T=e[6],A=e[7],D=e[8],P=e[9],k=e[10],W=e[11],Z=e[12],F=e[13],B=e[14],G=e[15],$=P*B*A-F*k*A+F*T*W-a*B*W-P*T*G+a*k*G,ne=Z*k*A-D*B*A-Z*T*W+w*B*W+D*T*G-w*k*G,me=D*F*A-Z*P*A+Z*a*W-w*F*W-D*a*G+w*P*G,K=Z*P*T-D*F*T-Z*a*k+w*F*k+D*a*B-w*P*B,Ee=n*$+l*ne+d*me+_*K;if(Ee===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Te=1/Ee;return e[0]=$*Te,e[1]=(F*k*_-P*B*_-F*d*W+l*B*W+P*d*G-l*k*G)*Te,e[2]=(a*B*_-F*T*_+F*d*A-l*B*A-a*d*G+l*T*G)*Te,e[3]=(P*T*_-a*k*_-P*d*A+l*k*A+a*d*W-l*T*W)*Te,e[4]=ne*Te,e[5]=(D*B*_-Z*k*_+Z*d*W-n*B*W-D*d*G+n*k*G)*Te,e[6]=(Z*T*_-w*B*_-Z*d*A+n*B*A+w*d*G-n*T*G)*Te,e[7]=(w*k*_-D*T*_+D*d*A-n*k*A-w*d*W+n*T*W)*Te,e[8]=me*Te,e[9]=(Z*P*_-D*F*_-Z*l*W+n*F*W+D*l*G-n*P*G)*Te,e[10]=(w*F*_-Z*a*_+Z*l*A-n*F*A-w*l*G+n*a*G)*Te,e[11]=(D*a*_-w*P*_-D*l*A+n*P*A+w*l*W-n*a*W)*Te,e[12]=K*Te,e[13]=(D*F*d-Z*P*d+Z*l*k-n*F*k-D*l*B+n*P*B)*Te,e[14]=(Z*a*d-w*F*d-Z*l*T+n*F*T+w*l*B-n*a*B)*Te,e[15]=(w*P*d-D*a*d+D*l*T-n*P*T-w*l*k+n*a*k)*Te,this}scale(e){const n=this.elements,l=e.x,d=e.y,_=e.z;return n[0]*=l,n[4]*=d,n[8]*=_,n[1]*=l,n[5]*=d,n[9]*=_,n[2]*=l,n[6]*=d,n[10]*=_,n[3]*=l,n[7]*=d,n[11]*=_,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],l=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],d=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,l,d))}makeTranslation(e,n,l){return this.set(1,0,0,e,0,1,0,n,0,0,1,l,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),l=Math.sin(e);return this.set(1,0,0,0,0,n,-l,0,0,l,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),l=Math.sin(e);return this.set(n,0,l,0,0,1,0,0,-l,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),l=Math.sin(e);return this.set(n,-l,0,0,l,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const l=Math.cos(n),d=Math.sin(n),_=1-l,w=e.x,a=e.y,T=e.z,A=_*w,D=_*a;return this.set(A*w+l,A*a-d*T,A*T+d*a,0,A*a+d*T,D*a+l,D*T-d*w,0,A*T-d*a,D*T+d*w,_*T*T+l,0,0,0,0,1),this}makeScale(e,n,l){return this.set(e,0,0,0,0,n,0,0,0,0,l,0,0,0,0,1),this}makeShear(e,n,l,d,_,w){return this.set(1,l,_,0,e,1,w,0,n,d,1,0,0,0,0,1),this}compose(e,n,l){const d=this.elements,_=n._x,w=n._y,a=n._z,T=n._w,A=_+_,D=w+w,P=a+a,k=_*A,W=_*D,Z=_*P,F=w*D,B=w*P,G=a*P,$=T*A,ne=T*D,me=T*P,K=l.x,Ee=l.y,Te=l.z;return d[0]=(1-(F+G))*K,d[1]=(W+me)*K,d[2]=(Z-ne)*K,d[3]=0,d[4]=(W-me)*Ee,d[5]=(1-(k+G))*Ee,d[6]=(B+$)*Ee,d[7]=0,d[8]=(Z+ne)*Te,d[9]=(B-$)*Te,d[10]=(1-(k+F))*Te,d[11]=0,d[12]=e.x,d[13]=e.y,d[14]=e.z,d[15]=1,this}decompose(e,n,l){const d=this.elements;let _=ah.set(d[0],d[1],d[2]).length();const w=ah.set(d[4],d[5],d[6]).length(),a=ah.set(d[8],d[9],d[10]).length();this.determinant()<0&&(_=-_),e.x=d[12],e.y=d[13],e.z=d[14],is.copy(this);const A=1/_,D=1/w,P=1/a;return is.elements[0]*=A,is.elements[1]*=A,is.elements[2]*=A,is.elements[4]*=D,is.elements[5]*=D,is.elements[6]*=D,is.elements[8]*=P,is.elements[9]*=P,is.elements[10]*=P,n.setFromRotationMatrix(is),l.x=_,l.y=w,l.z=a,this}makePerspective(e,n,l,d,_,w){w===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,T=2*_/(n-e),A=2*_/(l-d),D=(n+e)/(n-e),P=(l+d)/(l-d),k=-(w+_)/(w-_),W=-2*w*_/(w-_);return a[0]=T,a[4]=0,a[8]=D,a[12]=0,a[1]=0,a[5]=A,a[9]=P,a[13]=0,a[2]=0,a[6]=0,a[10]=k,a[14]=W,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,n,l,d,_,w){const a=this.elements,T=1/(n-e),A=1/(l-d),D=1/(w-_),P=(n+e)*T,k=(l+d)*A,W=(w+_)*D;return a[0]=2*T,a[4]=0,a[8]=0,a[12]=-P,a[1]=0,a[5]=2*A,a[9]=0,a[13]=-k,a[2]=0,a[6]=0,a[10]=-2*D,a[14]=-W,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const n=this.elements,l=e.elements;for(let d=0;d<16;d++)if(n[d]!==l[d])return!1;return!0}fromArray(e,n=0){for(let l=0;l<16;l++)this.elements[l]=e[l+n];return this}toArray(e=[],n=0){const l=this.elements;return e[n]=l[0],e[n+1]=l[1],e[n+2]=l[2],e[n+3]=l[3],e[n+4]=l[4],e[n+5]=l[5],e[n+6]=l[6],e[n+7]=l[7],e[n+8]=l[8],e[n+9]=l[9],e[n+10]=l[10],e[n+11]=l[11],e[n+12]=l[12],e[n+13]=l[13],e[n+14]=l[14],e[n+15]=l[15],e}}const ah=new Ye,is=new pr,Dz=new Ye(0,0,0),zz=new Ye(1,1,1),al=new Ye,R_=new Ye,go=new Ye,f2=new pr,p2=new $c;class Pp{constructor(e=0,n=0,l=0,d=Pp.DefaultOrder){this.isEuler=!0,this._x=e,this._y=n,this._z=l,this._order=d}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,l,d=this._order){return this._x=e,this._y=n,this._z=l,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,l=!0){const d=e.elements,_=d[0],w=d[4],a=d[8],T=d[1],A=d[5],D=d[9],P=d[2],k=d[6],W=d[10];switch(n){case"XYZ":this._y=Math.asin(Ur(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-D,W),this._z=Math.atan2(-w,_)):(this._x=Math.atan2(k,A),this._z=0);break;case"YXZ":this._x=Math.asin(-Ur(D,-1,1)),Math.abs(D)<.9999999?(this._y=Math.atan2(a,W),this._z=Math.atan2(T,A)):(this._y=Math.atan2(-P,_),this._z=0);break;case"ZXY":this._x=Math.asin(Ur(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(-P,W),this._z=Math.atan2(-w,A)):(this._y=0,this._z=Math.atan2(T,_));break;case"ZYX":this._y=Math.asin(-Ur(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(k,W),this._z=Math.atan2(T,_)):(this._x=0,this._z=Math.atan2(-w,A));break;case"YZX":this._z=Math.asin(Ur(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(-D,A),this._y=Math.atan2(-P,_)):(this._x=0,this._y=Math.atan2(a,W));break;case"XZY":this._z=Math.asin(-Ur(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(k,A),this._y=Math.atan2(a,_)):(this._x=Math.atan2(-D,W),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,l===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,l){return f2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(f2,n,l)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return p2.setFromEuler(this),this.setFromQuaternion(p2,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Pp.DefaultOrder="XYZ";Pp.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class zC{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let kz=0;const m2=new Ye,lh=new $c,la=new pr,F_=new Ye,Df=new Ye,Rz=new Ye,Fz=new $c,_2=new Ye(1,0,0),g2=new Ye(0,1,0),y2=new Ye(0,0,1),Bz={type:"added"},x2={type:"removed"};class uo extends Xc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kz++}),this.uuid=Ap(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=uo.DefaultUp.clone();const e=new Ye,n=new Pp,l=new $c,d=new Ye(1,1,1);function _(){l.setFromEuler(n,!1)}function w(){n.setFromQuaternion(l,void 0,!1)}n._onChange(_),l._onChange(w),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:l},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new pr},normalMatrix:{value:new Bs}}),this.matrix=new pr,this.matrixWorld=new pr,this.matrixAutoUpdate=uo.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new zC,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return lh.setFromAxisAngle(e,n),this.quaternion.multiply(lh),this}rotateOnWorldAxis(e,n){return lh.setFromAxisAngle(e,n),this.quaternion.premultiply(lh),this}rotateX(e){return this.rotateOnAxis(_2,e)}rotateY(e){return this.rotateOnAxis(g2,e)}rotateZ(e){return this.rotateOnAxis(y2,e)}translateOnAxis(e,n){return m2.copy(e).applyQuaternion(this.quaternion),this.position.add(m2.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(_2,e)}translateY(e){return this.translateOnAxis(g2,e)}translateZ(e){return this.translateOnAxis(y2,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(la.copy(this.matrixWorld).invert())}lookAt(e,n,l){e.isVector3?F_.copy(e):F_.set(e,n,l);const d=this.parent;this.updateWorldMatrix(!0,!1),Df.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?la.lookAt(Df,F_,this.up):la.lookAt(F_,Df,this.up),this.quaternion.setFromRotationMatrix(la),d&&(la.extractRotation(d.matrixWorld),lh.setFromRotationMatrix(la),this.quaternion.premultiply(lh.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Bz)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.remove(arguments[l]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(x2)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const n=this.children[e];n.parent=null,n.dispatchEvent(x2)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),la.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),la.multiply(e.parent.matrixWorld)),e.applyMatrix4(la),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let l=0,d=this.children.length;l<d;l++){const w=this.children[l].getObjectByProperty(e,n);if(w!==void 0)return w}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Df,e,Rz),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Df,Fz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let l=0,d=n.length;l<d;l++)n[l].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let l=0,d=n.length;l<d;l++)n[l].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let l=0,d=n.length;l<d;l++)n[l].updateMatrixWorld(e)}updateWorldMatrix(e,n){const l=this.parent;if(e===!0&&l!==null&&l.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const d=this.children;for(let _=0,w=d.length;_<w;_++)d[_].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",l={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},l.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const d={};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.castShadow===!0&&(d.castShadow=!0),this.receiveShadow===!0&&(d.receiveShadow=!0),this.visible===!1&&(d.visible=!1),this.frustumCulled===!1&&(d.frustumCulled=!1),this.renderOrder!==0&&(d.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(d.instanceColor=this.instanceColor.toJSON()));function _(a,T){return a[T.uuid]===void 0&&(a[T.uuid]=T.toJSON(e)),T.uuid}if(this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(d.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=_(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const T=a.shapes;if(Array.isArray(T))for(let A=0,D=T.length;A<D;A++){const P=T[A];_(e.shapes,P)}else _(e.shapes,T)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(_(e.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let T=0,A=this.material.length;T<A;T++)a.push(_(e.materials,this.material[T]));d.material=a}else d.material=_(e.materials,this.material);if(this.children.length>0){d.children=[];for(let a=0;a<this.children.length;a++)d.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){d.animations=[];for(let a=0;a<this.animations.length;a++){const T=this.animations[a];d.animations.push(_(e.animations,T))}}if(n){const a=w(e.geometries),T=w(e.materials),A=w(e.textures),D=w(e.images),P=w(e.shapes),k=w(e.skeletons),W=w(e.animations),Z=w(e.nodes);a.length>0&&(l.geometries=a),T.length>0&&(l.materials=T),A.length>0&&(l.textures=A),D.length>0&&(l.images=D),P.length>0&&(l.shapes=P),k.length>0&&(l.skeletons=k),W.length>0&&(l.animations=W),Z.length>0&&(l.nodes=Z)}return l.object=d,l;function w(a){const T=[];for(const A in a){const D=a[A];delete D.metadata,T.push(D)}return T}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let l=0;l<e.children.length;l++){const d=e.children[l];this.add(d.clone())}return this}}uo.DefaultUp=new Ye(0,1,0);uo.DefaultMatrixAutoUpdate=!0;const rs=new Ye,ca=new Ye,yx=new Ye,ua=new Ye,ch=new Ye,uh=new Ye,v2=new Ye,xx=new Ye,vx=new Ye,wx=new Ye;class Fs{constructor(e=new Ye,n=new Ye,l=new Ye){this.a=e,this.b=n,this.c=l}static getNormal(e,n,l,d){d.subVectors(l,n),rs.subVectors(e,n),d.cross(rs);const _=d.lengthSq();return _>0?d.multiplyScalar(1/Math.sqrt(_)):d.set(0,0,0)}static getBarycoord(e,n,l,d,_){rs.subVectors(d,n),ca.subVectors(l,n),yx.subVectors(e,n);const w=rs.dot(rs),a=rs.dot(ca),T=rs.dot(yx),A=ca.dot(ca),D=ca.dot(yx),P=w*A-a*a;if(P===0)return _.set(-2,-1,-1);const k=1/P,W=(A*T-a*D)*k,Z=(w*D-a*T)*k;return _.set(1-W-Z,Z,W)}static containsPoint(e,n,l,d){return this.getBarycoord(e,n,l,d,ua),ua.x>=0&&ua.y>=0&&ua.x+ua.y<=1}static getUV(e,n,l,d,_,w,a,T){return this.getBarycoord(e,n,l,d,ua),T.set(0,0),T.addScaledVector(_,ua.x),T.addScaledVector(w,ua.y),T.addScaledVector(a,ua.z),T}static isFrontFacing(e,n,l,d){return rs.subVectors(l,n),ca.subVectors(e,n),rs.cross(ca).dot(d)<0}set(e,n,l){return this.a.copy(e),this.b.copy(n),this.c.copy(l),this}setFromPointsAndIndices(e,n,l,d){return this.a.copy(e[n]),this.b.copy(e[l]),this.c.copy(e[d]),this}setFromAttributeAndIndices(e,n,l,d){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,l),this.c.fromBufferAttribute(e,d),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rs.subVectors(this.c,this.b),ca.subVectors(this.a,this.b),rs.cross(ca).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Fs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Fs.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,l,d,_){return Fs.getUV(e,this.a,this.b,this.c,n,l,d,_)}containsPoint(e){return Fs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Fs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const l=this.a,d=this.b,_=this.c;let w,a;ch.subVectors(d,l),uh.subVectors(_,l),xx.subVectors(e,l);const T=ch.dot(xx),A=uh.dot(xx);if(T<=0&&A<=0)return n.copy(l);vx.subVectors(e,d);const D=ch.dot(vx),P=uh.dot(vx);if(D>=0&&P<=D)return n.copy(d);const k=T*P-D*A;if(k<=0&&T>=0&&D<=0)return w=T/(T-D),n.copy(l).addScaledVector(ch,w);wx.subVectors(e,_);const W=ch.dot(wx),Z=uh.dot(wx);if(Z>=0&&W<=Z)return n.copy(_);const F=W*A-T*Z;if(F<=0&&A>=0&&Z<=0)return a=A/(A-Z),n.copy(l).addScaledVector(uh,a);const B=D*Z-W*P;if(B<=0&&P-D>=0&&W-Z>=0)return v2.subVectors(_,d),a=(P-D)/(P-D+(W-Z)),n.copy(d).addScaledVector(v2,a);const G=1/(B+F+k);return w=F*G,a=k*G,n.copy(l).addScaledVector(ch,w).addScaledVector(uh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Oz=0;class Sr extends Xc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Oz++}),this.uuid=Ap(),this.name="",this.type="Material",this.blending=Gh,this.side=yp,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=MC,this.blendDst=TC,this.blendEquation=gh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Pv,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ez,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ox,this.stencilZFail=ox,this.stencilZPass=ox,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const l=e[n];if(l===void 0){console.warn("THREE.Material: '"+n+"' parameter is undefined.");continue}if(n==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=l===kD;continue}const d=this[n];if(d===void 0){console.warn("THREE."+this.type+": '"+n+"' is not a property of this material.");continue}d&&d.isColor?d.set(l):d&&d.isVector3&&l&&l.isVector3?d.copy(l):this[n]=l}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const l={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.color&&this.color.isColor&&(l.color=this.color.getHex()),this.roughness!==void 0&&(l.roughness=this.roughness),this.metalness!==void 0&&(l.metalness=this.metalness),this.sheen!==void 0&&(l.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(l.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(l.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(l.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(l.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(l.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(l.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(l.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(l.shininess=this.shininess),this.clearcoat!==void 0&&(l.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(l.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(l.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(l.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(l.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,l.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(l.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(l.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(l.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(l.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(l.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(l.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(l.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(l.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(l.lightMap=this.lightMap.toJSON(e).uuid,l.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(l.aoMap=this.aoMap.toJSON(e).uuid,l.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(l.bumpMap=this.bumpMap.toJSON(e).uuid,l.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(l.normalMap=this.normalMap.toJSON(e).uuid,l.normalMapType=this.normalMapType,l.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(l.displacementMap=this.displacementMap.toJSON(e).uuid,l.displacementScale=this.displacementScale,l.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(l.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(l.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(l.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(l.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(l.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(l.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(l.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(l.combine=this.combine)),this.envMapIntensity!==void 0&&(l.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(l.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(l.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(l.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(l.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(l.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(l.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(l.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(l.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(l.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(l.size=this.size),this.shadowSide!==null&&(l.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(l.sizeAttenuation=this.sizeAttenuation),this.blending!==Gh&&(l.blending=this.blending),this.side!==yp&&(l.side=this.side),this.vertexColors&&(l.vertexColors=!0),this.opacity<1&&(l.opacity=this.opacity),this.transparent===!0&&(l.transparent=this.transparent),l.depthFunc=this.depthFunc,l.depthTest=this.depthTest,l.depthWrite=this.depthWrite,l.colorWrite=this.colorWrite,l.stencilWrite=this.stencilWrite,l.stencilWriteMask=this.stencilWriteMask,l.stencilFunc=this.stencilFunc,l.stencilRef=this.stencilRef,l.stencilFuncMask=this.stencilFuncMask,l.stencilFail=this.stencilFail,l.stencilZFail=this.stencilZFail,l.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(l.rotation=this.rotation),this.polygonOffset===!0&&(l.polygonOffset=!0),this.polygonOffsetFactor!==0&&(l.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(l.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(l.linewidth=this.linewidth),this.dashSize!==void 0&&(l.dashSize=this.dashSize),this.gapSize!==void 0&&(l.gapSize=this.gapSize),this.scale!==void 0&&(l.scale=this.scale),this.dithering===!0&&(l.dithering=!0),this.alphaTest>0&&(l.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(l.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(l.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(l.wireframe=this.wireframe),this.wireframeLinewidth>1&&(l.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(l.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(l.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(l.flatShading=this.flatShading),this.visible===!1&&(l.visible=!1),this.toneMapped===!1&&(l.toneMapped=!1),this.fog===!1&&(l.fog=!1),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData);function d(_){const w=[];for(const a in _){const T=_[a];delete T.metadata,w.push(T)}return w}if(n){const _=d(e.textures),w=d(e.images);_.length>0&&(l.textures=_),w.length>0&&(l.images=w)}return l}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let l=null;if(n!==null){const d=n.length;l=new Array(d);for(let _=0;_!==d;++_)l[_]=n[_].clone()}return this.clippingPlanes=l,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}get vertexTangents(){return console.warn("THREE."+this.type+": .vertexTangents has been removed."),!1}set vertexTangents(e){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}Sr.fromType=function(){return null};class G1 extends Sr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ln(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ty,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Xi=new Ye,B_=new In;class Us{constructor(e,n,l){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=l===!0,this.usage=l2,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,n,l){e*=this.itemSize,l*=n.itemSize;for(let d=0,_=this.itemSize;d<_;d++)this.array[e+d]=n.array[l+d];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const n=this.array;let l=0;for(let d=0,_=e.length;d<_;d++){let w=e[d];w===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),w=new Ln),n[l++]=w.r,n[l++]=w.g,n[l++]=w.b}return this}copyVector2sArray(e){const n=this.array;let l=0;for(let d=0,_=e.length;d<_;d++){let w=e[d];w===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),w=new In),n[l++]=w.x,n[l++]=w.y}return this}copyVector3sArray(e){const n=this.array;let l=0;for(let d=0,_=e.length;d<_;d++){let w=e[d];w===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),w=new Ye),n[l++]=w.x,n[l++]=w.y,n[l++]=w.z}return this}copyVector4sArray(e){const n=this.array;let l=0;for(let d=0,_=e.length;d<_;d++){let w=e[d];w===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),w=new vr),n[l++]=w.x,n[l++]=w.y,n[l++]=w.z,n[l++]=w.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,l=this.count;n<l;n++)B_.fromBufferAttribute(this,n),B_.applyMatrix3(e),this.setXY(n,B_.x,B_.y);else if(this.itemSize===3)for(let n=0,l=this.count;n<l;n++)Xi.fromBufferAttribute(this,n),Xi.applyMatrix3(e),this.setXYZ(n,Xi.x,Xi.y,Xi.z);return this}applyMatrix4(e){for(let n=0,l=this.count;n<l;n++)Xi.fromBufferAttribute(this,n),Xi.applyMatrix4(e),this.setXYZ(n,Xi.x,Xi.y,Xi.z);return this}applyNormalMatrix(e){for(let n=0,l=this.count;n<l;n++)Xi.fromBufferAttribute(this,n),Xi.applyNormalMatrix(e),this.setXYZ(n,Xi.x,Xi.y,Xi.z);return this}transformDirection(e){for(let n=0,l=this.count;n<l;n++)Xi.fromBufferAttribute(this,n),Xi.transformDirection(e),this.setXYZ(n,Xi.x,Xi.y,Xi.z);return this}set(e,n=0){return this.array.set(e,n),this}getX(e){return this.array[e*this.itemSize]}setX(e,n){return this.array[e*this.itemSize]=n,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,n){return this.array[e*this.itemSize+1]=n,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,n){return this.array[e*this.itemSize+2]=n,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,n){return this.array[e*this.itemSize+3]=n,this}setXY(e,n,l){return e*=this.itemSize,this.array[e+0]=n,this.array[e+1]=l,this}setXYZ(e,n,l,d){return e*=this.itemSize,this.array[e+0]=n,this.array[e+1]=l,this.array[e+2]=d,this}setXYZW(e,n,l,d,_){return e*=this.itemSize,this.array[e+0]=n,this.array[e+1]=l,this.array[e+2]=d,this.array[e+3]=_,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==l2&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class kC extends Us{constructor(e,n,l){super(new Uint16Array(e),n,l)}}class RC extends Us{constructor(e,n,l){super(new Uint32Array(e),n,l)}}class Oc extends Us{constructor(e,n,l){super(new Float32Array(e),n,l)}}let Nz=0;const Ro=new pr,bx=new uo,hh=new Ye,yo=new Ip,zf=new Ip,hr=new Ye;class Yc extends Xc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Nz++}),this.uuid=Ap(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(AC(e)?RC:kC)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,l=0){this.groups.push({start:e,count:n,materialIndex:l})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const l=this.attributes.normal;if(l!==void 0){const _=new Bs().getNormalMatrix(e);l.applyNormalMatrix(_),l.needsUpdate=!0}const d=this.attributes.tangent;return d!==void 0&&(d.transformDirection(e),d.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ro.makeRotationFromQuaternion(e),this.applyMatrix4(Ro),this}rotateX(e){return Ro.makeRotationX(e),this.applyMatrix4(Ro),this}rotateY(e){return Ro.makeRotationY(e),this.applyMatrix4(Ro),this}rotateZ(e){return Ro.makeRotationZ(e),this.applyMatrix4(Ro),this}translate(e,n,l){return Ro.makeTranslation(e,n,l),this.applyMatrix4(Ro),this}scale(e,n,l){return Ro.makeScale(e,n,l),this.applyMatrix4(Ro),this}lookAt(e){return bx.lookAt(e),bx.updateMatrix(),this.applyMatrix4(bx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(hh).negate(),this.translate(hh.x,hh.y,hh.z),this}setFromPoints(e){const n=[];for(let l=0,d=e.length;l<d;l++){const _=e[l];n.push(_.x,_.y,_.z||0)}return this.setAttribute("position",new Oc(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ip);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Ye(-1/0,-1/0,-1/0),new Ye(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let l=0,d=n.length;l<d;l++){const _=n[l];yo.setFromBufferAttribute(_),this.morphTargetsRelative?(hr.addVectors(this.boundingBox.min,yo.min),this.boundingBox.expandByPoint(hr),hr.addVectors(this.boundingBox.max,yo.max),this.boundingBox.expandByPoint(hr)):(this.boundingBox.expandByPoint(yo.min),this.boundingBox.expandByPoint(yo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new V1);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Ye,1/0);return}if(e){const l=this.boundingSphere.center;if(yo.setFromBufferAttribute(e),n)for(let _=0,w=n.length;_<w;_++){const a=n[_];zf.setFromBufferAttribute(a),this.morphTargetsRelative?(hr.addVectors(yo.min,zf.min),yo.expandByPoint(hr),hr.addVectors(yo.max,zf.max),yo.expandByPoint(hr)):(yo.expandByPoint(zf.min),yo.expandByPoint(zf.max))}yo.getCenter(l);let d=0;for(let _=0,w=e.count;_<w;_++)hr.fromBufferAttribute(e,_),d=Math.max(d,l.distanceToSquared(hr));if(n)for(let _=0,w=n.length;_<w;_++){const a=n[_],T=this.morphTargetsRelative;for(let A=0,D=a.count;A<D;A++)hr.fromBufferAttribute(a,A),T&&(hh.fromBufferAttribute(e,A),hr.add(hh)),d=Math.max(d,l.distanceToSquared(hr))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const l=e.array,d=n.position.array,_=n.normal.array,w=n.uv.array,a=d.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Us(new Float32Array(4*a),4));const T=this.getAttribute("tangent").array,A=[],D=[];for(let Fe=0;Fe<a;Fe++)A[Fe]=new Ye,D[Fe]=new Ye;const P=new Ye,k=new Ye,W=new Ye,Z=new In,F=new In,B=new In,G=new Ye,$=new Ye;function ne(Fe,qe,Pt){P.fromArray(d,Fe*3),k.fromArray(d,qe*3),W.fromArray(d,Pt*3),Z.fromArray(w,Fe*2),F.fromArray(w,qe*2),B.fromArray(w,Pt*2),k.sub(P),W.sub(P),F.sub(Z),B.sub(Z);const xt=1/(F.x*B.y-B.x*F.y);!isFinite(xt)||(G.copy(k).multiplyScalar(B.y).addScaledVector(W,-F.y).multiplyScalar(xt),$.copy(W).multiplyScalar(F.x).addScaledVector(k,-B.x).multiplyScalar(xt),A[Fe].add(G),A[qe].add(G),A[Pt].add(G),D[Fe].add($),D[qe].add($),D[Pt].add($))}let me=this.groups;me.length===0&&(me=[{start:0,count:l.length}]);for(let Fe=0,qe=me.length;Fe<qe;++Fe){const Pt=me[Fe],xt=Pt.start,je=Pt.count;for(let ut=xt,tt=xt+je;ut<tt;ut+=3)ne(l[ut+0],l[ut+1],l[ut+2])}const K=new Ye,Ee=new Ye,Te=new Ye,ee=new Ye;function Ae(Fe){Te.fromArray(_,Fe*3),ee.copy(Te);const qe=A[Fe];K.copy(qe),K.sub(Te.multiplyScalar(Te.dot(qe))).normalize(),Ee.crossVectors(ee,qe);const xt=Ee.dot(D[Fe])<0?-1:1;T[Fe*4]=K.x,T[Fe*4+1]=K.y,T[Fe*4+2]=K.z,T[Fe*4+3]=xt}for(let Fe=0,qe=me.length;Fe<qe;++Fe){const Pt=me[Fe],xt=Pt.start,je=Pt.count;for(let ut=xt,tt=xt+je;ut<tt;ut+=3)Ae(l[ut+0]),Ae(l[ut+1]),Ae(l[ut+2])}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let l=this.getAttribute("normal");if(l===void 0)l=new Us(new Float32Array(n.count*3),3),this.setAttribute("normal",l);else for(let k=0,W=l.count;k<W;k++)l.setXYZ(k,0,0,0);const d=new Ye,_=new Ye,w=new Ye,a=new Ye,T=new Ye,A=new Ye,D=new Ye,P=new Ye;if(e)for(let k=0,W=e.count;k<W;k+=3){const Z=e.getX(k+0),F=e.getX(k+1),B=e.getX(k+2);d.fromBufferAttribute(n,Z),_.fromBufferAttribute(n,F),w.fromBufferAttribute(n,B),D.subVectors(w,_),P.subVectors(d,_),D.cross(P),a.fromBufferAttribute(l,Z),T.fromBufferAttribute(l,F),A.fromBufferAttribute(l,B),a.add(D),T.add(D),A.add(D),l.setXYZ(Z,a.x,a.y,a.z),l.setXYZ(F,T.x,T.y,T.z),l.setXYZ(B,A.x,A.y,A.z)}else for(let k=0,W=n.count;k<W;k+=3)d.fromBufferAttribute(n,k+0),_.fromBufferAttribute(n,k+1),w.fromBufferAttribute(n,k+2),D.subVectors(w,_),P.subVectors(d,_),D.cross(P),l.setXYZ(k+0,D.x,D.y,D.z),l.setXYZ(k+1,D.x,D.y,D.z),l.setXYZ(k+2,D.x,D.y,D.z);this.normalizeNormals(),l.needsUpdate=!0}}merge(e,n){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}n===void 0&&(n=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const l=this.attributes;for(const d in l){if(e.attributes[d]===void 0)continue;const w=l[d].array,a=e.attributes[d],T=a.array,A=a.itemSize*n,D=Math.min(T.length,w.length-A);for(let P=0,k=A;P<D;P++,k++)w[k]=T[P]}return this}normalizeNormals(){const e=this.attributes.normal;for(let n=0,l=e.count;n<l;n++)hr.fromBufferAttribute(e,n),hr.normalize(),e.setXYZ(n,hr.x,hr.y,hr.z)}toNonIndexed(){function e(a,T){const A=a.array,D=a.itemSize,P=a.normalized,k=new A.constructor(T.length*D);let W=0,Z=0;for(let F=0,B=T.length;F<B;F++){a.isInterleavedBufferAttribute?W=T[F]*a.data.stride+a.offset:W=T[F]*D;for(let G=0;G<D;G++)k[Z++]=A[W++]}return new Us(k,D,P)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Yc,l=this.index.array,d=this.attributes;for(const a in d){const T=d[a],A=e(T,l);n.setAttribute(a,A)}const _=this.morphAttributes;for(const a in _){const T=[],A=_[a];for(let D=0,P=A.length;D<P;D++){const k=A[D],W=e(k,l);T.push(W)}n.morphAttributes[a]=T}n.morphTargetsRelative=this.morphTargetsRelative;const w=this.groups;for(let a=0,T=w.length;a<T;a++){const A=w[a];n.addGroup(A.start,A.count,A.materialIndex)}return n}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const T=this.parameters;for(const A in T)T[A]!==void 0&&(e[A]=T[A]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const l=this.attributes;for(const T in l){const A=l[T];e.data.attributes[T]=A.toJSON(e.data)}const d={};let _=!1;for(const T in this.morphAttributes){const A=this.morphAttributes[T],D=[];for(let P=0,k=A.length;P<k;P++){const W=A[P];D.push(W.toJSON(e.data))}D.length>0&&(d[T]=D,_=!0)}_&&(e.data.morphAttributes=d,e.data.morphTargetsRelative=this.morphTargetsRelative);const w=this.groups;w.length>0&&(e.data.groups=JSON.parse(JSON.stringify(w)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const l=e.index;l!==null&&this.setIndex(l.clone(n));const d=e.attributes;for(const A in d){const D=d[A];this.setAttribute(A,D.clone(n))}const _=e.morphAttributes;for(const A in _){const D=[],P=_[A];for(let k=0,W=P.length;k<W;k++)D.push(P[k].clone(n));this.morphAttributes[A]=D}this.morphTargetsRelative=e.morphTargetsRelative;const w=e.groups;for(let A=0,D=w.length;A<D;A++){const P=w[A];this.addGroup(P.start,P.count,P.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const T=e.boundingSphere;return T!==null&&(this.boundingSphere=T.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const w2=new pr,dh=new Lz,Sx=new V1,ll=new Ye,cl=new Ye,ul=new Ye,Mx=new Ye,Tx=new Ye,Ex=new Ye,O_=new Ye,N_=new Ye,U_=new Ye,V_=new In,G_=new In,j_=new In,Cx=new Ye,W_=new Ye;class _a extends uo{constructor(e=new Yc,n=new G1){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,l=Object.keys(n);if(l.length>0){const d=n[l[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _=0,w=d.length;_<w;_++){const a=d[_].name||String(_);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=_}}}}raycast(e,n){const l=this.geometry,d=this.material,_=this.matrixWorld;if(d===void 0||(l.boundingSphere===null&&l.computeBoundingSphere(),Sx.copy(l.boundingSphere),Sx.applyMatrix4(_),e.ray.intersectsSphere(Sx)===!1)||(w2.copy(_).invert(),dh.copy(e.ray).applyMatrix4(w2),l.boundingBox!==null&&dh.intersectsBox(l.boundingBox)===!1))return;let w;const a=l.index,T=l.attributes.position,A=l.morphAttributes.position,D=l.morphTargetsRelative,P=l.attributes.uv,k=l.attributes.uv2,W=l.groups,Z=l.drawRange;if(a!==null)if(Array.isArray(d))for(let F=0,B=W.length;F<B;F++){const G=W[F],$=d[G.materialIndex],ne=Math.max(G.start,Z.start),me=Math.min(a.count,Math.min(G.start+G.count,Z.start+Z.count));for(let K=ne,Ee=me;K<Ee;K+=3){const Te=a.getX(K),ee=a.getX(K+1),Ae=a.getX(K+2);w=H_(this,$,e,dh,T,A,D,P,k,Te,ee,Ae),w&&(w.faceIndex=Math.floor(K/3),w.face.materialIndex=G.materialIndex,n.push(w))}}else{const F=Math.max(0,Z.start),B=Math.min(a.count,Z.start+Z.count);for(let G=F,$=B;G<$;G+=3){const ne=a.getX(G),me=a.getX(G+1),K=a.getX(G+2);w=H_(this,d,e,dh,T,A,D,P,k,ne,me,K),w&&(w.faceIndex=Math.floor(G/3),n.push(w))}}else if(T!==void 0)if(Array.isArray(d))for(let F=0,B=W.length;F<B;F++){const G=W[F],$=d[G.materialIndex],ne=Math.max(G.start,Z.start),me=Math.min(T.count,Math.min(G.start+G.count,Z.start+Z.count));for(let K=ne,Ee=me;K<Ee;K+=3){const Te=K,ee=K+1,Ae=K+2;w=H_(this,$,e,dh,T,A,D,P,k,Te,ee,Ae),w&&(w.faceIndex=Math.floor(K/3),w.face.materialIndex=G.materialIndex,n.push(w))}}else{const F=Math.max(0,Z.start),B=Math.min(T.count,Z.start+Z.count);for(let G=F,$=B;G<$;G+=3){const ne=G,me=G+1,K=G+2;w=H_(this,d,e,dh,T,A,D,P,k,ne,me,K),w&&(w.faceIndex=Math.floor(G/3),n.push(w))}}}}function Uz(i,e,n,l,d,_,w,a){let T;if(e.side===ds?T=l.intersectTriangle(w,_,d,!0,a):T=l.intersectTriangle(d,_,w,e.side!==Kh,a),T===null)return null;W_.copy(a),W_.applyMatrix4(i.matrixWorld);const A=n.ray.origin.distanceTo(W_);return A<n.near||A>n.far?null:{distance:A,point:W_.clone(),object:i}}function H_(i,e,n,l,d,_,w,a,T,A,D,P){ll.fromBufferAttribute(d,A),cl.fromBufferAttribute(d,D),ul.fromBufferAttribute(d,P);const k=i.morphTargetInfluences;if(_&&k){O_.set(0,0,0),N_.set(0,0,0),U_.set(0,0,0);for(let Z=0,F=_.length;Z<F;Z++){const B=k[Z],G=_[Z];B!==0&&(Mx.fromBufferAttribute(G,A),Tx.fromBufferAttribute(G,D),Ex.fromBufferAttribute(G,P),w?(O_.addScaledVector(Mx,B),N_.addScaledVector(Tx,B),U_.addScaledVector(Ex,B)):(O_.addScaledVector(Mx.sub(ll),B),N_.addScaledVector(Tx.sub(cl),B),U_.addScaledVector(Ex.sub(ul),B)))}ll.add(O_),cl.add(N_),ul.add(U_)}i.isSkinnedMesh&&(i.boneTransform(A,ll),i.boneTransform(D,cl),i.boneTransform(P,ul));const W=Uz(i,e,n,l,ll,cl,ul,Cx);if(W){a&&(V_.fromBufferAttribute(a,A),G_.fromBufferAttribute(a,D),j_.fromBufferAttribute(a,P),W.uv=Fs.getUV(Cx,ll,cl,ul,V_,G_,j_,new In)),T&&(V_.fromBufferAttribute(T,A),G_.fromBufferAttribute(T,D),j_.fromBufferAttribute(T,P),W.uv2=Fs.getUV(Cx,ll,cl,ul,V_,G_,j_,new In));const Z={a:A,b:D,c:P,normal:new Ye,materialIndex:0};Fs.getNormal(ll,cl,ul,Z.normal),W.face=Z}return W}class Lp extends Yc{constructor(e=1,n=1,l=1,d=1,_=1,w=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:l,widthSegments:d,heightSegments:_,depthSegments:w};const a=this;d=Math.floor(d),_=Math.floor(_),w=Math.floor(w);const T=[],A=[],D=[],P=[];let k=0,W=0;Z("z","y","x",-1,-1,l,n,e,w,_,0),Z("z","y","x",1,-1,l,n,-e,w,_,1),Z("x","z","y",1,1,e,l,n,d,w,2),Z("x","z","y",1,-1,e,l,-n,d,w,3),Z("x","y","z",1,-1,e,n,l,d,_,4),Z("x","y","z",-1,-1,e,n,-l,d,_,5),this.setIndex(T),this.setAttribute("position",new Oc(A,3)),this.setAttribute("normal",new Oc(D,3)),this.setAttribute("uv",new Oc(P,2));function Z(F,B,G,$,ne,me,K,Ee,Te,ee,Ae){const Fe=me/Te,qe=K/ee,Pt=me/2,xt=K/2,je=Ee/2,ut=Te+1,tt=ee+1;let ct=0,Be=0;const Ne=new Ye;for(let Ze=0;Ze<tt;Ze++){const pt=Ze*qe-xt;for(let et=0;et<ut;et++){const gt=et*Fe-Pt;Ne[F]=gt*$,Ne[B]=pt*ne,Ne[G]=je,A.push(Ne.x,Ne.y,Ne.z),Ne[F]=0,Ne[B]=0,Ne[G]=Ee>0?1:-1,D.push(Ne.x,Ne.y,Ne.z),P.push(et/Te),P.push(1-Ze/ee),ct+=1}}for(let Ze=0;Ze<ee;Ze++)for(let pt=0;pt<Te;pt++){const et=k+pt+ut*Ze,gt=k+pt+ut*(Ze+1),jt=k+(pt+1)+ut*(Ze+1),Xt=k+(pt+1)+ut*Ze;T.push(et,gt,Xt),T.push(gt,jt,Xt),Be+=6}a.addGroup(W,Be,Ae),W+=Be,k+=ct}}static fromJSON(e){return new Lp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function td(i){const e={};for(const n in i){e[n]={};for(const l in i[n]){const d=i[n][l];d&&(d.isColor||d.isMatrix3||d.isMatrix4||d.isVector2||d.isVector3||d.isVector4||d.isTexture||d.isQuaternion)?e[n][l]=d.clone():Array.isArray(d)?e[n][l]=d.slice():e[n][l]=d}}return e}function zr(i){const e={};for(let n=0;n<i.length;n++){const l=td(i[n]);for(const d in l)e[d]=l[d]}return e}const Vz={clone:td,merge:zr};var Gz=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,jz=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Sa extends Sr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Gz,this.fragmentShader=jz,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=td(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const d in this.uniforms){const w=this.uniforms[d].value;w&&w.isTexture?n.uniforms[d]={type:"t",value:w.toJSON(e).uuid}:w&&w.isColor?n.uniforms[d]={type:"c",value:w.getHex()}:w&&w.isVector2?n.uniforms[d]={type:"v2",value:w.toArray()}:w&&w.isVector3?n.uniforms[d]={type:"v3",value:w.toArray()}:w&&w.isVector4?n.uniforms[d]={type:"v4",value:w.toArray()}:w&&w.isMatrix3?n.uniforms[d]={type:"m3",value:w.toArray()}:w&&w.isMatrix4?n.uniforms[d]={type:"m4",value:w.toArray()}:n.uniforms[d]={value:w}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;const l={};for(const d in this.extensions)this.extensions[d]===!0&&(l[d]=!0);return Object.keys(l).length>0&&(n.extensions=l),n}}class FC extends uo{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pr,this.projectionMatrix=new pr,this.projectionMatrixInverse=new pr}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(-n[8],-n[9],-n[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class vo extends FC{constructor(e=50,n=1,l=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=l,this.far=d,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=Rv*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(sx*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Rv*2*Math.atan(Math.tan(sx*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,n,l,d,_,w){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=l,this.view.offsetY=d,this.view.width=_,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(sx*.5*this.fov)/this.zoom,l=2*n,d=this.aspect*l,_=-.5*d;const w=this.view;if(this.view!==null&&this.view.enabled){const T=w.fullWidth,A=w.fullHeight;_+=w.offsetX*d/T,n-=w.offsetY*l/A,d*=w.width/T,l*=w.height/A}const a=this.filmOffset;a!==0&&(_+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(_,_+d,n,n-l,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const fh=90,ph=1;class Wz extends uo{constructor(e,n,l){if(super(),this.type="CubeCamera",l.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=l;const d=new vo(fh,ph,e,n);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new Ye(1,0,0)),this.add(d);const _=new vo(fh,ph,e,n);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new Ye(-1,0,0)),this.add(_);const w=new vo(fh,ph,e,n);w.layers=this.layers,w.up.set(0,0,1),w.lookAt(new Ye(0,1,0)),this.add(w);const a=new vo(fh,ph,e,n);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Ye(0,-1,0)),this.add(a);const T=new vo(fh,ph,e,n);T.layers=this.layers,T.up.set(0,-1,0),T.lookAt(new Ye(0,0,1)),this.add(T);const A=new vo(fh,ph,e,n);A.layers=this.layers,A.up.set(0,-1,0),A.lookAt(new Ye(0,0,-1)),this.add(A)}update(e,n){this.parent===null&&this.updateMatrixWorld();const l=this.renderTarget,[d,_,w,a,T,A]=this.children,D=e.getRenderTarget(),P=e.toneMapping,k=e.xr.enabled;e.toneMapping=ya,e.xr.enabled=!1;const W=l.texture.generateMipmaps;l.texture.generateMipmaps=!1,e.setRenderTarget(l,0),e.render(n,d),e.setRenderTarget(l,1),e.render(n,_),e.setRenderTarget(l,2),e.render(n,w),e.setRenderTarget(l,3),e.render(n,a),e.setRenderTarget(l,4),e.render(n,T),l.texture.generateMipmaps=W,e.setRenderTarget(l,5),e.render(n,A),e.setRenderTarget(D),e.toneMapping=P,e.xr.enabled=k,l.texture.needsPMREMUpdate=!0}}class BC extends jo{constructor(e,n,l,d,_,w,a,T,A,D){e=e!==void 0?e:[],n=n!==void 0?n:Jh,super(e,n,l,d,_,w,a,T,A,D),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Hz extends El{constructor(e,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const l={width:e,height:e,depth:1},d=[l,l,l,l,l,l];this.texture=new BC(d,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Oo}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.encoding=n.encoding,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const l={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},d=new Lp(5,5,5),_=new Sa({name:"CubemapFromEquirect",uniforms:td(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,side:ds,blending:Tl});_.uniforms.tEquirect.value=n;const w=new _a(d,_),a=n.minFilter;return n.minFilter===iy&&(n.minFilter=Oo),new Wz(1,10,this).update(e,w),n.minFilter=a,w.geometry.dispose(),w.material.dispose(),this}clear(e,n,l,d){const _=e.getRenderTarget();for(let w=0;w<6;w++)e.setRenderTarget(this,w),e.clear(n,l,d);e.setRenderTarget(_)}}const Ax=new Ye,$z=new Ye,qz=new Bs;class Mc{constructor(e=new Ye(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,l,d){return this.normal.set(e,n,l),this.constant=d,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,l){const d=Ax.subVectors(l,n).cross($z.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(d,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,n){const l=e.delta(Ax),d=this.normal.dot(l);if(d===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const _=-(e.start.dot(this.normal)+this.constant)/d;return _<0||_>1?null:n.copy(l).multiplyScalar(_).add(e.start)}intersectsLine(e){const n=this.distanceToPoint(e.start),l=this.distanceToPoint(e.end);return n<0&&l>0||l<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const l=n||qz.getNormalMatrix(e),d=this.coplanarPoint(Ax).applyMatrix4(e),_=this.normal.applyMatrix3(l).normalize();return this.constant=-d.dot(_),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const mh=new V1,$_=new Ye;class j1{constructor(e=new Mc,n=new Mc,l=new Mc,d=new Mc,_=new Mc,w=new Mc){this.planes=[e,n,l,d,_,w]}set(e,n,l,d,_,w){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(l),a[3].copy(d),a[4].copy(_),a[5].copy(w),this}copy(e){const n=this.planes;for(let l=0;l<6;l++)n[l].copy(e.planes[l]);return this}setFromProjectionMatrix(e){const n=this.planes,l=e.elements,d=l[0],_=l[1],w=l[2],a=l[3],T=l[4],A=l[5],D=l[6],P=l[7],k=l[8],W=l[9],Z=l[10],F=l[11],B=l[12],G=l[13],$=l[14],ne=l[15];return n[0].setComponents(a-d,P-T,F-k,ne-B).normalize(),n[1].setComponents(a+d,P+T,F+k,ne+B).normalize(),n[2].setComponents(a+_,P+A,F+W,ne+G).normalize(),n[3].setComponents(a-_,P-A,F-W,ne-G).normalize(),n[4].setComponents(a-w,P-D,F-Z,ne-$).normalize(),n[5].setComponents(a+w,P+D,F+Z,ne+$).normalize(),this}intersectsObject(e){const n=e.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),mh.copy(n.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(mh)}intersectsSprite(e){return mh.center.set(0,0,0),mh.radius=.7071067811865476,mh.applyMatrix4(e.matrixWorld),this.intersectsSphere(mh)}intersectsSphere(e){const n=this.planes,l=e.center,d=-e.radius;for(let _=0;_<6;_++)if(n[_].distanceToPoint(l)<d)return!1;return!0}intersectsBox(e){const n=this.planes;for(let l=0;l<6;l++){const d=n[l];if($_.x=d.normal.x>0?e.max.x:e.min.x,$_.y=d.normal.y>0?e.max.y:e.min.y,$_.z=d.normal.z>0?e.max.z:e.min.z,d.distanceToPoint($_)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let l=0;l<6;l++)if(n[l].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function OC(){let i=null,e=!1,n=null,l=null;function d(_,w){n(_,w),l=i.requestAnimationFrame(d)}return{start:function(){e!==!0&&n!==null&&(l=i.requestAnimationFrame(d),e=!0)},stop:function(){i.cancelAnimationFrame(l),e=!1},setAnimationLoop:function(_){n=_},setContext:function(_){i=_}}}function Zz(i,e){const n=e.isWebGL2,l=new WeakMap;function d(A,D){const P=A.array,k=A.usage,W=i.createBuffer();i.bindBuffer(D,W),i.bufferData(D,P,k),A.onUploadCallback();let Z;if(P instanceof Float32Array)Z=5126;else if(P instanceof Uint16Array)if(A.isFloat16BufferAttribute)if(n)Z=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else Z=5123;else if(P instanceof Int16Array)Z=5122;else if(P instanceof Uint32Array)Z=5125;else if(P instanceof Int32Array)Z=5124;else if(P instanceof Int8Array)Z=5120;else if(P instanceof Uint8Array)Z=5121;else if(P instanceof Uint8ClampedArray)Z=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+P);return{buffer:W,type:Z,bytesPerElement:P.BYTES_PER_ELEMENT,version:A.version}}function _(A,D,P){const k=D.array,W=D.updateRange;i.bindBuffer(P,A),W.count===-1?i.bufferSubData(P,0,k):(n?i.bufferSubData(P,W.offset*k.BYTES_PER_ELEMENT,k,W.offset,W.count):i.bufferSubData(P,W.offset*k.BYTES_PER_ELEMENT,k.subarray(W.offset,W.offset+W.count)),W.count=-1)}function w(A){return A.isInterleavedBufferAttribute&&(A=A.data),l.get(A)}function a(A){A.isInterleavedBufferAttribute&&(A=A.data);const D=l.get(A);D&&(i.deleteBuffer(D.buffer),l.delete(A))}function T(A,D){if(A.isGLBufferAttribute){const k=l.get(A);(!k||k.version<A.version)&&l.set(A,{buffer:A.buffer,type:A.type,bytesPerElement:A.elementSize,version:A.version});return}A.isInterleavedBufferAttribute&&(A=A.data);const P=l.get(A);P===void 0?l.set(A,d(A,D)):P.version<A.version&&(_(P.buffer,A,D),P.version=A.version)}return{get:w,remove:a,update:T}}class ry extends Yc{constructor(e=1,n=1,l=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:l,heightSegments:d};const _=e/2,w=n/2,a=Math.floor(l),T=Math.floor(d),A=a+1,D=T+1,P=e/a,k=n/T,W=[],Z=[],F=[],B=[];for(let G=0;G<D;G++){const $=G*k-w;for(let ne=0;ne<A;ne++){const me=ne*P-_;Z.push(me,-$,0),F.push(0,0,1),B.push(ne/a),B.push(1-G/T)}}for(let G=0;G<T;G++)for(let $=0;$<a;$++){const ne=$+A*G,me=$+A*(G+1),K=$+1+A*(G+1),Ee=$+1+A*G;W.push(ne,me,Ee),W.push(me,K,Ee)}this.setIndex(W),this.setAttribute("position",new Oc(Z,3)),this.setAttribute("normal",new Oc(F,3)),this.setAttribute("uv",new Oc(B,2))}static fromJSON(e){return new ry(e.width,e.height,e.widthSegments,e.heightSegments)}}var Xz=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Yz=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Kz=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Jz=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Qz=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ek=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,tk="vec3 transformed = vec3( position );",nk=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ik=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,rk=`#ifdef USE_IRIDESCENCE
const mat3 XYZ_TO_REC709 = mat3(
    3.2404542, -0.9692660,  0.0556434,
   -1.5371385,  1.8760108, -0.2040259,
   -0.4985314,  0.0415560,  1.0572252
);
vec3 Fresnel0ToIor( vec3 fresnel0 ) {
   vec3 sqrtF0 = sqrt( fresnel0 );
   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
}
vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
}
float IorToFresnel0( float transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
}
vec3 evalSensitivity( float OPD, vec3 shift ) {
   float phase = 2.0 * PI * OPD * 1.0e-9;
   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );
   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );
   xyz /= 1.0685e-7;
   vec3 srgb = XYZ_TO_REC709 * xyz;
   return srgb;
}
vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
   vec3 I;
   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
   float cosTheta2Sq = 1.0 - sinTheta2Sq;
   if ( cosTheta2Sq < 0.0 ) {
       return vec3( 1.0 );
   }
   float cosTheta2 = sqrt( cosTheta2Sq );
   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
   float R12 = F_Schlick( R0, 1.0, cosTheta1 );
   float R21 = R12;
   float T121 = 1.0 - R12;
   float phi12 = 0.0;
   if ( iridescenceIOR < outsideIOR ) phi12 = PI;
   float phi21 = PI - phi12;
   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
   vec3 phi23 = vec3( 0.0 );
   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;
   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;
   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;
   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
   vec3 phi = vec3( phi21 ) + phi23;
   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
   vec3 r123 = sqrt( R123 );
   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
   vec3 C0 = R12 + Rs;
   I = C0;
   vec3 Cm = Rs - T121;
   for ( int m = 1; m <= 2; ++m ) {
       Cm *= r123;
       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
       I += Cm * Sm;
   }
   return max( I, vec3( 0.0 ) );
}
#endif`,ok=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,sk=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,ak=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,ck=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,uk=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,hk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,dk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,fk=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,pk=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,mk=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,_k=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,gk=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,yk=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,xk=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,vk=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,wk="gl_FragColor = linearToOutputTexel( gl_FragColor );",bk=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Sk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Mk=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Tk=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ek=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Ck=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ak=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Ik=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Pk=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Lk=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Dk=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,zk=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,kk=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Rk=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Fk=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Bk=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Ok=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Nk=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Uk=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Vk=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Gk=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,jk=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Wk=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
float dotNVi = saturate( dot( normal, geometry.viewDir ) );
if ( material.iridescenceThickness == 0.0 ) {
	material.iridescence = 0.0;
} else {
	material.iridescence = saturate( material.iridescence );
}
if ( material.iridescence > 0.0 ) {
	material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
	material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Hk=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,$k=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,qk=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Zk=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Xk=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Yk=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Kk=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Jk=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Qk=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,eR=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tR=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,nR=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,iR=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,rR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,oR=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,sR=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,aR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,lR=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,cR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,hR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,dR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,fR=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,pR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,mR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,_R=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,gR=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,yR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,xR=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,wR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,bR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,SR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,MR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,TR=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,ER=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,CR=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,AR=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,IR=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,PR=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,LR=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,DR=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,zR=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,kR=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,RR=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,FR=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,BR=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,OR=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,NR=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,UR=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,VR=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,GR=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,jR=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,WR=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,HR=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const $R=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,qR=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ZR=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,XR=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,YR=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,KR=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,JR=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,QR=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,eF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,tF=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,nF=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,iF=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rF=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,oF=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sF=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,aF=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lF=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,cF=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uF=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,hF=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,dF=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fF=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pF=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,mF=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_F=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gF=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yF=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,xF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vF=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wF=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,bF=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,jn={alphamap_fragment:Xz,alphamap_pars_fragment:Yz,alphatest_fragment:Kz,alphatest_pars_fragment:Jz,aomap_fragment:Qz,aomap_pars_fragment:ek,begin_vertex:tk,beginnormal_vertex:nk,bsdfs:ik,iridescence_fragment:rk,bumpmap_pars_fragment:ok,clipping_planes_fragment:sk,clipping_planes_pars_fragment:ak,clipping_planes_pars_vertex:lk,clipping_planes_vertex:ck,color_fragment:uk,color_pars_fragment:hk,color_pars_vertex:dk,color_vertex:fk,common:pk,cube_uv_reflection_fragment:mk,defaultnormal_vertex:_k,displacementmap_pars_vertex:gk,displacementmap_vertex:yk,emissivemap_fragment:xk,emissivemap_pars_fragment:vk,encodings_fragment:wk,encodings_pars_fragment:bk,envmap_fragment:Sk,envmap_common_pars_fragment:Mk,envmap_pars_fragment:Tk,envmap_pars_vertex:Ek,envmap_physical_pars_fragment:Bk,envmap_vertex:Ck,fog_vertex:Ak,fog_pars_vertex:Ik,fog_fragment:Pk,fog_pars_fragment:Lk,gradientmap_pars_fragment:Dk,lightmap_fragment:zk,lightmap_pars_fragment:kk,lights_lambert_vertex:Rk,lights_pars_begin:Fk,lights_toon_fragment:Ok,lights_toon_pars_fragment:Nk,lights_phong_fragment:Uk,lights_phong_pars_fragment:Vk,lights_physical_fragment:Gk,lights_physical_pars_fragment:jk,lights_fragment_begin:Wk,lights_fragment_maps:Hk,lights_fragment_end:$k,logdepthbuf_fragment:qk,logdepthbuf_pars_fragment:Zk,logdepthbuf_pars_vertex:Xk,logdepthbuf_vertex:Yk,map_fragment:Kk,map_pars_fragment:Jk,map_particle_fragment:Qk,map_particle_pars_fragment:eR,metalnessmap_fragment:tR,metalnessmap_pars_fragment:nR,morphcolor_vertex:iR,morphnormal_vertex:rR,morphtarget_pars_vertex:oR,morphtarget_vertex:sR,normal_fragment_begin:aR,normal_fragment_maps:lR,normal_pars_fragment:cR,normal_pars_vertex:uR,normal_vertex:hR,normalmap_pars_fragment:dR,clearcoat_normal_fragment_begin:fR,clearcoat_normal_fragment_maps:pR,clearcoat_pars_fragment:mR,iridescence_pars_fragment:_R,output_fragment:gR,packing:yR,premultiplied_alpha_fragment:xR,project_vertex:vR,dithering_fragment:wR,dithering_pars_fragment:bR,roughnessmap_fragment:SR,roughnessmap_pars_fragment:MR,shadowmap_pars_fragment:TR,shadowmap_pars_vertex:ER,shadowmap_vertex:CR,shadowmask_pars_fragment:AR,skinbase_vertex:IR,skinning_pars_vertex:PR,skinning_vertex:LR,skinnormal_vertex:DR,specularmap_fragment:zR,specularmap_pars_fragment:kR,tonemapping_fragment:RR,tonemapping_pars_fragment:FR,transmission_fragment:BR,transmission_pars_fragment:OR,uv_pars_fragment:NR,uv_pars_vertex:UR,uv_vertex:VR,uv2_pars_fragment:GR,uv2_pars_vertex:jR,uv2_vertex:WR,worldpos_vertex:HR,background_vert:$R,background_frag:qR,cube_vert:ZR,cube_frag:XR,depth_vert:YR,depth_frag:KR,distanceRGBA_vert:JR,distanceRGBA_frag:QR,equirect_vert:eF,equirect_frag:tF,linedashed_vert:nF,linedashed_frag:iF,meshbasic_vert:rF,meshbasic_frag:oF,meshlambert_vert:sF,meshlambert_frag:aF,meshmatcap_vert:lF,meshmatcap_frag:cF,meshnormal_vert:uF,meshnormal_frag:hF,meshphong_vert:dF,meshphong_frag:fF,meshphysical_vert:pF,meshphysical_frag:mF,meshtoon_vert:_F,meshtoon_frag:gF,points_vert:yF,points_frag:xF,shadow_vert:vF,shadow_frag:wF,sprite_vert:bF,sprite_frag:SF},Zt={common:{diffuse:{value:new Ln(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Bs},uv2Transform:{value:new Bs},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new In(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ln(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ln(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Bs}},sprite:{diffuse:{value:new Ln(16777215)},opacity:{value:1},center:{value:new In(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Bs}}},ks={basic:{uniforms:zr([Zt.common,Zt.specularmap,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.fog]),vertexShader:jn.meshbasic_vert,fragmentShader:jn.meshbasic_frag},lambert:{uniforms:zr([Zt.common,Zt.specularmap,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.fog,Zt.lights,{emissive:{value:new Ln(0)}}]),vertexShader:jn.meshlambert_vert,fragmentShader:jn.meshlambert_frag},phong:{uniforms:zr([Zt.common,Zt.specularmap,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.fog,Zt.lights,{emissive:{value:new Ln(0)},specular:{value:new Ln(1118481)},shininess:{value:30}}]),vertexShader:jn.meshphong_vert,fragmentShader:jn.meshphong_frag},standard:{uniforms:zr([Zt.common,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.roughnessmap,Zt.metalnessmap,Zt.fog,Zt.lights,{emissive:{value:new Ln(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jn.meshphysical_vert,fragmentShader:jn.meshphysical_frag},toon:{uniforms:zr([Zt.common,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.gradientmap,Zt.fog,Zt.lights,{emissive:{value:new Ln(0)}}]),vertexShader:jn.meshtoon_vert,fragmentShader:jn.meshtoon_frag},matcap:{uniforms:zr([Zt.common,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.fog,{matcap:{value:null}}]),vertexShader:jn.meshmatcap_vert,fragmentShader:jn.meshmatcap_frag},points:{uniforms:zr([Zt.points,Zt.fog]),vertexShader:jn.points_vert,fragmentShader:jn.points_frag},dashed:{uniforms:zr([Zt.common,Zt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jn.linedashed_vert,fragmentShader:jn.linedashed_frag},depth:{uniforms:zr([Zt.common,Zt.displacementmap]),vertexShader:jn.depth_vert,fragmentShader:jn.depth_frag},normal:{uniforms:zr([Zt.common,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,{opacity:{value:1}}]),vertexShader:jn.meshnormal_vert,fragmentShader:jn.meshnormal_frag},sprite:{uniforms:zr([Zt.sprite,Zt.fog]),vertexShader:jn.sprite_vert,fragmentShader:jn.sprite_frag},background:{uniforms:{uvTransform:{value:new Bs},t2D:{value:null}},vertexShader:jn.background_vert,fragmentShader:jn.background_frag},cube:{uniforms:zr([Zt.envmap,{opacity:{value:1}}]),vertexShader:jn.cube_vert,fragmentShader:jn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jn.equirect_vert,fragmentShader:jn.equirect_frag},distanceRGBA:{uniforms:zr([Zt.common,Zt.displacementmap,{referencePosition:{value:new Ye},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jn.distanceRGBA_vert,fragmentShader:jn.distanceRGBA_frag},shadow:{uniforms:zr([Zt.lights,Zt.fog,{color:{value:new Ln(0)},opacity:{value:1}}]),vertexShader:jn.shadow_vert,fragmentShader:jn.shadow_frag}};ks.physical={uniforms:zr([ks.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new In(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ln(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new In},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ln(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ln(1,1,1)},specularColorMap:{value:null}}]),vertexShader:jn.meshphysical_vert,fragmentShader:jn.meshphysical_frag};function MF(i,e,n,l,d,_){const w=new Ln(0);let a=d===!0?0:1,T,A,D=null,P=0,k=null;function W(F,B){let G=!1,$=B.isScene===!0?B.background:null;$&&$.isTexture&&($=e.get($));const ne=i.xr,me=ne.getSession&&ne.getSession();me&&me.environmentBlendMode==="additive"&&($=null),$===null?Z(w,a):$&&$.isColor&&(Z($,1),G=!0),(i.autoClear||G)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),$&&($.isCubeTexture||$.mapping===ny)?(A===void 0&&(A=new _a(new Lp(1,1,1),new Sa({name:"BackgroundCubeMaterial",uniforms:td(ks.cube.uniforms),vertexShader:ks.cube.vertexShader,fragmentShader:ks.cube.fragmentShader,side:ds,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),A.geometry.deleteAttribute("uv"),A.onBeforeRender=function(K,Ee,Te){this.matrixWorld.copyPosition(Te.matrixWorld)},Object.defineProperty(A.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),l.update(A)),A.material.uniforms.envMap.value=$,A.material.uniforms.flipEnvMap.value=$.isCubeTexture&&$.isRenderTargetTexture===!1?-1:1,(D!==$||P!==$.version||k!==i.toneMapping)&&(A.material.needsUpdate=!0,D=$,P=$.version,k=i.toneMapping),A.layers.enableAll(),F.unshift(A,A.geometry,A.material,0,0,null)):$&&$.isTexture&&(T===void 0&&(T=new _a(new ry(2,2),new Sa({name:"BackgroundMaterial",uniforms:td(ks.background.uniforms),vertexShader:ks.background.vertexShader,fragmentShader:ks.background.fragmentShader,side:yp,depthTest:!1,depthWrite:!1,fog:!1})),T.geometry.deleteAttribute("normal"),Object.defineProperty(T.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(T)),T.material.uniforms.t2D.value=$,$.matrixAutoUpdate===!0&&$.updateMatrix(),T.material.uniforms.uvTransform.value.copy($.matrix),(D!==$||P!==$.version||k!==i.toneMapping)&&(T.material.needsUpdate=!0,D=$,P=$.version,k=i.toneMapping),T.layers.enableAll(),F.unshift(T,T.geometry,T.material,0,0,null))}function Z(F,B){n.buffers.color.setClear(F.r,F.g,F.b,B,_)}return{getClearColor:function(){return w},setClearColor:function(F,B=1){w.set(F),a=B,Z(w,a)},getClearAlpha:function(){return a},setClearAlpha:function(F){a=F,Z(w,a)},render:W}}function TF(i,e,n,l){const d=i.getParameter(34921),_=l.isWebGL2?null:e.get("OES_vertex_array_object"),w=l.isWebGL2||_!==null,a={},T=B(null);let A=T,D=!1;function P(je,ut,tt,ct,Be){let Ne=!1;if(w){const Ze=F(ct,tt,ut);A!==Ze&&(A=Ze,W(A.object)),Ne=G(je,ct,tt,Be),Ne&&$(je,ct,tt,Be)}else{const Ze=ut.wireframe===!0;(A.geometry!==ct.id||A.program!==tt.id||A.wireframe!==Ze)&&(A.geometry=ct.id,A.program=tt.id,A.wireframe=Ze,Ne=!0)}Be!==null&&n.update(Be,34963),(Ne||D)&&(D=!1,ee(je,ut,tt,ct),Be!==null&&i.bindBuffer(34963,n.get(Be).buffer))}function k(){return l.isWebGL2?i.createVertexArray():_.createVertexArrayOES()}function W(je){return l.isWebGL2?i.bindVertexArray(je):_.bindVertexArrayOES(je)}function Z(je){return l.isWebGL2?i.deleteVertexArray(je):_.deleteVertexArrayOES(je)}function F(je,ut,tt){const ct=tt.wireframe===!0;let Be=a[je.id];Be===void 0&&(Be={},a[je.id]=Be);let Ne=Be[ut.id];Ne===void 0&&(Ne={},Be[ut.id]=Ne);let Ze=Ne[ct];return Ze===void 0&&(Ze=B(k()),Ne[ct]=Ze),Ze}function B(je){const ut=[],tt=[],ct=[];for(let Be=0;Be<d;Be++)ut[Be]=0,tt[Be]=0,ct[Be]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ut,enabledAttributes:tt,attributeDivisors:ct,object:je,attributes:{},index:null}}function G(je,ut,tt,ct){const Be=A.attributes,Ne=ut.attributes;let Ze=0;const pt=tt.getAttributes();for(const et in pt)if(pt[et].location>=0){const jt=Be[et];let Xt=Ne[et];if(Xt===void 0&&(et==="instanceMatrix"&&je.instanceMatrix&&(Xt=je.instanceMatrix),et==="instanceColor"&&je.instanceColor&&(Xt=je.instanceColor)),jt===void 0||jt.attribute!==Xt||Xt&&jt.data!==Xt.data)return!0;Ze++}return A.attributesNum!==Ze||A.index!==ct}function $(je,ut,tt,ct){const Be={},Ne=ut.attributes;let Ze=0;const pt=tt.getAttributes();for(const et in pt)if(pt[et].location>=0){let jt=Ne[et];jt===void 0&&(et==="instanceMatrix"&&je.instanceMatrix&&(jt=je.instanceMatrix),et==="instanceColor"&&je.instanceColor&&(jt=je.instanceColor));const Xt={};Xt.attribute=jt,jt&&jt.data&&(Xt.data=jt.data),Be[et]=Xt,Ze++}A.attributes=Be,A.attributesNum=Ze,A.index=ct}function ne(){const je=A.newAttributes;for(let ut=0,tt=je.length;ut<tt;ut++)je[ut]=0}function me(je){K(je,0)}function K(je,ut){const tt=A.newAttributes,ct=A.enabledAttributes,Be=A.attributeDivisors;tt[je]=1,ct[je]===0&&(i.enableVertexAttribArray(je),ct[je]=1),Be[je]!==ut&&((l.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[l.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](je,ut),Be[je]=ut)}function Ee(){const je=A.newAttributes,ut=A.enabledAttributes;for(let tt=0,ct=ut.length;tt<ct;tt++)ut[tt]!==je[tt]&&(i.disableVertexAttribArray(tt),ut[tt]=0)}function Te(je,ut,tt,ct,Be,Ne){l.isWebGL2===!0&&(tt===5124||tt===5125)?i.vertexAttribIPointer(je,ut,tt,Be,Ne):i.vertexAttribPointer(je,ut,tt,ct,Be,Ne)}function ee(je,ut,tt,ct){if(l.isWebGL2===!1&&(je.isInstancedMesh||ct.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;ne();const Be=ct.attributes,Ne=tt.getAttributes(),Ze=ut.defaultAttributeValues;for(const pt in Ne){const et=Ne[pt];if(et.location>=0){let gt=Be[pt];if(gt===void 0&&(pt==="instanceMatrix"&&je.instanceMatrix&&(gt=je.instanceMatrix),pt==="instanceColor"&&je.instanceColor&&(gt=je.instanceColor)),gt!==void 0){const jt=gt.normalized,Xt=gt.itemSize,ot=n.get(gt);if(ot===void 0)continue;const Tn=ot.buffer,fn=ot.type,pn=ot.bytesPerElement;if(gt.isInterleavedBufferAttribute){const Wt=gt.data,On=Wt.stride,bn=gt.offset;if(Wt.isInstancedInterleavedBuffer){for(let hn=0;hn<et.locationSize;hn++)K(et.location+hn,Wt.meshPerAttribute);je.isInstancedMesh!==!0&&ct._maxInstanceCount===void 0&&(ct._maxInstanceCount=Wt.meshPerAttribute*Wt.count)}else for(let hn=0;hn<et.locationSize;hn++)me(et.location+hn);i.bindBuffer(34962,Tn);for(let hn=0;hn<et.locationSize;hn++)Te(et.location+hn,Xt/et.locationSize,fn,jt,On*pn,(bn+Xt/et.locationSize*hn)*pn)}else{if(gt.isInstancedBufferAttribute){for(let Wt=0;Wt<et.locationSize;Wt++)K(et.location+Wt,gt.meshPerAttribute);je.isInstancedMesh!==!0&&ct._maxInstanceCount===void 0&&(ct._maxInstanceCount=gt.meshPerAttribute*gt.count)}else for(let Wt=0;Wt<et.locationSize;Wt++)me(et.location+Wt);i.bindBuffer(34962,Tn);for(let Wt=0;Wt<et.locationSize;Wt++)Te(et.location+Wt,Xt/et.locationSize,fn,jt,Xt*pn,Xt/et.locationSize*Wt*pn)}}else if(Ze!==void 0){const jt=Ze[pt];if(jt!==void 0)switch(jt.length){case 2:i.vertexAttrib2fv(et.location,jt);break;case 3:i.vertexAttrib3fv(et.location,jt);break;case 4:i.vertexAttrib4fv(et.location,jt);break;default:i.vertexAttrib1fv(et.location,jt)}}}}Ee()}function Ae(){Pt();for(const je in a){const ut=a[je];for(const tt in ut){const ct=ut[tt];for(const Be in ct)Z(ct[Be].object),delete ct[Be];delete ut[tt]}delete a[je]}}function Fe(je){if(a[je.id]===void 0)return;const ut=a[je.id];for(const tt in ut){const ct=ut[tt];for(const Be in ct)Z(ct[Be].object),delete ct[Be];delete ut[tt]}delete a[je.id]}function qe(je){for(const ut in a){const tt=a[ut];if(tt[je.id]===void 0)continue;const ct=tt[je.id];for(const Be in ct)Z(ct[Be].object),delete ct[Be];delete tt[je.id]}}function Pt(){xt(),D=!0,A!==T&&(A=T,W(A.object))}function xt(){T.geometry=null,T.program=null,T.wireframe=!1}return{setup:P,reset:Pt,resetDefaultState:xt,dispose:Ae,releaseStatesOfGeometry:Fe,releaseStatesOfProgram:qe,initAttributes:ne,enableAttribute:me,disableUnusedAttributes:Ee}}function EF(i,e,n,l){const d=l.isWebGL2;let _;function w(A){_=A}function a(A,D){i.drawArrays(_,A,D),n.update(D,_,1)}function T(A,D,P){if(P===0)return;let k,W;if(d)k=i,W="drawArraysInstanced";else if(k=e.get("ANGLE_instanced_arrays"),W="drawArraysInstancedANGLE",k===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}k[W](_,A,D,P),n.update(D,_,P)}this.setMode=w,this.render=a,this.renderInstances=T}function CF(i,e,n){let l;function d(){if(l!==void 0)return l;if(e.has("EXT_texture_filter_anisotropic")===!0){const Te=e.get("EXT_texture_filter_anisotropic");l=i.getParameter(Te.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else l=0;return l}function _(Te){if(Te==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Te="mediump"}return Te==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const w=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext;let a=n.precision!==void 0?n.precision:"highp";const T=_(a);T!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",T,"instead."),a=T);const A=w||e.has("WEBGL_draw_buffers"),D=n.logarithmicDepthBuffer===!0,P=i.getParameter(34930),k=i.getParameter(35660),W=i.getParameter(3379),Z=i.getParameter(34076),F=i.getParameter(34921),B=i.getParameter(36347),G=i.getParameter(36348),$=i.getParameter(36349),ne=k>0,me=w||e.has("OES_texture_float"),K=ne&&me,Ee=w?i.getParameter(36183):0;return{isWebGL2:w,drawBuffers:A,getMaxAnisotropy:d,getMaxPrecision:_,precision:a,logarithmicDepthBuffer:D,maxTextures:P,maxVertexTextures:k,maxTextureSize:W,maxCubemapSize:Z,maxAttributes:F,maxVertexUniforms:B,maxVaryings:G,maxFragmentUniforms:$,vertexTextures:ne,floatFragmentTextures:me,floatVertexTextures:K,maxSamples:Ee}}function AF(i){const e=this;let n=null,l=0,d=!1,_=!1;const w=new Mc,a=new Bs,T={value:null,needsUpdate:!1};this.uniform=T,this.numPlanes=0,this.numIntersection=0,this.init=function(P,k,W){const Z=P.length!==0||k||l!==0||d;return d=k,n=D(P,W,0),l=P.length,Z},this.beginShadows=function(){_=!0,D(null)},this.endShadows=function(){_=!1,A()},this.setState=function(P,k,W){const Z=P.clippingPlanes,F=P.clipIntersection,B=P.clipShadows,G=i.get(P);if(!d||Z===null||Z.length===0||_&&!B)_?D(null):A();else{const $=_?0:l,ne=$*4;let me=G.clippingState||null;T.value=me,me=D(Z,k,ne,W);for(let K=0;K!==ne;++K)me[K]=n[K];G.clippingState=me,this.numIntersection=F?this.numPlanes:0,this.numPlanes+=$}};function A(){T.value!==n&&(T.value=n,T.needsUpdate=l>0),e.numPlanes=l,e.numIntersection=0}function D(P,k,W,Z){const F=P!==null?P.length:0;let B=null;if(F!==0){if(B=T.value,Z!==!0||B===null){const G=W+F*4,$=k.matrixWorldInverse;a.getNormalMatrix($),(B===null||B.length<G)&&(B=new Float32Array(G));for(let ne=0,me=W;ne!==F;++ne,me+=4)w.copy(P[ne]).applyMatrix4($,a),w.normal.toArray(B,me),B[me+3]=w.constant}T.value=B,T.needsUpdate=!0}return e.numPlanes=F,e.numIntersection=0,B}}function IF(i){let e=new WeakMap;function n(w,a){return a===Lv?w.mapping=Jh:a===Dv&&(w.mapping=Qh),w}function l(w){if(w&&w.isTexture&&w.isRenderTargetTexture===!1){const a=w.mapping;if(a===Lv||a===Dv)if(e.has(w)){const T=e.get(w).texture;return n(T,w.mapping)}else{const T=w.image;if(T&&T.height>0){const A=new Hz(T.height/2);return A.fromEquirectangularTexture(i,w),e.set(w,A),w.addEventListener("dispose",d),n(A.texture,w.mapping)}else return null}}return w}function d(w){const a=w.target;a.removeEventListener("dispose",d);const T=e.get(a);T!==void 0&&(e.delete(a),T.dispose())}function _(){e=new WeakMap}return{get:l,dispose:_}}class PF extends FC{constructor(e=-1,n=1,l=1,d=-1,_=.1,w=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=l,this.bottom=d,this.near=_,this.far=w,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,l,d,_,w){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=l,this.view.offsetY=d,this.view.width=_,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),l=(this.right+this.left)/2,d=(this.top+this.bottom)/2;let _=l-e,w=l+e,a=d+n,T=d-n;if(this.view!==null&&this.view.enabled){const A=(this.right-this.left)/this.view.fullWidth/this.zoom,D=(this.top-this.bottom)/this.view.fullHeight/this.zoom;_+=A*this.view.offsetX,w=_+A*this.view.width,a-=D*this.view.offsetY,T=a-D*this.view.height}this.projectionMatrix.makeOrthographic(_,w,a,T,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const zh=4,b2=[.125,.215,.35,.446,.526,.582],Ec=20,Ix=new PF,S2=new Ln;let Px=null;const Tc=(1+Math.sqrt(5))/2,_h=1/Tc,M2=[new Ye(1,1,1),new Ye(-1,1,1),new Ye(1,1,-1),new Ye(-1,1,-1),new Ye(0,Tc,_h),new Ye(0,Tc,-_h),new Ye(_h,0,Tc),new Ye(-_h,0,Tc),new Ye(Tc,_h,0),new Ye(-Tc,_h,0)];class T2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,l=.1,d=100){Px=this._renderer.getRenderTarget(),this._setSize(256);const _=this._allocateTargets();return _.depthBuffer=!0,this._sceneToCubeUV(e,l,d,_),n>0&&this._blur(_,0,0,n),this._applyPMREM(_),this._cleanup(_),_}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=A2(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=C2(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Px),e.scissorTest=!1,q_(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Jh||e.mapping===Qh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Px=this._renderer.getRenderTarget();const l=n||this._allocateTargets();return this._textureToCubeUV(e,l),this._applyPMREM(l),this._cleanup(l),l}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,l={magFilter:Oo,minFilter:Oo,generateMipmaps:!1,type:vp,format:cs,encoding:Hc,depthBuffer:!1},d=E2(e,n,l);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=E2(e,n,l);const{_lodMax:_}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=LF(_)),this._blurMaterial=DF(_,e,n)}return d}_compileMaterial(e){const n=new _a(this._lodPlanes[0],e);this._renderer.compile(n,Ix)}_sceneToCubeUV(e,n,l,d){const a=new vo(90,1,n,l),T=[1,-1,1,1,1,1],A=[1,1,1,-1,-1,-1],D=this._renderer,P=D.autoClear,k=D.toneMapping;D.getClearColor(S2),D.toneMapping=ya,D.autoClear=!1;const W=new G1({name:"PMREM.Background",side:ds,depthWrite:!1,depthTest:!1}),Z=new _a(new Lp,W);let F=!1;const B=e.background;B?B.isColor&&(W.color.copy(B),e.background=null,F=!0):(W.color.copy(S2),F=!0);for(let G=0;G<6;G++){const $=G%3;$===0?(a.up.set(0,T[G],0),a.lookAt(A[G],0,0)):$===1?(a.up.set(0,0,T[G]),a.lookAt(0,A[G],0)):(a.up.set(0,T[G],0),a.lookAt(0,0,A[G]));const ne=this._cubeSize;q_(d,$*ne,G>2?ne:0,ne,ne),D.setRenderTarget(d),F&&D.render(Z,a),D.render(e,a)}Z.geometry.dispose(),Z.material.dispose(),D.toneMapping=k,D.autoClear=P,e.background=B}_textureToCubeUV(e,n){const l=this._renderer,d=e.mapping===Jh||e.mapping===Qh;d?(this._cubemapMaterial===null&&(this._cubemapMaterial=A2()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=C2());const _=d?this._cubemapMaterial:this._equirectMaterial,w=new _a(this._lodPlanes[0],_),a=_.uniforms;a.envMap.value=e;const T=this._cubeSize;q_(n,0,0,3*T,2*T),l.setRenderTarget(n),l.render(w,Ix)}_applyPMREM(e){const n=this._renderer,l=n.autoClear;n.autoClear=!1;for(let d=1;d<this._lodPlanes.length;d++){const _=Math.sqrt(this._sigmas[d]*this._sigmas[d]-this._sigmas[d-1]*this._sigmas[d-1]),w=M2[(d-1)%M2.length];this._blur(e,d-1,d,_,w)}n.autoClear=l}_blur(e,n,l,d,_){const w=this._pingPongRenderTarget;this._halfBlur(e,w,n,l,d,"latitudinal",_),this._halfBlur(w,e,l,l,d,"longitudinal",_)}_halfBlur(e,n,l,d,_,w,a){const T=this._renderer,A=this._blurMaterial;w!=="latitudinal"&&w!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const D=3,P=new _a(this._lodPlanes[d],A),k=A.uniforms,W=this._sizeLods[l]-1,Z=isFinite(_)?Math.PI/(2*W):2*Math.PI/(2*Ec-1),F=_/Z,B=isFinite(_)?1+Math.floor(D*F):Ec;B>Ec&&console.warn(`sigmaRadians, ${_}, is too large and will clip, as it requested ${B} samples when the maximum is set to ${Ec}`);const G=[];let $=0;for(let Te=0;Te<Ec;++Te){const ee=Te/F,Ae=Math.exp(-ee*ee/2);G.push(Ae),Te===0?$+=Ae:Te<B&&($+=2*Ae)}for(let Te=0;Te<G.length;Te++)G[Te]=G[Te]/$;k.envMap.value=e.texture,k.samples.value=B,k.weights.value=G,k.latitudinal.value=w==="latitudinal",a&&(k.poleAxis.value=a);const{_lodMax:ne}=this;k.dTheta.value=Z,k.mipInt.value=ne-l;const me=this._sizeLods[d],K=3*me*(d>ne-zh?d-ne+zh:0),Ee=4*(this._cubeSize-me);q_(n,K,Ee,3*me,2*me),T.setRenderTarget(n),T.render(P,Ix)}}function LF(i){const e=[],n=[],l=[];let d=i;const _=i-zh+1+b2.length;for(let w=0;w<_;w++){const a=Math.pow(2,d);n.push(a);let T=1/a;w>i-zh?T=b2[w-i+zh-1]:w===0&&(T=0),l.push(T);const A=1/(a-2),D=-A,P=1+A,k=[D,D,P,D,P,P,D,D,P,P,D,P],W=6,Z=6,F=3,B=2,G=1,$=new Float32Array(F*Z*W),ne=new Float32Array(B*Z*W),me=new Float32Array(G*Z*W);for(let Ee=0;Ee<W;Ee++){const Te=Ee%3*2/3-1,ee=Ee>2?0:-1,Ae=[Te,ee,0,Te+2/3,ee,0,Te+2/3,ee+1,0,Te,ee,0,Te+2/3,ee+1,0,Te,ee+1,0];$.set(Ae,F*Z*Ee),ne.set(k,B*Z*Ee);const Fe=[Ee,Ee,Ee,Ee,Ee,Ee];me.set(Fe,G*Z*Ee)}const K=new Yc;K.setAttribute("position",new Us($,F)),K.setAttribute("uv",new Us(ne,B)),K.setAttribute("faceIndex",new Us(me,G)),e.push(K),d>zh&&d--}return{lodPlanes:e,sizeLods:n,sigmas:l}}function E2(i,e,n){const l=new El(i,e,n);return l.texture.mapping=ny,l.texture.name="PMREM.cubeUv",l.scissorTest=!0,l}function q_(i,e,n,l,d){i.viewport.set(e,n,l,d),i.scissor.set(e,n,l,d)}function DF(i,e,n){const l=new Float32Array(Ec),d=new Ye(0,1,0);return new Sa({name:"SphericalGaussianBlur",defines:{n:Ec,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:l},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:d}},vertexShader:W1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Tl,depthTest:!1,depthWrite:!1})}function C2(){return new Sa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:W1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Tl,depthTest:!1,depthWrite:!1})}function A2(){return new Sa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:W1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Tl,depthTest:!1,depthWrite:!1})}function W1(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zF(i){let e=new WeakMap,n=null;function l(a){if(a&&a.isTexture){const T=a.mapping,A=T===Lv||T===Dv,D=T===Jh||T===Qh;if(A||D)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let P=e.get(a);return n===null&&(n=new T2(i)),P=A?n.fromEquirectangular(a,P):n.fromCubemap(a,P),e.set(a,P),P.texture}else{if(e.has(a))return e.get(a).texture;{const P=a.image;if(A&&P&&P.height>0||D&&P&&d(P)){n===null&&(n=new T2(i));const k=A?n.fromEquirectangular(a):n.fromCubemap(a);return e.set(a,k),a.addEventListener("dispose",_),k.texture}else return null}}}return a}function d(a){let T=0;const A=6;for(let D=0;D<A;D++)a[D]!==void 0&&T++;return T===A}function _(a){const T=a.target;T.removeEventListener("dispose",_);const A=e.get(T);A!==void 0&&(e.delete(T),A.dispose())}function w(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:l,dispose:w}}function kF(i){const e={};function n(l){if(e[l]!==void 0)return e[l];let d;switch(l){case"WEBGL_depth_texture":d=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=i.getExtension(l)}return e[l]=d,d}return{has:function(l){return n(l)!==null},init:function(l){l.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(l){const d=n(l);return d===null&&console.warn("THREE.WebGLRenderer: "+l+" extension not supported."),d}}}function RF(i,e,n,l){const d={},_=new WeakMap;function w(P){const k=P.target;k.index!==null&&e.remove(k.index);for(const Z in k.attributes)e.remove(k.attributes[Z]);k.removeEventListener("dispose",w),delete d[k.id];const W=_.get(k);W&&(e.remove(W),_.delete(k)),l.releaseStatesOfGeometry(k),k.isInstancedBufferGeometry===!0&&delete k._maxInstanceCount,n.memory.geometries--}function a(P,k){return d[k.id]===!0||(k.addEventListener("dispose",w),d[k.id]=!0,n.memory.geometries++),k}function T(P){const k=P.attributes;for(const Z in k)e.update(k[Z],34962);const W=P.morphAttributes;for(const Z in W){const F=W[Z];for(let B=0,G=F.length;B<G;B++)e.update(F[B],34962)}}function A(P){const k=[],W=P.index,Z=P.attributes.position;let F=0;if(W!==null){const $=W.array;F=W.version;for(let ne=0,me=$.length;ne<me;ne+=3){const K=$[ne+0],Ee=$[ne+1],Te=$[ne+2];k.push(K,Ee,Ee,Te,Te,K)}}else{const $=Z.array;F=Z.version;for(let ne=0,me=$.length/3-1;ne<me;ne+=3){const K=ne+0,Ee=ne+1,Te=ne+2;k.push(K,Ee,Ee,Te,Te,K)}}const B=new(AC(k)?RC:kC)(k,1);B.version=F;const G=_.get(P);G&&e.remove(G),_.set(P,B)}function D(P){const k=_.get(P);if(k){const W=P.index;W!==null&&k.version<W.version&&A(P)}else A(P);return _.get(P)}return{get:a,update:T,getWireframeAttribute:D}}function FF(i,e,n,l){const d=l.isWebGL2;let _;function w(k){_=k}let a,T;function A(k){a=k.type,T=k.bytesPerElement}function D(k,W){i.drawElements(_,W,a,k*T),n.update(W,_,1)}function P(k,W,Z){if(Z===0)return;let F,B;if(d)F=i,B="drawElementsInstanced";else if(F=e.get("ANGLE_instanced_arrays"),B="drawElementsInstancedANGLE",F===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}F[B](_,W,a,k*T,Z),n.update(W,_,Z)}this.setMode=w,this.setIndex=A,this.render=D,this.renderInstances=P}function BF(i){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function l(_,w,a){switch(n.calls++,w){case 4:n.triangles+=a*(_/3);break;case 1:n.lines+=a*(_/2);break;case 3:n.lines+=a*(_-1);break;case 2:n.lines+=a*_;break;case 0:n.points+=a*_;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",w);break}}function d(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:d,update:l}}function OF(i,e){return i[0]-e[0]}function NF(i,e){return Math.abs(e[1])-Math.abs(i[1])}function Lx(i,e){let n=1;const l=e.isInterleavedBufferAttribute?e.data.array:e.array;l instanceof Int8Array?n=127:l instanceof Int16Array?n=32767:l instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",l),i.divideScalar(n)}function UF(i,e,n){const l={},d=new Float32Array(8),_=new WeakMap,w=new vr,a=[];for(let A=0;A<8;A++)a[A]=[A,0];function T(A,D,P,k){const W=A.morphTargetInfluences;if(e.isWebGL2===!0){const F=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,B=F!==void 0?F.length:0;let G=_.get(D);if(G===void 0||G.count!==B){let tt=function(){je.dispose(),_.delete(D),D.removeEventListener("dispose",tt)};var Z=tt;G!==void 0&&G.texture.dispose();const me=D.morphAttributes.position!==void 0,K=D.morphAttributes.normal!==void 0,Ee=D.morphAttributes.color!==void 0,Te=D.morphAttributes.position||[],ee=D.morphAttributes.normal||[],Ae=D.morphAttributes.color||[];let Fe=0;me===!0&&(Fe=1),K===!0&&(Fe=2),Ee===!0&&(Fe=3);let qe=D.attributes.position.count*Fe,Pt=1;qe>e.maxTextureSize&&(Pt=Math.ceil(qe/e.maxTextureSize),qe=e.maxTextureSize);const xt=new Float32Array(qe*Pt*4*B),je=new DC(xt,qe,Pt,B);je.type=Dc,je.needsUpdate=!0;const ut=Fe*4;for(let ct=0;ct<B;ct++){const Be=Te[ct],Ne=ee[ct],Ze=Ae[ct],pt=qe*Pt*4*ct;for(let et=0;et<Be.count;et++){const gt=et*ut;me===!0&&(w.fromBufferAttribute(Be,et),Be.normalized===!0&&Lx(w,Be),xt[pt+gt+0]=w.x,xt[pt+gt+1]=w.y,xt[pt+gt+2]=w.z,xt[pt+gt+3]=0),K===!0&&(w.fromBufferAttribute(Ne,et),Ne.normalized===!0&&Lx(w,Ne),xt[pt+gt+4]=w.x,xt[pt+gt+5]=w.y,xt[pt+gt+6]=w.z,xt[pt+gt+7]=0),Ee===!0&&(w.fromBufferAttribute(Ze,et),Ze.normalized===!0&&Lx(w,Ze),xt[pt+gt+8]=w.x,xt[pt+gt+9]=w.y,xt[pt+gt+10]=w.z,xt[pt+gt+11]=Ze.itemSize===4?w.w:1)}}G={count:B,texture:je,size:new In(qe,Pt)},_.set(D,G),D.addEventListener("dispose",tt)}let $=0;for(let me=0;me<W.length;me++)$+=W[me];const ne=D.morphTargetsRelative?1:1-$;k.getUniforms().setValue(i,"morphTargetBaseInfluence",ne),k.getUniforms().setValue(i,"morphTargetInfluences",W),k.getUniforms().setValue(i,"morphTargetsTexture",G.texture,n),k.getUniforms().setValue(i,"morphTargetsTextureSize",G.size)}else{const F=W===void 0?0:W.length;let B=l[D.id];if(B===void 0||B.length!==F){B=[];for(let K=0;K<F;K++)B[K]=[K,0];l[D.id]=B}for(let K=0;K<F;K++){const Ee=B[K];Ee[0]=K,Ee[1]=W[K]}B.sort(NF);for(let K=0;K<8;K++)K<F&&B[K][1]?(a[K][0]=B[K][0],a[K][1]=B[K][1]):(a[K][0]=Number.MAX_SAFE_INTEGER,a[K][1]=0);a.sort(OF);const G=D.morphAttributes.position,$=D.morphAttributes.normal;let ne=0;for(let K=0;K<8;K++){const Ee=a[K],Te=Ee[0],ee=Ee[1];Te!==Number.MAX_SAFE_INTEGER&&ee?(G&&D.getAttribute("morphTarget"+K)!==G[Te]&&D.setAttribute("morphTarget"+K,G[Te]),$&&D.getAttribute("morphNormal"+K)!==$[Te]&&D.setAttribute("morphNormal"+K,$[Te]),d[K]=ee,ne+=ee):(G&&D.hasAttribute("morphTarget"+K)===!0&&D.deleteAttribute("morphTarget"+K),$&&D.hasAttribute("morphNormal"+K)===!0&&D.deleteAttribute("morphNormal"+K),d[K]=0)}const me=D.morphTargetsRelative?1:1-ne;k.getUniforms().setValue(i,"morphTargetBaseInfluence",me),k.getUniforms().setValue(i,"morphTargetInfluences",d)}}return{update:T}}function VF(i,e,n,l){let d=new WeakMap;function _(T){const A=l.render.frame,D=T.geometry,P=e.get(T,D);return d.get(P)!==A&&(e.update(P),d.set(P,A)),T.isInstancedMesh&&(T.hasEventListener("dispose",a)===!1&&T.addEventListener("dispose",a),n.update(T.instanceMatrix,34962),T.instanceColor!==null&&n.update(T.instanceColor,34962)),P}function w(){d=new WeakMap}function a(T){const A=T.target;A.removeEventListener("dispose",a),n.remove(A.instanceMatrix),A.instanceColor!==null&&n.remove(A.instanceColor)}return{update:_,dispose:w}}const NC=new jo,UC=new DC,VC=new Iz,GC=new BC,I2=[],P2=[],L2=new Float32Array(16),D2=new Float32Array(9),z2=new Float32Array(4);function sd(i,e,n){const l=i[0];if(l<=0||l>0)return i;const d=e*n;let _=I2[d];if(_===void 0&&(_=new Float32Array(d),I2[d]=_),e!==0){l.toArray(_,0);for(let w=1,a=0;w!==e;++w)a+=n,i[w].toArray(_,a)}return _}function Gr(i,e){if(i.length!==e.length)return!1;for(let n=0,l=i.length;n<l;n++)if(i[n]!==e[n])return!1;return!0}function jr(i,e){for(let n=0,l=e.length;n<l;n++)i[n]=e[n]}function oy(i,e){let n=P2[e];n===void 0&&(n=new Int32Array(e),P2[e]=n);for(let l=0;l!==e;++l)n[l]=i.allocateTextureUnit();return n}function GF(i,e){const n=this.cache;n[0]!==e&&(i.uniform1f(this.addr,e),n[0]=e)}function jF(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Gr(n,e))return;i.uniform2fv(this.addr,e),jr(n,e)}}function WF(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Gr(n,e))return;i.uniform3fv(this.addr,e),jr(n,e)}}function HF(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Gr(n,e))return;i.uniform4fv(this.addr,e),jr(n,e)}}function $F(i,e){const n=this.cache,l=e.elements;if(l===void 0){if(Gr(n,e))return;i.uniformMatrix2fv(this.addr,!1,e),jr(n,e)}else{if(Gr(n,l))return;z2.set(l),i.uniformMatrix2fv(this.addr,!1,z2),jr(n,l)}}function qF(i,e){const n=this.cache,l=e.elements;if(l===void 0){if(Gr(n,e))return;i.uniformMatrix3fv(this.addr,!1,e),jr(n,e)}else{if(Gr(n,l))return;D2.set(l),i.uniformMatrix3fv(this.addr,!1,D2),jr(n,l)}}function ZF(i,e){const n=this.cache,l=e.elements;if(l===void 0){if(Gr(n,e))return;i.uniformMatrix4fv(this.addr,!1,e),jr(n,e)}else{if(Gr(n,l))return;L2.set(l),i.uniformMatrix4fv(this.addr,!1,L2),jr(n,l)}}function XF(i,e){const n=this.cache;n[0]!==e&&(i.uniform1i(this.addr,e),n[0]=e)}function YF(i,e){const n=this.cache;Gr(n,e)||(i.uniform2iv(this.addr,e),jr(n,e))}function KF(i,e){const n=this.cache;Gr(n,e)||(i.uniform3iv(this.addr,e),jr(n,e))}function JF(i,e){const n=this.cache;Gr(n,e)||(i.uniform4iv(this.addr,e),jr(n,e))}function QF(i,e){const n=this.cache;n[0]!==e&&(i.uniform1ui(this.addr,e),n[0]=e)}function eB(i,e){const n=this.cache;Gr(n,e)||(i.uniform2uiv(this.addr,e),jr(n,e))}function tB(i,e){const n=this.cache;Gr(n,e)||(i.uniform3uiv(this.addr,e),jr(n,e))}function nB(i,e){const n=this.cache;Gr(n,e)||(i.uniform4uiv(this.addr,e),jr(n,e))}function iB(i,e,n){const l=this.cache,d=n.allocateTextureUnit();l[0]!==d&&(i.uniform1i(this.addr,d),l[0]=d),n.setTexture2D(e||NC,d)}function rB(i,e,n){const l=this.cache,d=n.allocateTextureUnit();l[0]!==d&&(i.uniform1i(this.addr,d),l[0]=d),n.setTexture3D(e||VC,d)}function oB(i,e,n){const l=this.cache,d=n.allocateTextureUnit();l[0]!==d&&(i.uniform1i(this.addr,d),l[0]=d),n.setTextureCube(e||GC,d)}function sB(i,e,n){const l=this.cache,d=n.allocateTextureUnit();l[0]!==d&&(i.uniform1i(this.addr,d),l[0]=d),n.setTexture2DArray(e||UC,d)}function aB(i){switch(i){case 5126:return GF;case 35664:return jF;case 35665:return WF;case 35666:return HF;case 35674:return $F;case 35675:return qF;case 35676:return ZF;case 5124:case 35670:return XF;case 35667:case 35671:return YF;case 35668:case 35672:return KF;case 35669:case 35673:return JF;case 5125:return QF;case 36294:return eB;case 36295:return tB;case 36296:return nB;case 35678:case 36198:case 36298:case 36306:case 35682:return iB;case 35679:case 36299:case 36307:return rB;case 35680:case 36300:case 36308:case 36293:return oB;case 36289:case 36303:case 36311:case 36292:return sB}}function lB(i,e){i.uniform1fv(this.addr,e)}function cB(i,e){const n=sd(e,this.size,2);i.uniform2fv(this.addr,n)}function uB(i,e){const n=sd(e,this.size,3);i.uniform3fv(this.addr,n)}function hB(i,e){const n=sd(e,this.size,4);i.uniform4fv(this.addr,n)}function dB(i,e){const n=sd(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,n)}function fB(i,e){const n=sd(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,n)}function pB(i,e){const n=sd(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,n)}function mB(i,e){i.uniform1iv(this.addr,e)}function _B(i,e){i.uniform2iv(this.addr,e)}function gB(i,e){i.uniform3iv(this.addr,e)}function yB(i,e){i.uniform4iv(this.addr,e)}function xB(i,e){i.uniform1uiv(this.addr,e)}function vB(i,e){i.uniform2uiv(this.addr,e)}function wB(i,e){i.uniform3uiv(this.addr,e)}function bB(i,e){i.uniform4uiv(this.addr,e)}function SB(i,e,n){const l=e.length,d=oy(n,l);i.uniform1iv(this.addr,d);for(let _=0;_!==l;++_)n.setTexture2D(e[_]||NC,d[_])}function MB(i,e,n){const l=e.length,d=oy(n,l);i.uniform1iv(this.addr,d);for(let _=0;_!==l;++_)n.setTexture3D(e[_]||VC,d[_])}function TB(i,e,n){const l=e.length,d=oy(n,l);i.uniform1iv(this.addr,d);for(let _=0;_!==l;++_)n.setTextureCube(e[_]||GC,d[_])}function EB(i,e,n){const l=e.length,d=oy(n,l);i.uniform1iv(this.addr,d);for(let _=0;_!==l;++_)n.setTexture2DArray(e[_]||UC,d[_])}function CB(i){switch(i){case 5126:return lB;case 35664:return cB;case 35665:return uB;case 35666:return hB;case 35674:return dB;case 35675:return fB;case 35676:return pB;case 5124:case 35670:return mB;case 35667:case 35671:return _B;case 35668:case 35672:return gB;case 35669:case 35673:return yB;case 5125:return xB;case 36294:return vB;case 36295:return wB;case 36296:return bB;case 35678:case 36198:case 36298:case 36306:case 35682:return SB;case 35679:case 36299:case 36307:return MB;case 35680:case 36300:case 36308:case 36293:return TB;case 36289:case 36303:case 36311:case 36292:return EB}}class AB{constructor(e,n,l){this.id=e,this.addr=l,this.cache=[],this.setValue=aB(n.type)}}class IB{constructor(e,n,l){this.id=e,this.addr=l,this.cache=[],this.size=n.size,this.setValue=CB(n.type)}}class PB{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,l){const d=this.seq;for(let _=0,w=d.length;_!==w;++_){const a=d[_];a.setValue(e,n[a.id],l)}}}const Dx=/(\w+)(\])?(\[|\.)?/g;function k2(i,e){i.seq.push(e),i.map[e.id]=e}function LB(i,e,n){const l=i.name,d=l.length;for(Dx.lastIndex=0;;){const _=Dx.exec(l),w=Dx.lastIndex;let a=_[1];const T=_[2]==="]",A=_[3];if(T&&(a=a|0),A===void 0||A==="["&&w+2===d){k2(n,A===void 0?new AB(a,i,e):new IB(a,i,e));break}else{let P=n.map[a];P===void 0&&(P=new PB(a),k2(n,P)),n=P}}}class hg{constructor(e,n){this.seq=[],this.map={};const l=e.getProgramParameter(n,35718);for(let d=0;d<l;++d){const _=e.getActiveUniform(n,d),w=e.getUniformLocation(n,_.name);LB(_,w,this)}}setValue(e,n,l,d){const _=this.map[n];_!==void 0&&_.setValue(e,l,d)}setOptional(e,n,l){const d=n[l];d!==void 0&&this.setValue(e,l,d)}static upload(e,n,l,d){for(let _=0,w=n.length;_!==w;++_){const a=n[_],T=l[a.id];T.needsUpdate!==!1&&a.setValue(e,T.value,d)}}static seqWithValue(e,n){const l=[];for(let d=0,_=e.length;d!==_;++d){const w=e[d];w.id in n&&l.push(w)}return l}}function R2(i,e,n){const l=i.createShader(e);return i.shaderSource(l,n),i.compileShader(l),l}let DB=0;function zB(i,e){const n=i.split(`
`),l=[],d=Math.max(e-6,0),_=Math.min(e+6,n.length);for(let w=d;w<_;w++){const a=w+1;l.push(`${a===e?">":" "} ${a}: ${n[w]}`)}return l.join(`
`)}function kB(i){switch(i){case Hc:return["Linear","( value )"];case Bi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function F2(i,e,n){const l=i.getShaderParameter(e,35713),d=i.getShaderInfoLog(e).trim();if(l&&d==="")return"";const _=/ERROR: 0:(\d+)/.exec(d);if(_){const w=parseInt(_[1]);return n.toUpperCase()+`

`+d+`

`+zB(i.getShaderSource(e),w)}else return d}function RB(i,e){const n=kB(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function FB(i,e){let n;switch(e){case nz:n="Linear";break;case iz:n="Reinhard";break;case rz:n="OptimizedCineon";break;case oz:n="ACESFilmic";break;case sz:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+i+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function BB(i){return[i.extensionDerivatives||!!i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vf).join(`
`)}function OB(i){const e=[];for(const n in i){const l=i[n];l!==!1&&e.push("#define "+n+" "+l)}return e.join(`
`)}function NB(i,e){const n={},l=i.getProgramParameter(e,35721);for(let d=0;d<l;d++){const _=i.getActiveAttrib(e,d),w=_.name;let a=1;_.type===35674&&(a=2),_.type===35675&&(a=3),_.type===35676&&(a=4),n[w]={type:_.type,location:i.getAttribLocation(e,w),locationSize:a}}return n}function Vf(i){return i!==""}function B2(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function O2(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const UB=/^[ \t]*#include +<([\w\d./]+)>/gm;function Bv(i){return i.replace(UB,VB)}function VB(i,e){const n=jn[e];if(n===void 0)throw new Error("Can not resolve #include <"+e+">");return Bv(n)}const GB=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jB=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function N2(i){return i.replace(jB,jC).replace(GB,WB)}function WB(i,e,n,l){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),jC(i,e,n,l)}function jC(i,e,n,l){let d="";for(let _=parseInt(e);_<parseInt(n);_++)d+=l.replace(/\[\s*i\s*\]/g,"[ "+_+" ]").replace(/UNROLLED_LOOP_INDEX/g,_);return d}function U2(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function HB(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===SC?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===zD?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Uf&&(e="SHADOWMAP_TYPE_VSM"),e}function $B(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Jh:case Qh:e="ENVMAP_TYPE_CUBE";break;case ny:e="ENVMAP_TYPE_CUBE_UV";break}return e}function qB(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Qh:e="ENVMAP_MODE_REFRACTION";break}return e}function ZB(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case ty:e="ENVMAP_BLENDING_MULTIPLY";break;case ez:e="ENVMAP_BLENDING_MIX";break;case tz:e="ENVMAP_BLENDING_ADD";break}return e}function XB(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,l=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:l,maxMip:n}}function YB(i,e,n,l){const d=i.getContext(),_=n.defines;let w=n.vertexShader,a=n.fragmentShader;const T=HB(n),A=$B(n),D=qB(n),P=ZB(n),k=XB(n),W=n.isWebGL2?"":BB(n),Z=OB(_),F=d.createProgram();let B,G,$=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(B=[Z].filter(Vf).join(`
`),B.length>0&&(B+=`
`),G=[W,Z].filter(Vf).join(`
`),G.length>0&&(G+=`
`)):(B=[U2(n),"#define SHADER_NAME "+n.shaderName,Z,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+D:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+T:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Vf).join(`
`),G=[W,U2(n),"#define SHADER_NAME "+n.shaderName,Z,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+A:"",n.envMap?"#define "+D:"",n.envMap?"#define "+P:"",k?"#define CUBEUV_TEXEL_WIDTH "+k.texelWidth:"",k?"#define CUBEUV_TEXEL_HEIGHT "+k.texelHeight:"",k?"#define CUBEUV_MAX_MIP "+k.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+T:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ya?"#define TONE_MAPPING":"",n.toneMapping!==ya?jn.tonemapping_pars_fragment:"",n.toneMapping!==ya?FB("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",jn.encodings_pars_fragment,RB("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Vf).join(`
`)),w=Bv(w),w=B2(w,n),w=O2(w,n),a=Bv(a),a=B2(a,n),a=O2(a,n),w=N2(w),a=N2(a),n.isWebGL2&&n.isRawShaderMaterial!==!0&&($=`#version 300 es
`,B=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+B,G=["#define varying in",n.glslVersion===c2?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===c2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+G);const ne=$+B+w,me=$+G+a,K=R2(d,35633,ne),Ee=R2(d,35632,me);if(d.attachShader(F,K),d.attachShader(F,Ee),n.index0AttributeName!==void 0?d.bindAttribLocation(F,0,n.index0AttributeName):n.morphTargets===!0&&d.bindAttribLocation(F,0,"position"),d.linkProgram(F),i.debug.checkShaderErrors){const Ae=d.getProgramInfoLog(F).trim(),Fe=d.getShaderInfoLog(K).trim(),qe=d.getShaderInfoLog(Ee).trim();let Pt=!0,xt=!0;if(d.getProgramParameter(F,35714)===!1){Pt=!1;const je=F2(d,K,"vertex"),ut=F2(d,Ee,"fragment");console.error("THREE.WebGLProgram: Shader Error "+d.getError()+" - VALIDATE_STATUS "+d.getProgramParameter(F,35715)+`

Program Info Log: `+Ae+`
`+je+`
`+ut)}else Ae!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ae):(Fe===""||qe==="")&&(xt=!1);xt&&(this.diagnostics={runnable:Pt,programLog:Ae,vertexShader:{log:Fe,prefix:B},fragmentShader:{log:qe,prefix:G}})}d.deleteShader(K),d.deleteShader(Ee);let Te;this.getUniforms=function(){return Te===void 0&&(Te=new hg(d,F)),Te};let ee;return this.getAttributes=function(){return ee===void 0&&(ee=NB(d,F)),ee},this.destroy=function(){l.releaseStatesOfProgram(this),d.deleteProgram(F),this.program=void 0},this.name=n.shaderName,this.id=DB++,this.cacheKey=e,this.usedTimes=1,this.program=F,this.vertexShader=K,this.fragmentShader=Ee,this}let KB=0;class JB{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,l=e.fragmentShader,d=this._getShaderStage(n),_=this._getShaderStage(l),w=this._getShaderCacheForMaterial(e);return w.has(d)===!1&&(w.add(d),d.usedTimes++),w.has(_)===!1&&(w.add(_),_.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const l of n)l.usedTimes--,l.usedTimes===0&&this.shaderCache.delete(l.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;return n.has(e)===!1&&n.set(e,new Set),n.get(e)}_getShaderStage(e){const n=this.shaderCache;if(n.has(e)===!1){const l=new QB(e);n.set(e,l)}return n.get(e)}}class QB{constructor(e){this.id=KB++,this.code=e,this.usedTimes=0}}function eO(i,e,n,l,d,_,w){const a=new zC,T=new JB,A=[],D=d.isWebGL2,P=d.logarithmicDepthBuffer,k=d.vertexTextures;let W=d.precision;const Z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function F(ee,Ae,Fe,qe,Pt){const xt=qe.fog,je=Pt.geometry,ut=ee.isMeshStandardMaterial?qe.environment:null,tt=(ee.isMeshStandardMaterial?n:e).get(ee.envMap||ut),ct=!!tt&&tt.mapping===ny?tt.image.height:null,Be=Z[ee.type];ee.precision!==null&&(W=d.getMaxPrecision(ee.precision),W!==ee.precision&&console.warn("THREE.WebGLProgram.getParameters:",ee.precision,"not supported, using",W,"instead."));const Ne=je.morphAttributes.position||je.morphAttributes.normal||je.morphAttributes.color,Ze=Ne!==void 0?Ne.length:0;let pt=0;je.morphAttributes.position!==void 0&&(pt=1),je.morphAttributes.normal!==void 0&&(pt=2),je.morphAttributes.color!==void 0&&(pt=3);let et,gt,jt,Xt;if(Be){const On=ks[Be];et=On.vertexShader,gt=On.fragmentShader}else et=ee.vertexShader,gt=ee.fragmentShader,T.update(ee),jt=T.getVertexShaderID(ee),Xt=T.getFragmentShaderID(ee);const ot=i.getRenderTarget(),Tn=ee.alphaTest>0,fn=ee.clearcoat>0,pn=ee.iridescence>0;return{isWebGL2:D,shaderID:Be,shaderName:ee.type,vertexShader:et,fragmentShader:gt,defines:ee.defines,customVertexShaderID:jt,customFragmentShaderID:Xt,isRawShaderMaterial:ee.isRawShaderMaterial===!0,glslVersion:ee.glslVersion,precision:W,instancing:Pt.isInstancedMesh===!0,instancingColor:Pt.isInstancedMesh===!0&&Pt.instanceColor!==null,supportsVertexTextures:k,outputEncoding:ot===null?i.outputEncoding:ot.isXRRenderTarget===!0?ot.texture.encoding:Hc,map:!!ee.map,matcap:!!ee.matcap,envMap:!!tt,envMapMode:tt&&tt.mapping,envMapCubeUVHeight:ct,lightMap:!!ee.lightMap,aoMap:!!ee.aoMap,emissiveMap:!!ee.emissiveMap,bumpMap:!!ee.bumpMap,normalMap:!!ee.normalMap,objectSpaceNormalMap:ee.normalMapType===Tz,tangentSpaceNormalMap:ee.normalMapType===od,decodeVideoTexture:!!ee.map&&ee.map.isVideoTexture===!0&&ee.map.encoding===Bi,clearcoat:fn,clearcoatMap:fn&&!!ee.clearcoatMap,clearcoatRoughnessMap:fn&&!!ee.clearcoatRoughnessMap,clearcoatNormalMap:fn&&!!ee.clearcoatNormalMap,iridescence:pn,iridescenceMap:pn&&!!ee.iridescenceMap,iridescenceThicknessMap:pn&&!!ee.iridescenceThicknessMap,displacementMap:!!ee.displacementMap,roughnessMap:!!ee.roughnessMap,metalnessMap:!!ee.metalnessMap,specularMap:!!ee.specularMap,specularIntensityMap:!!ee.specularIntensityMap,specularColorMap:!!ee.specularColorMap,opaque:ee.transparent===!1&&ee.blending===Gh,alphaMap:!!ee.alphaMap,alphaTest:Tn,gradientMap:!!ee.gradientMap,sheen:ee.sheen>0,sheenColorMap:!!ee.sheenColorMap,sheenRoughnessMap:!!ee.sheenRoughnessMap,transmission:ee.transmission>0,transmissionMap:!!ee.transmissionMap,thicknessMap:!!ee.thicknessMap,combine:ee.combine,vertexTangents:!!ee.normalMap&&!!je.attributes.tangent,vertexColors:ee.vertexColors,vertexAlphas:ee.vertexColors===!0&&!!je.attributes.color&&je.attributes.color.itemSize===4,vertexUvs:!!ee.map||!!ee.bumpMap||!!ee.normalMap||!!ee.specularMap||!!ee.alphaMap||!!ee.emissiveMap||!!ee.roughnessMap||!!ee.metalnessMap||!!ee.clearcoatMap||!!ee.clearcoatRoughnessMap||!!ee.clearcoatNormalMap||!!ee.iridescenceMap||!!ee.iridescenceThicknessMap||!!ee.displacementMap||!!ee.transmissionMap||!!ee.thicknessMap||!!ee.specularIntensityMap||!!ee.specularColorMap||!!ee.sheenColorMap||!!ee.sheenRoughnessMap,uvsVertexOnly:!(!!ee.map||!!ee.bumpMap||!!ee.normalMap||!!ee.specularMap||!!ee.alphaMap||!!ee.emissiveMap||!!ee.roughnessMap||!!ee.metalnessMap||!!ee.clearcoatNormalMap||!!ee.iridescenceMap||!!ee.iridescenceThicknessMap||ee.transmission>0||!!ee.transmissionMap||!!ee.thicknessMap||!!ee.specularIntensityMap||!!ee.specularColorMap||ee.sheen>0||!!ee.sheenColorMap||!!ee.sheenRoughnessMap)&&!!ee.displacementMap,fog:!!xt,useFog:ee.fog===!0,fogExp2:xt&&xt.isFogExp2,flatShading:!!ee.flatShading,sizeAttenuation:ee.sizeAttenuation,logarithmicDepthBuffer:P,skinning:Pt.isSkinnedMesh===!0,morphTargets:je.morphAttributes.position!==void 0,morphNormals:je.morphAttributes.normal!==void 0,morphColors:je.morphAttributes.color!==void 0,morphTargetsCount:Ze,morphTextureStride:pt,numDirLights:Ae.directional.length,numPointLights:Ae.point.length,numSpotLights:Ae.spot.length,numRectAreaLights:Ae.rectArea.length,numHemiLights:Ae.hemi.length,numDirLightShadows:Ae.directionalShadowMap.length,numPointLightShadows:Ae.pointShadowMap.length,numSpotLightShadows:Ae.spotShadowMap.length,numClippingPlanes:w.numPlanes,numClipIntersection:w.numIntersection,dithering:ee.dithering,shadowMapEnabled:i.shadowMap.enabled&&Fe.length>0,shadowMapType:i.shadowMap.type,toneMapping:ee.toneMapped?i.toneMapping:ya,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:ee.premultipliedAlpha,doubleSided:ee.side===Kh,flipSided:ee.side===ds,useDepthPacking:!!ee.depthPacking,depthPacking:ee.depthPacking||0,index0AttributeName:ee.index0AttributeName,extensionDerivatives:ee.extensions&&ee.extensions.derivatives,extensionFragDepth:ee.extensions&&ee.extensions.fragDepth,extensionDrawBuffers:ee.extensions&&ee.extensions.drawBuffers,extensionShaderTextureLOD:ee.extensions&&ee.extensions.shaderTextureLOD,rendererExtensionFragDepth:D||l.has("EXT_frag_depth"),rendererExtensionDrawBuffers:D||l.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:D||l.has("EXT_shader_texture_lod"),customProgramCacheKey:ee.customProgramCacheKey()}}function B(ee){const Ae=[];if(ee.shaderID?Ae.push(ee.shaderID):(Ae.push(ee.customVertexShaderID),Ae.push(ee.customFragmentShaderID)),ee.defines!==void 0)for(const Fe in ee.defines)Ae.push(Fe),Ae.push(ee.defines[Fe]);return ee.isRawShaderMaterial===!1&&(G(Ae,ee),$(Ae,ee),Ae.push(i.outputEncoding)),Ae.push(ee.customProgramCacheKey),Ae.join()}function G(ee,Ae){ee.push(Ae.precision),ee.push(Ae.outputEncoding),ee.push(Ae.envMapMode),ee.push(Ae.envMapCubeUVHeight),ee.push(Ae.combine),ee.push(Ae.vertexUvs),ee.push(Ae.fogExp2),ee.push(Ae.sizeAttenuation),ee.push(Ae.morphTargetsCount),ee.push(Ae.morphAttributeCount),ee.push(Ae.numDirLights),ee.push(Ae.numPointLights),ee.push(Ae.numSpotLights),ee.push(Ae.numHemiLights),ee.push(Ae.numRectAreaLights),ee.push(Ae.numDirLightShadows),ee.push(Ae.numPointLightShadows),ee.push(Ae.numSpotLightShadows),ee.push(Ae.shadowMapType),ee.push(Ae.toneMapping),ee.push(Ae.numClippingPlanes),ee.push(Ae.numClipIntersection),ee.push(Ae.depthPacking)}function $(ee,Ae){a.disableAll(),Ae.isWebGL2&&a.enable(0),Ae.supportsVertexTextures&&a.enable(1),Ae.instancing&&a.enable(2),Ae.instancingColor&&a.enable(3),Ae.map&&a.enable(4),Ae.matcap&&a.enable(5),Ae.envMap&&a.enable(6),Ae.lightMap&&a.enable(7),Ae.aoMap&&a.enable(8),Ae.emissiveMap&&a.enable(9),Ae.bumpMap&&a.enable(10),Ae.normalMap&&a.enable(11),Ae.objectSpaceNormalMap&&a.enable(12),Ae.tangentSpaceNormalMap&&a.enable(13),Ae.clearcoat&&a.enable(14),Ae.clearcoatMap&&a.enable(15),Ae.clearcoatRoughnessMap&&a.enable(16),Ae.clearcoatNormalMap&&a.enable(17),Ae.iridescence&&a.enable(18),Ae.iridescenceMap&&a.enable(19),Ae.iridescenceThicknessMap&&a.enable(20),Ae.displacementMap&&a.enable(21),Ae.specularMap&&a.enable(22),Ae.roughnessMap&&a.enable(23),Ae.metalnessMap&&a.enable(24),Ae.gradientMap&&a.enable(25),Ae.alphaMap&&a.enable(26),Ae.alphaTest&&a.enable(27),Ae.vertexColors&&a.enable(28),Ae.vertexAlphas&&a.enable(29),Ae.vertexUvs&&a.enable(30),Ae.vertexTangents&&a.enable(31),Ae.uvsVertexOnly&&a.enable(32),Ae.fog&&a.enable(33),ee.push(a.mask),a.disableAll(),Ae.useFog&&a.enable(0),Ae.flatShading&&a.enable(1),Ae.logarithmicDepthBuffer&&a.enable(2),Ae.skinning&&a.enable(3),Ae.morphTargets&&a.enable(4),Ae.morphNormals&&a.enable(5),Ae.morphColors&&a.enable(6),Ae.premultipliedAlpha&&a.enable(7),Ae.shadowMapEnabled&&a.enable(8),Ae.physicallyCorrectLights&&a.enable(9),Ae.doubleSided&&a.enable(10),Ae.flipSided&&a.enable(11),Ae.useDepthPacking&&a.enable(12),Ae.dithering&&a.enable(13),Ae.specularIntensityMap&&a.enable(14),Ae.specularColorMap&&a.enable(15),Ae.transmission&&a.enable(16),Ae.transmissionMap&&a.enable(17),Ae.thicknessMap&&a.enable(18),Ae.sheen&&a.enable(19),Ae.sheenColorMap&&a.enable(20),Ae.sheenRoughnessMap&&a.enable(21),Ae.decodeVideoTexture&&a.enable(22),Ae.opaque&&a.enable(23),ee.push(a.mask)}function ne(ee){const Ae=Z[ee.type];let Fe;if(Ae){const qe=ks[Ae];Fe=Vz.clone(qe.uniforms)}else Fe=ee.uniforms;return Fe}function me(ee,Ae){let Fe;for(let qe=0,Pt=A.length;qe<Pt;qe++){const xt=A[qe];if(xt.cacheKey===Ae){Fe=xt,++Fe.usedTimes;break}}return Fe===void 0&&(Fe=new YB(i,Ae,ee,_),A.push(Fe)),Fe}function K(ee){if(--ee.usedTimes===0){const Ae=A.indexOf(ee);A[Ae]=A[A.length-1],A.pop(),ee.destroy()}}function Ee(ee){T.remove(ee)}function Te(){T.dispose()}return{getParameters:F,getProgramCacheKey:B,getUniforms:ne,acquireProgram:me,releaseProgram:K,releaseShaderCache:Ee,programs:A,dispose:Te}}function tO(){let i=new WeakMap;function e(_){let w=i.get(_);return w===void 0&&(w={},i.set(_,w)),w}function n(_){i.delete(_)}function l(_,w,a){i.get(_)[w]=a}function d(){i=new WeakMap}return{get:e,remove:n,update:l,dispose:d}}function nO(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function V2(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function G2(){const i=[];let e=0;const n=[],l=[],d=[];function _(){e=0,n.length=0,l.length=0,d.length=0}function w(P,k,W,Z,F,B){let G=i[e];return G===void 0?(G={id:P.id,object:P,geometry:k,material:W,groupOrder:Z,renderOrder:P.renderOrder,z:F,group:B},i[e]=G):(G.id=P.id,G.object=P,G.geometry=k,G.material=W,G.groupOrder=Z,G.renderOrder=P.renderOrder,G.z=F,G.group=B),e++,G}function a(P,k,W,Z,F,B){const G=w(P,k,W,Z,F,B);W.transmission>0?l.push(G):W.transparent===!0?d.push(G):n.push(G)}function T(P,k,W,Z,F,B){const G=w(P,k,W,Z,F,B);W.transmission>0?l.unshift(G):W.transparent===!0?d.unshift(G):n.unshift(G)}function A(P,k){n.length>1&&n.sort(P||nO),l.length>1&&l.sort(k||V2),d.length>1&&d.sort(k||V2)}function D(){for(let P=e,k=i.length;P<k;P++){const W=i[P];if(W.id===null)break;W.id=null,W.object=null,W.geometry=null,W.material=null,W.group=null}}return{opaque:n,transmissive:l,transparent:d,init:_,push:a,unshift:T,finish:D,sort:A}}function iO(){let i=new WeakMap;function e(l,d){let _;return i.has(l)===!1?(_=new G2,i.set(l,[_])):d>=i.get(l).length?(_=new G2,i.get(l).push(_)):_=i.get(l)[d],_}function n(){i=new WeakMap}return{get:e,dispose:n}}function rO(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Ye,color:new Ln};break;case"SpotLight":n={position:new Ye,direction:new Ye,color:new Ln,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ye,color:new Ln,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ye,skyColor:new Ln,groundColor:new Ln};break;case"RectAreaLight":n={color:new Ln,position:new Ye,halfWidth:new Ye,halfHeight:new Ye};break}return i[e.id]=n,n}}}function oO(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new In};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new In};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new In,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=n,n}}}let sO=0;function aO(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function lO(i,e){const n=new rO,l=oO(),d={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let D=0;D<9;D++)d.probe.push(new Ye);const _=new Ye,w=new pr,a=new pr;function T(D,P){let k=0,W=0,Z=0;for(let Ae=0;Ae<9;Ae++)d.probe[Ae].set(0,0,0);let F=0,B=0,G=0,$=0,ne=0,me=0,K=0,Ee=0;D.sort(aO);const Te=P!==!0?Math.PI:1;for(let Ae=0,Fe=D.length;Ae<Fe;Ae++){const qe=D[Ae],Pt=qe.color,xt=qe.intensity,je=qe.distance,ut=qe.shadow&&qe.shadow.map?qe.shadow.map.texture:null;if(qe.isAmbientLight)k+=Pt.r*xt*Te,W+=Pt.g*xt*Te,Z+=Pt.b*xt*Te;else if(qe.isLightProbe)for(let tt=0;tt<9;tt++)d.probe[tt].addScaledVector(qe.sh.coefficients[tt],xt);else if(qe.isDirectionalLight){const tt=n.get(qe);if(tt.color.copy(qe.color).multiplyScalar(qe.intensity*Te),qe.castShadow){const ct=qe.shadow,Be=l.get(qe);Be.shadowBias=ct.bias,Be.shadowNormalBias=ct.normalBias,Be.shadowRadius=ct.radius,Be.shadowMapSize=ct.mapSize,d.directionalShadow[F]=Be,d.directionalShadowMap[F]=ut,d.directionalShadowMatrix[F]=qe.shadow.matrix,me++}d.directional[F]=tt,F++}else if(qe.isSpotLight){const tt=n.get(qe);if(tt.position.setFromMatrixPosition(qe.matrixWorld),tt.color.copy(Pt).multiplyScalar(xt*Te),tt.distance=je,tt.coneCos=Math.cos(qe.angle),tt.penumbraCos=Math.cos(qe.angle*(1-qe.penumbra)),tt.decay=qe.decay,qe.castShadow){const ct=qe.shadow,Be=l.get(qe);Be.shadowBias=ct.bias,Be.shadowNormalBias=ct.normalBias,Be.shadowRadius=ct.radius,Be.shadowMapSize=ct.mapSize,d.spotShadow[G]=Be,d.spotShadowMap[G]=ut,d.spotShadowMatrix[G]=qe.shadow.matrix,Ee++}d.spot[G]=tt,G++}else if(qe.isRectAreaLight){const tt=n.get(qe);tt.color.copy(Pt).multiplyScalar(xt),tt.halfWidth.set(qe.width*.5,0,0),tt.halfHeight.set(0,qe.height*.5,0),d.rectArea[$]=tt,$++}else if(qe.isPointLight){const tt=n.get(qe);if(tt.color.copy(qe.color).multiplyScalar(qe.intensity*Te),tt.distance=qe.distance,tt.decay=qe.decay,qe.castShadow){const ct=qe.shadow,Be=l.get(qe);Be.shadowBias=ct.bias,Be.shadowNormalBias=ct.normalBias,Be.shadowRadius=ct.radius,Be.shadowMapSize=ct.mapSize,Be.shadowCameraNear=ct.camera.near,Be.shadowCameraFar=ct.camera.far,d.pointShadow[B]=Be,d.pointShadowMap[B]=ut,d.pointShadowMatrix[B]=qe.shadow.matrix,K++}d.point[B]=tt,B++}else if(qe.isHemisphereLight){const tt=n.get(qe);tt.skyColor.copy(qe.color).multiplyScalar(xt*Te),tt.groundColor.copy(qe.groundColor).multiplyScalar(xt*Te),d.hemi[ne]=tt,ne++}}$>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(d.rectAreaLTC1=Zt.LTC_FLOAT_1,d.rectAreaLTC2=Zt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(d.rectAreaLTC1=Zt.LTC_HALF_1,d.rectAreaLTC2=Zt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),d.ambient[0]=k,d.ambient[1]=W,d.ambient[2]=Z;const ee=d.hash;(ee.directionalLength!==F||ee.pointLength!==B||ee.spotLength!==G||ee.rectAreaLength!==$||ee.hemiLength!==ne||ee.numDirectionalShadows!==me||ee.numPointShadows!==K||ee.numSpotShadows!==Ee)&&(d.directional.length=F,d.spot.length=G,d.rectArea.length=$,d.point.length=B,d.hemi.length=ne,d.directionalShadow.length=me,d.directionalShadowMap.length=me,d.pointShadow.length=K,d.pointShadowMap.length=K,d.spotShadow.length=Ee,d.spotShadowMap.length=Ee,d.directionalShadowMatrix.length=me,d.pointShadowMatrix.length=K,d.spotShadowMatrix.length=Ee,ee.directionalLength=F,ee.pointLength=B,ee.spotLength=G,ee.rectAreaLength=$,ee.hemiLength=ne,ee.numDirectionalShadows=me,ee.numPointShadows=K,ee.numSpotShadows=Ee,d.version=sO++)}function A(D,P){let k=0,W=0,Z=0,F=0,B=0;const G=P.matrixWorldInverse;for(let $=0,ne=D.length;$<ne;$++){const me=D[$];if(me.isDirectionalLight){const K=d.directional[k];K.direction.setFromMatrixPosition(me.matrixWorld),_.setFromMatrixPosition(me.target.matrixWorld),K.direction.sub(_),K.direction.transformDirection(G),k++}else if(me.isSpotLight){const K=d.spot[Z];K.position.setFromMatrixPosition(me.matrixWorld),K.position.applyMatrix4(G),K.direction.setFromMatrixPosition(me.matrixWorld),_.setFromMatrixPosition(me.target.matrixWorld),K.direction.sub(_),K.direction.transformDirection(G),Z++}else if(me.isRectAreaLight){const K=d.rectArea[F];K.position.setFromMatrixPosition(me.matrixWorld),K.position.applyMatrix4(G),a.identity(),w.copy(me.matrixWorld),w.premultiply(G),a.extractRotation(w),K.halfWidth.set(me.width*.5,0,0),K.halfHeight.set(0,me.height*.5,0),K.halfWidth.applyMatrix4(a),K.halfHeight.applyMatrix4(a),F++}else if(me.isPointLight){const K=d.point[W];K.position.setFromMatrixPosition(me.matrixWorld),K.position.applyMatrix4(G),W++}else if(me.isHemisphereLight){const K=d.hemi[B];K.direction.setFromMatrixPosition(me.matrixWorld),K.direction.transformDirection(G),B++}}}return{setup:T,setupView:A,state:d}}function j2(i,e){const n=new lO(i,e),l=[],d=[];function _(){l.length=0,d.length=0}function w(P){l.push(P)}function a(P){d.push(P)}function T(P){n.setup(l,P)}function A(P){n.setupView(l,P)}return{init:_,state:{lightsArray:l,shadowsArray:d,lights:n},setupLights:T,setupLightsView:A,pushLight:w,pushShadow:a}}function cO(i,e){let n=new WeakMap;function l(_,w=0){let a;return n.has(_)===!1?(a=new j2(i,e),n.set(_,[a])):w>=n.get(_).length?(a=new j2(i,e),n.get(_).push(a)):a=n.get(_)[w],a}function d(){n=new WeakMap}return{get:l,dispose:d}}class WC extends Sr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Sz,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class HC extends Sr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Ye,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const uO=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,hO=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function dO(i,e,n){let l=new j1;const d=new In,_=new In,w=new vr,a=new WC({depthPacking:Mz}),T=new HC,A={},D=n.maxTextureSize,P={0:ds,1:yp,2:Kh},k=new Sa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new In},radius:{value:4}},vertexShader:uO,fragmentShader:hO}),W=k.clone();W.defines.HORIZONTAL_PASS=1;const Z=new Yc;Z.setAttribute("position",new Us(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const F=new _a(Z,k),B=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=SC,this.render=function(me,K,Ee){if(B.enabled===!1||B.autoUpdate===!1&&B.needsUpdate===!1||me.length===0)return;const Te=i.getRenderTarget(),ee=i.getActiveCubeFace(),Ae=i.getActiveMipmapLevel(),Fe=i.state;Fe.setBlending(Tl),Fe.buffers.color.setClear(1,1,1,1),Fe.buffers.depth.setTest(!0),Fe.setScissorTest(!1);for(let qe=0,Pt=me.length;qe<Pt;qe++){const xt=me[qe],je=xt.shadow;if(je===void 0){console.warn("THREE.WebGLShadowMap:",xt,"has no shadow.");continue}if(je.autoUpdate===!1&&je.needsUpdate===!1)continue;d.copy(je.mapSize);const ut=je.getFrameExtents();if(d.multiply(ut),_.copy(je.mapSize),(d.x>D||d.y>D)&&(d.x>D&&(_.x=Math.floor(D/ut.x),d.x=_.x*ut.x,je.mapSize.x=_.x),d.y>D&&(_.y=Math.floor(D/ut.y),d.y=_.y*ut.y,je.mapSize.y=_.y)),je.map===null&&!je.isPointLightShadow&&this.type===Uf&&(je.map=new El(d.x,d.y),je.map.texture.name=xt.name+".shadowMap",je.mapPass=new El(d.x,d.y),je.camera.updateProjectionMatrix()),je.map===null){const ct={minFilter:oo,magFilter:oo,format:cs};je.map=new El(d.x,d.y,ct),je.map.texture.name=xt.name+".shadowMap",je.camera.updateProjectionMatrix()}i.setRenderTarget(je.map),i.clear();const tt=je.getViewportCount();for(let ct=0;ct<tt;ct++){const Be=je.getViewport(ct);w.set(_.x*Be.x,_.y*Be.y,_.x*Be.z,_.y*Be.w),Fe.viewport(w),je.updateMatrices(xt,ct),l=je.getFrustum(),ne(K,Ee,je.camera,xt,this.type)}!je.isPointLightShadow&&this.type===Uf&&G(je,Ee),je.needsUpdate=!1}B.needsUpdate=!1,i.setRenderTarget(Te,ee,Ae)};function G(me,K){const Ee=e.update(F);k.defines.VSM_SAMPLES!==me.blurSamples&&(k.defines.VSM_SAMPLES=me.blurSamples,W.defines.VSM_SAMPLES=me.blurSamples,k.needsUpdate=!0,W.needsUpdate=!0),k.uniforms.shadow_pass.value=me.map.texture,k.uniforms.resolution.value=me.mapSize,k.uniforms.radius.value=me.radius,i.setRenderTarget(me.mapPass),i.clear(),i.renderBufferDirect(K,null,Ee,k,F,null),W.uniforms.shadow_pass.value=me.mapPass.texture,W.uniforms.resolution.value=me.mapSize,W.uniforms.radius.value=me.radius,i.setRenderTarget(me.map),i.clear(),i.renderBufferDirect(K,null,Ee,W,F,null)}function $(me,K,Ee,Te,ee,Ae){let Fe=null;const qe=Ee.isPointLight===!0?me.customDistanceMaterial:me.customDepthMaterial;if(qe!==void 0?Fe=qe:Fe=Ee.isPointLight===!0?T:a,i.localClippingEnabled&&K.clipShadows===!0&&K.clippingPlanes.length!==0||K.displacementMap&&K.displacementScale!==0||K.alphaMap&&K.alphaTest>0){const Pt=Fe.uuid,xt=K.uuid;let je=A[Pt];je===void 0&&(je={},A[Pt]=je);let ut=je[xt];ut===void 0&&(ut=Fe.clone(),je[xt]=ut),Fe=ut}return Fe.visible=K.visible,Fe.wireframe=K.wireframe,Ae===Uf?Fe.side=K.shadowSide!==null?K.shadowSide:K.side:Fe.side=K.shadowSide!==null?K.shadowSide:P[K.side],Fe.alphaMap=K.alphaMap,Fe.alphaTest=K.alphaTest,Fe.clipShadows=K.clipShadows,Fe.clippingPlanes=K.clippingPlanes,Fe.clipIntersection=K.clipIntersection,Fe.displacementMap=K.displacementMap,Fe.displacementScale=K.displacementScale,Fe.displacementBias=K.displacementBias,Fe.wireframeLinewidth=K.wireframeLinewidth,Fe.linewidth=K.linewidth,Ee.isPointLight===!0&&Fe.isMeshDistanceMaterial===!0&&(Fe.referencePosition.setFromMatrixPosition(Ee.matrixWorld),Fe.nearDistance=Te,Fe.farDistance=ee),Fe}function ne(me,K,Ee,Te,ee){if(me.visible===!1)return;if(me.layers.test(K.layers)&&(me.isMesh||me.isLine||me.isPoints)&&(me.castShadow||me.receiveShadow&&ee===Uf)&&(!me.frustumCulled||l.intersectsObject(me))){me.modelViewMatrix.multiplyMatrices(Ee.matrixWorldInverse,me.matrixWorld);const qe=e.update(me),Pt=me.material;if(Array.isArray(Pt)){const xt=qe.groups;for(let je=0,ut=xt.length;je<ut;je++){const tt=xt[je],ct=Pt[tt.materialIndex];if(ct&&ct.visible){const Be=$(me,ct,Te,Ee.near,Ee.far,ee);i.renderBufferDirect(Ee,null,qe,Be,me,tt)}}}else if(Pt.visible){const xt=$(me,Pt,Te,Ee.near,Ee.far,ee);i.renderBufferDirect(Ee,null,qe,xt,me,null)}}const Fe=me.children;for(let qe=0,Pt=Fe.length;qe<Pt;qe++)ne(Fe[qe],K,Ee,Te,ee)}}function fO(i,e,n){const l=n.isWebGL2;function d(){let ze=!1;const Ft=new vr;let kt=null;const un=new vr(0,0,0,0);return{setMask:function(Ht){kt!==Ht&&!ze&&(i.colorMask(Ht,Ht,Ht,Ht),kt=Ht)},setLocked:function(Ht){ze=Ht},setClear:function(Ht,rn,Bt,mn,qn){qn===!0&&(Ht*=mn,rn*=mn,Bt*=mn),Ft.set(Ht,rn,Bt,mn),un.equals(Ft)===!1&&(i.clearColor(Ht,rn,Bt,mn),un.copy(Ft))},reset:function(){ze=!1,kt=null,un.set(-1,0,0,0)}}}function _(){let ze=!1,Ft=null,kt=null,un=null;return{setTest:function(Ht){Ht?Xt(2929):ot(2929)},setMask:function(Ht){Ft!==Ht&&!ze&&(i.depthMask(Ht),Ft=Ht)},setFunc:function(Ht){if(kt!==Ht){if(Ht)switch(Ht){case qD:i.depthFunc(512);break;case ZD:i.depthFunc(519);break;case XD:i.depthFunc(513);break;case Pv:i.depthFunc(515);break;case YD:i.depthFunc(514);break;case KD:i.depthFunc(518);break;case JD:i.depthFunc(516);break;case QD:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);kt=Ht}},setLocked:function(Ht){ze=Ht},setClear:function(Ht){un!==Ht&&(i.clearDepth(Ht),un=Ht)},reset:function(){ze=!1,Ft=null,kt=null,un=null}}}function w(){let ze=!1,Ft=null,kt=null,un=null,Ht=null,rn=null,Bt=null,mn=null,qn=null;return{setTest:function(zn){ze||(zn?Xt(2960):ot(2960))},setMask:function(zn){Ft!==zn&&!ze&&(i.stencilMask(zn),Ft=zn)},setFunc:function(zn,hi,Ki){(kt!==zn||un!==hi||Ht!==Ki)&&(i.stencilFunc(zn,hi,Ki),kt=zn,un=hi,Ht=Ki)},setOp:function(zn,hi,Ki){(rn!==zn||Bt!==hi||mn!==Ki)&&(i.stencilOp(zn,hi,Ki),rn=zn,Bt=hi,mn=Ki)},setLocked:function(zn){ze=zn},setClear:function(zn){qn!==zn&&(i.clearStencil(zn),qn=zn)},reset:function(){ze=!1,Ft=null,kt=null,un=null,Ht=null,rn=null,Bt=null,mn=null,qn=null}}}const a=new d,T=new _,A=new w;let D={},P={},k=new WeakMap,W=[],Z=null,F=!1,B=null,G=null,$=null,ne=null,me=null,K=null,Ee=null,Te=!1,ee=null,Ae=null,Fe=null,qe=null,Pt=null;const xt=i.getParameter(35661);let je=!1,ut=0;const tt=i.getParameter(7938);tt.indexOf("WebGL")!==-1?(ut=parseFloat(/^WebGL (\d)/.exec(tt)[1]),je=ut>=1):tt.indexOf("OpenGL ES")!==-1&&(ut=parseFloat(/^OpenGL ES (\d)/.exec(tt)[1]),je=ut>=2);let ct=null,Be={};const Ne=i.getParameter(3088),Ze=i.getParameter(2978),pt=new vr().fromArray(Ne),et=new vr().fromArray(Ze);function gt(ze,Ft,kt){const un=new Uint8Array(4),Ht=i.createTexture();i.bindTexture(ze,Ht),i.texParameteri(ze,10241,9728),i.texParameteri(ze,10240,9728);for(let rn=0;rn<kt;rn++)i.texImage2D(Ft+rn,0,6408,1,1,0,6408,5121,un);return Ht}const jt={};jt[3553]=gt(3553,3553,1),jt[34067]=gt(34067,34069,6),a.setClear(0,0,0,1),T.setClear(1),A.setClear(0),Xt(2929),T.setFunc(Pv),an(!1),ii(zM),Xt(2884),bn(Tl);function Xt(ze){D[ze]!==!0&&(i.enable(ze),D[ze]=!0)}function ot(ze){D[ze]!==!1&&(i.disable(ze),D[ze]=!1)}function Tn(ze,Ft){return P[ze]!==Ft?(i.bindFramebuffer(ze,Ft),P[ze]=Ft,l&&(ze===36009&&(P[36160]=Ft),ze===36160&&(P[36009]=Ft)),!0):!1}function fn(ze,Ft){let kt=W,un=!1;if(ze)if(kt=k.get(Ft),kt===void 0&&(kt=[],k.set(Ft,kt)),ze.isWebGLMultipleRenderTargets){const Ht=ze.texture;if(kt.length!==Ht.length||kt[0]!==36064){for(let rn=0,Bt=Ht.length;rn<Bt;rn++)kt[rn]=36064+rn;kt.length=Ht.length,un=!0}}else kt[0]!==36064&&(kt[0]=36064,un=!0);else kt[0]!==1029&&(kt[0]=1029,un=!0);un&&(n.isWebGL2?i.drawBuffers(kt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(kt))}function pn(ze){return Z!==ze?(i.useProgram(ze),Z=ze,!0):!1}const Wt={[gh]:32774,[FD]:32778,[BD]:32779};if(l)Wt[BM]=32775,Wt[OM]=32776;else{const ze=e.get("EXT_blend_minmax");ze!==null&&(Wt[BM]=ze.MIN_EXT,Wt[OM]=ze.MAX_EXT)}const On={[OD]:0,[ND]:1,[UD]:768,[MC]:770,[$D]:776,[WD]:774,[GD]:772,[VD]:769,[TC]:771,[HD]:775,[jD]:773};function bn(ze,Ft,kt,un,Ht,rn,Bt,mn){if(ze===Tl){F===!0&&(ot(3042),F=!1);return}if(F===!1&&(Xt(3042),F=!0),ze!==RD){if(ze!==B||mn!==Te){if((G!==gh||me!==gh)&&(i.blendEquation(32774),G=gh,me=gh),mn)switch(ze){case Gh:i.blendFuncSeparate(1,771,1,771);break;case kM:i.blendFunc(1,1);break;case RM:i.blendFuncSeparate(0,769,0,1);break;case FM:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ze);break}else switch(ze){case Gh:i.blendFuncSeparate(770,771,1,771);break;case kM:i.blendFunc(770,1);break;case RM:i.blendFuncSeparate(0,769,0,1);break;case FM:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ze);break}$=null,ne=null,K=null,Ee=null,B=ze,Te=mn}return}Ht=Ht||Ft,rn=rn||kt,Bt=Bt||un,(Ft!==G||Ht!==me)&&(i.blendEquationSeparate(Wt[Ft],Wt[Ht]),G=Ft,me=Ht),(kt!==$||un!==ne||rn!==K||Bt!==Ee)&&(i.blendFuncSeparate(On[kt],On[un],On[rn],On[Bt]),$=kt,ne=un,K=rn,Ee=Bt),B=ze,Te=null}function hn(ze,Ft){ze.side===Kh?ot(2884):Xt(2884);let kt=ze.side===ds;Ft&&(kt=!kt),an(kt),ze.blending===Gh&&ze.transparent===!1?bn(Tl):bn(ze.blending,ze.blendEquation,ze.blendSrc,ze.blendDst,ze.blendEquationAlpha,ze.blendSrcAlpha,ze.blendDstAlpha,ze.premultipliedAlpha),T.setFunc(ze.depthFunc),T.setTest(ze.depthTest),T.setMask(ze.depthWrite),a.setMask(ze.colorWrite);const un=ze.stencilWrite;A.setTest(un),un&&(A.setMask(ze.stencilWriteMask),A.setFunc(ze.stencilFunc,ze.stencilRef,ze.stencilFuncMask),A.setOp(ze.stencilFail,ze.stencilZFail,ze.stencilZPass)),mi(ze.polygonOffset,ze.polygonOffsetFactor,ze.polygonOffsetUnits),ze.alphaToCoverage===!0?Xt(32926):ot(32926)}function an(ze){ee!==ze&&(ze?i.frontFace(2304):i.frontFace(2305),ee=ze)}function ii(ze){ze!==LD?(Xt(2884),ze!==Ae&&(ze===zM?i.cullFace(1029):ze===DD?i.cullFace(1028):i.cullFace(1032))):ot(2884),Ae=ze}function ui(ze){ze!==Fe&&(je&&i.lineWidth(ze),Fe=ze)}function mi(ze,Ft,kt){ze?(Xt(32823),(qe!==Ft||Pt!==kt)&&(i.polygonOffset(Ft,kt),qe=Ft,Pt=kt)):ot(32823)}function Zn(ze){ze?Xt(3089):ot(3089)}function Nn(ze){ze===void 0&&(ze=33984+xt-1),ct!==ze&&(i.activeTexture(ze),ct=ze)}function dn(ze,Ft){ct===null&&Nn();let kt=Be[ct];kt===void 0&&(kt={type:void 0,texture:void 0},Be[ct]=kt),(kt.type!==ze||kt.texture!==Ft)&&(i.bindTexture(ze,Ft||jt[ze]),kt.type=ze,kt.texture=Ft)}function zi(){const ze=Be[ct];ze!==void 0&&ze.type!==void 0&&(i.bindTexture(ze.type,null),ze.type=void 0,ze.texture=void 0)}function Se(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function fe(){try{i.texSubImage2D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function st(){try{i.texSubImage3D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Et(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Rt(){try{i.texStorage2D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function qt(){try{i.texStorage3D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function nn(){try{i.texImage2D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function ge(){try{i.texImage3D.apply(i,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function mt(ze){pt.equals(ze)===!1&&(i.scissor(ze.x,ze.y,ze.z,ze.w),pt.copy(ze))}function Ut(ze){et.equals(ze)===!1&&(i.viewport(ze.x,ze.y,ze.z,ze.w),et.copy(ze))}function Mt(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),l===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),D={},ct=null,Be={},P={},k=new WeakMap,W=[],Z=null,F=!1,B=null,G=null,$=null,ne=null,me=null,K=null,Ee=null,Te=!1,ee=null,Ae=null,Fe=null,qe=null,Pt=null,pt.set(0,0,i.canvas.width,i.canvas.height),et.set(0,0,i.canvas.width,i.canvas.height),a.reset(),T.reset(),A.reset()}return{buffers:{color:a,depth:T,stencil:A},enable:Xt,disable:ot,bindFramebuffer:Tn,drawBuffers:fn,useProgram:pn,setBlending:bn,setMaterial:hn,setFlipSided:an,setCullFace:ii,setLineWidth:ui,setPolygonOffset:mi,setScissorTest:Zn,activeTexture:Nn,bindTexture:dn,unbindTexture:zi,compressedTexImage2D:Se,texImage2D:nn,texImage3D:ge,texStorage2D:Rt,texStorage3D:qt,texSubImage2D:fe,texSubImage3D:st,compressedTexSubImage2D:Et,scissor:mt,viewport:Ut,reset:Mt}}function pO(i,e,n,l,d,_,w){const a=d.isWebGL2,T=d.maxTextures,A=d.maxCubemapSize,D=d.maxTextureSize,P=d.maxSamples,k=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,W=/OculusBrowser/g.test(navigator.userAgent),Z=new WeakMap;let F;const B=new WeakMap;let G=!1;try{G=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function $(Se,fe){return G?new OffscreenCanvas(Se,fe):wp("canvas")}function ne(Se,fe,st,Et){let Rt=1;if((Se.width>Et||Se.height>Et)&&(Rt=Et/Math.max(Se.width,Se.height)),Rt<1||fe===!0)if(typeof HTMLImageElement!="undefined"&&Se instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&Se instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&Se instanceof ImageBitmap){const qt=fe?Fv:Math.floor,nn=qt(Rt*Se.width),ge=qt(Rt*Se.height);F===void 0&&(F=$(nn,ge));const mt=st?$(nn,ge):F;return mt.width=nn,mt.height=ge,mt.getContext("2d").drawImage(Se,0,0,nn,ge),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Se.width+"x"+Se.height+") to ("+nn+"x"+ge+")."),mt}else return"data"in Se&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Se.width+"x"+Se.height+")."),Se;return Se}function me(Se){return u2(Se.width)&&u2(Se.height)}function K(Se){return a?!1:Se.wrapS!==ls||Se.wrapT!==ls||Se.minFilter!==oo&&Se.minFilter!==Oo}function Ee(Se,fe){return Se.generateMipmaps&&fe&&Se.minFilter!==oo&&Se.minFilter!==Oo}function Te(Se){i.generateMipmap(Se)}function ee(Se,fe,st,Et,Rt=!1){if(a===!1)return fe;if(Se!==null){if(i[Se]!==void 0)return i[Se];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Se+"'")}let qt=fe;return fe===6403&&(st===5126&&(qt=33326),st===5131&&(qt=33325),st===5121&&(qt=33321)),fe===33319&&(st===5126&&(qt=33328),st===5131&&(qt=33327),st===5121&&(qt=33323)),fe===6408&&(st===5126&&(qt=34836),st===5131&&(qt=34842),st===5121&&(qt=Et===Bi&&Rt===!1?35907:32856),st===32819&&(qt=32854),st===32820&&(qt=32855)),(qt===33325||qt===33326||qt===33327||qt===33328||qt===34842||qt===34836)&&e.get("EXT_color_buffer_float"),qt}function Ae(Se,fe,st){return Ee(Se,st)===!0||Se.isFramebufferTexture&&Se.minFilter!==oo&&Se.minFilter!==Oo?Math.log2(Math.max(fe.width,fe.height))+1:Se.mipmaps!==void 0&&Se.mipmaps.length>0?Se.mipmaps.length:Se.isCompressedTexture&&Array.isArray(Se.image)?fe.mipmaps.length:1}function Fe(Se){return Se===oo||Se===NM||Se===UM?9728:9729}function qe(Se){const fe=Se.target;fe.removeEventListener("dispose",qe),xt(fe),fe.isVideoTexture&&Z.delete(fe)}function Pt(Se){const fe=Se.target;fe.removeEventListener("dispose",Pt),ut(fe)}function xt(Se){const fe=l.get(Se);if(fe.__webglInit===void 0)return;const st=Se.source,Et=B.get(st);if(Et){const Rt=Et[fe.__cacheKey];Rt.usedTimes--,Rt.usedTimes===0&&je(Se),Object.keys(Et).length===0&&B.delete(st)}l.remove(Se)}function je(Se){const fe=l.get(Se);i.deleteTexture(fe.__webglTexture);const st=Se.source,Et=B.get(st);delete Et[fe.__cacheKey],w.memory.textures--}function ut(Se){const fe=Se.texture,st=l.get(Se),Et=l.get(fe);if(Et.__webglTexture!==void 0&&(i.deleteTexture(Et.__webglTexture),w.memory.textures--),Se.depthTexture&&Se.depthTexture.dispose(),Se.isWebGLCubeRenderTarget)for(let Rt=0;Rt<6;Rt++)i.deleteFramebuffer(st.__webglFramebuffer[Rt]),st.__webglDepthbuffer&&i.deleteRenderbuffer(st.__webglDepthbuffer[Rt]);else{if(i.deleteFramebuffer(st.__webglFramebuffer),st.__webglDepthbuffer&&i.deleteRenderbuffer(st.__webglDepthbuffer),st.__webglMultisampledFramebuffer&&i.deleteFramebuffer(st.__webglMultisampledFramebuffer),st.__webglColorRenderbuffer)for(let Rt=0;Rt<st.__webglColorRenderbuffer.length;Rt++)st.__webglColorRenderbuffer[Rt]&&i.deleteRenderbuffer(st.__webglColorRenderbuffer[Rt]);st.__webglDepthRenderbuffer&&i.deleteRenderbuffer(st.__webglDepthRenderbuffer)}if(Se.isWebGLMultipleRenderTargets)for(let Rt=0,qt=fe.length;Rt<qt;Rt++){const nn=l.get(fe[Rt]);nn.__webglTexture&&(i.deleteTexture(nn.__webglTexture),w.memory.textures--),l.remove(fe[Rt])}l.remove(fe),l.remove(Se)}let tt=0;function ct(){tt=0}function Be(){const Se=tt;return Se>=T&&console.warn("THREE.WebGLTextures: Trying to use "+Se+" texture units while this GPU supports only "+T),tt+=1,Se}function Ne(Se){const fe=[];return fe.push(Se.wrapS),fe.push(Se.wrapT),fe.push(Se.magFilter),fe.push(Se.minFilter),fe.push(Se.anisotropy),fe.push(Se.internalFormat),fe.push(Se.format),fe.push(Se.type),fe.push(Se.generateMipmaps),fe.push(Se.premultiplyAlpha),fe.push(Se.flipY),fe.push(Se.unpackAlignment),fe.push(Se.encoding),fe.join()}function Ze(Se,fe){const st=l.get(Se);if(Se.isVideoTexture&&dn(Se),Se.isRenderTargetTexture===!1&&Se.version>0&&st.__version!==Se.version){const Et=Se.image;if(Et===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Et.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{fn(st,Se,fe);return}}n.activeTexture(33984+fe),n.bindTexture(3553,st.__webglTexture)}function pt(Se,fe){const st=l.get(Se);if(Se.version>0&&st.__version!==Se.version){fn(st,Se,fe);return}n.activeTexture(33984+fe),n.bindTexture(35866,st.__webglTexture)}function et(Se,fe){const st=l.get(Se);if(Se.version>0&&st.__version!==Se.version){fn(st,Se,fe);return}n.activeTexture(33984+fe),n.bindTexture(32879,st.__webglTexture)}function gt(Se,fe){const st=l.get(Se);if(Se.version>0&&st.__version!==Se.version){pn(st,Se,fe);return}n.activeTexture(33984+fe),n.bindTexture(34067,st.__webglTexture)}const jt={[xp]:10497,[ls]:33071,[zv]:33648},Xt={[oo]:9728,[NM]:9984,[UM]:9986,[Oo]:9729,[az]:9985,[iy]:9987};function ot(Se,fe,st){if(st?(i.texParameteri(Se,10242,jt[fe.wrapS]),i.texParameteri(Se,10243,jt[fe.wrapT]),(Se===32879||Se===35866)&&i.texParameteri(Se,32882,jt[fe.wrapR]),i.texParameteri(Se,10240,Xt[fe.magFilter]),i.texParameteri(Se,10241,Xt[fe.minFilter])):(i.texParameteri(Se,10242,33071),i.texParameteri(Se,10243,33071),(Se===32879||Se===35866)&&i.texParameteri(Se,32882,33071),(fe.wrapS!==ls||fe.wrapT!==ls)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(Se,10240,Fe(fe.magFilter)),i.texParameteri(Se,10241,Fe(fe.minFilter)),fe.minFilter!==oo&&fe.minFilter!==Oo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Et=e.get("EXT_texture_filter_anisotropic");if(fe.type===Dc&&e.has("OES_texture_float_linear")===!1||a===!1&&fe.type===vp&&e.has("OES_texture_half_float_linear")===!1)return;(fe.anisotropy>1||l.get(fe).__currentAnisotropy)&&(i.texParameterf(Se,Et.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(fe.anisotropy,d.getMaxAnisotropy())),l.get(fe).__currentAnisotropy=fe.anisotropy)}}function Tn(Se,fe){let st=!1;Se.__webglInit===void 0&&(Se.__webglInit=!0,fe.addEventListener("dispose",qe));const Et=fe.source;let Rt=B.get(Et);Rt===void 0&&(Rt={},B.set(Et,Rt));const qt=Ne(fe);if(qt!==Se.__cacheKey){Rt[qt]===void 0&&(Rt[qt]={texture:i.createTexture(),usedTimes:0},w.memory.textures++,st=!0),Rt[qt].usedTimes++;const nn=Rt[Se.__cacheKey];nn!==void 0&&(Rt[Se.__cacheKey].usedTimes--,nn.usedTimes===0&&je(fe)),Se.__cacheKey=qt,Se.__webglTexture=Rt[qt].texture}return st}function fn(Se,fe,st){let Et=3553;fe.isDataArrayTexture&&(Et=35866),fe.isData3DTexture&&(Et=32879);const Rt=Tn(Se,fe),qt=fe.source;if(n.activeTexture(33984+st),n.bindTexture(Et,Se.__webglTexture),qt.version!==qt.__currentVersion||Rt===!0){i.pixelStorei(37440,fe.flipY),i.pixelStorei(37441,fe.premultiplyAlpha),i.pixelStorei(3317,fe.unpackAlignment),i.pixelStorei(37443,0);const nn=K(fe)&&me(fe.image)===!1;let ge=ne(fe.image,nn,!1,D);ge=zi(fe,ge);const mt=me(ge)||a,Ut=_.convert(fe.format,fe.encoding);let Mt=_.convert(fe.type),ze=ee(fe.internalFormat,Ut,Mt,fe.encoding,fe.isVideoTexture);ot(Et,fe,mt);let Ft;const kt=fe.mipmaps,un=a&&fe.isVideoTexture!==!0,Ht=qt.__currentVersion===void 0||Rt===!0,rn=Ae(fe,ge,mt);if(fe.isDepthTexture)ze=6402,a?fe.type===Dc?ze=36012:fe.type===Lc?ze=33190:fe.type===jh?ze=35056:ze=33189:fe.type===Dc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),fe.format===Fc&&ze===6402&&fe.type!==CC&&fe.type!==Lc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),fe.type=Lc,Mt=_.convert(fe.type)),fe.format===ed&&ze===6402&&(ze=34041,fe.type!==jh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),fe.type=jh,Mt=_.convert(fe.type))),Ht&&(un?n.texStorage2D(3553,1,ze,ge.width,ge.height):n.texImage2D(3553,0,ze,ge.width,ge.height,0,Ut,Mt,null));else if(fe.isDataTexture)if(kt.length>0&&mt){un&&Ht&&n.texStorage2D(3553,rn,ze,kt[0].width,kt[0].height);for(let Bt=0,mn=kt.length;Bt<mn;Bt++)Ft=kt[Bt],un?n.texSubImage2D(3553,Bt,0,0,Ft.width,Ft.height,Ut,Mt,Ft.data):n.texImage2D(3553,Bt,ze,Ft.width,Ft.height,0,Ut,Mt,Ft.data);fe.generateMipmaps=!1}else un?(Ht&&n.texStorage2D(3553,rn,ze,ge.width,ge.height),n.texSubImage2D(3553,0,0,0,ge.width,ge.height,Ut,Mt,ge.data)):n.texImage2D(3553,0,ze,ge.width,ge.height,0,Ut,Mt,ge.data);else if(fe.isCompressedTexture){un&&Ht&&n.texStorage2D(3553,rn,ze,kt[0].width,kt[0].height);for(let Bt=0,mn=kt.length;Bt<mn;Bt++)Ft=kt[Bt],fe.format!==cs?Ut!==null?un?n.compressedTexSubImage2D(3553,Bt,0,0,Ft.width,Ft.height,Ut,Ft.data):n.compressedTexImage2D(3553,Bt,ze,Ft.width,Ft.height,0,Ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):un?n.texSubImage2D(3553,Bt,0,0,Ft.width,Ft.height,Ut,Mt,Ft.data):n.texImage2D(3553,Bt,ze,Ft.width,Ft.height,0,Ut,Mt,Ft.data)}else if(fe.isDataArrayTexture)un?(Ht&&n.texStorage3D(35866,rn,ze,ge.width,ge.height,ge.depth),n.texSubImage3D(35866,0,0,0,0,ge.width,ge.height,ge.depth,Ut,Mt,ge.data)):n.texImage3D(35866,0,ze,ge.width,ge.height,ge.depth,0,Ut,Mt,ge.data);else if(fe.isData3DTexture)un?(Ht&&n.texStorage3D(32879,rn,ze,ge.width,ge.height,ge.depth),n.texSubImage3D(32879,0,0,0,0,ge.width,ge.height,ge.depth,Ut,Mt,ge.data)):n.texImage3D(32879,0,ze,ge.width,ge.height,ge.depth,0,Ut,Mt,ge.data);else if(fe.isFramebufferTexture){if(Ht)if(un)n.texStorage2D(3553,rn,ze,ge.width,ge.height);else{let Bt=ge.width,mn=ge.height;for(let qn=0;qn<rn;qn++)n.texImage2D(3553,qn,ze,Bt,mn,0,Ut,Mt,null),Bt>>=1,mn>>=1}}else if(kt.length>0&&mt){un&&Ht&&n.texStorage2D(3553,rn,ze,kt[0].width,kt[0].height);for(let Bt=0,mn=kt.length;Bt<mn;Bt++)Ft=kt[Bt],un?n.texSubImage2D(3553,Bt,0,0,Ut,Mt,Ft):n.texImage2D(3553,Bt,ze,Ut,Mt,Ft);fe.generateMipmaps=!1}else un?(Ht&&n.texStorage2D(3553,rn,ze,ge.width,ge.height),n.texSubImage2D(3553,0,0,0,Ut,Mt,ge)):n.texImage2D(3553,0,ze,Ut,Mt,ge);Ee(fe,mt)&&Te(Et),qt.__currentVersion=qt.version,fe.onUpdate&&fe.onUpdate(fe)}Se.__version=fe.version}function pn(Se,fe,st){if(fe.image.length!==6)return;const Et=Tn(Se,fe),Rt=fe.source;if(n.activeTexture(33984+st),n.bindTexture(34067,Se.__webglTexture),Rt.version!==Rt.__currentVersion||Et===!0){i.pixelStorei(37440,fe.flipY),i.pixelStorei(37441,fe.premultiplyAlpha),i.pixelStorei(3317,fe.unpackAlignment),i.pixelStorei(37443,0);const qt=fe.isCompressedTexture||fe.image[0].isCompressedTexture,nn=fe.image[0]&&fe.image[0].isDataTexture,ge=[];for(let Bt=0;Bt<6;Bt++)!qt&&!nn?ge[Bt]=ne(fe.image[Bt],!1,!0,A):ge[Bt]=nn?fe.image[Bt].image:fe.image[Bt],ge[Bt]=zi(fe,ge[Bt]);const mt=ge[0],Ut=me(mt)||a,Mt=_.convert(fe.format,fe.encoding),ze=_.convert(fe.type),Ft=ee(fe.internalFormat,Mt,ze,fe.encoding),kt=a&&fe.isVideoTexture!==!0,un=Rt.__currentVersion===void 0||Et===!0;let Ht=Ae(fe,mt,Ut);ot(34067,fe,Ut);let rn;if(qt){kt&&un&&n.texStorage2D(34067,Ht,Ft,mt.width,mt.height);for(let Bt=0;Bt<6;Bt++){rn=ge[Bt].mipmaps;for(let mn=0;mn<rn.length;mn++){const qn=rn[mn];fe.format!==cs?Mt!==null?kt?n.compressedTexSubImage2D(34069+Bt,mn,0,0,qn.width,qn.height,Mt,qn.data):n.compressedTexImage2D(34069+Bt,mn,Ft,qn.width,qn.height,0,qn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):kt?n.texSubImage2D(34069+Bt,mn,0,0,qn.width,qn.height,Mt,ze,qn.data):n.texImage2D(34069+Bt,mn,Ft,qn.width,qn.height,0,Mt,ze,qn.data)}}}else{rn=fe.mipmaps,kt&&un&&(rn.length>0&&Ht++,n.texStorage2D(34067,Ht,Ft,ge[0].width,ge[0].height));for(let Bt=0;Bt<6;Bt++)if(nn){kt?n.texSubImage2D(34069+Bt,0,0,0,ge[Bt].width,ge[Bt].height,Mt,ze,ge[Bt].data):n.texImage2D(34069+Bt,0,Ft,ge[Bt].width,ge[Bt].height,0,Mt,ze,ge[Bt].data);for(let mn=0;mn<rn.length;mn++){const zn=rn[mn].image[Bt].image;kt?n.texSubImage2D(34069+Bt,mn+1,0,0,zn.width,zn.height,Mt,ze,zn.data):n.texImage2D(34069+Bt,mn+1,Ft,zn.width,zn.height,0,Mt,ze,zn.data)}}else{kt?n.texSubImage2D(34069+Bt,0,0,0,Mt,ze,ge[Bt]):n.texImage2D(34069+Bt,0,Ft,Mt,ze,ge[Bt]);for(let mn=0;mn<rn.length;mn++){const qn=rn[mn];kt?n.texSubImage2D(34069+Bt,mn+1,0,0,Mt,ze,qn.image[Bt]):n.texImage2D(34069+Bt,mn+1,Ft,Mt,ze,qn.image[Bt])}}}Ee(fe,Ut)&&Te(34067),Rt.__currentVersion=Rt.version,fe.onUpdate&&fe.onUpdate(fe)}Se.__version=fe.version}function Wt(Se,fe,st,Et,Rt){const qt=_.convert(st.format,st.encoding),nn=_.convert(st.type),ge=ee(st.internalFormat,qt,nn,st.encoding);l.get(fe).__hasExternalTextures||(Rt===32879||Rt===35866?n.texImage3D(Rt,0,ge,fe.width,fe.height,fe.depth,0,qt,nn,null):n.texImage2D(Rt,0,ge,fe.width,fe.height,0,qt,nn,null)),n.bindFramebuffer(36160,Se),Nn(fe)?k.framebufferTexture2DMultisampleEXT(36160,Et,Rt,l.get(st).__webglTexture,0,Zn(fe)):i.framebufferTexture2D(36160,Et,Rt,l.get(st).__webglTexture,0),n.bindFramebuffer(36160,null)}function On(Se,fe,st){if(i.bindRenderbuffer(36161,Se),fe.depthBuffer&&!fe.stencilBuffer){let Et=33189;if(st||Nn(fe)){const Rt=fe.depthTexture;Rt&&Rt.isDepthTexture&&(Rt.type===Dc?Et=36012:Rt.type===Lc&&(Et=33190));const qt=Zn(fe);Nn(fe)?k.renderbufferStorageMultisampleEXT(36161,qt,Et,fe.width,fe.height):i.renderbufferStorageMultisample(36161,qt,Et,fe.width,fe.height)}else i.renderbufferStorage(36161,Et,fe.width,fe.height);i.framebufferRenderbuffer(36160,36096,36161,Se)}else if(fe.depthBuffer&&fe.stencilBuffer){const Et=Zn(fe);st&&Nn(fe)===!1?i.renderbufferStorageMultisample(36161,Et,35056,fe.width,fe.height):Nn(fe)?k.renderbufferStorageMultisampleEXT(36161,Et,35056,fe.width,fe.height):i.renderbufferStorage(36161,34041,fe.width,fe.height),i.framebufferRenderbuffer(36160,33306,36161,Se)}else{const Et=fe.isWebGLMultipleRenderTargets===!0?fe.texture:[fe.texture];for(let Rt=0;Rt<Et.length;Rt++){const qt=Et[Rt],nn=_.convert(qt.format,qt.encoding),ge=_.convert(qt.type),mt=ee(qt.internalFormat,nn,ge,qt.encoding),Ut=Zn(fe);st&&Nn(fe)===!1?i.renderbufferStorageMultisample(36161,Ut,mt,fe.width,fe.height):Nn(fe)?k.renderbufferStorageMultisampleEXT(36161,Ut,mt,fe.width,fe.height):i.renderbufferStorage(36161,mt,fe.width,fe.height)}}i.bindRenderbuffer(36161,null)}function bn(Se,fe){if(fe&&fe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,Se),!(fe.depthTexture&&fe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!l.get(fe.depthTexture).__webglTexture||fe.depthTexture.image.width!==fe.width||fe.depthTexture.image.height!==fe.height)&&(fe.depthTexture.image.width=fe.width,fe.depthTexture.image.height=fe.height,fe.depthTexture.needsUpdate=!0),Ze(fe.depthTexture,0);const Et=l.get(fe.depthTexture).__webglTexture,Rt=Zn(fe);if(fe.depthTexture.format===Fc)Nn(fe)?k.framebufferTexture2DMultisampleEXT(36160,36096,3553,Et,0,Rt):i.framebufferTexture2D(36160,36096,3553,Et,0);else if(fe.depthTexture.format===ed)Nn(fe)?k.framebufferTexture2DMultisampleEXT(36160,33306,3553,Et,0,Rt):i.framebufferTexture2D(36160,33306,3553,Et,0);else throw new Error("Unknown depthTexture format")}function hn(Se){const fe=l.get(Se),st=Se.isWebGLCubeRenderTarget===!0;if(Se.depthTexture&&!fe.__autoAllocateDepthBuffer){if(st)throw new Error("target.depthTexture not supported in Cube render targets");bn(fe.__webglFramebuffer,Se)}else if(st){fe.__webglDepthbuffer=[];for(let Et=0;Et<6;Et++)n.bindFramebuffer(36160,fe.__webglFramebuffer[Et]),fe.__webglDepthbuffer[Et]=i.createRenderbuffer(),On(fe.__webglDepthbuffer[Et],Se,!1)}else n.bindFramebuffer(36160,fe.__webglFramebuffer),fe.__webglDepthbuffer=i.createRenderbuffer(),On(fe.__webglDepthbuffer,Se,!1);n.bindFramebuffer(36160,null)}function an(Se,fe,st){const Et=l.get(Se);fe!==void 0&&Wt(Et.__webglFramebuffer,Se,Se.texture,36064,3553),st!==void 0&&hn(Se)}function ii(Se){const fe=Se.texture,st=l.get(Se),Et=l.get(fe);Se.addEventListener("dispose",Pt),Se.isWebGLMultipleRenderTargets!==!0&&(Et.__webglTexture===void 0&&(Et.__webglTexture=i.createTexture()),Et.__version=fe.version,w.memory.textures++);const Rt=Se.isWebGLCubeRenderTarget===!0,qt=Se.isWebGLMultipleRenderTargets===!0,nn=me(Se)||a;if(Rt){st.__webglFramebuffer=[];for(let ge=0;ge<6;ge++)st.__webglFramebuffer[ge]=i.createFramebuffer()}else{if(st.__webglFramebuffer=i.createFramebuffer(),qt)if(d.drawBuffers){const ge=Se.texture;for(let mt=0,Ut=ge.length;mt<Ut;mt++){const Mt=l.get(ge[mt]);Mt.__webglTexture===void 0&&(Mt.__webglTexture=i.createTexture(),w.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&Se.samples>0&&Nn(Se)===!1){const ge=qt?fe:[fe];st.__webglMultisampledFramebuffer=i.createFramebuffer(),st.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,st.__webglMultisampledFramebuffer);for(let mt=0;mt<ge.length;mt++){const Ut=ge[mt];st.__webglColorRenderbuffer[mt]=i.createRenderbuffer(),i.bindRenderbuffer(36161,st.__webglColorRenderbuffer[mt]);const Mt=_.convert(Ut.format,Ut.encoding),ze=_.convert(Ut.type),Ft=ee(Ut.internalFormat,Mt,ze,Ut.encoding),kt=Zn(Se);i.renderbufferStorageMultisample(36161,kt,Ft,Se.width,Se.height),i.framebufferRenderbuffer(36160,36064+mt,36161,st.__webglColorRenderbuffer[mt])}i.bindRenderbuffer(36161,null),Se.depthBuffer&&(st.__webglDepthRenderbuffer=i.createRenderbuffer(),On(st.__webglDepthRenderbuffer,Se,!0)),n.bindFramebuffer(36160,null)}}if(Rt){n.bindTexture(34067,Et.__webglTexture),ot(34067,fe,nn);for(let ge=0;ge<6;ge++)Wt(st.__webglFramebuffer[ge],Se,fe,36064,34069+ge);Ee(fe,nn)&&Te(34067),n.unbindTexture()}else if(qt){const ge=Se.texture;for(let mt=0,Ut=ge.length;mt<Ut;mt++){const Mt=ge[mt],ze=l.get(Mt);n.bindTexture(3553,ze.__webglTexture),ot(3553,Mt,nn),Wt(st.__webglFramebuffer,Se,Mt,36064+mt,3553),Ee(Mt,nn)&&Te(3553)}n.unbindTexture()}else{let ge=3553;(Se.isWebGL3DRenderTarget||Se.isWebGLArrayRenderTarget)&&(a?ge=Se.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(ge,Et.__webglTexture),ot(ge,fe,nn),Wt(st.__webglFramebuffer,Se,fe,36064,ge),Ee(fe,nn)&&Te(ge),n.unbindTexture()}Se.depthBuffer&&hn(Se)}function ui(Se){const fe=me(Se)||a,st=Se.isWebGLMultipleRenderTargets===!0?Se.texture:[Se.texture];for(let Et=0,Rt=st.length;Et<Rt;Et++){const qt=st[Et];if(Ee(qt,fe)){const nn=Se.isWebGLCubeRenderTarget?34067:3553,ge=l.get(qt).__webglTexture;n.bindTexture(nn,ge),Te(nn),n.unbindTexture()}}}function mi(Se){if(a&&Se.samples>0&&Nn(Se)===!1){const fe=Se.isWebGLMultipleRenderTargets?Se.texture:[Se.texture],st=Se.width,Et=Se.height;let Rt=16384;const qt=[],nn=Se.stencilBuffer?33306:36096,ge=l.get(Se),mt=Se.isWebGLMultipleRenderTargets===!0;if(mt)for(let Ut=0;Ut<fe.length;Ut++)n.bindFramebuffer(36160,ge.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Ut,36161,null),n.bindFramebuffer(36160,ge.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Ut,3553,null,0);n.bindFramebuffer(36008,ge.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,ge.__webglFramebuffer);for(let Ut=0;Ut<fe.length;Ut++){qt.push(36064+Ut),Se.depthBuffer&&qt.push(nn);const Mt=ge.__ignoreDepthValues!==void 0?ge.__ignoreDepthValues:!1;if(Mt===!1&&(Se.depthBuffer&&(Rt|=256),Se.stencilBuffer&&(Rt|=1024)),mt&&i.framebufferRenderbuffer(36008,36064,36161,ge.__webglColorRenderbuffer[Ut]),Mt===!0&&(i.invalidateFramebuffer(36008,[nn]),i.invalidateFramebuffer(36009,[nn])),mt){const ze=l.get(fe[Ut]).__webglTexture;i.framebufferTexture2D(36009,36064,3553,ze,0)}i.blitFramebuffer(0,0,st,Et,0,0,st,Et,Rt,9728),W&&i.invalidateFramebuffer(36008,qt)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),mt)for(let Ut=0;Ut<fe.length;Ut++){n.bindFramebuffer(36160,ge.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Ut,36161,ge.__webglColorRenderbuffer[Ut]);const Mt=l.get(fe[Ut]).__webglTexture;n.bindFramebuffer(36160,ge.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Ut,3553,Mt,0)}n.bindFramebuffer(36009,ge.__webglMultisampledFramebuffer)}}function Zn(Se){return Math.min(P,Se.samples)}function Nn(Se){const fe=l.get(Se);return a&&Se.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&fe.__useRenderToTexture!==!1}function dn(Se){const fe=w.render.frame;Z.get(Se)!==fe&&(Z.set(Se,fe),Se.update())}function zi(Se,fe){const st=Se.encoding,Et=Se.format,Rt=Se.type;return Se.isCompressedTexture===!0||Se.isVideoTexture===!0||Se.format===kv||st!==Hc&&(st===Bi?a===!1?e.has("EXT_sRGB")===!0&&Et===cs?(Se.format=kv,Se.minFilter=Oo,Se.generateMipmaps=!1):fe=PC.sRGBToLinear(fe):(Et!==cs||Rt!==Wc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",st)),fe}this.allocateTextureUnit=Be,this.resetTextureUnits=ct,this.setTexture2D=Ze,this.setTexture2DArray=pt,this.setTexture3D=et,this.setTextureCube=gt,this.rebindTextures=an,this.setupRenderTarget=ii,this.updateRenderTargetMipmap=ui,this.updateMultisampleRenderTarget=mi,this.setupDepthRenderbuffer=hn,this.setupFrameBufferTexture=Wt,this.useMultisampledRTT=Nn}function mO(i,e,n){const l=n.isWebGL2;function d(_,w=null){let a;if(_===Wc)return 5121;if(_===hz)return 32819;if(_===dz)return 32820;if(_===lz)return 5120;if(_===cz)return 5122;if(_===CC)return 5123;if(_===uz)return 5124;if(_===Lc)return 5125;if(_===Dc)return 5126;if(_===vp)return l?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(_===fz)return 6406;if(_===cs)return 6408;if(_===mz)return 6409;if(_===_z)return 6410;if(_===Fc)return 6402;if(_===ed)return 34041;if(_===gz)return 6403;if(_===pz)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(_===kv)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(_===yz)return 36244;if(_===xz)return 33319;if(_===vz)return 33320;if(_===wz)return 36249;if(_===tx||_===nx||_===ix||_===rx)if(w===Bi)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(_===tx)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(_===nx)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(_===ix)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(_===rx)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(_===tx)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_===nx)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_===ix)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_===rx)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(_===VM||_===GM||_===jM||_===WM)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(_===VM)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_===GM)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_===jM)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_===WM)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(_===bz)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(_===HM||_===$M)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(_===HM)return w===Bi?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(_===$M)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(_===qM||_===ZM||_===XM||_===YM||_===KM||_===JM||_===QM||_===e2||_===t2||_===n2||_===i2||_===r2||_===o2||_===s2)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(_===qM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(_===ZM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(_===XM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(_===YM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(_===KM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(_===JM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(_===QM)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(_===e2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(_===t2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(_===n2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(_===i2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(_===r2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(_===o2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(_===s2)return w===Bi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(_===a2)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(_===a2)return w===Bi?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return _===jh?l?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[_]!==void 0?i[_]:null}return{convert:d}}class _O extends vo{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Z_ extends uo{constructor(){super(),this.isGroup=!0,this.type="Group"}}const gO={type:"move"};class zx{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Z_,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Z_,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ye,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ye),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Z_,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ye,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ye),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,l){let d=null,_=null,w=null;const a=this._targetRay,T=this._grip,A=this._hand;if(e&&n.session.visibilityState!=="visible-blurred")if(a!==null&&(d=n.getPose(e.targetRaySpace,l),d!==null&&(a.matrix.fromArray(d.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),d.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(d.linearVelocity)):a.hasLinearVelocity=!1,d.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(d.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(gO))),A&&e.hand){w=!0;for(const F of e.hand.values()){const B=n.getJointPose(F,l);if(A.joints[F.jointName]===void 0){const $=new Z_;$.matrixAutoUpdate=!1,$.visible=!1,A.joints[F.jointName]=$,A.add($)}const G=A.joints[F.jointName];B!==null&&(G.matrix.fromArray(B.transform.matrix),G.matrix.decompose(G.position,G.rotation,G.scale),G.jointRadius=B.radius),G.visible=B!==null}const D=A.joints["index-finger-tip"],P=A.joints["thumb-tip"],k=D.position.distanceTo(P.position),W=.02,Z=.005;A.inputState.pinching&&k>W+Z?(A.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!A.inputState.pinching&&k<=W-Z&&(A.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else T!==null&&e.gripSpace&&(_=n.getPose(e.gripSpace,l),_!==null&&(T.matrix.fromArray(_.transform.matrix),T.matrix.decompose(T.position,T.rotation,T.scale),_.linearVelocity?(T.hasLinearVelocity=!0,T.linearVelocity.copy(_.linearVelocity)):T.hasLinearVelocity=!1,_.angularVelocity?(T.hasAngularVelocity=!0,T.angularVelocity.copy(_.angularVelocity)):T.hasAngularVelocity=!1));return a!==null&&(a.visible=d!==null),T!==null&&(T.visible=_!==null),A!==null&&(A.visible=w!==null),this}}class yO extends jo{constructor(e,n,l,d,_,w,a,T,A,D){if(D=D!==void 0?D:Fc,D!==Fc&&D!==ed)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");l===void 0&&D===Fc&&(l=Lc),l===void 0&&D===ed&&(l=jh),super(null,d,_,w,a,T,D,l,A),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:oo,this.minFilter=T!==void 0?T:oo,this.flipY=!1,this.generateMipmaps=!1}}class xO extends Xc{constructor(e,n){super();const l=this;let d=null,_=1,w=null,a="local-floor",T=null,A=null,D=null,P=null,k=null,W=null;const Z=n.getContextAttributes();let F=null,B=null;const G=[],$=new Map,ne=new vo;ne.layers.enable(1),ne.viewport=new vr;const me=new vo;me.layers.enable(2),me.viewport=new vr;const K=[ne,me],Ee=new _O;Ee.layers.enable(1),Ee.layers.enable(2);let Te=null,ee=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ne){let Ze=G[Ne];return Ze===void 0&&(Ze=new zx,G[Ne]=Ze),Ze.getTargetRaySpace()},this.getControllerGrip=function(Ne){let Ze=G[Ne];return Ze===void 0&&(Ze=new zx,G[Ne]=Ze),Ze.getGripSpace()},this.getHand=function(Ne){let Ze=G[Ne];return Ze===void 0&&(Ze=new zx,G[Ne]=Ze),Ze.getHandSpace()};function Ae(Ne){const Ze=$.get(Ne.inputSource);Ze!==void 0&&Ze.dispatchEvent({type:Ne.type,data:Ne.inputSource})}function Fe(){d.removeEventListener("select",Ae),d.removeEventListener("selectstart",Ae),d.removeEventListener("selectend",Ae),d.removeEventListener("squeeze",Ae),d.removeEventListener("squeezestart",Ae),d.removeEventListener("squeezeend",Ae),d.removeEventListener("end",Fe),d.removeEventListener("inputsourceschange",qe),$.forEach(function(Ne,Ze){Ne!==void 0&&Ne.disconnect(Ze)}),$.clear(),Te=null,ee=null,e.setRenderTarget(F),k=null,P=null,D=null,d=null,B=null,Be.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ne){_=Ne,l.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ne){a=Ne,l.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return T||w},this.setReferenceSpace=function(Ne){T=Ne},this.getBaseLayer=function(){return P!==null?P:k},this.getBinding=function(){return D},this.getFrame=function(){return W},this.getSession=function(){return d},this.setSession=async function(Ne){if(d=Ne,d!==null){if(F=e.getRenderTarget(),d.addEventListener("select",Ae),d.addEventListener("selectstart",Ae),d.addEventListener("selectend",Ae),d.addEventListener("squeeze",Ae),d.addEventListener("squeezestart",Ae),d.addEventListener("squeezeend",Ae),d.addEventListener("end",Fe),d.addEventListener("inputsourceschange",qe),Z.xrCompatible!==!0&&await n.makeXRCompatible(),d.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Ze={antialias:d.renderState.layers===void 0?Z.antialias:!0,alpha:Z.alpha,depth:Z.depth,stencil:Z.stencil,framebufferScaleFactor:_};k=new XRWebGLLayer(d,n,Ze),d.updateRenderState({baseLayer:k}),B=new El(k.framebufferWidth,k.framebufferHeight,{format:cs,type:Wc,encoding:e.outputEncoding})}else{let Ze=null,pt=null,et=null;Z.depth&&(et=Z.stencil?35056:33190,Ze=Z.stencil?ed:Fc,pt=Z.stencil?jh:Lc);const gt={colorFormat:e.outputEncoding===Bi?35907:32856,depthFormat:et,scaleFactor:_};D=new XRWebGLBinding(d,n),P=D.createProjectionLayer(gt),d.updateRenderState({layers:[P]}),B=new El(P.textureWidth,P.textureHeight,{format:cs,type:Wc,depthTexture:new yO(P.textureWidth,P.textureHeight,pt,void 0,void 0,void 0,void 0,void 0,void 0,Ze),stencilBuffer:Z.stencil,encoding:e.outputEncoding,samples:Z.antialias?4:0});const jt=e.properties.get(B);jt.__ignoreDepthValues=P.ignoreDepthValues}B.isXRRenderTarget=!0,this.setFoveation(1),T=null,w=await d.requestReferenceSpace(a),Be.setContext(d),Be.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}};function qe(Ne){const Ze=d.inputSources;for(let pt=0;pt<Ze.length;pt++){const et=Ze[pt].handedness==="right"?1:0;$.set(Ze[pt],G[et])}for(let pt=0;pt<Ne.removed.length;pt++){const et=Ne.removed[pt],gt=$.get(et);gt&&(gt.dispatchEvent({type:"disconnected",data:et}),$.delete(et))}for(let pt=0;pt<Ne.added.length;pt++){const et=Ne.added[pt],gt=$.get(et);gt&&gt.dispatchEvent({type:"connected",data:et})}}const Pt=new Ye,xt=new Ye;function je(Ne,Ze,pt){Pt.setFromMatrixPosition(Ze.matrixWorld),xt.setFromMatrixPosition(pt.matrixWorld);const et=Pt.distanceTo(xt),gt=Ze.projectionMatrix.elements,jt=pt.projectionMatrix.elements,Xt=gt[14]/(gt[10]-1),ot=gt[14]/(gt[10]+1),Tn=(gt[9]+1)/gt[5],fn=(gt[9]-1)/gt[5],pn=(gt[8]-1)/gt[0],Wt=(jt[8]+1)/jt[0],On=Xt*pn,bn=Xt*Wt,hn=et/(-pn+Wt),an=hn*-pn;Ze.matrixWorld.decompose(Ne.position,Ne.quaternion,Ne.scale),Ne.translateX(an),Ne.translateZ(hn),Ne.matrixWorld.compose(Ne.position,Ne.quaternion,Ne.scale),Ne.matrixWorldInverse.copy(Ne.matrixWorld).invert();const ii=Xt+hn,ui=ot+hn,mi=On-an,Zn=bn+(et-an),Nn=Tn*ot/ui*ii,dn=fn*ot/ui*ii;Ne.projectionMatrix.makePerspective(mi,Zn,Nn,dn,ii,ui)}function ut(Ne,Ze){Ze===null?Ne.matrixWorld.copy(Ne.matrix):Ne.matrixWorld.multiplyMatrices(Ze.matrixWorld,Ne.matrix),Ne.matrixWorldInverse.copy(Ne.matrixWorld).invert()}this.updateCamera=function(Ne){if(d===null)return;Ee.near=me.near=ne.near=Ne.near,Ee.far=me.far=ne.far=Ne.far,(Te!==Ee.near||ee!==Ee.far)&&(d.updateRenderState({depthNear:Ee.near,depthFar:Ee.far}),Te=Ee.near,ee=Ee.far);const Ze=Ne.parent,pt=Ee.cameras;ut(Ee,Ze);for(let gt=0;gt<pt.length;gt++)ut(pt[gt],Ze);Ee.matrixWorld.decompose(Ee.position,Ee.quaternion,Ee.scale),Ne.position.copy(Ee.position),Ne.quaternion.copy(Ee.quaternion),Ne.scale.copy(Ee.scale),Ne.matrix.copy(Ee.matrix),Ne.matrixWorld.copy(Ee.matrixWorld);const et=Ne.children;for(let gt=0,jt=et.length;gt<jt;gt++)et[gt].updateMatrixWorld(!0);pt.length===2?je(Ee,ne,me):Ee.projectionMatrix.copy(ne.projectionMatrix)},this.getCamera=function(){return Ee},this.getFoveation=function(){if(P!==null)return P.fixedFoveation;if(k!==null)return k.fixedFoveation},this.setFoveation=function(Ne){P!==null&&(P.fixedFoveation=Ne),k!==null&&k.fixedFoveation!==void 0&&(k.fixedFoveation=Ne)};let tt=null;function ct(Ne,Ze){if(A=Ze.getViewerPose(T||w),W=Ze,A!==null){const et=A.views;k!==null&&(e.setRenderTargetFramebuffer(B,k.framebuffer),e.setRenderTarget(B));let gt=!1;et.length!==Ee.cameras.length&&(Ee.cameras.length=0,gt=!0);for(let jt=0;jt<et.length;jt++){const Xt=et[jt];let ot=null;if(k!==null)ot=k.getViewport(Xt);else{const fn=D.getViewSubImage(P,Xt);ot=fn.viewport,jt===0&&(e.setRenderTargetTextures(B,fn.colorTexture,P.ignoreDepthValues?void 0:fn.depthStencilTexture),e.setRenderTarget(B))}let Tn=K[jt];Tn===void 0&&(Tn=new vo,Tn.layers.enable(jt),Tn.viewport=new vr,K[jt]=Tn),Tn.matrix.fromArray(Xt.transform.matrix),Tn.projectionMatrix.fromArray(Xt.projectionMatrix),Tn.viewport.set(ot.x,ot.y,ot.width,ot.height),jt===0&&Ee.matrix.copy(Tn.matrix),gt===!0&&Ee.cameras.push(Tn)}}const pt=d.inputSources;for(let et=0;et<G.length;et++){const gt=pt[et],jt=$.get(gt);jt!==void 0&&jt.update(gt,Ze,T||w)}tt&&tt(Ne,Ze),W=null}const Be=new OC;Be.setAnimationLoop(ct),this.setAnimationLoop=function(Ne){tt=Ne},this.dispose=function(){}}}function vO(i,e){function n(F,B){F.fogColor.value.copy(B.color),B.isFog?(F.fogNear.value=B.near,F.fogFar.value=B.far):B.isFogExp2&&(F.fogDensity.value=B.density)}function l(F,B,G,$,ne){B.isMeshBasicMaterial||B.isMeshLambertMaterial?d(F,B):B.isMeshToonMaterial?(d(F,B),D(F,B)):B.isMeshPhongMaterial?(d(F,B),A(F,B)):B.isMeshStandardMaterial?(d(F,B),P(F,B),B.isMeshPhysicalMaterial&&k(F,B,ne)):B.isMeshMatcapMaterial?(d(F,B),W(F,B)):B.isMeshDepthMaterial?d(F,B):B.isMeshDistanceMaterial?(d(F,B),Z(F,B)):B.isMeshNormalMaterial?d(F,B):B.isLineBasicMaterial?(_(F,B),B.isLineDashedMaterial&&w(F,B)):B.isPointsMaterial?a(F,B,G,$):B.isSpriteMaterial?T(F,B):B.isShadowMaterial?(F.color.value.copy(B.color),F.opacity.value=B.opacity):B.isShaderMaterial&&(B.uniformsNeedUpdate=!1)}function d(F,B){F.opacity.value=B.opacity,B.color&&F.diffuse.value.copy(B.color),B.emissive&&F.emissive.value.copy(B.emissive).multiplyScalar(B.emissiveIntensity),B.map&&(F.map.value=B.map),B.alphaMap&&(F.alphaMap.value=B.alphaMap),B.bumpMap&&(F.bumpMap.value=B.bumpMap,F.bumpScale.value=B.bumpScale,B.side===ds&&(F.bumpScale.value*=-1)),B.displacementMap&&(F.displacementMap.value=B.displacementMap,F.displacementScale.value=B.displacementScale,F.displacementBias.value=B.displacementBias),B.emissiveMap&&(F.emissiveMap.value=B.emissiveMap),B.normalMap&&(F.normalMap.value=B.normalMap,F.normalScale.value.copy(B.normalScale),B.side===ds&&F.normalScale.value.negate()),B.specularMap&&(F.specularMap.value=B.specularMap),B.alphaTest>0&&(F.alphaTest.value=B.alphaTest);const G=e.get(B).envMap;if(G&&(F.envMap.value=G,F.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,F.reflectivity.value=B.reflectivity,F.ior.value=B.ior,F.refractionRatio.value=B.refractionRatio),B.lightMap){F.lightMap.value=B.lightMap;const me=i.physicallyCorrectLights!==!0?Math.PI:1;F.lightMapIntensity.value=B.lightMapIntensity*me}B.aoMap&&(F.aoMap.value=B.aoMap,F.aoMapIntensity.value=B.aoMapIntensity);let $;B.map?$=B.map:B.specularMap?$=B.specularMap:B.displacementMap?$=B.displacementMap:B.normalMap?$=B.normalMap:B.bumpMap?$=B.bumpMap:B.roughnessMap?$=B.roughnessMap:B.metalnessMap?$=B.metalnessMap:B.alphaMap?$=B.alphaMap:B.emissiveMap?$=B.emissiveMap:B.clearcoatMap?$=B.clearcoatMap:B.clearcoatNormalMap?$=B.clearcoatNormalMap:B.clearcoatRoughnessMap?$=B.clearcoatRoughnessMap:B.iridescenceMap?$=B.iridescenceMap:B.iridescenceThicknessMap?$=B.iridescenceThicknessMap:B.specularIntensityMap?$=B.specularIntensityMap:B.specularColorMap?$=B.specularColorMap:B.transmissionMap?$=B.transmissionMap:B.thicknessMap?$=B.thicknessMap:B.sheenColorMap?$=B.sheenColorMap:B.sheenRoughnessMap&&($=B.sheenRoughnessMap),$!==void 0&&($.isWebGLRenderTarget&&($=$.texture),$.matrixAutoUpdate===!0&&$.updateMatrix(),F.uvTransform.value.copy($.matrix));let ne;B.aoMap?ne=B.aoMap:B.lightMap&&(ne=B.lightMap),ne!==void 0&&(ne.isWebGLRenderTarget&&(ne=ne.texture),ne.matrixAutoUpdate===!0&&ne.updateMatrix(),F.uv2Transform.value.copy(ne.matrix))}function _(F,B){F.diffuse.value.copy(B.color),F.opacity.value=B.opacity}function w(F,B){F.dashSize.value=B.dashSize,F.totalSize.value=B.dashSize+B.gapSize,F.scale.value=B.scale}function a(F,B,G,$){F.diffuse.value.copy(B.color),F.opacity.value=B.opacity,F.size.value=B.size*G,F.scale.value=$*.5,B.map&&(F.map.value=B.map),B.alphaMap&&(F.alphaMap.value=B.alphaMap),B.alphaTest>0&&(F.alphaTest.value=B.alphaTest);let ne;B.map?ne=B.map:B.alphaMap&&(ne=B.alphaMap),ne!==void 0&&(ne.matrixAutoUpdate===!0&&ne.updateMatrix(),F.uvTransform.value.copy(ne.matrix))}function T(F,B){F.diffuse.value.copy(B.color),F.opacity.value=B.opacity,F.rotation.value=B.rotation,B.map&&(F.map.value=B.map),B.alphaMap&&(F.alphaMap.value=B.alphaMap),B.alphaTest>0&&(F.alphaTest.value=B.alphaTest);let G;B.map?G=B.map:B.alphaMap&&(G=B.alphaMap),G!==void 0&&(G.matrixAutoUpdate===!0&&G.updateMatrix(),F.uvTransform.value.copy(G.matrix))}function A(F,B){F.specular.value.copy(B.specular),F.shininess.value=Math.max(B.shininess,1e-4)}function D(F,B){B.gradientMap&&(F.gradientMap.value=B.gradientMap)}function P(F,B){F.roughness.value=B.roughness,F.metalness.value=B.metalness,B.roughnessMap&&(F.roughnessMap.value=B.roughnessMap),B.metalnessMap&&(F.metalnessMap.value=B.metalnessMap),e.get(B).envMap&&(F.envMapIntensity.value=B.envMapIntensity)}function k(F,B,G){F.ior.value=B.ior,B.sheen>0&&(F.sheenColor.value.copy(B.sheenColor).multiplyScalar(B.sheen),F.sheenRoughness.value=B.sheenRoughness,B.sheenColorMap&&(F.sheenColorMap.value=B.sheenColorMap),B.sheenRoughnessMap&&(F.sheenRoughnessMap.value=B.sheenRoughnessMap)),B.clearcoat>0&&(F.clearcoat.value=B.clearcoat,F.clearcoatRoughness.value=B.clearcoatRoughness,B.clearcoatMap&&(F.clearcoatMap.value=B.clearcoatMap),B.clearcoatRoughnessMap&&(F.clearcoatRoughnessMap.value=B.clearcoatRoughnessMap),B.clearcoatNormalMap&&(F.clearcoatNormalScale.value.copy(B.clearcoatNormalScale),F.clearcoatNormalMap.value=B.clearcoatNormalMap,B.side===ds&&F.clearcoatNormalScale.value.negate())),B.iridescence>0&&(F.iridescence.value=B.iridescence,F.iridescenceIOR.value=B.iridescenceIOR,F.iridescenceThicknessMinimum.value=B.iridescenceThicknessRange[0],F.iridescenceThicknessMaximum.value=B.iridescenceThicknessRange[1],B.iridescenceMap&&(F.iridescenceMap.value=B.iridescenceMap),B.iridescenceThicknessMap&&(F.iridescenceThicknessMap.value=B.iridescenceThicknessMap)),B.transmission>0&&(F.transmission.value=B.transmission,F.transmissionSamplerMap.value=G.texture,F.transmissionSamplerSize.value.set(G.width,G.height),B.transmissionMap&&(F.transmissionMap.value=B.transmissionMap),F.thickness.value=B.thickness,B.thicknessMap&&(F.thicknessMap.value=B.thicknessMap),F.attenuationDistance.value=B.attenuationDistance,F.attenuationColor.value.copy(B.attenuationColor)),F.specularIntensity.value=B.specularIntensity,F.specularColor.value.copy(B.specularColor),B.specularIntensityMap&&(F.specularIntensityMap.value=B.specularIntensityMap),B.specularColorMap&&(F.specularColorMap.value=B.specularColorMap)}function W(F,B){B.matcap&&(F.matcap.value=B.matcap)}function Z(F,B){F.referencePosition.value.copy(B.referencePosition),F.nearDistance.value=B.nearDistance,F.farDistance.value=B.farDistance}return{refreshFogUniforms:n,refreshMaterialUniforms:l}}function wO(){const i=wp("canvas");return i.style.display="block",i}function $C(i={}){this.isWebGLRenderer=!0;const e=i.canvas!==void 0?i.canvas:wO(),n=i.context!==void 0?i.context:null,l=i.depth!==void 0?i.depth:!0,d=i.stencil!==void 0?i.stencil:!0,_=i.antialias!==void 0?i.antialias:!1,w=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,a=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,T=i.powerPreference!==void 0?i.powerPreference:"default",A=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let D;n!==null?D=n.getContextAttributes().alpha:D=i.alpha!==void 0?i.alpha:!1;let P=null,k=null;const W=[],Z=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Hc,this.physicallyCorrectLights=!1,this.toneMapping=ya,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const F=this;let B=!1,G=0,$=0,ne=null,me=-1,K=null;const Ee=new vr,Te=new vr;let ee=null,Ae=e.width,Fe=e.height,qe=1,Pt=null,xt=null;const je=new vr(0,0,Ae,Fe),ut=new vr(0,0,Ae,Fe);let tt=!1;const ct=new j1;let Be=!1,Ne=!1,Ze=null;const pt=new pr,et=new In,gt=new Ye,jt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Xt(){return ne===null?qe:1}let ot=n;function Tn(H,re){for(let te=0;te<H.length;te++){const ce=H[te],Ce=e.getContext(ce,re);if(Ce!==null)return Ce}return null}try{const H={alpha:!0,depth:l,stencil:d,antialias:_,premultipliedAlpha:w,preserveDrawingBuffer:a,powerPreference:T,failIfMajorPerformanceCaveat:A};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${U1}`),e.addEventListener("webglcontextlost",ze,!1),e.addEventListener("webglcontextrestored",Ft,!1),e.addEventListener("webglcontextcreationerror",kt,!1),ot===null){const re=["webgl2","webgl","experimental-webgl"];if(F.isWebGL1Renderer===!0&&re.shift(),ot=Tn(re,H),ot===null)throw Tn(re)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ot.getShaderPrecisionFormat===void 0&&(ot.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let fn,pn,Wt,On,bn,hn,an,ii,ui,mi,Zn,Nn,dn,zi,Se,fe,st,Et,Rt,qt,nn,ge,mt;function Ut(){fn=new kF(ot),pn=new CF(ot,fn,i),fn.init(pn),ge=new mO(ot,fn,pn),Wt=new fO(ot,fn,pn),On=new BF,bn=new tO,hn=new pO(ot,fn,Wt,bn,pn,ge,On),an=new IF(F),ii=new zF(F),ui=new Zz(ot,pn),mt=new TF(ot,fn,ui,pn),mi=new RF(ot,ui,On,mt),Zn=new VF(ot,mi,ui,On),Rt=new UF(ot,pn,hn),fe=new AF(bn),Nn=new eO(F,an,ii,fn,pn,mt,fe),dn=new vO(F,bn),zi=new iO,Se=new cO(fn,pn),Et=new MF(F,an,Wt,Zn,D,w),st=new dO(F,Zn,pn),qt=new EF(ot,fn,On,pn),nn=new FF(ot,fn,On,pn),On.programs=Nn.programs,F.capabilities=pn,F.extensions=fn,F.properties=bn,F.renderLists=zi,F.shadowMap=st,F.state=Wt,F.info=On}Ut();const Mt=new xO(F,ot);this.xr=Mt,this.getContext=function(){return ot},this.getContextAttributes=function(){return ot.getContextAttributes()},this.forceContextLoss=function(){const H=fn.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=fn.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return qe},this.setPixelRatio=function(H){H!==void 0&&(qe=H,this.setSize(Ae,Fe,!1))},this.getSize=function(H){return H.set(Ae,Fe)},this.setSize=function(H,re,te){if(Mt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ae=H,Fe=re,e.width=Math.floor(H*qe),e.height=Math.floor(re*qe),te!==!1&&(e.style.width=H+"px",e.style.height=re+"px"),this.setViewport(0,0,H,re)},this.getDrawingBufferSize=function(H){return H.set(Ae*qe,Fe*qe).floor()},this.setDrawingBufferSize=function(H,re,te){Ae=H,Fe=re,qe=te,e.width=Math.floor(H*te),e.height=Math.floor(re*te),this.setViewport(0,0,H,re)},this.getCurrentViewport=function(H){return H.copy(Ee)},this.getViewport=function(H){return H.copy(je)},this.setViewport=function(H,re,te,ce){H.isVector4?je.set(H.x,H.y,H.z,H.w):je.set(H,re,te,ce),Wt.viewport(Ee.copy(je).multiplyScalar(qe).floor())},this.getScissor=function(H){return H.copy(ut)},this.setScissor=function(H,re,te,ce){H.isVector4?ut.set(H.x,H.y,H.z,H.w):ut.set(H,re,te,ce),Wt.scissor(Te.copy(ut).multiplyScalar(qe).floor())},this.getScissorTest=function(){return tt},this.setScissorTest=function(H){Wt.setScissorTest(tt=H)},this.setOpaqueSort=function(H){Pt=H},this.setTransparentSort=function(H){xt=H},this.getClearColor=function(H){return H.copy(Et.getClearColor())},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(H=!0,re=!0,te=!0){let ce=0;H&&(ce|=16384),re&&(ce|=256),te&&(ce|=1024),ot.clear(ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ze,!1),e.removeEventListener("webglcontextrestored",Ft,!1),e.removeEventListener("webglcontextcreationerror",kt,!1),zi.dispose(),Se.dispose(),bn.dispose(),an.dispose(),ii.dispose(),Zn.dispose(),mt.dispose(),Nn.dispose(),Mt.dispose(),Mt.removeEventListener("sessionstart",qn),Mt.removeEventListener("sessionend",zn),Ze&&(Ze.dispose(),Ze=null),hi.stop()};function ze(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),B=!0}function Ft(){console.log("THREE.WebGLRenderer: Context Restored."),B=!1;const H=On.autoReset,re=st.enabled,te=st.autoUpdate,ce=st.needsUpdate,Ce=st.type;Ut(),On.autoReset=H,st.enabled=re,st.autoUpdate=te,st.needsUpdate=ce,st.type=Ce}function kt(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function un(H){const re=H.target;re.removeEventListener("dispose",un),Ht(re)}function Ht(H){rn(H),bn.remove(H)}function rn(H){const re=bn.get(H).programs;re!==void 0&&(re.forEach(function(te){Nn.releaseProgram(te)}),H.isShaderMaterial&&Nn.releaseShaderCache(H))}this.renderBufferDirect=function(H,re,te,ce,Ce,it){re===null&&(re=jt);const Xe=Ce.isMesh&&Ce.matrixWorld.determinant()<0,vt=ue(H,re,te,ce,Ce);Wt.setMaterial(ce,Xe);let bt=te.index;const At=te.attributes.position;if(bt===null){if(At===void 0||At.count===0)return}else if(bt.count===0)return;let Lt=1;ce.wireframe===!0&&(bt=mi.getWireframeAttribute(te),Lt=2),mt.setup(Ce,ce,vt,te,bt);let $t,sn=qt;bt!==null&&($t=ui.get(bt),sn=nn,sn.setIndex($t));const Un=bt!==null?bt.count:At.count,Pn=te.drawRange.start*Lt,Re=te.drawRange.count*Lt,_i=it!==null?it.start*Lt:0,cn=it!==null?it.count*Lt:1/0,Hi=Math.max(Pn,_i),Ei=Math.min(Un,Pn+Re,_i+cn)-1,gi=Math.max(0,Ei-Hi+1);if(gi!==0){if(Ce.isMesh)ce.wireframe===!0?(Wt.setLineWidth(ce.wireframeLinewidth*Xt()),sn.setMode(1)):sn.setMode(4);else if(Ce.isLine){let Fr=ce.linewidth;Fr===void 0&&(Fr=1),Wt.setLineWidth(Fr*Xt()),Ce.isLineSegments?sn.setMode(1):Ce.isLineLoop?sn.setMode(2):sn.setMode(3)}else Ce.isPoints?sn.setMode(0):Ce.isSprite&&sn.setMode(4);if(Ce.isInstancedMesh)sn.renderInstances(Hi,gi,Ce.count);else if(te.isInstancedBufferGeometry){const Fr=Math.min(te.instanceCount,te._maxInstanceCount);sn.renderInstances(Hi,gi,Fr)}else sn.render(Hi,gi)}},this.compile=function(H,re){k=Se.get(H),k.init(),Z.push(k),H.traverseVisible(function(te){te.isLight&&te.layers.test(re.layers)&&(k.pushLight(te),te.castShadow&&k.pushShadow(te))}),k.setupLights(F.physicallyCorrectLights),H.traverse(function(te){const ce=te.material;if(ce)if(Array.isArray(ce))for(let Ce=0;Ce<ce.length;Ce++){const it=ce[Ce];V(it,H,te)}else V(ce,H,te)}),Z.pop(),k=null};let Bt=null;function mn(H){Bt&&Bt(H)}function qn(){hi.stop()}function zn(){hi.start()}const hi=new OC;hi.setAnimationLoop(mn),typeof self!="undefined"&&hi.setContext(self),this.setAnimationLoop=function(H){Bt=H,Mt.setAnimationLoop(H),H===null?hi.stop():hi.start()},Mt.addEventListener("sessionstart",qn),Mt.addEventListener("sessionend",zn),this.render=function(H,re){if(re!==void 0&&re.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(B===!0)return;H.autoUpdate===!0&&H.updateMatrixWorld(),re.parent===null&&re.updateMatrixWorld(),Mt.enabled===!0&&Mt.isPresenting===!0&&(Mt.cameraAutoUpdate===!0&&Mt.updateCamera(re),re=Mt.getCamera()),H.isScene===!0&&H.onBeforeRender(F,H,re,ne),k=Se.get(H,Z.length),k.init(),Z.push(k),pt.multiplyMatrices(re.projectionMatrix,re.matrixWorldInverse),ct.setFromProjectionMatrix(pt),Ne=this.localClippingEnabled,Be=fe.init(this.clippingPlanes,Ne,re),P=zi.get(H,W.length),P.init(),W.push(P),Ki(H,re,0,F.sortObjects),P.finish(),F.sortObjects===!0&&P.sort(Pt,xt),Be===!0&&fe.beginShadows();const te=k.state.shadowsArray;if(st.render(te,H,re),Be===!0&&fe.endShadows(),this.info.autoReset===!0&&this.info.reset(),Et.render(P,H),k.setupLights(F.physicallyCorrectLights),re.isArrayCamera){const ce=re.cameras;for(let Ce=0,it=ce.length;Ce<it;Ce++){const Xe=ce[Ce];Vs(P,H,Xe,Xe.viewport)}}else Vs(P,H,re);ne!==null&&(hn.updateMultisampleRenderTarget(ne),hn.updateRenderTargetMipmap(ne)),H.isScene===!0&&H.onAfterRender(F,H,re),mt.resetDefaultState(),me=-1,K=null,Z.pop(),Z.length>0?k=Z[Z.length-1]:k=null,W.pop(),W.length>0?P=W[W.length-1]:P=null};function Ki(H,re,te,ce){if(H.visible===!1)return;if(H.layers.test(re.layers)){if(H.isGroup)te=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(re);else if(H.isLight)k.pushLight(H),H.castShadow&&k.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||ct.intersectsSprite(H)){ce&&gt.setFromMatrixPosition(H.matrixWorld).applyMatrix4(pt);const Xe=Zn.update(H),vt=H.material;vt.visible&&P.push(H,Xe,vt,te,gt.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(H.isSkinnedMesh&&H.skeleton.frame!==On.render.frame&&(H.skeleton.update(),H.skeleton.frame=On.render.frame),!H.frustumCulled||ct.intersectsObject(H))){ce&&gt.setFromMatrixPosition(H.matrixWorld).applyMatrix4(pt);const Xe=Zn.update(H),vt=H.material;if(Array.isArray(vt)){const bt=Xe.groups;for(let At=0,Lt=bt.length;At<Lt;At++){const $t=bt[At],sn=vt[$t.materialIndex];sn&&sn.visible&&P.push(H,Xe,sn,te,gt.z,$t)}}else vt.visible&&P.push(H,Xe,vt,te,gt.z,null)}}const it=H.children;for(let Xe=0,vt=it.length;Xe<vt;Xe++)Ki(it[Xe],re,te,ce)}function Vs(H,re,te,ce){const Ce=H.opaque,it=H.transmissive,Xe=H.transparent;k.setupLightsView(te),it.length>0&&sr(Ce,re,te),ce&&Wt.viewport(Ee.copy(ce)),Ce.length>0&&Eo(Ce,re,te),it.length>0&&Eo(it,re,te),Xe.length>0&&Eo(Xe,re,te),Wt.buffers.depth.setTest(!0),Wt.buffers.depth.setMask(!0),Wt.buffers.color.setMask(!0),Wt.setPolygonOffset(!1)}function sr(H,re,te){const ce=pn.isWebGL2;Ze===null&&(Ze=new El(1,1,{generateMipmaps:!0,type:fn.has("EXT_color_buffer_half_float")?vp:Wc,minFilter:iy,samples:ce&&_===!0?4:0})),F.getDrawingBufferSize(et),ce?Ze.setSize(et.x,et.y):Ze.setSize(Fv(et.x),Fv(et.y));const Ce=F.getRenderTarget();F.setRenderTarget(Ze),F.clear();const it=F.toneMapping;F.toneMapping=ya,Eo(H,re,te),F.toneMapping=it,hn.updateMultisampleRenderTarget(Ze),hn.updateRenderTargetMipmap(Ze),F.setRenderTarget(Ce)}function Eo(H,re,te){const ce=re.isScene===!0?re.overrideMaterial:null;for(let Ce=0,it=H.length;Ce<it;Ce++){const Xe=H[Ce],vt=Xe.object,bt=Xe.geometry,At=ce===null?Xe.material:ce,Lt=Xe.group;vt.layers.test(te.layers)&&he(vt,re,te,bt,At,Lt)}}function he(H,re,te,ce,Ce,it){H.onBeforeRender(F,re,te,ce,Ce,it),H.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),Ce.onBeforeRender(F,re,te,ce,H,it),Ce.transparent===!0&&Ce.side===Kh?(Ce.side=ds,Ce.needsUpdate=!0,F.renderBufferDirect(te,re,ce,Ce,H,it),Ce.side=yp,Ce.needsUpdate=!0,F.renderBufferDirect(te,re,ce,Ce,H,it),Ce.side=Kh):F.renderBufferDirect(te,re,ce,Ce,H,it),H.onAfterRender(F,re,te,ce,Ce,it)}function V(H,re,te){re.isScene!==!0&&(re=jt);const ce=bn.get(H),Ce=k.state.lights,it=k.state.shadowsArray,Xe=Ce.state.version,vt=Nn.getParameters(H,Ce.state,it,re,te),bt=Nn.getProgramCacheKey(vt);let At=ce.programs;ce.environment=H.isMeshStandardMaterial?re.environment:null,ce.fog=re.fog,ce.envMap=(H.isMeshStandardMaterial?ii:an).get(H.envMap||ce.environment),At===void 0&&(H.addEventListener("dispose",un),At=new Map,ce.programs=At);let Lt=At.get(bt);if(Lt!==void 0){if(ce.currentProgram===Lt&&ce.lightsStateVersion===Xe)return q(H,vt),Lt}else vt.uniforms=Nn.getUniforms(H),H.onBuild(te,vt,F),H.onBeforeCompile(vt,F),Lt=Nn.acquireProgram(vt,bt),At.set(bt,Lt),ce.uniforms=vt.uniforms;const $t=ce.uniforms;(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&($t.clippingPlanes=fe.uniform),q(H,vt),ce.needsLights=Pe(H),ce.lightsStateVersion=Xe,ce.needsLights&&($t.ambientLightColor.value=Ce.state.ambient,$t.lightProbe.value=Ce.state.probe,$t.directionalLights.value=Ce.state.directional,$t.directionalLightShadows.value=Ce.state.directionalShadow,$t.spotLights.value=Ce.state.spot,$t.spotLightShadows.value=Ce.state.spotShadow,$t.rectAreaLights.value=Ce.state.rectArea,$t.ltc_1.value=Ce.state.rectAreaLTC1,$t.ltc_2.value=Ce.state.rectAreaLTC2,$t.pointLights.value=Ce.state.point,$t.pointLightShadows.value=Ce.state.pointShadow,$t.hemisphereLights.value=Ce.state.hemi,$t.directionalShadowMap.value=Ce.state.directionalShadowMap,$t.directionalShadowMatrix.value=Ce.state.directionalShadowMatrix,$t.spotShadowMap.value=Ce.state.spotShadowMap,$t.spotShadowMatrix.value=Ce.state.spotShadowMatrix,$t.pointShadowMap.value=Ce.state.pointShadowMap,$t.pointShadowMatrix.value=Ce.state.pointShadowMatrix);const sn=Lt.getUniforms(),Un=hg.seqWithValue(sn.seq,$t);return ce.currentProgram=Lt,ce.uniformsList=Un,Lt}function q(H,re){const te=bn.get(H);te.outputEncoding=re.outputEncoding,te.instancing=re.instancing,te.skinning=re.skinning,te.morphTargets=re.morphTargets,te.morphNormals=re.morphNormals,te.morphColors=re.morphColors,te.morphTargetsCount=re.morphTargetsCount,te.numClippingPlanes=re.numClippingPlanes,te.numIntersection=re.numClipIntersection,te.vertexAlphas=re.vertexAlphas,te.vertexTangents=re.vertexTangents,te.toneMapping=re.toneMapping}function ue(H,re,te,ce,Ce){re.isScene!==!0&&(re=jt),hn.resetTextureUnits();const it=re.fog,Xe=ce.isMeshStandardMaterial?re.environment:null,vt=ne===null?F.outputEncoding:ne.isXRRenderTarget===!0?ne.texture.encoding:Hc,bt=(ce.isMeshStandardMaterial?ii:an).get(ce.envMap||Xe),At=ce.vertexColors===!0&&!!te.attributes.color&&te.attributes.color.itemSize===4,Lt=!!ce.normalMap&&!!te.attributes.tangent,$t=!!te.morphAttributes.position,sn=!!te.morphAttributes.normal,Un=!!te.morphAttributes.color,Pn=ce.toneMapped?F.toneMapping:ya,Re=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,_i=Re!==void 0?Re.length:0,cn=bn.get(ce),Hi=k.state.lights;if(Be===!0&&(Ne===!0||H!==K)){const Ci=H===K&&ce.id===me;fe.setState(ce,H,Ci)}let Ei=!1;ce.version===cn.__version?(cn.needsLights&&cn.lightsStateVersion!==Hi.state.version||cn.outputEncoding!==vt||Ce.isInstancedMesh&&cn.instancing===!1||!Ce.isInstancedMesh&&cn.instancing===!0||Ce.isSkinnedMesh&&cn.skinning===!1||!Ce.isSkinnedMesh&&cn.skinning===!0||cn.envMap!==bt||ce.fog===!0&&cn.fog!==it||cn.numClippingPlanes!==void 0&&(cn.numClippingPlanes!==fe.numPlanes||cn.numIntersection!==fe.numIntersection)||cn.vertexAlphas!==At||cn.vertexTangents!==Lt||cn.morphTargets!==$t||cn.morphNormals!==sn||cn.morphColors!==Un||cn.toneMapping!==Pn||pn.isWebGL2===!0&&cn.morphTargetsCount!==_i)&&(Ei=!0):(Ei=!0,cn.__version=ce.version);let gi=cn.currentProgram;Ei===!0&&(gi=V(ce,re,Ce));let Fr=!1,_s=!1,Wo=!1;const wt=gi.getUniforms(),Sn=cn.uniforms;if(Wt.useProgram(gi.program)&&(Fr=!0,_s=!0,Wo=!0),ce.id!==me&&(me=ce.id,_s=!0),Fr||K!==H){if(wt.setValue(ot,"projectionMatrix",H.projectionMatrix),pn.logarithmicDepthBuffer&&wt.setValue(ot,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),K!==H&&(K=H,_s=!0,Wo=!0),ce.isShaderMaterial||ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshStandardMaterial||ce.envMap){const Ci=wt.map.cameraPosition;Ci!==void 0&&Ci.setValue(ot,gt.setFromMatrixPosition(H.matrixWorld))}(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial)&&wt.setValue(ot,"isOrthographic",H.isOrthographicCamera===!0),(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial||ce.isShadowMaterial||Ce.isSkinnedMesh)&&wt.setValue(ot,"viewMatrix",H.matrixWorldInverse)}if(Ce.isSkinnedMesh){wt.setOptional(ot,Ce,"bindMatrix"),wt.setOptional(ot,Ce,"bindMatrixInverse");const Ci=Ce.skeleton;Ci&&(pn.floatVertexTextures?(Ci.boneTexture===null&&Ci.computeBoneTexture(),wt.setValue(ot,"boneTexture",Ci.boneTexture,hn),wt.setValue(ot,"boneTextureSize",Ci.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const _n=te.morphAttributes;return(_n.position!==void 0||_n.normal!==void 0||_n.color!==void 0&&pn.isWebGL2===!0)&&Rt.update(Ce,te,ce,gi),(_s||cn.receiveShadow!==Ce.receiveShadow)&&(cn.receiveShadow=Ce.receiveShadow,wt.setValue(ot,"receiveShadow",Ce.receiveShadow)),_s&&(wt.setValue(ot,"toneMappingExposure",F.toneMappingExposure),cn.needsLights&&xe(Sn,Wo),it&&ce.fog===!0&&dn.refreshFogUniforms(Sn,it),dn.refreshMaterialUniforms(Sn,ce,qe,Fe,Ze),hg.upload(ot,cn.uniformsList,Sn,hn)),ce.isShaderMaterial&&ce.uniformsNeedUpdate===!0&&(hg.upload(ot,cn.uniformsList,Sn,hn),ce.uniformsNeedUpdate=!1),ce.isSpriteMaterial&&wt.setValue(ot,"center",Ce.center),wt.setValue(ot,"modelViewMatrix",Ce.modelViewMatrix),wt.setValue(ot,"normalMatrix",Ce.normalMatrix),wt.setValue(ot,"modelMatrix",Ce.matrixWorld),gi}function xe(H,re){H.ambientLightColor.needsUpdate=re,H.lightProbe.needsUpdate=re,H.directionalLights.needsUpdate=re,H.directionalLightShadows.needsUpdate=re,H.pointLights.needsUpdate=re,H.pointLightShadows.needsUpdate=re,H.spotLights.needsUpdate=re,H.spotLightShadows.needsUpdate=re,H.rectAreaLights.needsUpdate=re,H.hemisphereLights.needsUpdate=re}function Pe(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return ne},this.setRenderTargetTextures=function(H,re,te){bn.get(H.texture).__webglTexture=re,bn.get(H.depthTexture).__webglTexture=te;const ce=bn.get(H);ce.__hasExternalTextures=!0,ce.__hasExternalTextures&&(ce.__autoAllocateDepthBuffer=te===void 0,ce.__autoAllocateDepthBuffer||fn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ce.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(H,re){const te=bn.get(H);te.__webglFramebuffer=re,te.__useDefaultFramebuffer=re===void 0},this.setRenderTarget=function(H,re=0,te=0){ne=H,G=re,$=te;let ce=!0;if(H){const bt=bn.get(H);bt.__useDefaultFramebuffer!==void 0?(Wt.bindFramebuffer(36160,null),ce=!1):bt.__webglFramebuffer===void 0?hn.setupRenderTarget(H):bt.__hasExternalTextures&&hn.rebindTextures(H,bn.get(H.texture).__webglTexture,bn.get(H.depthTexture).__webglTexture)}let Ce=null,it=!1,Xe=!1;if(H){const bt=H.texture;(bt.isData3DTexture||bt.isDataArrayTexture)&&(Xe=!0);const At=bn.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Ce=At[re],it=!0):pn.isWebGL2&&H.samples>0&&hn.useMultisampledRTT(H)===!1?Ce=bn.get(H).__webglMultisampledFramebuffer:Ce=At,Ee.copy(H.viewport),Te.copy(H.scissor),ee=H.scissorTest}else Ee.copy(je).multiplyScalar(qe).floor(),Te.copy(ut).multiplyScalar(qe).floor(),ee=tt;if(Wt.bindFramebuffer(36160,Ce)&&pn.drawBuffers&&ce&&Wt.drawBuffers(H,Ce),Wt.viewport(Ee),Wt.scissor(Te),Wt.setScissorTest(ee),it){const bt=bn.get(H.texture);ot.framebufferTexture2D(36160,36064,34069+re,bt.__webglTexture,te)}else if(Xe){const bt=bn.get(H.texture),At=re||0;ot.framebufferTextureLayer(36160,36064,bt.__webglTexture,te||0,At)}me=-1},this.readRenderTargetPixels=function(H,re,te,ce,Ce,it,Xe){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let vt=bn.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&Xe!==void 0&&(vt=vt[Xe]),vt){Wt.bindFramebuffer(36160,vt);try{const bt=H.texture,At=bt.format,Lt=bt.type;if(At!==cs&&ge.convert(At)!==ot.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const $t=Lt===vp&&(fn.has("EXT_color_buffer_half_float")||pn.isWebGL2&&fn.has("EXT_color_buffer_float"));if(Lt!==Wc&&ge.convert(Lt)!==ot.getParameter(35738)&&!(Lt===Dc&&(pn.isWebGL2||fn.has("OES_texture_float")||fn.has("WEBGL_color_buffer_float")))&&!$t){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}re>=0&&re<=H.width-ce&&te>=0&&te<=H.height-Ce&&ot.readPixels(re,te,ce,Ce,ge.convert(At),ge.convert(Lt),it)}finally{const bt=ne!==null?bn.get(ne).__webglFramebuffer:null;Wt.bindFramebuffer(36160,bt)}}},this.copyFramebufferToTexture=function(H,re,te=0){const ce=Math.pow(2,-te),Ce=Math.floor(re.image.width*ce),it=Math.floor(re.image.height*ce);hn.setTexture2D(re,0),ot.copyTexSubImage2D(3553,te,0,0,H.x,H.y,Ce,it),Wt.unbindTexture()},this.copyTextureToTexture=function(H,re,te,ce=0){const Ce=re.image.width,it=re.image.height,Xe=ge.convert(te.format),vt=ge.convert(te.type);hn.setTexture2D(te,0),ot.pixelStorei(37440,te.flipY),ot.pixelStorei(37441,te.premultiplyAlpha),ot.pixelStorei(3317,te.unpackAlignment),re.isDataTexture?ot.texSubImage2D(3553,ce,H.x,H.y,Ce,it,Xe,vt,re.image.data):re.isCompressedTexture?ot.compressedTexSubImage2D(3553,ce,H.x,H.y,re.mipmaps[0].width,re.mipmaps[0].height,Xe,re.mipmaps[0].data):ot.texSubImage2D(3553,ce,H.x,H.y,Xe,vt,re.image),ce===0&&te.generateMipmaps&&ot.generateMipmap(3553),Wt.unbindTexture()},this.copyTextureToTexture3D=function(H,re,te,ce,Ce=0){if(F.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const it=H.max.x-H.min.x+1,Xe=H.max.y-H.min.y+1,vt=H.max.z-H.min.z+1,bt=ge.convert(ce.format),At=ge.convert(ce.type);let Lt;if(ce.isData3DTexture)hn.setTexture3D(ce,0),Lt=32879;else if(ce.isDataArrayTexture)hn.setTexture2DArray(ce,0),Lt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ot.pixelStorei(37440,ce.flipY),ot.pixelStorei(37441,ce.premultiplyAlpha),ot.pixelStorei(3317,ce.unpackAlignment);const $t=ot.getParameter(3314),sn=ot.getParameter(32878),Un=ot.getParameter(3316),Pn=ot.getParameter(3315),Re=ot.getParameter(32877),_i=te.isCompressedTexture?te.mipmaps[0]:te.image;ot.pixelStorei(3314,_i.width),ot.pixelStorei(32878,_i.height),ot.pixelStorei(3316,H.min.x),ot.pixelStorei(3315,H.min.y),ot.pixelStorei(32877,H.min.z),te.isDataTexture||te.isData3DTexture?ot.texSubImage3D(Lt,Ce,re.x,re.y,re.z,it,Xe,vt,bt,At,_i.data):te.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ot.compressedTexSubImage3D(Lt,Ce,re.x,re.y,re.z,it,Xe,vt,bt,_i.data)):ot.texSubImage3D(Lt,Ce,re.x,re.y,re.z,it,Xe,vt,bt,At,_i),ot.pixelStorei(3314,$t),ot.pixelStorei(32878,sn),ot.pixelStorei(3316,Un),ot.pixelStorei(3315,Pn),ot.pixelStorei(32877,Re),Ce===0&&ce.generateMipmaps&&ot.generateMipmap(Lt),Wt.unbindTexture()},this.initTexture=function(H){hn.setTexture2D(H,0),Wt.unbindTexture()},this.resetState=function(){G=0,$=0,ne=null,Wt.reset(),mt.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class bO extends $C{}bO.prototype.isWebGL1Renderer=!0;class SO extends uo{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),n}}class MO extends Sr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ln(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class qC extends Sr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ln(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class TO extends Sr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ln(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}new Ye;new Ye;new Ye;new Ye;new Fs;class EO extends Sr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ln(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class CO extends Sa{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ZC extends Sr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ln(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=od,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class AO extends ZC{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new In(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ur(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ln(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ln(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ln(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class IO extends Sr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ln(16777215),this.specular=new Ln(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=od,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ty,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PO extends Sr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ln(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=od,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class LO extends Sr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=od,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class XC extends Sr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ln(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ln(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ty,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class DO extends Sr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ln(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=od,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zO extends qC{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const kO={ShadowMaterial:EO,SpriteMaterial:MO,RawShaderMaterial:CO,ShaderMaterial:Sa,PointsMaterial:TO,MeshPhysicalMaterial:AO,MeshStandardMaterial:ZC,MeshPhongMaterial:IO,MeshToonMaterial:PO,MeshNormalMaterial:LO,MeshLambertMaterial:XC,MeshDepthMaterial:WC,MeshDistanceMaterial:HC,MeshBasicMaterial:G1,MeshMatcapMaterial:DO,LineDashedMaterial:zO,LineBasicMaterial:qC,Material:Sr};Sr.fromType=function(i){return new kO[i]};const W2={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class RO{constructor(e,n,l){const d=this;let _=!1,w=0,a=0,T;const A=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=l,this.itemStart=function(D){a++,_===!1&&d.onStart!==void 0&&d.onStart(D,w,a),_=!0},this.itemEnd=function(D){w++,d.onProgress!==void 0&&d.onProgress(D,w,a),w===a&&(_=!1,d.onLoad!==void 0&&d.onLoad())},this.itemError=function(D){d.onError!==void 0&&d.onError(D)},this.resolveURL=function(D){return T?T(D):D},this.setURLModifier=function(D){return T=D,this},this.addHandler=function(D,P){return A.push(D,P),this},this.removeHandler=function(D){const P=A.indexOf(D);return P!==-1&&A.splice(P,2),this},this.getHandler=function(D){for(let P=0,k=A.length;P<k;P+=2){const W=A[P],Z=A[P+1];if(W.global&&(W.lastIndex=0),W.test(D))return Z}return null}}}const FO=new RO;class YC{constructor(e){this.manager=e!==void 0?e:FO,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const l=this;return new Promise(function(d,_){l.load(e,d,n,_)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}class BO extends YC{constructor(e){super(e)}load(e,n,l,d){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const _=this,w=W2.get(e);if(w!==void 0)return _.manager.itemStart(e),setTimeout(function(){n&&n(w),_.manager.itemEnd(e)},0),w;const a=wp("img");function T(){D(),W2.add(e,this),n&&n(this),_.manager.itemEnd(e)}function A(P){D(),d&&d(P),_.manager.itemError(e),_.manager.itemEnd(e)}function D(){a.removeEventListener("load",T,!1),a.removeEventListener("error",A,!1)}return a.addEventListener("load",T,!1),a.addEventListener("error",A,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),_.manager.itemStart(e),a.src=e,a}}class OO extends YC{constructor(e){super(e)}load(e,n,l,d){const _=new jo,w=new BO(this.manager);return w.setCrossOrigin(this.crossOrigin),w.setPath(this.path),w.load(e,function(a){_.image=a,_.needsUpdate=!0,n!==void 0&&n(_)},l,d),_}}class KC extends uo{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new Ln(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n}}const H2=new pr,$2=new Ye,q2=new Ye;class NO{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new In(512,512),this.map=null,this.mapPass=null,this.matrix=new pr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new j1,this._frameExtents=new In(1,1),this._viewportCount=1,this._viewports=[new vr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,l=this.matrix;$2.setFromMatrixPosition(e.matrixWorld),n.position.copy($2),q2.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(q2),n.updateMatrixWorld(),H2.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(H2),l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(n.projectionMatrix),l.multiply(n.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class UO extends NO{constructor(){super(new vo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,l=Rv*2*e.angle*this.focus,d=this.mapSize.width/this.mapSize.height,_=e.distance||n.far;(l!==n.fov||d!==n.aspect||_!==n.far)&&(n.fov=l,n.aspect=d,n.far=_,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class VO extends KC{constructor(e,n,l=0,d=Math.PI/3,_=0,w=1){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(uo.DefaultUp),this.updateMatrix(),this.target=new uo,this.distance=l,this.angle=d,this.penumbra=_,this.decay=w,this.shadow=new UO}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class GO extends KC{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class jO{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Z2(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=Z2();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function Z2(){return(typeof performance=="undefined"?Date:performance).now()}const JC="\\[\\]\\.:\\/",H1="[^"+JC+"]",WO="[^"+JC.replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",H1);/(WCOD+)?/.source.replace("WCOD",WO);/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",H1);/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",H1);class X2{constructor(e=1,n=0,l=0){return this.radius=e,this.phi=n,this.theta=l,this}set(e,n,l){return this.radius=e,this.phi=n,this.theta=l,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,l){return this.radius=Math.sqrt(e*e+n*n+l*l),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,l),this.phi=Math.acos(Ur(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const Ps=new Uint32Array(512),Ls=new Uint32Array(512);for(let i=0;i<256;++i){const e=i-127;e<-27?(Ps[i]=0,Ps[i|256]=32768,Ls[i]=24,Ls[i|256]=24):e<-14?(Ps[i]=1024>>-e-14,Ps[i|256]=1024>>-e-14|32768,Ls[i]=-e-1,Ls[i|256]=-e-1):e<=15?(Ps[i]=e+15<<10,Ps[i|256]=e+15<<10|32768,Ls[i]=13,Ls[i|256]=13):e<128?(Ps[i]=31744,Ps[i|256]=64512,Ls[i]=24,Ls[i|256]=24):(Ps[i]=31744,Ps[i|256]=64512,Ls[i]=13,Ls[i|256]=13)}const QC=new Uint32Array(2048),Dp=new Uint32Array(64),HO=new Uint32Array(64);for(let i=1;i<1024;++i){let e=i<<13,n=0;for(;(e&8388608)===0;)e<<=1,n-=8388608;e&=-8388609,n+=947912704,QC[i]=e|n}for(let i=1024;i<2048;++i)QC[i]=939524096+(i-1024<<13);for(let i=1;i<31;++i)Dp[i]=i<<23;Dp[31]=1199570944;Dp[32]=2147483648;for(let i=33;i<63;++i)Dp[i]=2147483648+(i-32<<23);Dp[63]=3347054592;for(let i=1;i<64;++i)i!==32&&(HO[i]=1024);typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:U1}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=U1);function $O(i){if(!!i&&typeof window!="undefined"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=i,document.head.appendChild(e),i}}function kh(i,e){var n=i.__state.conversionName.toString(),l=Math.round(i.r),d=Math.round(i.g),_=Math.round(i.b),w=i.a,a=Math.round(i.h),T=i.s.toFixed(1),A=i.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var D=i.hex.toString(16);D.length<6;)D="0"+D;return"#"+D}else{if(n==="CSS_RGB")return"rgb("+l+","+d+","+_+")";if(n==="CSS_RGBA")return"rgba("+l+","+d+","+_+","+w+")";if(n==="HEX")return"0x"+i.hex.toString(16);if(n==="RGB_ARRAY")return"["+l+","+d+","+_+"]";if(n==="RGBA_ARRAY")return"["+l+","+d+","+_+","+w+"]";if(n==="RGB_OBJ")return"{r:"+l+",g:"+d+",b:"+_+"}";if(n==="RGBA_OBJ")return"{r:"+l+",g:"+d+",b:"+_+",a:"+w+"}";if(n==="HSV_OBJ")return"{h:"+a+",s:"+T+",v:"+A+"}";if(n==="HSVA_OBJ")return"{h:"+a+",s:"+T+",v:"+A+",a:"+w+"}"}return"unknown format"}var Y2=Array.prototype.forEach,kf=Array.prototype.slice,yt={BREAK:{},extend:function(e){return this.each(kf.call(arguments,1),function(n){var l=this.isObject(n)?Object.keys(n):[];l.forEach(function(d){this.isUndefined(n[d])||(e[d]=n[d])}.bind(this))},this),e},defaults:function(e){return this.each(kf.call(arguments,1),function(n){var l=this.isObject(n)?Object.keys(n):[];l.forEach(function(d){this.isUndefined(e[d])&&(e[d]=n[d])}.bind(this))},this),e},compose:function(){var e=kf.call(arguments);return function(){for(var n=kf.call(arguments),l=e.length-1;l>=0;l--)n=[e[l].apply(this,n)];return n[0]}},each:function(e,n,l){if(!!e){if(Y2&&e.forEach&&e.forEach===Y2)e.forEach(n,l);else if(e.length===e.length+0){var d=void 0,_=void 0;for(d=0,_=e.length;d<_;d++)if(d in e&&n.call(l,e[d],d)===this.BREAK)return}else for(var w in e)if(n.call(l,e[w],w)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,n,l){var d=void 0;return function(){var _=this,w=arguments;function a(){d=null,l||e.apply(_,w)}var T=l||!d;clearTimeout(d),d=setTimeout(a,n),T&&e.apply(_,w)}},toArray:function(e){return e.toArray?e.toArray():kf.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(i){function e(n){return i.apply(this,arguments)}return e.toString=function(){return i.toString()},e}(function(i){return isNaN(i)}),isArray:Array.isArray||function(i){return i.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},qO=[{litmus:yt.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:kh},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:kh},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:kh},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:kh}}},{litmus:yt.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:yt.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:yt.isObject,conversions:{RGBA_OBJ:{read:function(e){return yt.isNumber(e.r)&&yt.isNumber(e.g)&&yt.isNumber(e.b)&&yt.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return yt.isNumber(e.r)&&yt.isNumber(e.g)&&yt.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return yt.isNumber(e.h)&&yt.isNumber(e.s)&&yt.isNumber(e.v)&&yt.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return yt.isNumber(e.h)&&yt.isNumber(e.s)&&yt.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Rf=void 0,X_=void 0,Ov=function(){X_=!1;var e=arguments.length>1?yt.toArray(arguments):arguments[0];return yt.each(qO,function(n){if(n.litmus(e))return yt.each(n.conversions,function(l,d){if(Rf=l.read(e),X_===!1&&Rf!==!1)return X_=Rf,Rf.conversionName=d,Rf.conversion=l,yt.BREAK}),yt.BREAK}),X_},K2=void 0,Bg={hsv_to_rgb:function(e,n,l){var d=Math.floor(e/60)%6,_=e/60-Math.floor(e/60),w=l*(1-n),a=l*(1-_*n),T=l*(1-(1-_)*n),A=[[l,T,w],[a,l,w],[w,l,T],[w,a,l],[T,w,l],[l,w,a]][d];return{r:A[0]*255,g:A[1]*255,b:A[2]*255}},rgb_to_hsv:function(e,n,l){var d=Math.min(e,n,l),_=Math.max(e,n,l),w=_-d,a=void 0,T=void 0;if(_!==0)T=w/_;else return{h:NaN,s:0,v:0};return e===_?a=(n-l)/w:n===_?a=2+(l-e)/w:a=4+(e-n)/w,a/=6,a<0&&(a+=1),{h:a*360,s:T,v:_/255}},rgb_to_hex:function(e,n,l){var d=this.hex_with_component(0,2,e);return d=this.hex_with_component(d,1,n),d=this.hex_with_component(d,0,l),d},component_from_hex:function(e,n){return e>>n*8&255},hex_with_component:function(e,n,l){return l<<(K2=n*8)|e&~(255<<K2)}},ZO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},ps=function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")},ms=function(){function i(e,n){for(var l=0;l<n.length;l++){var d=n[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(e,d.key,d)}}return function(e,n,l){return n&&i(e.prototype,n),l&&i(e,l),e}}(),Pl=function i(e,n,l){e===null&&(e=Function.prototype);var d=Object.getOwnPropertyDescriptor(e,n);if(d===void 0){var _=Object.getPrototypeOf(e);return _===null?void 0:i(_,n,l)}else{if("value"in d)return d.value;var w=d.get;return w===void 0?void 0:w.call(l)}},kl=function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(i,e):i.__proto__=e)},Rl=function(i,e){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:i},mr=function(){function i(){if(ps(this,i),this.__state=Ov.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ms(i,[{key:"toString",value:function(){return kh(this)}},{key:"toHexString",value:function(){return kh(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),i}();function $1(i,e,n){Object.defineProperty(i,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(mr.recalculateRGB(this,e,n),this.__state[e])},set:function(d){this.__state.space!=="RGB"&&(mr.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=d}})}function q1(i,e){Object.defineProperty(i,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(mr.recalculateHSV(this),this.__state[e])},set:function(l){this.__state.space!=="HSV"&&(mr.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=l}})}mr.recalculateRGB=function(i,e,n){if(i.__state.space==="HEX")i.__state[e]=Bg.component_from_hex(i.__state.hex,n);else if(i.__state.space==="HSV")yt.extend(i.__state,Bg.hsv_to_rgb(i.__state.h,i.__state.s,i.__state.v));else throw new Error("Corrupted color state")};mr.recalculateHSV=function(i){var e=Bg.rgb_to_hsv(i.r,i.g,i.b);yt.extend(i.__state,{s:e.s,v:e.v}),yt.isNaN(e.h)?yt.isUndefined(i.__state.h)&&(i.__state.h=0):i.__state.h=e.h};mr.COMPONENTS=["r","g","b","h","s","v","hex","a"];$1(mr.prototype,"r",2);$1(mr.prototype,"g",1);$1(mr.prototype,"b",0);q1(mr.prototype,"h");q1(mr.prototype,"s");q1(mr.prototype,"v");Object.defineProperty(mr.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(mr.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=Bg.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Kc=function(){function i(e,n){ps(this,i),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return ms(i,[{key:"onChange",value:function(n){return this.__onChange=n,this}},{key:"onFinishChange",value:function(n){return this.__onFinishChange=n,this}},{key:"setValue",value:function(n){return this.object[this.property]=n,this.__onChange&&this.__onChange.call(this,n),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),i}(),XO={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},eA={};yt.each(XO,function(i,e){yt.each(i,function(n){eA[n]=e})});var YO=/(\d+(\.\d+)?)px/;function Ds(i){if(i==="0"||yt.isUndefined(i))return 0;var e=i.match(YO);return yt.isNull(e)?0:parseFloat(e[1])}var Je={makeSelectable:function(e,n){e===void 0||e.style===void 0||(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,l){var d=l,_=n;yt.isUndefined(_)&&(_=!0),yt.isUndefined(d)&&(d=!0),e.style.position="absolute",_&&(e.style.left=0,e.style.right=0),d&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,l,d){var _=l||{},w=eA[n];if(!w)throw new Error("Event type "+n+" not supported.");var a=document.createEvent(w);switch(w){case"MouseEvents":{var T=_.x||_.clientX||0,A=_.y||_.clientY||0;a.initMouseEvent(n,_.bubbles||!1,_.cancelable||!0,window,_.clickCount||1,0,0,T,A,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var D=a.initKeyboardEvent||a.initKeyEvent;yt.defaults(_,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),D(n,_.bubbles||!1,_.cancelable,window,_.ctrlKey,_.altKey,_.shiftKey,_.metaKey,_.keyCode,_.charCode);break}default:{a.initEvent(n,_.bubbles||!1,_.cancelable||!0);break}}yt.defaults(a,d),e.dispatchEvent(a)},bind:function(e,n,l,d){var _=d||!1;return e.addEventListener?e.addEventListener(n,l,_):e.attachEvent&&e.attachEvent("on"+n,l),Je},unbind:function(e,n,l,d){var _=d||!1;return e.removeEventListener?e.removeEventListener(n,l,_):e.detachEvent&&e.detachEvent("on"+n,l),Je},addClass:function(e,n){if(e.className===void 0)e.className=n;else if(e.className!==n){var l=e.className.split(/ +/);l.indexOf(n)===-1&&(l.push(n),e.className=l.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Je},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var l=e.className.split(/ +/),d=l.indexOf(n);d!==-1&&(l.splice(d,1),e.className=l.join(" "))}else e.className=void 0;return Je},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return Ds(n["border-left-width"])+Ds(n["border-right-width"])+Ds(n["padding-left"])+Ds(n["padding-right"])+Ds(n.width)},getHeight:function(e){var n=getComputedStyle(e);return Ds(n["border-top-width"])+Ds(n["border-bottom-width"])+Ds(n["padding-top"])+Ds(n["padding-bottom"])+Ds(n.height)},getOffset:function(e){var n=e,l={left:0,top:0};if(n.offsetParent)do l.left+=n.offsetLeft,l.top+=n.offsetTop,n=n.offsetParent;while(n);return l},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},tA=function(i){kl(e,i);function e(n,l){ps(this,e);var d=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l)),_=d;d.__prev=d.getValue(),d.__checkbox=document.createElement("input"),d.__checkbox.setAttribute("type","checkbox");function w(){_.setValue(!_.__prev)}return Je.bind(d.__checkbox,"change",w,!1),d.domElement.appendChild(d.__checkbox),d.updateDisplay(),d}return ms(e,[{key:"setValue",value:function(l){var d=Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,l);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),d}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Kc),KO=function(i){kl(e,i);function e(n,l,d){ps(this,e);var _=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l)),w=d,a=_;if(_.__select=document.createElement("select"),yt.isArray(w)){var T={};yt.each(w,function(A){T[A]=A}),w=T}return yt.each(w,function(A,D){var P=document.createElement("option");P.innerHTML=D,P.setAttribute("value",A),a.__select.appendChild(P)}),_.updateDisplay(),Je.bind(_.__select,"change",function(){var A=this.options[this.selectedIndex].value;a.setValue(A)}),_.domElement.appendChild(_.__select),_}return ms(e,[{key:"setValue",value:function(l){var d=Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,l);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),d}},{key:"updateDisplay",value:function(){return Je.isActive(this.__select)?this:(this.__select.value=this.getValue(),Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Kc),JO=function(i){kl(e,i);function e(n,l){ps(this,e);var d=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l)),_=d;function w(){_.setValue(_.__input.value)}function a(){_.__onFinishChange&&_.__onFinishChange.call(_,_.getValue())}return d.__input=document.createElement("input"),d.__input.setAttribute("type","text"),Je.bind(d.__input,"keyup",w),Je.bind(d.__input,"change",w),Je.bind(d.__input,"blur",a),Je.bind(d.__input,"keydown",function(T){T.keyCode===13&&this.blur()}),d.updateDisplay(),d.domElement.appendChild(d.__input),d}return ms(e,[{key:"updateDisplay",value:function(){return Je.isActive(this.__input)||(this.__input.value=this.getValue()),Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Kc);function J2(i){var e=i.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var nA=function(i){kl(e,i);function e(n,l,d){ps(this,e);var _=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l)),w=d||{};return _.__min=w.min,_.__max=w.max,_.__step=w.step,yt.isUndefined(_.__step)?_.initialValue===0?_.__impliedStep=1:_.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(_.initialValue))/Math.LN10))/10:_.__impliedStep=_.__step,_.__precision=J2(_.__impliedStep),_}return ms(e,[{key:"setValue",value:function(l){var d=l;return this.__min!==void 0&&d<this.__min?d=this.__min:this.__max!==void 0&&d>this.__max&&(d=this.__max),this.__step!==void 0&&d%this.__step!==0&&(d=Math.round(d/this.__step)*this.__step),Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,d)}},{key:"min",value:function(l){return this.__min=l,this}},{key:"max",value:function(l){return this.__max=l,this}},{key:"step",value:function(l){return this.__step=l,this.__impliedStep=l,this.__precision=J2(l),this}}]),e}(Kc);function QO(i,e){var n=Math.pow(10,e);return Math.round(i*n)/n}var Og=function(i){kl(e,i);function e(n,l,d){ps(this,e);var _=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l,d));_.__truncationSuspended=!1;var w=_,a=void 0;function T(){var Z=parseFloat(w.__input.value);yt.isNaN(Z)||w.setValue(Z)}function A(){w.__onFinishChange&&w.__onFinishChange.call(w,w.getValue())}function D(){A()}function P(Z){var F=a-Z.clientY;w.setValue(w.getValue()+F*w.__impliedStep),a=Z.clientY}function k(){Je.unbind(window,"mousemove",P),Je.unbind(window,"mouseup",k),A()}function W(Z){Je.bind(window,"mousemove",P),Je.bind(window,"mouseup",k),a=Z.clientY}return _.__input=document.createElement("input"),_.__input.setAttribute("type","text"),Je.bind(_.__input,"change",T),Je.bind(_.__input,"blur",D),Je.bind(_.__input,"mousedown",W),Je.bind(_.__input,"keydown",function(Z){Z.keyCode===13&&(w.__truncationSuspended=!0,this.blur(),w.__truncationSuspended=!1,A())}),_.updateDisplay(),_.domElement.appendChild(_.__input),_}return ms(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():QO(this.getValue(),this.__precision),Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(nA);function Q2(i,e,n,l,d){return l+(d-l)*((i-e)/(n-e))}var Nv=function(i){kl(e,i);function e(n,l,d,_,w){ps(this,e);var a=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l,{min:d,max:_,step:w})),T=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),Je.bind(a.__background,"mousedown",A),Je.bind(a.__background,"touchstart",k),Je.addClass(a.__background,"slider"),Je.addClass(a.__foreground,"slider-fg");function A(F){document.activeElement.blur(),Je.bind(window,"mousemove",D),Je.bind(window,"mouseup",P),D(F)}function D(F){F.preventDefault();var B=T.__background.getBoundingClientRect();return T.setValue(Q2(F.clientX,B.left,B.right,T.__min,T.__max)),!1}function P(){Je.unbind(window,"mousemove",D),Je.unbind(window,"mouseup",P),T.__onFinishChange&&T.__onFinishChange.call(T,T.getValue())}function k(F){F.touches.length===1&&(Je.bind(window,"touchmove",W),Je.bind(window,"touchend",Z),W(F))}function W(F){var B=F.touches[0].clientX,G=T.__background.getBoundingClientRect();T.setValue(Q2(B,G.left,G.right,T.__min,T.__max))}function Z(){Je.unbind(window,"touchmove",W),Je.unbind(window,"touchend",Z),T.__onFinishChange&&T.__onFinishChange.call(T,T.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return ms(e,[{key:"updateDisplay",value:function(){var l=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=l*100+"%",Pl(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(nA),iA=function(i){kl(e,i);function e(n,l,d){ps(this,e);var _=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l)),w=_;return _.__button=document.createElement("div"),_.__button.innerHTML=d===void 0?"Fire":d,Je.bind(_.__button,"click",function(a){return a.preventDefault(),w.fire(),!1}),Je.addClass(_.__button,"button"),_.domElement.appendChild(_.__button),_}return ms(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Kc),Uv=function(i){kl(e,i);function e(n,l){ps(this,e);var d=Rl(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,l));d.__color=new mr(d.getValue()),d.__temp=new mr(0);var _=d;d.domElement=document.createElement("div"),Je.makeSelectable(d.domElement,!1),d.__selector=document.createElement("div"),d.__selector.className="selector",d.__saturation_field=document.createElement("div"),d.__saturation_field.className="saturation-field",d.__field_knob=document.createElement("div"),d.__field_knob.className="field-knob",d.__field_knob_border="2px solid ",d.__hue_knob=document.createElement("div"),d.__hue_knob.className="hue-knob",d.__hue_field=document.createElement("div"),d.__hue_field.className="hue-field",d.__input=document.createElement("input"),d.__input.type="text",d.__input_textShadow="0 1px 1px ",Je.bind(d.__input,"keydown",function(F){F.keyCode===13&&P.call(this)}),Je.bind(d.__input,"blur",P),Je.bind(d.__selector,"mousedown",function(){Je.addClass(this,"drag").bind(window,"mouseup",function(){Je.removeClass(_.__selector,"drag")})}),Je.bind(d.__selector,"touchstart",function(){Je.addClass(this,"drag").bind(window,"touchend",function(){Je.removeClass(_.__selector,"drag")})});var w=document.createElement("div");yt.extend(d.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),yt.extend(d.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:d.__field_knob_border+(d.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),yt.extend(d.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),yt.extend(d.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),yt.extend(w.style,{width:"100%",height:"100%",background:"none"}),eT(w,"top","rgba(0,0,0,0)","#000"),yt.extend(d.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),t4(d.__hue_field),yt.extend(d.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:d.__input_textShadow+"rgba(0,0,0,0.7)"}),Je.bind(d.__saturation_field,"mousedown",a),Je.bind(d.__saturation_field,"touchstart",a),Je.bind(d.__field_knob,"mousedown",a),Je.bind(d.__field_knob,"touchstart",a),Je.bind(d.__hue_field,"mousedown",T),Je.bind(d.__hue_field,"touchstart",T);function a(F){W(F),Je.bind(window,"mousemove",W),Je.bind(window,"touchmove",W),Je.bind(window,"mouseup",A),Je.bind(window,"touchend",A)}function T(F){Z(F),Je.bind(window,"mousemove",Z),Je.bind(window,"touchmove",Z),Je.bind(window,"mouseup",D),Je.bind(window,"touchend",D)}function A(){Je.unbind(window,"mousemove",W),Je.unbind(window,"touchmove",W),Je.unbind(window,"mouseup",A),Je.unbind(window,"touchend",A),k()}function D(){Je.unbind(window,"mousemove",Z),Je.unbind(window,"touchmove",Z),Je.unbind(window,"mouseup",D),Je.unbind(window,"touchend",D),k()}function P(){var F=Ov(this.value);F!==!1?(_.__color.__state=F,_.setValue(_.__color.toOriginal())):this.value=_.__color.toString()}function k(){_.__onFinishChange&&_.__onFinishChange.call(_,_.__color.toOriginal())}d.__saturation_field.appendChild(w),d.__selector.appendChild(d.__field_knob),d.__selector.appendChild(d.__saturation_field),d.__selector.appendChild(d.__hue_field),d.__hue_field.appendChild(d.__hue_knob),d.domElement.appendChild(d.__input),d.domElement.appendChild(d.__selector),d.updateDisplay();function W(F){F.type.indexOf("touch")===-1&&F.preventDefault();var B=_.__saturation_field.getBoundingClientRect(),G=F.touches&&F.touches[0]||F,$=G.clientX,ne=G.clientY,me=($-B.left)/(B.right-B.left),K=1-(ne-B.top)/(B.bottom-B.top);return K>1?K=1:K<0&&(K=0),me>1?me=1:me<0&&(me=0),_.__color.v=K,_.__color.s=me,_.setValue(_.__color.toOriginal()),!1}function Z(F){F.type.indexOf("touch")===-1&&F.preventDefault();var B=_.__hue_field.getBoundingClientRect(),G=F.touches&&F.touches[0]||F,$=G.clientY,ne=1-($-B.top)/(B.bottom-B.top);return ne>1?ne=1:ne<0&&(ne=0),_.__color.h=ne*360,_.setValue(_.__color.toOriginal()),!1}return d}return ms(e,[{key:"updateDisplay",value:function(){var l=Ov(this.getValue());if(l!==!1){var d=!1;yt.each(mr.COMPONENTS,function(a){if(!yt.isUndefined(l[a])&&!yt.isUndefined(this.__color.__state[a])&&l[a]!==this.__color.__state[a])return d=!0,{}},this),d&&yt.extend(this.__color.__state,l)}yt.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var _=this.__color.v<.5||this.__color.s>.5?255:0,w=255-_;yt.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+_+","+_+","+_+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,eT(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),yt.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+_+","+_+","+_+")",textShadow:this.__input_textShadow+"rgba("+w+","+w+","+w+",.7)"})}}]),e}(Kc),e4=["-moz-","-o-","-webkit-","-ms-",""];function eT(i,e,n,l){i.style.background="",yt.each(e4,function(d){i.style.cssText+="background: "+d+"linear-gradient("+e+", "+n+" 0%, "+l+" 100%); "})}function t4(i){i.style.background="",i.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",i.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var n4={load:function(e,n){var l=n||document,d=l.createElement("link");d.type="text/css",d.rel="stylesheet",d.href=e,l.getElementsByTagName("head")[0].appendChild(d)},inject:function(e,n){var l=n||document,d=document.createElement("style");d.type="text/css",d.innerHTML=e;var _=l.getElementsByTagName("head")[0];try{_.appendChild(d)}catch{}}},i4=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,r4=function(e,n){var l=e[n];return yt.isArray(arguments[2])||yt.isObject(arguments[2])?new KO(e,n,arguments[2]):yt.isNumber(l)?yt.isNumber(arguments[2])&&yt.isNumber(arguments[3])?yt.isNumber(arguments[4])?new Nv(e,n,arguments[2],arguments[3],arguments[4]):new Nv(e,n,arguments[2],arguments[3]):yt.isNumber(arguments[4])?new Og(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Og(e,n,{min:arguments[2],max:arguments[3]}):yt.isString(l)?new JO(e,n):yt.isFunction(l)?new iA(e,n,""):yt.isBoolean(l)?new tA(e,n):null};function o4(i){setTimeout(i,1e3/60)}var s4=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||o4,a4=function(){function i(){ps(this,i),this.backgroundElement=document.createElement("div"),yt.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Je.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),yt.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Je.bind(this.backgroundElement,"click",function(){e.hide()})}return ms(i,[{key:"show",value:function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),yt.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var n=this,l=function d(){n.domElement.style.display="none",n.backgroundElement.style.display="none",Je.unbind(n.domElement,"webkitTransitionEnd",d),Je.unbind(n.domElement,"transitionend",d),Je.unbind(n.domElement,"oTransitionEnd",d)};Je.bind(this.domElement,"webkitTransitionEnd",l),Je.bind(this.domElement,"transitionend",l),Je.bind(this.domElement,"oTransitionEnd",l),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Je.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Je.getHeight(this.domElement)/2+"px"}}]),i}(),l4=$O(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);n4.inject(l4);var tT="dg",nT=72,iT=20,bp="Default",Gf=function(){try{return!!window.localStorage}catch{return!1}}(),Jf=void 0,rT=!0,yh=void 0,kx=!1,rA=[],Mi=function i(e){var n=this,l=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Je.addClass(this.domElement,tT),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],l=yt.defaults(l,{closeOnTop:!1,autoPlace:!0,width:i.DEFAULT_WIDTH}),l=yt.defaults(l,{resizable:l.autoPlace,hideable:l.autoPlace}),yt.isUndefined(l.load)?l.load={preset:bp}:l.preset&&(l.load.preset=l.preset),yt.isUndefined(l.parent)&&l.hideable&&rA.push(this),l.resizable=yt.isUndefined(l.parent)&&l.resizable,l.autoPlace&&yt.isUndefined(l.scrollable)&&(l.scrollable=!0);var d=Gf&&localStorage.getItem(xh(this,"isLocal"))==="true",_=void 0,w=void 0;if(Object.defineProperties(this,{parent:{get:function(){return l.parent}},scrollable:{get:function(){return l.scrollable}},autoPlace:{get:function(){return l.autoPlace}},closeOnTop:{get:function(){return l.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:l.load.preset},set:function(k){n.parent?n.getRoot().preset=k:l.load.preset=k,d4(this),n.revert()}},width:{get:function(){return l.width},set:function(k){l.width=k,jv(n,k)}},name:{get:function(){return l.name},set:function(k){l.name=k,w&&(w.innerHTML=l.name)}},closed:{get:function(){return l.closed},set:function(k){l.closed=k,l.closed?Je.addClass(n.__ul,i.CLASS_CLOSED):Je.removeClass(n.__ul,i.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=k?i.TEXT_OPEN:i.TEXT_CLOSED)}},load:{get:function(){return l.load}},useLocalStorage:{get:function(){return d},set:function(k){Gf&&(d=k,k?Je.bind(window,"unload",_):Je.unbind(window,"unload",_),localStorage.setItem(xh(n,"isLocal"),k))}}}),yt.isUndefined(l.parent)){if(this.closed=l.closed||!1,Je.addClass(this.domElement,i.CLASS_MAIN),Je.makeSelectable(this.domElement,!1),Gf&&d){n.useLocalStorage=!0;var a=localStorage.getItem(xh(this,"gui"));a&&(l.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=i.TEXT_CLOSED,Je.addClass(this.__closeButton,i.CLASS_CLOSE_BUTTON),l.closeOnTop?(Je.addClass(this.__closeButton,i.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Je.addClass(this.__closeButton,i.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Je.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{l.closed===void 0&&(l.closed=!0);var T=document.createTextNode(l.name);Je.addClass(T,"controller-name"),w=Z1(n,T);var A=function(k){return k.preventDefault(),n.closed=!n.closed,!1};Je.addClass(this.__ul,i.CLASS_CLOSED),Je.addClass(w,"title"),Je.bind(w,"click",A),l.closed||(this.closed=!1)}l.autoPlace&&(yt.isUndefined(l.parent)&&(rT&&(yh=document.createElement("div"),Je.addClass(yh,tT),Je.addClass(yh,i.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(yh),rT=!1),yh.appendChild(this.domElement),Je.addClass(this.domElement,i.CLASS_AUTO_PLACE)),this.parent||jv(n,l.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Je.bind(window,"resize",this.__resizeHandler),Je.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Je.bind(this.__ul,"transitionend",this.__resizeHandler),Je.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),l.resizable&&h4(this),_=function(){Gf&&localStorage.getItem(xh(n,"isLocal"))==="true"&&localStorage.setItem(xh(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=_;function D(){var P=n.getRoot();P.width+=1,yt.defer(function(){P.width-=1})}l.parent||D()};Mi.toggleHide=function(){kx=!kx,yt.each(rA,function(i){i.domElement.style.display=kx?"none":""})};Mi.CLASS_AUTO_PLACE="a";Mi.CLASS_AUTO_PLACE_CONTAINER="ac";Mi.CLASS_MAIN="main";Mi.CLASS_CONTROLLER_ROW="cr";Mi.CLASS_TOO_TALL="taller-than-window";Mi.CLASS_CLOSED="closed";Mi.CLASS_CLOSE_BUTTON="close-button";Mi.CLASS_CLOSE_TOP="close-top";Mi.CLASS_CLOSE_BOTTOM="close-bottom";Mi.CLASS_DRAG="drag";Mi.DEFAULT_WIDTH=245;Mi.TEXT_CLOSED="Close Controls";Mi.TEXT_OPEN="Open Controls";Mi._keydownHandler=function(i){document.activeElement.type!=="text"&&(i.which===nT||i.keyCode===nT)&&Mi.toggleHide()};Je.bind(window,"keydown",Mi._keydownHandler,!1);yt.extend(Mi.prototype,{add:function(e,n){return Qf(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return Qf(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;yt.defer(function(){n.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&yh.removeChild(this.domElement);var e=this;yt.each(this.__folders,function(n){e.removeFolder(n)}),Je.unbind(window,"keydown",Mi._keydownHandler,!1),oT(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var l=new Mi(n);this.__folders[e]=l;var d=Z1(this,l.domElement);return Je.addClass(d,"folder"),l},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],oT(e);var n=this;yt.each(e.__folders,function(l){e.removeFolder(l)}),yt.defer(function(){n.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=Je.getOffset(e.__ul).top,l=0;yt.each(e.__ul.childNodes,function(d){e.autoPlace&&d===e.__save_row||(l+=Je.getHeight(d))}),window.innerHeight-n-iT<l?(Je.addClass(e.domElement,Mi.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-iT+"px"):(Je.removeClass(e.domElement,Mi.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&yt.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:yt.debounce(function(){this.onResize()},50),remember:function(){if(yt.isUndefined(Jf)&&(Jf=new a4,Jf.domElement.innerHTML=i4),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;yt.each(Array.prototype.slice.call(arguments),function(n){e.__rememberedObjects.length===0&&u4(e),e.__rememberedObjects.indexOf(n)===-1&&e.__rememberedObjects.push(n)}),this.autoPlace&&jv(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Y_(this)),e.folders={},yt.each(this.__folders,function(n,l){e.folders[l]=n.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Y_(this),Vv(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[bp]=Y_(this,!0)),this.load.remembered[e]=Y_(this),this.preset=e,Gv(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){yt.each(this.__controllers,function(n){this.getRoot().load.remembered?oA(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())},this),yt.each(this.__folders,function(n){n.revert(n)}),e||Vv(this.getRoot(),!1)},listen:function(e){var n=this.__listening.length===0;this.__listening.push(e),n&&sA(this.__listening)},updateDisplay:function(){yt.each(this.__controllers,function(e){e.updateDisplay()}),yt.each(this.__folders,function(e){e.updateDisplay()})}});function Z1(i,e,n){var l=document.createElement("li");return e&&l.appendChild(e),n?i.__ul.insertBefore(l,n):i.__ul.appendChild(l),i.onResize(),l}function oT(i){Je.unbind(window,"resize",i.__resizeHandler),i.saveToLocalStorageIfPossible&&Je.unbind(window,"unload",i.saveToLocalStorageIfPossible)}function Vv(i,e){var n=i.__preset_select[i.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function c4(i,e,n){if(n.__li=e,n.__gui=i,yt.extend(n,{options:function(w){if(arguments.length>1){var a=n.__li.nextElementSibling;return n.remove(),Qf(i,n.object,n.property,{before:a,factoryArgs:[yt.toArray(arguments)]})}if(yt.isArray(w)||yt.isObject(w)){var T=n.__li.nextElementSibling;return n.remove(),Qf(i,n.object,n.property,{before:T,factoryArgs:[w]})}},name:function(w){return n.__li.firstElementChild.firstElementChild.innerHTML=w,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Nv){var l=new Og(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});yt.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(_){var w=n[_],a=l[_];n[_]=l[_]=function(){var T=Array.prototype.slice.call(arguments);return a.apply(l,T),w.apply(n,T)}}),Je.addClass(e,"has-slider"),n.domElement.insertBefore(l.domElement,n.domElement.firstElementChild)}else if(n instanceof Og){var d=function(w){if(yt.isNumber(n.__min)&&yt.isNumber(n.__max)){var a=n.__li.firstElementChild.firstElementChild.innerHTML,T=n.__gui.__listening.indexOf(n)>-1;n.remove();var A=Qf(i,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return A.name(a),T&&A.listen(),A}return w};n.min=yt.compose(d,n.min),n.max=yt.compose(d,n.max)}else n instanceof tA?(Je.bind(e,"click",function(){Je.fakeEvent(n.__checkbox,"click")}),Je.bind(n.__checkbox,"click",function(_){_.stopPropagation()})):n instanceof iA?(Je.bind(e,"click",function(){Je.fakeEvent(n.__button,"click")}),Je.bind(e,"mouseover",function(){Je.addClass(n.__button,"hover")}),Je.bind(e,"mouseout",function(){Je.removeClass(n.__button,"hover")})):n instanceof Uv&&(Je.addClass(e,"color"),n.updateDisplay=yt.compose(function(_){return e.style.borderLeftColor=n.__color.toString(),_},n.updateDisplay),n.updateDisplay());n.setValue=yt.compose(function(_){return i.getRoot().__preset_select&&n.isModified()&&Vv(i.getRoot(),!0),_},n.setValue)}function oA(i,e){var n=i.getRoot(),l=n.__rememberedObjects.indexOf(e.object);if(l!==-1){var d=n.__rememberedObjectIndecesToControllers[l];if(d===void 0&&(d={},n.__rememberedObjectIndecesToControllers[l]=d),d[e.property]=e,n.load&&n.load.remembered){var _=n.load.remembered,w=void 0;if(_[i.preset])w=_[i.preset];else if(_[bp])w=_[bp];else return;if(w[l]&&w[l][e.property]!==void 0){var a=w[l][e.property];e.initialValue=a,e.setValue(a)}}}}function Qf(i,e,n,l){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var d=void 0;if(l.color)d=new Uv(e,n);else{var _=[e,n].concat(l.factoryArgs);d=r4.apply(i,_)}l.before instanceof Kc&&(l.before=l.before.__li),oA(i,d),Je.addClass(d.domElement,"c");var w=document.createElement("span");Je.addClass(w,"property-name"),w.innerHTML=d.property;var a=document.createElement("div");a.appendChild(w),a.appendChild(d.domElement);var T=Z1(i,a,l.before);return Je.addClass(T,Mi.CLASS_CONTROLLER_ROW),d instanceof Uv?Je.addClass(T,"color"):Je.addClass(T,ZO(d.getValue())),c4(i,T,d),i.__controllers.push(d),d}function xh(i,e){return document.location.href+"."+e}function Gv(i,e,n){var l=document.createElement("option");l.innerHTML=e,l.value=e,i.__preset_select.appendChild(l),n&&(i.__preset_select.selectedIndex=i.__preset_select.length-1)}function sT(i,e){e.style.display=i.useLocalStorage?"block":"none"}function u4(i){var e=i.__save_row=document.createElement("li");Je.addClass(i.domElement,"has-save"),i.__ul.insertBefore(e,i.__ul.firstChild),Je.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Je.addClass(n,"button gears");var l=document.createElement("span");l.innerHTML="Save",Je.addClass(l,"button"),Je.addClass(l,"save");var d=document.createElement("span");d.innerHTML="New",Je.addClass(d,"button"),Je.addClass(d,"save-as");var _=document.createElement("span");_.innerHTML="Revert",Je.addClass(_,"button"),Je.addClass(_,"revert");var w=i.__preset_select=document.createElement("select");if(i.load&&i.load.remembered?yt.each(i.load.remembered,function(P,k){Gv(i,k,k===i.preset)}):Gv(i,bp,!1),Je.bind(w,"change",function(){for(var P=0;P<i.__preset_select.length;P++)i.__preset_select[P].innerHTML=i.__preset_select[P].value;i.preset=this.value}),e.appendChild(w),e.appendChild(n),e.appendChild(l),e.appendChild(d),e.appendChild(_),Gf){var a=document.getElementById("dg-local-explain"),T=document.getElementById("dg-local-storage"),A=document.getElementById("dg-save-locally");A.style.display="block",localStorage.getItem(xh(i,"isLocal"))==="true"&&T.setAttribute("checked","checked"),sT(i,a),Je.bind(T,"change",function(){i.useLocalStorage=!i.useLocalStorage,sT(i,a)})}var D=document.getElementById("dg-new-constructor");Je.bind(D,"keydown",function(P){P.metaKey&&(P.which===67||P.keyCode===67)&&Jf.hide()}),Je.bind(n,"click",function(){D.innerHTML=JSON.stringify(i.getSaveObject(),void 0,2),Jf.show(),D.focus(),D.select()}),Je.bind(l,"click",function(){i.save()}),Je.bind(d,"click",function(){var P=prompt("Enter a new preset name.");P&&i.saveAs(P)}),Je.bind(_,"click",function(){i.revert()})}function h4(i){var e=void 0;i.__resize_handle=document.createElement("div"),yt.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(_){return _.preventDefault(),i.width+=e-_.clientX,i.onResize(),e=_.clientX,!1}function l(){Je.removeClass(i.__closeButton,Mi.CLASS_DRAG),Je.unbind(window,"mousemove",n),Je.unbind(window,"mouseup",l)}function d(_){return _.preventDefault(),e=_.clientX,Je.addClass(i.__closeButton,Mi.CLASS_DRAG),Je.bind(window,"mousemove",n),Je.bind(window,"mouseup",l),!1}Je.bind(i.__resize_handle,"mousedown",d),Je.bind(i.__closeButton,"mousedown",d),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)}function jv(i,e){i.domElement.style.width=e+"px",i.__save_row&&i.autoPlace&&(i.__save_row.style.width=e+"px"),i.__closeButton&&(i.__closeButton.style.width=e+"px")}function Y_(i,e){var n={};return yt.each(i.__rememberedObjects,function(l,d){var _={},w=i.__rememberedObjectIndecesToControllers[d];yt.each(w,function(a,T){_[T]=e?a.initialValue:a.getValue()}),n[d]=_}),n}function d4(i){for(var e=0;e<i.__preset_select.length;e++)i.__preset_select[e].value===i.preset&&(i.__preset_select.selectedIndex=e)}function sA(i){i.length!==0&&s4.call(window,function(){sA(i)}),yt.each(i,function(e){e.updateDisplay()})}const aT={type:"change"},Rx={type:"start"},lT={type:"end"};class f4 extends Xc{constructor(e,n){super(),n===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Ye,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:th.ROTATE,MIDDLE:th.DOLLY,RIGHT:th.PAN},this.touches={ONE:nh.ROTATE,TWO:nh.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ge){ge.addEventListener("keydown",zi),this._domElementKeyEvents=ge},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(aT),l.update(),_=d.NONE},this.update=function(){const ge=new Ye,mt=new $c().setFromUnitVectors(e.up,new Ye(0,1,0)),Ut=mt.clone().invert(),Mt=new Ye,ze=new $c,Ft=2*Math.PI;return function(){const un=l.object.position;ge.copy(un).sub(l.target),ge.applyQuaternion(mt),a.setFromVector3(ge),l.autoRotate&&_===d.NONE&&Ae(Te()),l.enableDamping?(a.theta+=T.theta*l.dampingFactor,a.phi+=T.phi*l.dampingFactor):(a.theta+=T.theta,a.phi+=T.phi);let Ht=l.minAzimuthAngle,rn=l.maxAzimuthAngle;return isFinite(Ht)&&isFinite(rn)&&(Ht<-Math.PI?Ht+=Ft:Ht>Math.PI&&(Ht-=Ft),rn<-Math.PI?rn+=Ft:rn>Math.PI&&(rn-=Ft),Ht<=rn?a.theta=Math.max(Ht,Math.min(rn,a.theta)):a.theta=a.theta>(Ht+rn)/2?Math.max(Ht,a.theta):Math.min(rn,a.theta)),a.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=A,a.radius=Math.max(l.minDistance,Math.min(l.maxDistance,a.radius)),l.enableDamping===!0?l.target.addScaledVector(D,l.dampingFactor):l.target.add(D),ge.setFromSpherical(a),ge.applyQuaternion(Ut),un.copy(l.target).add(ge),l.object.lookAt(l.target),l.enableDamping===!0?(T.theta*=1-l.dampingFactor,T.phi*=1-l.dampingFactor,D.multiplyScalar(1-l.dampingFactor)):(T.set(0,0,0),D.set(0,0,0)),A=1,P||Mt.distanceToSquared(l.object.position)>w||8*(1-ze.dot(l.object.quaternion))>w?(l.dispatchEvent(aT),Mt.copy(l.object.position),ze.copy(l.object.quaternion),P=!1,!0):!1}}(),this.dispose=function(){l.domElement.removeEventListener("contextmenu",st),l.domElement.removeEventListener("pointerdown",an),l.domElement.removeEventListener("pointercancel",mi),l.domElement.removeEventListener("wheel",dn),l.domElement.removeEventListener("pointermove",ii),l.domElement.removeEventListener("pointerup",ui),l._domElementKeyEvents!==null&&l._domElementKeyEvents.removeEventListener("keydown",zi)};const l=this,d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let _=d.NONE;const w=1e-6,a=new X2,T=new X2;let A=1;const D=new Ye;let P=!1;const k=new In,W=new In,Z=new In,F=new In,B=new In,G=new In,$=new In,ne=new In,me=new In,K=[],Ee={};function Te(){return 2*Math.PI/60/60*l.autoRotateSpeed}function ee(){return Math.pow(.95,l.zoomSpeed)}function Ae(ge){T.theta-=ge}function Fe(ge){T.phi-=ge}const qe=function(){const ge=new Ye;return function(Ut,Mt){ge.setFromMatrixColumn(Mt,0),ge.multiplyScalar(-Ut),D.add(ge)}}(),Pt=function(){const ge=new Ye;return function(Ut,Mt){l.screenSpacePanning===!0?ge.setFromMatrixColumn(Mt,1):(ge.setFromMatrixColumn(Mt,0),ge.crossVectors(l.object.up,ge)),ge.multiplyScalar(Ut),D.add(ge)}}(),xt=function(){const ge=new Ye;return function(Ut,Mt){const ze=l.domElement;if(l.object.isPerspectiveCamera){const Ft=l.object.position;ge.copy(Ft).sub(l.target);let kt=ge.length();kt*=Math.tan(l.object.fov/2*Math.PI/180),qe(2*Ut*kt/ze.clientHeight,l.object.matrix),Pt(2*Mt*kt/ze.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(qe(Ut*(l.object.right-l.object.left)/l.object.zoom/ze.clientWidth,l.object.matrix),Pt(Mt*(l.object.top-l.object.bottom)/l.object.zoom/ze.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function je(ge){l.object.isPerspectiveCamera?A/=ge:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*ge)),l.object.updateProjectionMatrix(),P=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function ut(ge){l.object.isPerspectiveCamera?A*=ge:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/ge)),l.object.updateProjectionMatrix(),P=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function tt(ge){k.set(ge.clientX,ge.clientY)}function ct(ge){$.set(ge.clientX,ge.clientY)}function Be(ge){F.set(ge.clientX,ge.clientY)}function Ne(ge){W.set(ge.clientX,ge.clientY),Z.subVectors(W,k).multiplyScalar(l.rotateSpeed);const mt=l.domElement;Ae(2*Math.PI*Z.x/mt.clientHeight),Fe(2*Math.PI*Z.y/mt.clientHeight),k.copy(W),l.update()}function Ze(ge){ne.set(ge.clientX,ge.clientY),me.subVectors(ne,$),me.y>0?je(ee()):me.y<0&&ut(ee()),$.copy(ne),l.update()}function pt(ge){B.set(ge.clientX,ge.clientY),G.subVectors(B,F).multiplyScalar(l.panSpeed),xt(G.x,G.y),F.copy(B),l.update()}function et(ge){ge.deltaY<0?ut(ee()):ge.deltaY>0&&je(ee()),l.update()}function gt(ge){let mt=!1;switch(ge.code){case l.keys.UP:xt(0,l.keyPanSpeed),mt=!0;break;case l.keys.BOTTOM:xt(0,-l.keyPanSpeed),mt=!0;break;case l.keys.LEFT:xt(l.keyPanSpeed,0),mt=!0;break;case l.keys.RIGHT:xt(-l.keyPanSpeed,0),mt=!0;break}mt&&(ge.preventDefault(),l.update())}function jt(){if(K.length===1)k.set(K[0].pageX,K[0].pageY);else{const ge=.5*(K[0].pageX+K[1].pageX),mt=.5*(K[0].pageY+K[1].pageY);k.set(ge,mt)}}function Xt(){if(K.length===1)F.set(K[0].pageX,K[0].pageY);else{const ge=.5*(K[0].pageX+K[1].pageX),mt=.5*(K[0].pageY+K[1].pageY);F.set(ge,mt)}}function ot(){const ge=K[0].pageX-K[1].pageX,mt=K[0].pageY-K[1].pageY,Ut=Math.sqrt(ge*ge+mt*mt);$.set(0,Ut)}function Tn(){l.enableZoom&&ot(),l.enablePan&&Xt()}function fn(){l.enableZoom&&ot(),l.enableRotate&&jt()}function pn(ge){if(K.length==1)W.set(ge.pageX,ge.pageY);else{const Ut=nn(ge),Mt=.5*(ge.pageX+Ut.x),ze=.5*(ge.pageY+Ut.y);W.set(Mt,ze)}Z.subVectors(W,k).multiplyScalar(l.rotateSpeed);const mt=l.domElement;Ae(2*Math.PI*Z.x/mt.clientHeight),Fe(2*Math.PI*Z.y/mt.clientHeight),k.copy(W)}function Wt(ge){if(K.length===1)B.set(ge.pageX,ge.pageY);else{const mt=nn(ge),Ut=.5*(ge.pageX+mt.x),Mt=.5*(ge.pageY+mt.y);B.set(Ut,Mt)}G.subVectors(B,F).multiplyScalar(l.panSpeed),xt(G.x,G.y),F.copy(B)}function On(ge){const mt=nn(ge),Ut=ge.pageX-mt.x,Mt=ge.pageY-mt.y,ze=Math.sqrt(Ut*Ut+Mt*Mt);ne.set(0,ze),me.set(0,Math.pow(ne.y/$.y,l.zoomSpeed)),je(me.y),$.copy(ne)}function bn(ge){l.enableZoom&&On(ge),l.enablePan&&Wt(ge)}function hn(ge){l.enableZoom&&On(ge),l.enableRotate&&pn(ge)}function an(ge){l.enabled!==!1&&(K.length===0&&(l.domElement.setPointerCapture(ge.pointerId),l.domElement.addEventListener("pointermove",ii),l.domElement.addEventListener("pointerup",ui)),Et(ge),ge.pointerType==="touch"?Se(ge):Zn(ge))}function ii(ge){l.enabled!==!1&&(ge.pointerType==="touch"?fe(ge):Nn(ge))}function ui(ge){Rt(ge),K.length===0&&(l.domElement.releasePointerCapture(ge.pointerId),l.domElement.removeEventListener("pointermove",ii),l.domElement.removeEventListener("pointerup",ui)),l.dispatchEvent(lT),_=d.NONE}function mi(ge){Rt(ge)}function Zn(ge){let mt;switch(ge.button){case 0:mt=l.mouseButtons.LEFT;break;case 1:mt=l.mouseButtons.MIDDLE;break;case 2:mt=l.mouseButtons.RIGHT;break;default:mt=-1}switch(mt){case th.DOLLY:if(l.enableZoom===!1)return;ct(ge),_=d.DOLLY;break;case th.ROTATE:if(ge.ctrlKey||ge.metaKey||ge.shiftKey){if(l.enablePan===!1)return;Be(ge),_=d.PAN}else{if(l.enableRotate===!1)return;tt(ge),_=d.ROTATE}break;case th.PAN:if(ge.ctrlKey||ge.metaKey||ge.shiftKey){if(l.enableRotate===!1)return;tt(ge),_=d.ROTATE}else{if(l.enablePan===!1)return;Be(ge),_=d.PAN}break;default:_=d.NONE}_!==d.NONE&&l.dispatchEvent(Rx)}function Nn(ge){if(l.enabled!==!1)switch(_){case d.ROTATE:if(l.enableRotate===!1)return;Ne(ge);break;case d.DOLLY:if(l.enableZoom===!1)return;Ze(ge);break;case d.PAN:if(l.enablePan===!1)return;pt(ge);break}}function dn(ge){l.enabled===!1||l.enableZoom===!1||_!==d.NONE||(ge.preventDefault(),l.dispatchEvent(Rx),et(ge),l.dispatchEvent(lT))}function zi(ge){l.enabled===!1||l.enablePan===!1||gt(ge)}function Se(ge){switch(qt(ge),K.length){case 1:switch(l.touches.ONE){case nh.ROTATE:if(l.enableRotate===!1)return;jt(),_=d.TOUCH_ROTATE;break;case nh.PAN:if(l.enablePan===!1)return;Xt(),_=d.TOUCH_PAN;break;default:_=d.NONE}break;case 2:switch(l.touches.TWO){case nh.DOLLY_PAN:if(l.enableZoom===!1&&l.enablePan===!1)return;Tn(),_=d.TOUCH_DOLLY_PAN;break;case nh.DOLLY_ROTATE:if(l.enableZoom===!1&&l.enableRotate===!1)return;fn(),_=d.TOUCH_DOLLY_ROTATE;break;default:_=d.NONE}break;default:_=d.NONE}_!==d.NONE&&l.dispatchEvent(Rx)}function fe(ge){switch(qt(ge),_){case d.TOUCH_ROTATE:if(l.enableRotate===!1)return;pn(ge),l.update();break;case d.TOUCH_PAN:if(l.enablePan===!1)return;Wt(ge),l.update();break;case d.TOUCH_DOLLY_PAN:if(l.enableZoom===!1&&l.enablePan===!1)return;bn(ge),l.update();break;case d.TOUCH_DOLLY_ROTATE:if(l.enableZoom===!1&&l.enableRotate===!1)return;hn(ge),l.update();break;default:_=d.NONE}}function st(ge){l.enabled!==!1&&ge.preventDefault()}function Et(ge){K.push(ge)}function Rt(ge){delete Ee[ge.pointerId];for(let mt=0;mt<K.length;mt++)if(K[mt].pointerId==ge.pointerId){K.splice(mt,1);return}}function qt(ge){let mt=Ee[ge.pointerId];mt===void 0&&(mt=new In,Ee[ge.pointerId]=mt),mt.set(ge.pageX,ge.pageY)}function nn(ge){const mt=ge.pointerId===K[0].pointerId?K[1]:K[0];return Ee[mt.pointerId]}l.domElement.addEventListener("contextmenu",st),l.domElement.addEventListener("pointerdown",an),l.domElement.addEventListener("pointercancel",mi),l.domElement.addEventListener("wheel",dn,{passive:!1}),this.update()}}var ep=function(){var i=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(D){D.preventDefault(),l(++i%e.children.length)},!1);function n(D){return e.appendChild(D.dom),D}function l(D){for(var P=0;P<e.children.length;P++)e.children[P].style.display=P===D?"block":"none";i=D}var d=(performance||Date).now(),_=d,w=0,a=n(new ep.Panel("FPS","#0ff","#002")),T=n(new ep.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var A=n(new ep.Panel("MB","#f08","#201"));return l(0),{REVISION:16,dom:e,addPanel:n,showPanel:l,begin:function(){d=(performance||Date).now()},end:function(){w++;var D=(performance||Date).now();if(T.update(D-d,200),D>=_+1e3&&(a.update(w*1e3/(D-_),100),_=D,w=0,A)){var P=performance.memory;A.update(P.usedJSHeapSize/1048576,P.jsHeapSizeLimit/1048576)}return D},update:function(){d=this.end()},domElement:e,setMode:l}};ep.Panel=function(i,e,n){var l=1/0,d=0,_=Math.round,w=_(window.devicePixelRatio||1),a=80*w,T=48*w,A=3*w,D=2*w,P=3*w,k=15*w,W=74*w,Z=30*w,F=document.createElement("canvas");F.width=a,F.height=T,F.style.cssText="width:80px;height:48px";var B=F.getContext("2d");return B.font="bold "+9*w+"px Helvetica,Arial,sans-serif",B.textBaseline="top",B.fillStyle=n,B.fillRect(0,0,a,T),B.fillStyle=e,B.fillText(i,A,D),B.fillRect(P,k,W,Z),B.fillStyle=n,B.globalAlpha=.9,B.fillRect(P,k,W,Z),{dom:F,update:function(G,$){l=Math.min(l,G),d=Math.max(d,G),B.fillStyle=n,B.globalAlpha=1,B.fillRect(0,0,a,k),B.fillStyle=e,B.fillText(_(G)+" "+i+" ("+_(l)+"-"+_(d)+")",A,D),B.drawImage(F,P+w,k,W-w,Z,P,k,W-w,Z),B.fillRect(P+W-w,k,w,Z),B.fillStyle=n,B.globalAlpha=.9,B.fillRect(P+W-w,k,w,_((1-G/$)*Z))}}};class p4{constructor(e){this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.fov=60,this.nearPlane=1,this.farPlane=1e3,this.canvasId=e,this.clock=void 0,this.stats=void 0,this.controls=void 0,this.ambientLight=void 0,this.directionalLight=void 0}initialize(){this.scene=new SO,this.camera=new vo(this.fov,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.z=40,this.camera.position.x=40,this.camera.position.y=40;const e=document.getElementById(this.canvasId);this.renderer=new $C({canvas:e,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.clock=new jO,this.controls=new f4(this.camera,this.renderer.domElement),this.stats=ep(),document.body.appendChild(this.stats.dom),this.ambientLight=new GO(16777215,.5),this.ambientLight.castShadow=!0,this.scene.add(this.ambientLight),this.spotLight=new VO(16777215,1),this.spotLight.castShadow=!0,this.spotLight.position.set(0,64,32),this.scene.add(this.spotLight),window.addEventListener("resize",()=>this.onWindowResize(),!1)}animate(){window.requestAnimationFrame(this.animate.bind(this)),this.render(),this.stats.update(),this.controls.update()}render(){this.renderer.render(this.scene,this.camera)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}}var X1={exports:{}},sy={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m4=si.exports,_4=Symbol.for("react.element"),g4=Symbol.for("react.fragment"),y4=Object.prototype.hasOwnProperty,x4=m4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v4={key:!0,ref:!0,__self:!0,__source:!0};function aA(i,e,n){var l,d={},_=null,w=null;n!==void 0&&(_=""+n),e.key!==void 0&&(_=""+e.key),e.ref!==void 0&&(w=e.ref);for(l in e)y4.call(e,l)&&!v4.hasOwnProperty(l)&&(d[l]=e[l]);if(i&&i.defaultProps)for(l in e=i.defaultProps,e)d[l]===void 0&&(d[l]=e[l]);return{$$typeof:_4,type:i,key:_,ref:w,props:d,_owner:x4.current}}sy.Fragment=g4;sy.jsx=aA;sy.jsxs=aA;X1.exports=sy;const An=X1.exports.jsx,vh=X1.exports.jsxs;function w4(){return si.exports.useEffect(()=>{const i=new p4("moduleCanvas");i.initialize(),i.animate();const e=new ry(50,50),n=new OO().load("../assets/grass/grass.png");n.wrapS=xp,n.wrapT=xp;const l=new XC({map:n,depthWrite:!1,transparent:!0,color:65280}),d=new _a(e,l);d.rotation.y=0,i.scene.add(d);for(var _=0,w=4,a;_<w;)a=d.clone(),a.rotation.y=_*(Math.round(Math.PI)/w),i.scene.add(a),_+=1},[]),An("div",{children:An("canvas",{id:"moduleCanvas"})})}function b4(){return vh("div",{children:[An("div",{className:Pf.header,children:An("strong",{children:An("h2",{children:"openGreenRoof"})})}),vh("div",{className:Pf.subHeader,children:[An("strong",{children:An("h4",{children:"Let's bring more green roofs to cities, together"})}),An("h4",{children:"Coming September 2022"})]}),vh("div",{className:Pf.introBox,children:[An("br",{}),An("span",{className:Pf.subText,children:vh("h5",{children:[An("strong",{children:"So why do we need more green roofs?"}),An("br",{}),"For starter, ",An("a",{href:"https://www.youtube.com/watch?v=FlJoBhLnqko",target:"_blank",children:"this video by NPR's Beck Harlan and Kara Frame"})," did a great job explaining why green roofs are great for cities.",An("br",{}),An("br",{}),An("strong",{children:"TLDR, here's a short list of benefits:"}),An("br",{}),"- reduce heat island effect ",An("br",{}),"- improve indoor climate ",An("br",{}),"- ease surface runoff ",An("br",{}),"- bring back bio-diversity ",An("br",{}),"- more accessible nature ",An("br",{}),An("br",{}),An("strong",{children:"How do we build more green roofs?"}),An("br",{}),"Thanks to wider awareness, there are already many existing companies dedicated to help builders transform unused roof spaces to green roofs. OpenGreenRoof as a public tool aims to take the effort further - by providing visibility and optimization engine to help identify more usable spaces, maximize environmental benefits, and produce actionable next-steps for anyone whos want to participate in the movement."]})})]}),vh("div",{className:Pf.footer,children:[An("strong",{children:"V1 Location:"})," London | ",An("strong",{children:" Supporting "}),An("a",{href:"https://www.london.gov.uk/sites/default/files/the_london_plan_2021.pdf",target:"_blank",children:"London Plan 2021 - Policy G5"}),An("br",{}),"Project in development by ",An("a",{href:"http://hellowelcomeback.online/",target:"_blank",children:"Tinnei P"}),", MSc Architectural Computation.",An("br",{}),"Adviced by Philippe Morel and Vasileios Papalexopoulos at UCL Bartlett."]})]})}var lA={exports:{}};(function(i,e){(function(n,l){i.exports=l()})(F3,function(){var n,l,d;function _(a,T){if(!n)n=T;else if(!l)l=T;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",D={};n(D),d=T(D),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}_(["exports"],function(a){var T=typeof self!="undefined"?self:{},A=D;function D(o,t,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=s,this.p2y=c}D.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},D.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},D.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},D.prototype.solveCurveX=function(o,t){var s,c,h,p,g;for(t===void 0&&(t=1e-6),h=o,g=0;g<8;g++){if(p=this.sampleCurveX(h)-o,Math.abs(p)<t)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=p/x}if((h=o)<(s=0))return s;if(h>(c=1))return c;for(;s<c;){if(p=this.sampleCurveX(h),Math.abs(p-o)<t)return h;o>p?s=h:c=h,h=.5*(c-s)+s}return h},D.prototype.solve=function(o,t){return this.sampleCurveY(this.solveCurveX(o,t))};var P=k;function k(o,t){this.x=o,this.y=t}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,t){return this.clone()._rotateAround(o,t)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var t=o.x-this.x,s=o.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,t){return Math.atan2(this.x*t-this.y*o,this.x*o+this.y*t)},_matMult:function(o){var t=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=t,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var t=Math.cos(o),s=Math.sin(o),c=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,t){var s=Math.cos(o),c=Math.sin(o),h=t.y+c*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-c*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(o){return o instanceof k?o:Array.isArray(o)?new k(o[0],o[1]):o};const W=Math.PI/180,Z=180/Math.PI;function F(o){return o*W}function B(o){return o*Z}const G=[[0,0],[1,0],[1,1],[0,1]];function $(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,s=t*o;return 4*(o<.5?s:3*(o-t)+s-.75)}function ne(o,t,s,c){const h=new A(o,t,s,c);return function(p){return h.solve(p)}}const me=ne(.25,.1,.25,1);function K(o,t,s){return Math.min(s,Math.max(t,o))}function Ee(o,t,s){return(s=K((s-o)/(t-o),0,1))*s*(3-2*s)}function Te(o,t,s){const c=s-t,h=((o-t)%c+c)%c+t;return h===t?s:h}function ee(o,t,s){if(!o.length)return s(null,[]);let c=o.length;const h=new Array(o.length);let p=null;o.forEach((g,x)=>{t(g,(b,S)=>{b&&(p=b),h[x]=S,--c==0&&s(p,h)})})}function Ae(o){const t=[];for(const s in o)t.push(o[s]);return t}function Fe(o,...t){for(const s of t)for(const c in s)o[c]=s[c];return o}let qe=1;function Pt(){return qe++}function xt(){return function o(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function je(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function ut(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function tt(o,t){o.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function ct(o,t){return o.indexOf(t,o.length-t.length)!==-1}function Be(o,t,s){const c={};for(const h in o)c[h]=t.call(s||this,o[h],h,o);return c}function Ne(o,t,s){const c={};for(const h in o)t.call(s||this,o[h],h,o)&&(c[h]=o[h]);return c}function Ze(o){return Array.isArray(o)?o.map(Ze):typeof o=="object"&&o?Be(o,Ze):o}const pt={};function et(o){pt[o]||(typeof console!="undefined"&&console.warn(o),pt[o]=!0)}function gt(o,t,s){return(s.y-o.y)*(t.x-o.x)>(t.y-o.y)*(s.x-o.x)}function jt(o){let t=0;for(let s,c,h=0,p=o.length,g=p-1;h<p;g=h++)s=o[h],c=o[g],t+=(c.x-s.x)*(s.y+c.y);return t}function Xt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ot(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,h,p)=>{const g=h||p;return t[c]=!g||g.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let Tn=null;function fn(o){if(Tn==null){const t=o.navigator?o.navigator.userAgent:null;Tn=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Tn}function pn(o){try{const t=T[o];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Wt(o,t){return[o[4*t],o[4*t+1],o[4*t+2],o[4*t+3]]}const On=T.performance;function bn(o){const t=o?o.url.toString():void 0;return On.getEntriesByName(t)}var hn="2.9.2";let an,ii,ui,mi;const Zn={now:()=>ui!==void 0?ui:T.performance.now(),setNow(o){ui=o},restoreNow(){ui=void 0},frame(o){const t=T.requestAnimationFrame(o);return{cancel:()=>T.cancelAnimationFrame(t)}},getImageData(o,t=0){const{width:s,height:c}=o;mi||(mi=T.document.createElement("canvas"));const h=mi.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(s>mi.width||c>mi.height)&&(mi.width=s,mi.height=c),h.clearRect(-t,-t,s+2*t,c+2*t),h.drawImage(o,0,0,s,c),h.getImageData(-t,-t,s+2*t,c+2*t)},resolveURL:o=>(an||(an=T.document.createElement("a")),an.href=o,an.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(ii==null&&(ii=T.matchMedia("(prefers-reduced-motion: reduce)")),ii.matches)}};let Nn;const dn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Nn==null){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Nn={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):o}catch{Nn=o}}return Nn},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},zi={supported:!1,testSupport:function(o){!st&&fe&&(Et?Rt(o):Se=o)}};let Se,fe,st=!1,Et=!1;function Rt(o){const t=o.createTexture();o.bindTexture(o.TEXTURE_2D,t);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,fe),o.isContextLost())return;zi.supported=!0}catch{}o.deleteTexture(t),st=!0}T.document&&(fe=T.document.createElement("img"),fe.onload=function(){Se&&Rt(Se),Se=null,Et=!0},fe.onerror=function(){st=!0,Se=null},fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qt="01",nn="NO_ACCESS_TOKEN";function ge(o){return o.indexOf("mapbox:")===0}function mt(o){return dn.API_URL_REGEX.test(o)}const Ut=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mt(o){const t=o.match(Ut);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ze(o){const t=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${t}`}function Ft(o){if(!o)return null;const t=o.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(t[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class kt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Ft(dn.ACCESS_TOKEN);let c="";return c=s&&s.u?T.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(Number("0x"+p)))):dn.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const t=pn("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const h=T.localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const p=T.localStorage.getItem(c);p&&(this.anonId=p)}catch{et("Unable to read from LocalStorage")}}saveEventData(){const t=pn("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{T.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{et("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,c,h){if(!dn.EVENTS_URL)return;const p=Mt(dn.EVENTS_URL);p.params.push(`access_token=${h||dn.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:hn,skuId:qt,userId:this.anonId},x=s?Fe(g,s):g,b={url:ze(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=ce(b,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(h)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const un=new class extends kt{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,t){dn.EVENTS_URL&&dn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>ge(s)||mt(s))&&this.queueRequest(Date.now(),t)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ft(dn.ACCESS_TOKEN),s=t?t.u:dn.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;ut(this.anonId)||(this.anonId=xt(),c=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||p.getDate()!==g.getDate()}else c=!0;c?this.postEvent(h,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},o):this.processRequests()}},Ht=un.postTurnstileEvent.bind(un),rn=new class extends kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,t,s,c){this.skuToken=t,this.errorCb=c,dn.EVENTS_URL&&(s||dn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(nn)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ut(this.anonId)||(this.anonId=xt()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},o))}},Bt=rn.postMapLoadEvent.bind(rn),mn=new class extends kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,t,s,c){if(!dn.API_URL||!dn.SESSION_PATH)return;const h=Mt(dn.API_URL+dn.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${c||dn.ACCESS_TOKEN||""}`);const p={url:ze(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ce(p,g=>{this.pendingRequest=null,s(g),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,t,s,c){this.skuToken=t,this.errorCb=c,dn.SESSION_PATH&&dn.API_URL&&(s||dn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(nn)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},o)}},qn=mn.getSessionAPI.bind(mn),zn=new Set;let hi,Ki=500,Vs=50,sr={};function Eo(o){const t=V(o);let s,c;t&&t.forEach(p=>{const g=p.split("=");g[0]==="language"?s=g[1]:g[0]==="worldview"&&(c=g[1])});let h="mapbox-tiles";return s&&(h+=`-${s}`),c&&(h+=`-${c}`),h}function he(o){T.caches&&!sr[o]&&(sr[o]=T.caches.open(o))}function V(o){const t=o.indexOf("?");return t>0?o.slice(t+1).split("&"):[]}function q(o){const t=o.indexOf("?");if(t<0)return o;const s=V(o).filter(c=>{const h=c.split("=");return h[0]==="language"||h[0]==="worldview"});return s.length?`${o.slice(0,t)}?${s.join("&")}`:o.slice(0,t)}let ue=1/0;const xe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(xe);class Pe extends Error{constructor(t,s,c){s===401&&mt(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const H=Xt()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,re=function(o,t){if(!(/^file:/.test(s=o.url)||/^file:/.test(H())&&!/^\w+:/.test(s))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(c,h){const p=new T.AbortController,g=new T.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:H(),signal:p.signal});let x=!1,b=!1;const S=(C=g.url).indexOf("sku=")>0&&mt(C);var C;c.type==="json"&&g.headers.set("Accept","application/json");const L=(O,U,X)=>{if(b)return;if(O&&O.message!=="SecurityError"&&et(O),U&&X)return z(U);const se=Date.now();T.fetch(g).then(de=>{if(de.ok){const Me=S?de.clone():null;return z(de,Me,se)}return h(new Pe(de.statusText,de.status,c.url))}).catch(de=>{de.code!==20&&h(new Error(de.message))})},z=(O,U,X)=>{(c.type==="arrayBuffer"?O.arrayBuffer():c.type==="json"?O.json():O.text()).then(se=>{b||(U&&X&&function(de,Me,be){const Ie=Eo(de.url);if(he(Ie),!sr[Ie])return;const De={status:Me.status,statusText:Me.statusText,headers:new T.Headers};Me.headers.forEach(($e,nt)=>De.headers.set(nt,$e));const ke=ot(Me.headers.get("Cache-Control")||"");if(ke["no-store"])return;ke["max-age"]&&De.headers.set("Expires",new Date(be+1e3*ke["max-age"]).toUTCString());const We=De.headers.get("Expires");We&&(new Date(We).getTime()-be<42e4||function($e,nt){if(hi===void 0)try{new Response(new ReadableStream),hi=!0}catch{hi=!1}hi?nt($e.body):$e.blob().then(nt)}(Me,$e=>{const nt=new T.Response($e,De);he(Ie),sr[Ie]&&sr[Ie].then(ht=>ht.put(q(de.url),nt)).catch(ht=>et(ht.message))}))}(g,U,X),x=!0,h(null,se,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(se=>{b||h(new Error(se.message))})};return S?function(O,U){const X=Eo(O.url);if(he(X),!sr[X])return U(null);const se=q(O.url);sr[X].then(de=>{de.match(se).then(Me=>{const be=function(Ie){if(!Ie)return!1;const De=new Date(Ie.headers.get("Expires")||0),ke=ot(Ie.headers.get("Cache-Control")||"");return De>Date.now()&&!ke["no-cache"]}(Me);de.delete(se),be&&de.put(se,Me.clone()),U(null,Me,be)}).catch(U)}).catch(U)}(g,L):L(null,null),{cancel:()=>{b=!0,x||p.abort()}}}(o,t);if(Xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,t,void 0,!0)}var s;return function(c,h){const p=new T.XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in c.headers)p.setRequestHeader(g,c.headers[g]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(c.type==="json")try{g=JSON.parse(p.response)}catch(x){return h(x)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Pe(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(o,t)},te=function(o,t){return re(Fe(o,{type:"arrayBuffer"}),t)},ce=function(o,t){return re(Fe(o,{method:"POST"}),t)},Ce=function(o,t){return re(Fe(o,{method:"GET"}),t)};function it(o){const t=T.document.createElement("a");return t.href=o,t.protocol===T.document.location.protocol&&t.host===T.document.location.host}const Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let vt,bt;vt=[],bt=0;const At=function(o,t){if(zi.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),bt>=dn.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:o,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return vt.push(p),p}bt++;let s=!1;const c=()=>{if(!s)for(s=!0,bt--;vt.length&&bt<dn.MAX_PARALLEL_IMAGE_REQUESTS;){const p=vt.shift(),{requestParameters:g,callback:x,cancelled:b}=p;b||(p.cancel=At(g,x).cancel)}},h=te(o,(p,g,x,b)=>{c(),p?t(p):g&&(T.createImageBitmap?function(S,C){const L=new T.Blob([new Uint8Array(S)],{type:"image/png"});T.createImageBitmap(L).then(z=>{C(null,z)}).catch(z=>{C(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(S,C)=>t(S,C,x,b)):function(S,C){const L=new T.Image,z=T.URL;L.onload=()=>{C(null,L),z.revokeObjectURL(L.src),L.onload=null,T.requestAnimationFrame(()=>{L.src=Xe})},L.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new T.Blob([new Uint8Array(S)],{type:"image/png"});L.src=S.byteLength?z.createObjectURL(O):Xe}(g,(S,C)=>t(S,C,x,b)))});return{cancel:()=>{h.cancel(),c()}}};function Lt(o,t,s){s[o]&&s[o].indexOf(t)!==-1||(s[o]=s[o]||[],s[o].push(t))}function $t(o,t,s){if(s&&s[o]){const c=s[o].indexOf(t);c!==-1&&s[o].splice(c,1)}}class sn{constructor(t,s={}){Fe(this,s),this.type=t}}class Un extends sn{constructor(t,s={}){super("error",Fe({error:t},s))}}class Pn{on(t,s){return this._listeners=this._listeners||{},Lt(t,s,this._listeners),this}off(t,s){return $t(t,s,this._listeners),$t(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Lt(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){typeof t=="string"&&(t=new sn(t,s||{}));const c=t.type;if(this.listens(c)){t.target=this;const h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of h)x.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of p)$t(c,x,this._oneTimeListeners),x.call(this,t);const g=this._eventedParent;g&&(Fe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Un&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function _i(o,...t){for(const s of t)for(const c in s)o[c]=s[c];return o}function cn(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Hi(o){if(Array.isArray(o))return o.map(Hi);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const s in o)t[s]=Hi(o[s]);return t}return cn(o)}class Ei extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}var gi=Ei;class Fr{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,h]of s)this.bindings[c]=h}concat(t){return new Fr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var _s=Fr;const Wo={kind:"null"},wt={kind:"number"},Sn={kind:"string"},_n={kind:"boolean"},Ci={kind:"color"},Gs={kind:"object"},xn={kind:"value"},Ho={kind:"collator"},Ta={kind:"formatted"},Fl={kind:"resolvedImage"};function $r(o,t){return{kind:"array",itemType:o,N:t}}function di(o){if(o.kind==="array"){const t=di(o.itemType);return typeof o.N=="number"?`array<${t}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${t}>`}return o.kind}const zp=[Wo,wt,Sn,_n,Ci,Ta,Gs,$r(xn),Fl];function Ea(o,t){if(t.kind==="error")return null;if(o.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ea(o.itemType,t.itemType))&&(typeof o.N!="number"||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if(o.kind==="value"){for(const s of zp)if(!Ea(s,t))return null}}return`Expected ${di(o)} but found ${di(t)} instead.`}function Jc(o,t){return t.some(s=>s.kind===o.kind)}function Ca(o,t){return t.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}function Aa(o){var t={exports:{}};return o(t,t.exports),t.exports}var kp=Aa(function(o,t){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return c(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function p(x){return(b=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:b>1?1:b;var b}function g(x,b,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?x+(b-x)*S*6:2*S<1?b:3*S<2?x+(b-x)*(2/3-S)*6:x}try{t.parseCSSColor=function(x){var b,S=x.replace(/ /g,"").toLowerCase();if(S in s)return s[S].slice();if(S[0]==="#")return S.length===4?(b=parseInt(S.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:S.length===7&&(b=parseInt(S.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var C=S.indexOf("("),L=S.indexOf(")");if(C!==-1&&L+1===S.length){var z=S.substr(0,C),O=S.substr(C+1,L-(C+1)).split(","),U=1;switch(z){case"rgba":if(O.length!==4)return null;U=p(O.pop());case"rgb":return O.length!==3?null:[h(O[0]),h(O[1]),h(O[2]),U];case"hsla":if(O.length!==4)return null;U=p(O.pop());case"hsl":if(O.length!==3)return null;var X=(parseFloat(O[0])%360+360)%360/360,se=p(O[1]),de=p(O[2]),Me=de<=.5?de*(se+1):de+se-de*se,be=2*de-Me;return[c(255*g(be,Me,X+1/3)),c(255*g(be,Me,X)),c(255*g(be,Me,X-1/3)),U];default:return null}}return null}}catch{}});class Vi{constructor(t,s,c,h=1){this.r=t,this.g=s,this.b=c,this.a=h}static parse(t){if(!t)return;if(t instanceof Vi)return t;if(typeof t!="string")return;const s=kp.parseCSSColor(t);return s?new Vi(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[t,s,c,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(c)},${h})`}toArray(){const{r:t,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[255*t/h,255*s/h,255*c/h,h]}toArray01(){const{r:t,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[t/h,s/h,c/h,h]}toArray01PremultipliedAlpha(){const{r:t,g:s,b:c,a:h}=this;return[t,s,c,h]}}Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1),Vi.blue=new Vi(0,0,1,1);var vi=Vi;class qr{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ad{constructor(t,s,c,h,p){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=c,this.fontStack=h,this.textColor=p}}class ar{constructor(t){this.sections=t}static fromString(t){return new ar([new ad(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ar?t:ar.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.name]);continue}t.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),t.push(c)}return t}}class Zr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Zr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Qc(o,t,s,c){return typeof o=="number"&&o>=0&&o<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,t,s,c]:[o,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bl(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof vi||o instanceof qr||o instanceof ar||o instanceof Zr)return!0;if(Array.isArray(o)){for(const t of o)if(!Bl(t))return!1;return!0}if(typeof o=="object"){for(const t in o)if(!Bl(o[t]))return!1;return!0}return!1}function yi(o){if(o===null)return Wo;if(typeof o=="string")return Sn;if(typeof o=="boolean")return _n;if(typeof o=="number")return wt;if(o instanceof vi)return Ci;if(o instanceof qr)return Ho;if(o instanceof ar)return Ta;if(o instanceof Zr)return Fl;if(Array.isArray(o)){const t=o.length;let s;for(const c of o){const h=yi(c);if(s){if(s===h)continue;s=xn;break}s=h}return $r(s||xn,t)}return Gs}function js(o){const t=typeof o;return o===null?"":t==="string"||t==="number"||t==="boolean"?String(o):o instanceof vi||o instanceof ar||o instanceof Zr?o.toString():JSON.stringify(o)}class ld{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Bl(t[1]))return s.error("invalid value");const c=t[1];let h=yi(c);const p=s.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new ld(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vi?["rgba"].concat(this.value.toArray()):this.value instanceof ar?this.value.serialize():this.value}}var Ol=ld,Ji=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const eu={string:Sn,number:wt,boolean:_n,object:Gs};class Nl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,h=1;const p=t[0];if(p==="array"){let x,b;if(t.length>2){const S=t[1];if(typeof S!="string"||!(S in eu)||S==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=eu[S],h++}else x=xn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}c=$r(x,b)}else c=eu[p];const g=[];for(;h<t.length;h++){const x=s.parse(t[h],h,xn);if(!x)return null;g.push(x)}return new Nl(c,g)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!Ea(this.type,yi(c)))return c;if(s===this.args.length-1)throw new Ji(`Expected value to be of type ${di(this.type)}, but found ${di(yi(c))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const h=t.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(c=>c.serialize()))}}var $o=Nl;class gs{constructor(t){this.type=Ta,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=t.length-1;++g){const x=t[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let b=null;if(x["font-scale"]&&(b=s.parse(x["font-scale"],1,wt),!b))return null;let S=null;if(x["text-font"]&&(S=s.parse(x["text-font"],1,$r(Sn)),!S))return null;let C=null;if(x["text-color"]&&(C=s.parse(x["text-color"],1,Ci),!C))return null;const L=h[h.length-1];L.scale=b,L.font=S,L.textColor=C}else{const b=s.parse(t[g],1,xn);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new gs(h)}evaluate(t){return new ar(this.sections.map(s=>{const c=s.content.evaluate(t);return yi(c)===Fl?new ad("",c,null,null,null):new ad(js(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),t.push(c)}return t}}class tu{constructor(t){this.type=Fl,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const c=s.parse(t[1],1,Sn);return c?new tu(c):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),c=Zr.fromString(s);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(s)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ay={"to-boolean":_n,"to-color":Ci,"to-number":wt,"to-string":Sn};class cd{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0];if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");const h=ay[c],p=[];for(let g=1;g<t.length;g++){const x=s.parse(t[g],g,xn);if(!x)return null;p.push(x)}return new cd(h,p)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let s,c;for(const h of this.args){if(s=h.evaluate(t),c=null,s instanceof vi)return s;if(typeof s=="string"){const p=t.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Qc(s[0],s[1],s[2],s[3]),!c))return new vi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ji(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new Ji(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?ar.fromString(js(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Zr.fromString(js(this.args[0].evaluate(t))):js(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new gs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new tu(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}var Ia=cd;const ly=["Unknown","Point","LineString","Polygon"];var Rp=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ly[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*t-o[0])+this.featureDistanceData.bearing[1]*(c*t-o[1])}return 0}parseColor(o){let t=this._parseColorCache[o];return t||(t=this._parseColorCache[o]=vi.parse(o)),t}};class Pa{constructor(t,s,c,h){this.name=t,this.type=s,this._evaluate=c,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const c=t[0],h=Pa.definitions[c];if(!h)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=g.filter(([S])=>!Array.isArray(S)||S.length===t.length-1);let b=null;for(const[S,C]of x){b=new Np(s.registry,s.path,null,s.scope);const L=[];let z=!1;for(let O=1;O<t.length;O++){const U=t[O],X=Array.isArray(S)?S[O-1]:S.type,se=b.parse(U,1+L.length,X);if(!se){z=!0;break}L.push(se)}if(!z)if(Array.isArray(S)&&S.length!==L.length)b.error(`Expected ${S.length} arguments, but found ${L.length} instead.`);else{for(let O=0;O<L.length;O++){const U=Array.isArray(S)?S[O]:S.type,X=L[O];b.concat(O+1).checkSubtype(U,X.type)}if(b.errors.length===0)return new Pa(c,p,C,L)}}if(x.length===1)s.errors.push(...b.errors);else{const S=(x.length?x:g).map(([L])=>{return z=L,Array.isArray(z)?`(${z.map(di).join(", ")})`:`(${di(z.type)}...)`;var z}).join(" | "),C=[];for(let L=1;L<t.length;L++){const z=s.parse(t[L],1+C.length);if(!z)return null;C.push(di(z.type))}s.error(`Expected arguments of type ${S}, but found (${C.join(", ")}) instead.`)}return null}static register(t,s){Pa.definitions=s;for(const c in s)t[c]=Pa}}var qo=Pa;class Ws{constructor(t,s,c){this.type=Ho,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const h=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,_n);if(!h)return null;const p=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,_n);if(!p)return null;let g=null;return c.locale&&(g=s.parse(c.locale,1,Sn),!g)?null:new Ws(h,p,g)}evaluate(t){return new qr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const ys=8192;function ud(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function nu(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function cy(o,t){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*ys),Math.round(c*h*ys)]}function uy(o,t,s){const c=o[0]-t[0],h=o[1]-t[1],p=o[0]-s[0],g=o[1]-s[1];return c*g-p*h==0&&c*p<=0&&h*g<=0}function hd(o,t){let s=!1;for(let g=0,x=t.length;g<x;g++){const b=t[g];for(let S=0,C=b.length;S<C-1;S++){if(uy(o,b[S],b[S+1]))return!1;(h=b[S])[1]>(c=o)[1]!=(p=b[S+1])[1]>c[1]&&c[0]<(p[0]-h[0])*(c[1]-h[1])/(p[1]-h[1])+h[0]&&(s=!s)}}var c,h,p;return s}function Fp(o,t){for(let s=0;s<t.length;s++)if(hd(o,t[s]))return!0;return!1}function Ul(o,t,s,c){const h=c[0]-s[0],p=c[1]-s[1],g=(o[0]-s[0])*p-h*(o[1]-s[1]),x=(t[0]-s[0])*p-h*(t[1]-s[1]);return g>0&&x<0||g<0&&x>0}function hy(o,t,s){for(const S of s)for(let C=0;C<S.length-1;++C)if((x=[(g=S[C+1])[0]-(p=S[C])[0],g[1]-p[1]])[0]*(b=[(h=t)[0]-(c=o)[0],h[1]-c[1]])[1]-x[1]*b[0]!=0&&Ul(c,h,p,g)&&Ul(p,g,c,h))return!0;var c,h,p,g,x,b;return!1}function Bp(o,t){for(let s=0;s<o.length;++s)if(!hd(o[s],t))return!1;for(let s=0;s<o.length-1;++s)if(hy(o[s],o[s+1],t))return!1;return!0}function dy(o,t){for(let s=0;s<t.length;s++)if(Bp(o,t[s]))return!0;return!1}function dd(o,t,s){const c=[];for(let h=0;h<o.length;h++){const p=[];for(let g=0;g<o[h].length;g++){const x=cy(o[h][g],s);ud(t,x),p.push(x)}c.push(p)}return c}function ho(o,t,s){const c=[];for(let h=0;h<o.length;h++){const p=dd(o[h],t,s);c.push(p)}return c}function fd(o,t,s,c){if(o[0]<s[0]||o[0]>s[2]){const h=.5*c;let p=o[0]-s[0]>h?-c:s[0]-o[0]>h?c:0;p===0&&(p=o[0]-s[2]>h?-c:s[2]-o[0]>h?c:0),o[0]+=p}ud(t,o)}function pd(o,t,s,c){const h=Math.pow(2,c.z)*ys,p=[c.x*ys,c.y*ys],g=[];if(!o)return g;for(const x of o)for(const b of x){const S=[b.x+p[0],b.y+p[1]];fd(S,t,s,h),g.push(S)}return g}function Vl(o,t,s,c){const h=Math.pow(2,c.z)*ys,p=[c.x*ys,c.y*ys],g=[];if(!o)return g;for(const b of o){const S=[];for(const C of b){const L=[C.x+p[0],C.y+p[1]];ud(t,L),S.push(L)}g.push(S)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const b of g)for(const S of b)fd(S,t,s,h)}var x;return g}class Zo{constructor(t,s){this.type=_n,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Bl(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){const p=c.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Zo(c,c.features[h].geometry)}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Zo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Zo(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const x=dd(c.coordinates,p,g),b=pd(s.geometry(),h,p,g);if(!nu(h,p))return!1;for(const S of b)if(!hd(S,x))return!1}if(c.type==="MultiPolygon"){const x=ho(c.coordinates,p,g),b=pd(s.geometry(),h,p,g);if(!nu(h,p))return!1;for(const S of b)if(!Fp(S,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const x=dd(c.coordinates,p,g),b=Vl(s.geometry(),h,p,g);if(!nu(h,p))return!1;for(const S of b)if(!Bp(S,x))return!1}if(c.type==="MultiPolygon"){const x=ho(c.coordinates,p,g),b=Vl(s.geometry(),h,p,g);if(!nu(h,p))return!1;for(const S of b)if(!dy(S,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var iu=Zo;function La(o){if(o instanceof qo&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof iu)return!1;let t=!0;return o.eachChild(s=>{t&&!La(s)&&(t=!1)}),t}function Da(o){if(o instanceof qo&&o.name==="feature-state")return!1;let t=!0;return o.eachChild(s=>{t&&!Da(s)&&(t=!1)}),t}function ru(o,t){if(o instanceof qo&&t.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!ru(c,t)&&(s=!1)}),s}class Vn{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new Vn(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Op=Vn;class md{constructor(t,s=[],c,h=new _s,p=[]){this.registry=t,this.path=s,this.key=s.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c}parse(t,s,c,h,p={}){return s?this.concat(s,c,h)._parse(t,p):this._parse(t,p)}_parse(t,s){function c(h,p,g){return g==="assert"?new $o(p,[h]):g==="coerce"?new Ia(p,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(t,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,b=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||b.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(x,b))return null}else g=c(g,x,s.typeAnnotation||"coerce");else g=c(g,x,s.typeAnnotation||"assert")}if(!(g instanceof Ol)&&g.type.kind!=="resolvedImage"&&ou(g)){const x=new Rp;try{g=new Ol(g.type,g.evaluate(x))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c){const h=typeof t=="number"?this.path.concat(t):this.path,p=c?this.scope.concat(c):this.scope;return new md(this.registry,h,s||null,p,this.errors)}error(t,...s){const c=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new gi(c,t))}checkSubtype(t,s){const c=Ea(t,s);return c&&this.error(c),c}}var Np=md;function ou(o){if(o instanceof Op)return ou(o.boundExpression);if(o instanceof qo&&o.name==="error"||o instanceof Ws||o instanceof iu)return!1;const t=o instanceof Ia||o instanceof $o;let s=!0;return o.eachChild(c=>{s=t?s&&ou(c):s&&c instanceof Ol}),!!s&&La(o)&&ru(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function su(o,t){const s=o.length-1;let c,h,p=0,g=s,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),c=o[x],h=o[x+1],c<=t){if(x===s||t<h)return x;p=x+1}else{if(!(c>t))throw new Ji("Input is not a number.");g=x-1}return 0}class au{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[h,p]of c)this.labels.push(h),this.outputs.push(p)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,wt);if(!c)return null;const h=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let g=1;g<t.length;g+=2){const x=g===1?-1/0:t[g],b=t[g+1],S=g,C=g+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const L=s.parse(b,C,p);if(!L)return null;p=p||L.type,h.push([x,L])}return new au(p,c,h)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return c[0].evaluate(t);const p=s.length;return h>=s[p-1]?c[p-1].evaluate(t):c[su(s,h)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}var lu=au;function Rn(o,t,s){return o*(1-s)+t*s}var Gl=Object.freeze({__proto__:null,number:Rn,color:function(o,t,s){return new vi(Rn(o.r,t.r,s),Rn(o.g,t.g,s),Rn(o.b,t.b,s),Rn(o.a,t.a,s))},array:function(o,t,s){return o.map((c,h)=>Rn(c,t[h],s))}});const Hs=.95047,jl=1.08883,Up=4/29,Wl=6/29,_d=3*Wl*Wl,fy=Math.PI/180,py=180/Math.PI;function cu(o){return o>.008856451679035631?Math.pow(o,1/3):o/_d+Up}function gd(o){return o>Wl?o*o*o:_d*(o-Up)}function uu(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function hu(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function yd(o){const t=hu(o.r),s=hu(o.g),c=hu(o.b),h=cu((.4124564*t+.3575761*s+.1804375*c)/Hs),p=cu((.2126729*t+.7151522*s+.072175*c)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-cu((.0193339*t+.119192*s+.9503041*c)/jl)),alpha:o.a}}function Vp(o){let t=(o.l+16)/116,s=isNaN(o.a)?t:t+o.a/500,c=isNaN(o.b)?t:t-o.b/200;return t=1*gd(t),s=Hs*gd(s),c=jl*gd(c),new vi(uu(3.2404542*s-1.5371385*t-.4985314*c),uu(-.969266*s+1.8760108*t+.041556*c),uu(.0556434*s-.2040259*t+1.0572252*c),o.alpha)}function Gp(o,t,s){const c=t-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Hl={forward:yd,reverse:Vp,interpolate:function(o,t,s){return{l:Rn(o.l,t.l,s),a:Rn(o.a,t.a,s),b:Rn(o.b,t.b,s),alpha:Rn(o.alpha,t.alpha,s)}}},za={forward:function(o){const{l:t,a:s,b:c}=yd(o),h=Math.atan2(c,s)*py;return{h:h<0?h+360:h,c:Math.sqrt(s*s+c*c),l:t,alpha:o.a}},reverse:function(o){const t=o.h*fy,s=o.c;return Vp({l:o.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:o.alpha})},interpolate:function(o,t,s){return{h:Gp(o.h,t.h,s),c:Rn(o.c,t.c,s),l:Rn(o.l,t.l,s),alpha:Rn(o.alpha,t.alpha,s)}}};var xd=Object.freeze({__proto__:null,lab:Hl,hcl:za});class du{constructor(t,s,c,h,p){this.type=t,this.operator=s,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(t,s,c,h){let p=0;if(t.name==="exponential")p=vd(s,t.base,c,h);else if(t.name==="linear")p=vd(s,1,c,h);else if(t.name==="cubic-bezier"){const g=t.controlPoints;p=new A(g[0],g[1],g[2],g[3]).solve(vd(s,1,c,h))}return p}static parse(t,s){let[c,h,p,...g]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some(C=>typeof C!="number"||C<0||C>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,wt),!p)return null;const x=[];let b=null;c==="interpolate-hcl"||c==="interpolate-lab"?b=Ci:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let S=0;S<g.length;S+=2){const C=g[S],L=g[S+1],z=S+3,O=S+4;if(typeof C!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(x.length&&x[x.length-1][0]>=C)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const U=s.parse(L,O,b);if(!U)return null;b=b||U.type,x.push([C,U])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new du(b,c,h,p,x):s.error(`Type ${di(b)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return c[0].evaluate(t);const p=s.length;if(h>=s[p-1])return c[p-1].evaluate(t);const g=su(s,h),x=du.interpolationFactor(this.interpolation,h,s[g],s[g+1]),b=c[g].evaluate(t),S=c[g+1].evaluate(t);return this.operator==="interpolate"?Gl[this.type.kind.toLowerCase()](b,S,x):this.operator==="interpolate-hcl"?za.reverse(za.interpolate(za.forward(b),za.forward(S),x)):Hl.reverse(Hl.interpolate(Hl.forward(b),Hl.forward(S),x))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function vd(o,t,s,c){const h=c-s,p=o-s;return h===0?0:t===1?p/h:(Math.pow(t,p)-1)/(Math.pow(t,h)-1)}var Co=du;class wd{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const h=s.expectedType;h&&h.kind!=="value"&&(c=h);const p=[];for(const x of t.slice(1)){const b=s.parse(x,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!b)return null;c=c||b.type,p.push(b)}const g=h&&p.some(x=>Ea(h,x.type));return new wd(g?xn:c,p)}evaluate(t){let s,c=null,h=0;for(const p of this.args){if(h++,c=p.evaluate(t),c&&c instanceof Zr&&!c.available&&(s||(s=c),c=null,h===this.args.length))return s;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}var jp=wd;class bd{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let p=1;p<t.length-1;p+=2){const g=t[p];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=s.parse(t[p+1],p+1);if(!x)return null;c.push([g,x])}const h=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return h?new bd(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,c]of this.bindings)t.push(s,c.serialize());return t.push(this.result.serialize()),t}}var Sd=bd;class Md{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,wt),h=s.parse(t[2],2,$r(s.expectedType||xn));return c&&h?new Md(h.type.itemType,c,h):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new Ji(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Ji(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Ji(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var my=Md;class Td{constructor(t,s){this.type=_n,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,xn),h=s.parse(t[2],2,xn);return c&&h?Jc(c.type,[_n,Sn,wt,Wo,xn])?new Td(c,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Ca(s,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${di(yi(s))} instead.`);if(!Ca(c,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${di(yi(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var _y=Td;class $l{constructor(t,s,c){this.type=wt,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,xn),h=s.parse(t[2],2,xn);if(!c||!h)return null;if(!Jc(c.type,[_n,Sn,wt,Wo,xn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(c.type)} instead`);if(t.length===4){const p=s.parse(t[3],3,wt);return p?new $l(c,h,p):null}return new $l(c,h)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Ca(s,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${di(yi(s))} instead.`);if(!Ca(c,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${di(yi(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return c.indexOf(s,h)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Wp=$l;class fu{constructor(t,s,c,h,p,g){this.inputType=t,this.type=s,this.input=c,this.cases=h,this.outputs=p,this.otherwise=g}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const p={},g=[];for(let S=2;S<t.length-1;S+=2){let C=t[S];const L=t[S+1];Array.isArray(C)||(C=[C]);const z=s.concat(S);if(C.length===0)return z.error("Expected at least one branch label.");for(const U of C){if(typeof U!="number"&&typeof U!="string")return z.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,yi(U)))return null}else c=yi(U);if(p[String(U)]!==void 0)return z.error("Branch labels must be unique.");p[String(U)]=g.length}const O=s.parse(L,S,h);if(!O)return null;h=h||O.type,g.push(O)}const x=s.parse(t[1],1,xn);if(!x)return null;const b=s.parse(t[t.length-1],t.length-1,h);return b?x.type.kind!=="value"&&s.concat(1).checkSubtype(c,x.type)?null:new fu(c,h,x,p,g,b):null}evaluate(t){const s=this.input.evaluate(t);return(yi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],h={};for(const g of s){const x=h[this.cases[g]];x===void 0?(h[this.cases[g]]=c.length,c.push([this.cases[g],[g]])):c[x][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,x]of c)t.push(x.length===1?p(x[0]):x.map(p)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var gy=fu;class Ed{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const x=s.parse(t[g],g,_n);if(!x)return null;const b=s.parse(t[g+1],g+1,c);if(!b)return null;h.push([x,b]),c=c||b.type}const p=s.parse(t[t.length-1],t.length-1,c);return p?new Ed(c,h,p):null}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}var Hp=Ed;class ql{constructor(t,s,c,h){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,xn),h=s.parse(t[2],2,wt);if(!c||!h)return null;if(!Jc(c.type,[$r(xn),Sn,xn]))return s.error(`Expected first argument to be of type array or string, but found ${di(c.type)} instead`);if(t.length===4){const p=s.parse(t[3],3,wt);return p?new ql(c.type,c,h,p):null}return new ql(c.type,c,h)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Ca(s,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${di(yi(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return s.slice(c,h)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var $p=ql;function qp(o,t){return o==="=="||o==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Zp(o,t,s,c){return c.compare(t,s)===0}function ka(o,t,s){const c=o!=="=="&&o!=="!=";return class cA{constructor(p,g,x){this.type=_n,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let b=g.parse(p[1],1,xn);if(!b)return null;if(!qp(x,b.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${di(b.type)}'.`);let S=g.parse(p[2],2,xn);if(!S)return null;if(!qp(x,S.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${di(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return g.error(`Cannot compare types '${di(b.type)}' and '${di(S.type)}'.`);c&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new $o(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new $o(b.type,[S])));let C=null;if(p.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(p[3],3,Ho),!C)return null}return new cA(b,S,C)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const b=yi(g),S=yi(x);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Ji(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const b=yi(g),S=yi(x);if(b.kind!=="string"||S.kind!=="string")return t(p,g,x)}return this.collator?s(p,g,x,this.collator.evaluate(p)):t(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[o];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const yy=ka("==",function(o,t,s){return t===s},Zp),pu=ka("!=",function(o,t,s){return t!==s},function(o,t,s,c){return!Zp(0,t,s,c)}),Xp=ka("<",function(o,t,s){return t<s},function(o,t,s,c){return c.compare(t,s)<0}),Yp=ka(">",function(o,t,s){return t>s},function(o,t,s,c){return c.compare(t,s)>0}),xy=ka("<=",function(o,t,s){return t<=s},function(o,t,s,c){return c.compare(t,s)<=0}),vy=ka(">=",function(o,t,s){return t>=s},function(o,t,s,c){return c.compare(t,s)>=0});class Cd{constructor(t,s,c,h,p){this.type=Sn,this.number=t,this.locale=s,this.currency=c,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,wt);if(!c)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=s.parse(h.locale,1,Sn),!p))return null;let g=null;if(h.currency&&(g=s.parse(h.currency,1,Sn),!g))return null;let x=null;if(h["min-fraction-digits"]&&(x=s.parse(h["min-fraction-digits"],1,wt),!x))return null;let b=null;return h["max-fraction-digits"]&&(b=s.parse(h["max-fraction-digits"],1,wt),!b)?null:new Cd(c,p,g,x,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class mu{constructor(t){this.type=wt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${di(c.type)} instead.`):new mu(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Ji(`Expected value to be of type string or array, but found ${di(yi(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}const Ad={"==":yy,"!=":pu,">":Yp,"<":Xp,">=":vy,"<=":xy,array:$o,at:my,boolean:$o,case:Hp,coalesce:jp,collator:Ws,format:gs,image:tu,in:_y,"index-of":Wp,interpolate:Co,"interpolate-hcl":Co,"interpolate-lab":Co,length:mu,let:Sd,literal:Ol,match:gy,number:$o,"number-format":Cd,object:$o,slice:$p,step:lu,string:$o,"to-boolean":Ia,"to-color":Ia,"to-number":Ia,"to-string":Ia,var:Op,within:iu};function Id(o,[t,s,c,h]){t=t.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const p=h?h.evaluate(o):1,g=Qc(t,s,c,p);if(g)throw new Ji(g);return new vi(t/255*p,s/255*p,c/255*p,p)}function _u(o,t){return o in t}function Pd(o,t){const s=t[o];return s===void 0?null:s}function $s(o){return{type:o}}qo.register(Ad,{error:[{kind:"error"},[Sn],(o,[t])=>{throw new Ji(t.evaluate(o))}],typeof:[Sn,[xn],(o,[t])=>di(yi(t.evaluate(o)))],"to-rgba":[$r(wt,4),[Ci],(o,[t])=>t.evaluate(o).toArray()],rgb:[Ci,[wt,wt,wt],Id],rgba:[Ci,[wt,wt,wt,wt],Id],has:{type:_n,overloads:[[[Sn],(o,[t])=>_u(t.evaluate(o),o.properties())],[[Sn,Gs],(o,[t,s])=>_u(t.evaluate(o),s.evaluate(o))]]},get:{type:xn,overloads:[[[Sn],(o,[t])=>Pd(t.evaluate(o),o.properties())],[[Sn,Gs],(o,[t,s])=>Pd(t.evaluate(o),s.evaluate(o))]]},"feature-state":[xn,[Sn],(o,[t])=>Pd(t.evaluate(o),o.featureState||{})],properties:[Gs,[],o=>o.properties()],"geometry-type":[Sn,[],o=>o.geometryType()],id:[xn,[],o=>o.id()],zoom:[wt,[],o=>o.globals.zoom],pitch:[wt,[],o=>o.globals.pitch||0],"distance-from-center":[wt,[],o=>o.distanceFromCenter()],"heatmap-density":[wt,[],o=>o.globals.heatmapDensity||0],"line-progress":[wt,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[wt,[],o=>o.globals.skyRadialProgress||0],accumulated:[xn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[wt,$s(wt),(o,t)=>{let s=0;for(const c of t)s+=c.evaluate(o);return s}],"*":[wt,$s(wt),(o,t)=>{let s=1;for(const c of t)s*=c.evaluate(o);return s}],"-":{type:wt,overloads:[[[wt,wt],(o,[t,s])=>t.evaluate(o)-s.evaluate(o)],[[wt],(o,[t])=>-t.evaluate(o)]]},"/":[wt,[wt,wt],(o,[t,s])=>t.evaluate(o)/s.evaluate(o)],"%":[wt,[wt,wt],(o,[t,s])=>t.evaluate(o)%s.evaluate(o)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(o,[t,s])=>Math.pow(t.evaluate(o),s.evaluate(o))],sqrt:[wt,[wt],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[wt,[wt],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[wt,[wt],(o,[t])=>Math.log(t.evaluate(o))],log2:[wt,[wt],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[wt,[wt],(o,[t])=>Math.sin(t.evaluate(o))],cos:[wt,[wt],(o,[t])=>Math.cos(t.evaluate(o))],tan:[wt,[wt],(o,[t])=>Math.tan(t.evaluate(o))],asin:[wt,[wt],(o,[t])=>Math.asin(t.evaluate(o))],acos:[wt,[wt],(o,[t])=>Math.acos(t.evaluate(o))],atan:[wt,[wt],(o,[t])=>Math.atan(t.evaluate(o))],min:[wt,$s(wt),(o,t)=>Math.min(...t.map(s=>s.evaluate(o)))],max:[wt,$s(wt),(o,t)=>Math.max(...t.map(s=>s.evaluate(o)))],abs:[wt,[wt],(o,[t])=>Math.abs(t.evaluate(o))],round:[wt,[wt],(o,[t])=>{const s=t.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[wt,[wt],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[wt,[wt],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[_n,[Sn,xn],(o,[t,s])=>o.properties()[t.value]===s.value],"filter-id-==":[_n,[xn],(o,[t])=>o.id()===t.value],"filter-type-==":[_n,[Sn],(o,[t])=>o.geometryType()===t.value],"filter-<":[_n,[Sn,xn],(o,[t,s])=>{const c=o.properties()[t.value],h=s.value;return typeof c==typeof h&&c<h}],"filter-id-<":[_n,[xn],(o,[t])=>{const s=o.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[_n,[Sn,xn],(o,[t,s])=>{const c=o.properties()[t.value],h=s.value;return typeof c==typeof h&&c>h}],"filter-id->":[_n,[xn],(o,[t])=>{const s=o.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[_n,[Sn,xn],(o,[t,s])=>{const c=o.properties()[t.value],h=s.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[_n,[xn],(o,[t])=>{const s=o.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[_n,[Sn,xn],(o,[t,s])=>{const c=o.properties()[t.value],h=s.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[_n,[xn],(o,[t])=>{const s=o.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[_n,[xn],(o,[t])=>t.value in o.properties()],"filter-has-id":[_n,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[_n,[$r(Sn)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[_n,[$r(xn)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[_n,[Sn,$r(xn)],(o,[t,s])=>s.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[_n,[Sn,$r(xn)],(o,[t,s])=>function(c,h,p,g){for(;p<=g;){const x=p+g>>1;if(h[x]===c)return!0;h[x]>c?g=x-1:p=x+1}return!1}(o.properties()[t.value],s.value,0,s.value.length-1)],all:{type:_n,overloads:[[[_n,_n],(o,[t,s])=>t.evaluate(o)&&s.evaluate(o)],[$s(_n),(o,t)=>{for(const s of t)if(!s.evaluate(o))return!1;return!0}]]},any:{type:_n,overloads:[[[_n,_n],(o,[t,s])=>t.evaluate(o)||s.evaluate(o)],[$s(_n),(o,t)=>{for(const s of t)if(s.evaluate(o))return!0;return!1}]]},"!":[_n,[_n],(o,[t])=>!t.evaluate(o)],"is-supported-script":[_n,[Sn],(o,[t])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(t.evaluate(o))}],upcase:[Sn,[Sn],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Sn,[Sn],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Sn,$s(xn),(o,t)=>t.map(s=>js(s.evaluate(o))).join("")],"resolved-locale":[Sn,[Ho],(o,[t])=>t.evaluate(o).resolvedLocale()]});var Zl=Ad;function Kp(o){return{result:"success",value:o}}function Ra(o){return{result:"error",value:o}}function Fa(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Ld(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function gu(o){return!!o.expression&&o.expression.interpolated}function Fn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function yu(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function wy(o){return o}function Jp(o,t){const s=t.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",h=c||!(c||o.property!==void 0),p=o.type||(gu(t)?"exponential":"interval");if(s&&((o=_i({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],vi.parse(S[1])])),o.default=vi.parse(o.default?o.default:t.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!xd[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let g,x,b;if(p==="exponential")g=em;else if(p==="interval")g=Ba;else if(p==="categorical"){g=Qp,x=Object.create(null);for(const S of o.stops)x[S[0]]=S[1];b=typeof o.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=by}if(c){const S={},C=[];for(let O=0;O<o.stops.length;O++){const U=o.stops[O],X=U[0].zoom;S[X]===void 0&&(S[X]={zoom:X,type:o.type,property:o.property,default:o.default,stops:[]},C.push(X)),S[X].stops.push([U[0].value,U[1]])}const L=[];for(const O of C)L.push([S[O].zoom,Jp(S[O],t)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Co.interpolationFactor.bind(void 0,z),zoomStops:L.map(O=>O[0]),evaluate:({zoom:O},U)=>em({stops:L,base:o.base},t,O).evaluate(O,U)}}if(h){const S=p==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Co.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(C=>C[0]),evaluate:({zoom:C})=>g(o,t,C,x,b)}}return{kind:"source",evaluate(S,C){const L=C&&C.properties?C.properties[o.property]:void 0;return L===void 0?Xr(o.default,t.default):g(o,t,L,x,b)}}}function Xr(o,t,s){return o!==void 0?o:t!==void 0?t:s!==void 0?s:void 0}function Qp(o,t,s,c,h){return Xr(typeof s===h?c[s]:void 0,o.default,t.default)}function Ba(o,t,s){if(Fn(s)!=="number")return Xr(o.default,t.default);const c=o.stops.length;if(c===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const h=su(o.stops.map(p=>p[0]),s);return o.stops[h][1]}function em(o,t,s){const c=o.base!==void 0?o.base:1;if(Fn(s)!=="number")return Xr(o.default,t.default);const h=o.stops.length;if(h===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[h-1][0])return o.stops[h-1][1];const p=su(o.stops.map(C=>C[0]),s),g=function(C,L,z,O){const U=O-z,X=C-z;return U===0?0:L===1?X/U:(Math.pow(L,X)-1)/(Math.pow(L,U)-1)}(s,c,o.stops[p][0],o.stops[p+1][0]),x=o.stops[p][1],b=o.stops[p+1][1];let S=Gl[t.type]||wy;if(o.colorSpace&&o.colorSpace!=="rgb"){const C=xd[o.colorSpace];S=(L,z)=>C.reverse(C.interpolate(C.forward(L),C.forward(z),g))}return typeof x.evaluate=="function"?{evaluate(...C){const L=x.evaluate.apply(void 0,C),z=b.evaluate.apply(void 0,C);if(L!==void 0&&z!==void 0)return S(L,z,g)}}:S(x,b,g)}function by(o,t,s){return t.type==="color"?s=vi.parse(s):t.type==="formatted"?s=ar.fromString(s.toString()):t.type==="resolvedImage"?s=Zr.fromString(s.toString()):Fn(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),Xr(s,o.default,t.default)}class xu{constructor(t,s){this.expression=t,this._warningHistory={},this._evaluator=new Rp,this._defaultValue=s?function(c){return c.type==="color"&&(yu(c.default)||Array.isArray(c.default))?new vi(0,0,0,0):c.type==="color"?vi.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,c,h,p,g,x,b){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,h,p,g,x,b){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console!="undefined"&&console.warn(S.message)),this._defaultValue}}}function vu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Zl}function qs(o,t){const s=new Np(Zl,[],t?function(h){const p={color:Ci,string:Sn,number:wt,enum:Sn,boolean:_n,formatted:Ta,resolvedImage:Fl};return h.type==="array"?$r(p[h.value]||xn,h.length):p[h.type]}(t):void 0),c=s.parse(o,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Kp(new xu(c,t)):Ra(s.errors)}class wu{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!Da(s.expression)}evaluateWithoutErrorHandling(t,s,c,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,h,p,g)}evaluate(t,s,c,h,p,g){return this._styleExpression.evaluate(t,s,c,h,p,g)}}class Xl{constructor(t,s,c,h){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Da(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,c,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,h,p,g)}evaluate(t,s,c,h,p,g){return this._styleExpression.evaluate(t,s,c,h,p,g)}interpolationFactor(t,s,c){return this.interpolationType?Co.interpolationFactor(this.interpolationType,t,s,c):0}}function bu(o,t){if((o=qs(o,t)).result==="error")return o;const s=o.value.expression,c=La(s);if(!c&&!Fa(t))return Ra([new gi("","data expressions not supported")]);const h=ru(s,["zoom","pitch","distance-from-center"]);if(!h&&!Ld(t))return Ra([new gi("","zoom expressions not supported")]);const p=Oa(s);return p||h?p instanceof gi?Ra([p]):p instanceof Co&&!gu(t)?Ra([new gi("",'"interpolate" expressions cannot be used with this property')]):Kp(p?new Xl(c?"camera":"composite",o.value,p.labels,p instanceof Co?p.interpolation:void 0):new wu(c?"constant":"source",o.value)):Ra([new gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yl{constructor(t,s){this._parameters=t,this._specification=s,_i(this,Jp(this._parameters,this._specification))}static deserialize(t){return new Yl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Oa(o){let t=null;if(o instanceof Sd)t=Oa(o.result);else if(o instanceof jp){for(const s of o.args)if(t=Oa(s),t)break}else(o instanceof lu||o instanceof Co)&&o.input instanceof qo&&o.input.name==="zoom"&&(t=o);return t instanceof gi||o.eachChild(s=>{const c=Oa(s);c instanceof gi?t=c:!t&&c?t=new gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Nt{constructor(t,s,c,h){this.message=(t?`${t}: `:"")+c,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function Yr(o){const t=o.key,s=o.value,c=o.valueSpec||{},h=o.objectElementValidators||{},p=o.style,g=o.styleSpec;let x=[];const b=Fn(s);if(b!=="object")return[new Nt(t,s,`object expected, ${b} found`)];for(const S in s){const C=S.split(".")[0],L=c[C]||c["*"];let z;h[C]?z=h[C]:c[C]?z=$i:h["*"]?z=h["*"]:c["*"]&&(z=$i),z?x=x.concat(z({key:(t&&`${t}.`)+S,value:s[S],valueSpec:L,style:p,styleSpec:g,object:s,objectKey:S},s)):x.push(new Nt(t,s[S],`unknown property "${S}"`))}for(const S in c)h[S]||c[S].required&&c[S].default===void 0&&s[S]===void 0&&x.push(new Nt(t,s,`missing required property "${S}"`));return x}function Kl(o){const t=o.value,s=o.valueSpec,c=o.style,h=o.styleSpec,p=o.key,g=o.arrayElementValidator||$i;if(Fn(t)!=="array")return[new Nt(p,t,`array expected, ${Fn(t)} found`)];if(s.length&&t.length!==s.length)return[new Nt(p,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Nt(p,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};h.$version<7&&(x.function=s.function),Fn(s.value)==="object"&&(x=s.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(g({array:t,arrayIndex:S,value:t[S],valueSpec:x,style:c,styleSpec:h,key:`${p}[${S}]`}));return b}function Zs(o){const t=o.key,s=o.value,c=o.valueSpec;let h=Fn(s);if(h==="number"&&s!=s&&(h="NaN"),h!=="number")return[new Nt(t,s,`number expected, ${h} found`)];if("minimum"in c){let p=c.minimum;if(Fn(c.minimum)==="array"&&(p=c.minimum[o.arrayIndex]),s<p)return[new Nt(t,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in c){let p=c.maximum;if(Fn(c.maximum)==="array"&&(p=c.maximum[o.arrayIndex]),s>p)return[new Nt(t,s,`${s} is greater than the maximum value ${p}`)]}return[]}function Dd(o){const t=o.valueSpec,s=cn(o.value.type);let c,h,p,g={};const x=s!=="categorical"&&o.value.property===void 0,b=!x,S=Fn(o.value.stops)==="array"&&Fn(o.value.stops[0])==="array"&&Fn(o.value.stops[0][0])==="object",C=Yr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(O){if(s==="identity")return[new Nt(O.key,O.value,'identity function may not have a "stops" property')];let U=[];const X=O.value;return U=U.concat(Kl({key:O.key,value:X,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:L})),Fn(X)==="array"&&X.length===0&&U.push(new Nt(O.key,X,"array must have at least one stop")),U},default:function(O){return $i({key:O.key,value:O.value,valueSpec:t,style:O.style,styleSpec:O.styleSpec})}}});return s==="identity"&&x&&C.push(new Nt(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||C.push(new Nt(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!gu(o.valueSpec)&&C.push(new Nt(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(b&&!Fa(o.valueSpec)?C.push(new Nt(o.key,o.value,"property functions not supported")):x&&!Ld(o.valueSpec)&&C.push(new Nt(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!S||o.value.property!==void 0||C.push(new Nt(o.key,o.value,'"property" property is required')),C;function L(O){let U=[];const X=O.value,se=O.key;if(Fn(X)!=="array")return[new Nt(se,X,`array expected, ${Fn(X)} found`)];if(X.length!==2)return[new Nt(se,X,`array length 2 expected, length ${X.length} found`)];if(S){if(Fn(X[0])!=="object")return[new Nt(se,X,`object expected, ${Fn(X[0])} found`)];if(X[0].zoom===void 0)return[new Nt(se,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new Nt(se,X,"object stop key must have value")];const de=cn(X[0].zoom);if(typeof de!="number")return[new Nt(se,X[0].zoom,"stop zoom values must be numbers")];if(p&&p>de)return[new Nt(se,X[0].zoom,"stop zoom values must appear in ascending order")];de!==p&&(p=de,h=void 0,g={}),U=U.concat(Yr({key:`${se}[0]`,value:X[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Zs,value:z}}))}else U=U.concat(z({key:`${se}[0]`,value:X[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},X));return vu(Hi(X[1]))?U.concat([new Nt(`${se}[1]`,X[1],"expressions are not allowed in function stops.")]):U.concat($i({key:`${se}[1]`,value:X[1],valueSpec:t,style:O.style,styleSpec:O.styleSpec}))}function z(O,U){const X=Fn(O.value),se=cn(O.value),de=O.value!==null?O.value:U;if(c){if(X!==c)return[new Nt(O.key,de,`${X} stop domain type must match previous stop domain type ${c}`)]}else c=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new Nt(O.key,de,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&s!=="categorical"){let Me=`number expected, ${X} found`;return Fa(t)&&s===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(O.key,de,Me)]}return s!=="categorical"||X!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?s!=="categorical"&&X==="number"&&typeof se=="number"&&typeof h=="number"&&h!==void 0&&se<h?[new Nt(O.key,de,"stop domain values must appear in ascending order")]:(h=se,s==="categorical"&&se in g?[new Nt(O.key,de,"stop domain values must be unique")]:(g[se]=!0,[])):[new Nt(O.key,de,`integer expected, found ${String(se)}`)]}}function Xs(o){const t=(o.expressionContext==="property"?bu:qs)(Hi(o.value),o.valueSpec);if(t.result==="error")return t.value.map(c=>new Nt(`${o.key}${c.key}`,o.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new Nt(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Da(s))return[new Nt(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return Su(s,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!ru(s,["zoom","feature-state"]))return[new Nt(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!La(s))return[new Nt(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Su(o,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const h of t.valueSpec.expression.parameters)s.delete(h);if(s.size===0)return[];const c=[];return o instanceof qo&&s.has(o.name)?[new Nt(t.key,t.value,`["${o.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(o.eachChild(h=>{c.push(...Su(h,t))}),c)}function Jl(o){const t=o.key,s=o.value,c=o.valueSpec,h=[];return Array.isArray(c.values)?c.values.indexOf(cn(s))===-1&&h.push(new Nt(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(cn(s))===-1&&h.push(new Nt(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function zd(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!zd(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Ys(o,t="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zd(o)||(o=Ks(o));const s=o;let c=!0;try{c=function(S){if(!Na(S))return S;let C=Hi(S);return nm(C),C=tm(C),C}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const h=Re[`filter_${t}`],p=qs(c,h);let g=null;if(p.result==="error")throw new Error(p.value.map(S=>`${S.key}: ${S.message}`).join(", "));g=(S,C,L)=>p.value.evaluate(S,C,{},L);let x=null,b=null;if(c!==s){const S=qs(s,h);if(S.result==="error")throw new Error(S.value.map(C=>`${C.key}: ${C.message}`).join(", "));x=(C,L,z,O,U)=>S.value.evaluate(C,L,{},z,void 0,void 0,O,U),b=!La(S.value.expression)}return g=g,{filter:g,dynamicFilter:x||void 0,needGeometry:Ql(c),needFeature:!!b}}function tm(o){if(!Array.isArray(o))return o;const t=function(s){if(Sy.has(s[0])){for(let c=1;c<s.length;c++)if(Na(s[c]))return!0}return s}(o);return t===!0?t:t.map(s=>tm(s))}function nm(o){let t=!1;const s=[];if(o[0]==="case"){for(let c=1;c<o.length-1;c+=2)t=t||Na(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if(o[0]==="match"){t=t||Na(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if(o[0]==="step"){t=t||Na(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}t&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)nm(o[c])}function Na(o){if(!Array.isArray(o))return!1;if((t=o[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<o.length;s++)if(Na(o[s]))return!0;return!1}const Sy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function My(o,t){return o<t?-1:o>t?1:0}function Ql(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let t=1;t<o.length;t++)if(Ql(o[t]))return!0;return!1}function Ks(o){if(!o)return!0;const t=o[0];return o.length<=1?t!=="any":t==="=="?_r(o[1],o[2],"=="):t==="!="?Mu(_r(o[1],o[2],"==")):t==="<"||t===">"||t==="<="||t===">="?_r(o[1],o[2],t):t==="any"?(s=o.slice(1),["any"].concat(s.map(Ks))):t==="all"?["all"].concat(o.slice(1).map(Ks)):t==="none"?["all"].concat(o.slice(1).map(Ks).map(Mu)):t==="in"?ec(o[1],o.slice(2)):t==="!in"?Mu(ec(o[1],o.slice(2))):t==="has"?im(o[1]):t==="!has"?Mu(im(o[1])):t!=="within"||o;var s}function _r(o,t,s){switch(o){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,o,t]}}function ec(o,t){if(t.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",o,["literal",t.sort(My)]]:["filter-in-small",o,["literal",t]]}}function im(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Mu(o){return["!",o]}function kd(o){return zd(Hi(o.value))?Xs(_i({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):rm(o)}function rm(o){const t=o.value,s=o.key;if(Fn(t)!=="array")return[new Nt(s,t,`array expected, ${Fn(t)} found`)];const c=o.styleSpec;let h,p=[];if(t.length<1)return[new Nt(s,t,"filter array must have at least 1 element")];switch(p=p.concat(Jl({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),cn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&cn(t[1])==="$type"&&p.push(new Nt(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Nt(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Fn(t[1]),h!=="string"&&p.push(new Nt(`${s}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Fn(t[g]),cn(t[1])==="$type"?p=p.concat(Jl({key:`${s}[${g}]`,value:t[g],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new Nt(`${s}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)p=p.concat(rm({key:`${s}[${g}]`,value:t[g],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":h=Fn(t[1]),t.length!==2?p.push(new Nt(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new Nt(`${s}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Fn(t[1]),t.length!==2?p.push(new Nt(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&p.push(new Nt(`${s}[1]`,t[1],`object expected, ${h} found`))}return p}function Tu(o,t){const s=o.key,c=o.style,h=o.styleSpec,p=o.value,g=o.objectKey,x=h[`${t}_${o.layerType}`];if(!x)return[];const b=g.match(/^(.*)-transition$/);if(t==="paint"&&b&&x[b[1]]&&x[b[1]].transition)return $i({key:s,value:p,valueSpec:h.transition,style:c,styleSpec:h});const S=o.valueSpec||x[g];if(!S)return[new Nt(s,p,`unknown property "${g}"`)];let C;if(Fn(p)==="string"&&Fa(S)&&!S.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new Nt(s,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const L=[];return o.layerType==="symbol"&&(g==="text-field"&&c&&!c.glyphs&&L.push(new Nt(s,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&yu(Hi(p))&&cn(p.type)==="identity"&&L.push(new Nt(s,p,'"text-font" does not support identity functions'))),L.concat($i({key:o.key,value:p,valueSpec:S,style:c,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:g}))}function om(o){return Tu(o,"paint")}function Eu(o){return Tu(o,"layout")}function sm(o){let t=[];const s=o.value,c=o.key,h=o.style,p=o.styleSpec;s.type||s.ref||t.push(new Nt(c,s,'either "type" or "ref" is required'));let g=cn(s.type);const x=cn(s.ref);if(s.id){const b=cn(s.id);for(let S=0;S<o.arrayIndex;S++){const C=h.layers[S];cn(C.id)===b&&t.push(new Nt(c,s.id,`duplicate layer id "${s.id}", previously used at line ${C.id.__line__}`))}}if("ref"in s){let b;["type","source","source-layer","filter","layout"].forEach(S=>{S in s&&t.push(new Nt(c,s[S],`"${S}" is prohibited for ref layers`))}),h.layers.forEach(S=>{cn(S.id)===x&&(b=S)}),b?b.ref?t.push(new Nt(c,s.ref,"ref cannot reference another ref layer")):g=cn(b.type):typeof x=="string"&&t.push(new Nt(c,s.ref,`ref layer "${x}" not found`))}else if(g!=="background"&&g!=="sky")if(s.source){const b=h.sources&&h.sources[s.source],S=b&&cn(b.type);b?S==="vector"&&g==="raster"?t.push(new Nt(c,s.source,`layer "${s.id}" requires a raster source`)):S==="raster"&&g!=="raster"?t.push(new Nt(c,s.source,`layer "${s.id}" requires a vector source`)):S!=="vector"||s["source-layer"]?S==="raster-dem"&&g!=="hillshade"?t.push(new Nt(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||S==="geojson"&&b.lineMetrics||t.push(new Nt(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Nt(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Nt(c,s.source,`source "${s.source}" not found`))}else t.push(new Nt(c,s,'missing required property "source"'));return t=t.concat(Yr({key:c,value:s,valueSpec:p.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${c}.type`,value:s.type,valueSpec:p.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:b=>kd(_i({layerType:g},b)),layout:b=>Yr({layer:s,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>Eu(_i({layerType:g},S))}}),paint:b=>Yr({layer:s,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>om(_i({layerType:g},S))}})}})),t}function Ua(o){const t=o.value,s=o.key,c=Fn(t);return c!=="string"?[new Nt(s,t,`string expected, ${c} found`)]:[]}const Cu={promoteId:function({key:o,value:t}){if(Fn(t)==="string")return Ua({key:o,value:t});{const s=[];for(const c in t)s.push(...Ua({key:`${o}.${c}`,value:t[c]}));return s}}};function am(o){const t=o.value,s=o.key,c=o.styleSpec,h=o.style;if(!t.type)return[new Nt(s,t,'"type" is required')];const p=cn(t.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=Yr({key:s,value:t,valueSpec:c[`source_${p.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:Cu}),g;case"geojson":if(g=Yr({key:s,value:t,valueSpec:c.source_geojson,style:h,styleSpec:c,objectElementValidators:Cu}),t.cluster)for(const x in t.clusterProperties){const[b,S]=t.clusterProperties[x],C=typeof b=="string"?[b,["accumulated"],["get",x]]:b;g.push(...Xs({key:`${s}.${x}.map`,value:S,expressionContext:"cluster-map"})),g.push(...Xs({key:`${s}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return g;case"video":return Yr({key:s,value:t,valueSpec:c.source_video,style:h,styleSpec:c});case"image":return Yr({key:s,value:t,valueSpec:c.source_image,style:h,styleSpec:c});case"canvas":return[new Nt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:c})}}function Rd(o){const t=o.value,s=o.styleSpec,c=s.light,h=o.style;let p=[];const g=Fn(t);if(t===void 0)return p;if(g!=="object")return p=p.concat([new Nt("light",t,`object expected, ${g} found`)]),p;for(const x in t){const b=x.match(/^(.*)-transition$/);p=p.concat(b&&c[b[1]]&&c[b[1]].transition?$i({key:x,value:t[x],valueSpec:s.transition,style:h,styleSpec:s}):c[x]?$i({key:x,value:t[x],valueSpec:c[x],style:h,styleSpec:s}):[new Nt(x,t[x],`unknown property "${x}"`)])}return p}function Fd(o){const t=o.value,s=o.key,c=o.style,h=o.styleSpec,p=h.terrain;let g=[];const x=Fn(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new Nt("terrain",t,`object expected, ${x} found`)]),g;for(const b in t){const S=b.match(/^(.*)-transition$/);g=g.concat(S&&p[S[1]]&&p[S[1]].transition?$i({key:b,value:t[b],valueSpec:h.transition,style:c,styleSpec:h}):p[b]?$i({key:b,value:t[b],valueSpec:p[b],style:c,styleSpec:h}):[new Nt(b,t[b],`unknown property "${b}"`)])}if(t.source){const b=c.sources&&c.sources[t.source],S=b&&cn(b.type);b?S!=="raster-dem"&&g.push(new Nt(s,t.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):g.push(new Nt(s,t.source,`source "${t.source}" not found`))}else g.push(new Nt(s,t,'terrain is missing required property "source"'));return g}function lm(o){const t=o.value,s=o.style,c=o.styleSpec,h=c.fog;let p=[];const g=Fn(t);if(t===void 0)return p;if(g!=="object")return p=p.concat([new Nt("fog",t,`object expected, ${g} found`)]),p;for(const x in t){const b=x.match(/^(.*)-transition$/);p=p.concat(b&&h[b[1]]&&h[b[1]].transition?$i({key:x,value:t[x],valueSpec:c.transition,style:s,styleSpec:c}):h[x]?$i({key:x,value:t[x],valueSpec:h[x],style:s,styleSpec:c}):[new Nt(x,t[x],`unknown property "${x}"`)])}return p}const Au={"*":()=>[],array:Kl,boolean:function(o){const t=o.value,s=o.key,c=Fn(t);return c!=="boolean"?[new Nt(s,t,`boolean expected, ${c} found`)]:[]},number:Zs,color:function(o){const t=o.key,s=o.value,c=Fn(s);return c!=="string"?[new Nt(t,s,`color expected, ${c} found`)]:kp.parseCSSColor(s)===null?[new Nt(t,s,`color expected, "${s}" found`)]:[]},enum:Jl,filter:kd,function:Dd,layer:sm,object:Yr,source:am,light:Rd,terrain:Fd,fog:lm,string:Ua,formatted:function(o){return Ua(o).length===0?[]:Xs(o)},resolvedImage:function(o){return Ua(o).length===0?[]:Xs(o)},projection:function(o){const t=o.value,s=o.styleSpec,c=s.projection,h=o.style;let p=[];const g=Fn(t);if(g==="object")for(const x in t)p=p.concat($i({key:x,value:t[x],valueSpec:c[x],style:h,styleSpec:s}));else g!=="string"&&(p=p.concat([new Nt("projection",t,`object or string expected, ${g} found`)]));return p}};function $i(o){const t=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&yu(cn(t))?Dd(o):s.expression&&vu(Hi(t))?Xs(o):s.type&&Au[s.type]?Au[s.type](o):Yr(_i({},o,{valueSpec:s.type?c[s.type]:s}))}function cm(o){const t=o.value,s=o.key,c=Ua(o);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Nt(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Nt(s,t,'"glyphs" url must include a "{range}" token'))),c}function um(o,t=Re){return fo($i({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,objectElementValidators:{glyphs:cm,"*":()=>[]}}))}const hm=o=>fo(om(o)),Ty=o=>fo(Eu(o));function fo(o){return o.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function dm(o,t){let s=!1;if(t&&t.length)for(const c of t)o.fire(new Un(new Error(c.message))),s=!0;return s}var Va=Ao;function Ao(o,t,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var h=new Int32Array(this.arrayBuffer);o=h[0],this.d=(t=h[1])+2*(s=h[2]);for(var p=0;p<this.d*this.d;p++){var g=h[3+p],x=h[3+p+1];c.push(g===x?null:h.subarray(g,x))}var b=h[3+c.length+1];this.keys=h.subarray(h[3+c.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=t+2*s;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=o,this.padding=s,this.scale=t/o,this.uid=0;var C=s/t*o;this.min=-C,this.max=o+C}Ao.prototype.insert=function(o,t,s,c,h){this._forEachCell(t,s,c,h,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(h)},Ao.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ao.prototype._insertCell=function(o,t,s,c,h,p){this.cells[h].push(p)},Ao.prototype.query=function(o,t,s,c,h){var p=this.min,g=this.max;if(o<=p&&t<=p&&g<=s&&g<=c&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,t,s,c,this._queryCell,x,{},h),x},Ao.prototype._queryCell=function(o,t,s,c,h,p,g,x){var b=this.cells[h];if(b!==null)for(var S=this.keys,C=this.bboxes,L=0;L<b.length;L++){var z=b[L];if(g[z]===void 0){var O=4*z;(x?x(C[O+0],C[O+1],C[O+2],C[O+3]):o<=C[O+2]&&t<=C[O+3]&&s>=C[O+0]&&c>=C[O+1])?(g[z]=!0,p.push(S[z])):g[z]=!1}}},Ao.prototype._forEachCell=function(o,t,s,c,h,p,g,x){for(var b=this._convertToCellCoord(o),S=this._convertToCellCoord(t),C=this._convertToCellCoord(s),L=this._convertToCellCoord(c),z=b;z<=C;z++)for(var O=S;O<=L;O++){var U=this.d*O+z;if((!x||x(this._convertFromCellCoord(z),this._convertFromCellCoord(O),this._convertFromCellCoord(z+1),this._convertFromCellCoord(O+1)))&&h.call(this,o,t,s,c,U,p,g,x))return}},Ao.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Ao.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Ao.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,t=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var h=new Int32Array(t+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=t,g=0;g<o.length;g++){var x=o[g];h[3+g]=p,h.set(x,p),p+=x.length}return h[3+o.length]=p,h.set(this.keys,p),h[3+o.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};const Iu={};function Vt(o,t,s={}){Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Iu[t]={klass:o,omit:s.omit||[]}}Vt(Object,"Object"),Va.serialize=function(o,t){const s=o.toArrayBuffer();return t&&t.push(s),{buffer:s}},Va.deserialize=function(o){return new Va(o.buffer)},Object.defineProperty(Va,"name",{value:"Grid"}),Vt(Va,"Grid"),Vt(vi,"Color"),Vt(Error,"Error"),Vt(Pe,"AJAXError"),Vt(Zr,"ResolvedImage"),Vt(Yl,"StylePropertyFunction"),Vt(xu,"StyleExpression",{omit:["_evaluator"]}),Vt(Xl,"ZoomDependentExpression"),Vt(wu,"ZoomConstantExpression"),Vt(qo,"CompoundExpression",{omit:["_evaluate"]});for(const o in Zl)Iu[Zl[o]._classRegistryKey]||Vt(Zl[o],`Expression${o}`);function fm(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function pm(o){return T.ImageBitmap&&o instanceof T.ImageBitmap}function tc(o,t){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(fm(o)||pm(o))return t&&t.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return t&&t.push(s.buffer),s}if(o instanceof T.ImageData)return t&&t.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(tc(c,t));return s}if(typeof o=="object"){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const h=s.serialize?s.serialize(o,t):{};if(!s.serialize){for(const p in o)o.hasOwnProperty(p)&&(Iu[c].omit.indexOf(p)>=0||(h[p]=tc(o[p],t)));o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof o)}function nc(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||fm(o)||pm(o)||ArrayBuffer.isView(o)||o instanceof T.ImageData)return o;if(Array.isArray(o))return o.map(nc);if(typeof o=="object"){const t=o.$name||"Object",{klass:s}=Iu[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const h of Object.keys(o))h!=="$name"&&(c[h]=nc(o[h]));return c}throw new Error("can't deserialize object of type "+typeof o)}class mm{constructor(){this.first=!0}update(t,s){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const _m=o=>o>=1536&&o<=1791,gm=o=>o>=1872&&o<=1919,ic=o=>o>=2208&&o<=2303,ym=o=>o>=11904&&o<=12031,xm=o=>o>=12032&&o<=12255,rc=o=>o>=12272&&o<=12287,Pu=o=>o>=12288&&o<=12351,Lu=o=>o>=12352&&o<=12447,Du=o=>o>=12448&&o<=12543,Bd=o=>o>=12544&&o<=12591,Od=o=>o>=12704&&o<=12735,Nd=o=>o>=12736&&o<=12783,Ud=o=>o>=12784&&o<=12799,zu=o=>o>=12800&&o<=13055,ku=o=>o>=13056&&o<=13311,vm=o=>o>=13312&&o<=19903,Vd=o=>o>=19968&&o<=40959,wm=o=>o>=40960&&o<=42127,Ru=o=>o>=42128&&o<=42191,bm=o=>o>=44032&&o<=55215,Sm=o=>o>=63744&&o<=64255,Gd=o=>o>=64336&&o<=65023,Mm=o=>o>=65040&&o<=65055,jd=o=>o>=65072&&o<=65103,Wd=o=>o>=65104&&o<=65135,Hd=o=>o>=65136&&o<=65279,$d=o=>o>=65280&&o<=65519;function Fu(o){for(const t of o)if(r(t.charCodeAt(0)))return!0;return!1}function Bu(o){for(const t of o)if(!f(t.charCodeAt(0)))return!1;return!0}function f(o){return!(_m(o)||gm(o)||ic(o)||Gd(o)||Hd(o))}function r(o){return!(o!==746&&o!==747&&(o<4352||!(Od(o)||Bd(o)||jd(o)&&!(o>=65097&&o<=65103)||Sm(o)||ku(o)||ym(o)||Nd(o)||!(!Pu(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||vm(o)||Vd(o)||zu(o)||(t=>t>=12592&&t<=12687)(o)||(t=>t>=43360&&t<=43391)(o)||(t=>t>=55216&&t<=55295)(o)||(t=>t>=4352&&t<=4607)(o)||bm(o)||Lu(o)||rc(o)||(t=>t>=12688&&t<=12703)(o)||xm(o)||Ud(o)||Du(o)&&o!==12540||!(!$d(o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Wd(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(t=>t>=5120&&t<=5759)(o)||(t=>t>=6320&&t<=6399)(o)||Mm(o)||(t=>t>=19904&&t<=19967)(o)||wm(o)||Ru(o))))}function u(o){return!(r(o)||function(t){return!!((s=>s>=128&&s<=255)(t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||(s=>s>=8192&&s<=8303)(t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||(s=>s>=8448&&s<=8527)(t)||(s=>s>=8528&&s<=8591)(t)||(s=>s>=8960&&s<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||(s=>s>=9216&&s<=9279)(t)&&t!==9251||(s=>s>=9280&&s<=9311)(t)||(s=>s>=9312&&s<=9471)(t)||(s=>s>=9632&&s<=9727)(t)||(s=>s>=9728&&s<=9983)(t)&&!(t>=9754&&t<=9759)||(s=>s>=11008&&s<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Pu(t)||Du(t)||(s=>s>=57344&&s<=63743)(t)||jd(t)||Wd(t)||$d(t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(o))}function m(o){return o>=1424&&o<=2303||Gd(o)||Hd(o)}function y(o,t){return!(!t&&m(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(s=>s>=6016&&s<=6143)(o))}function v(o){for(const t of o)if(m(t.charCodeAt(0)))return!0;return!1}const M="deferred",E="loading",I="loaded";let R=null,N="unavailable",j=null;const Y=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(N="error"),R&&R(o)};function ie(){oe.fire(new sn("pluginStateChange",{pluginStatus:N,pluginURL:j}))}const oe=new Pn,J=function(){return N},_e=function(){if(N!==M||!j)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");N=E,ie(),j&&te({url:j},o=>{o?Y(o):(N=I,ie())})},Q={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>N===I||Q.applyArabicShaping!=null,isLoading:()=>N===E,setState(o){N=o.pluginStatus,j=o.pluginURL},isParsed:()=>Q.applyArabicShaping!=null&&Q.processBidirectionalText!=null&&Q.processStyledBidirectionalText!=null,getPluginURL:()=>j};class ae{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mm,this.transition={},this.pitch=0)}isSupportedScript(t){return function(s,c){for(const h of s)if(!y(h.charCodeAt(0),c))return!1;return!0}(t,Q.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class le{constructor(t,s){this.property=t,this.value=s,this.expression=function(c,h){if(yu(c))return new Yl(c,h);if(vu(c)){const p=bu(c,h);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=c;return typeof c=="string"&&h.type==="color"&&(p=vi.parse(c)),{kind:"constant",evaluate:()=>p}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class we{constructor(t){this.property=t,this.value=new le(t,void 0)}transitioned(t,s){return new ye(this.property,this.value,s,Fe({},t.transition,this.transition),t.now)}untransitioned(){return new ye(this.property,this.value,null,{},0)}}class pe{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ze(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new we(this._values[t].property)),this._values[t].value=new le(this._values[t].property,s===null?void 0:Ze(s))}getTransition(t){return Ze(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new we(this._values[t].property)),this._values[t].transition=Ze(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){const c=new Le(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(t,s._values[h]);return c}untransitioned(){const t=new Le(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class ye{constructor(t,s,c,h,p){const g=h.delay||0,x=h.duration||0;p=p||0,this.property=t,this.value=s,this.begin=p+g,this.end=this.begin+x,t.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const h=t.now||0,p=this.value.possiblyEvaluate(t,s,c),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(t,s,c);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,s,c),p,$(x))}}return p}}class Le{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const h=new Ge(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,s,c);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ve{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Ze(this._values[t].value)}setValue(t,s){this._values[t]=new le(this._values[t].property,s===null?void 0:Ze(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const h=new Ge(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,s,c);return h}}class He{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,h){return this.property.evaluate(this.value,this.parameters,t,s,c,h)}}class Ge{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ue{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,c){const h=Gl[this.specification.type];return h?h(t,s,c):t}}class ve{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,h){return new He(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,h)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new He(this,{kind:"constant",value:void 0},t.parameters);const h=Gl[this.specification.type];return h?new He(this,{kind:"constant",value:h(t.value.value,s.value.value,c)},t.parameters):t}evaluate(t,s,c,h,p,g){return t.kind==="constant"?t.value:t.evaluate(s,c,h,p,g)}}class at extends ve{possiblyEvaluate(t,s,c,h){if(t.value===void 0)return new He(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const p=t.expression.evaluate(s,null,{},c,h),g=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,x=this._calculate(g,g,g,s);return new He(this,{kind:"constant",value:x},s)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new He(this,{kind:"constant",value:p},s)}return new He(this,t.expression,s)}evaluate(t,s,c,h,p,g){if(t.kind==="source"){const x=t.evaluate(s,c,h,p,g);return this._calculate(x,x,x,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},c,h),t.evaluate({zoom:Math.floor(s.zoom)},c,h),t.evaluate({zoom:Math.floor(s.zoom)+1},c,h),s):t.value}_calculate(t,s,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s,other:c}:{from:c,to:s,other:t}}interpolate(t){return t}}class rt{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(s,null,{},c,h);return this._calculate(p,p,p,s)}return this._calculate(t.expression.evaluate(new ae(Math.floor(s.zoom-1),s)),t.expression.evaluate(new ae(Math.floor(s.zoom),s)),t.expression.evaluate(new ae(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:c,to:s}}interpolate(t){return t}}class It{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,h){return!!t.expression.evaluate(s,null,{},c,h)}interpolate(){return!1}}class Ke{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new ae(0,{});for(const c in t){const h=t[c];h.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new le(h,void 0),g=this.defaultTransitionablePropertyValues[c]=new we(h);this.defaultTransitioningPropertyValues[c]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(s)}}}function Jt(o,t){return 256*(o=K(Math.floor(o),0,255))+K(Math.floor(t),0,255)}Vt(ve,"DataDrivenProperty"),Vt(Ue,"DataConstantProperty"),Vt(at,"CrossFadedDataDrivenProperty"),Vt(rt,"CrossFadedProperty"),Vt(It,"ColorRampProperty");const Ct={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Tt{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _t{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function St(o,t=1){let s=0,c=0;return{members:o.map(h=>{const p=Ct[h.type].BYTES_PER_ELEMENT,g=s=ln(s,Math.max(t,p)),x=h.components||1;return c=Math.max(c,p),s+=p*x,{name:h.name,type:h.type,components:x,offset:g}}),size:ln(s,Math.max(c,t)),alignment:t}}function ln(o,t){return Math.ceil(o/t)*t}class en extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const h=2*t;return this.int16[h+0]=s,this.int16[h+1]=c,t}}en.prototype.bytesPerElement=4,Vt(en,"StructArrayLayout2i4");class vn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const p=3*t;return this.int16[p+0]=s,this.int16[p+1]=c,this.int16[p+2]=h,t}}vn.prototype.bytesPerElement=6,Vt(vn,"StructArrayLayout3i6");class Kt extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,h)}emplace(t,s,c,h,p){const g=4*t;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=h,this.int16[g+3]=p,t}}Kt.prototype.bytesPerElement=8,Vt(Kt,"StructArrayLayout4i8");class gn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,c,h,p,g,x)}emplace(t,s,c,h,p,g,x,b){const S=6*t,C=12*t,L=3*t;return this.int16[S+0]=s,this.int16[S+1]=c,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=g,this.uint8[C+7]=x,this.float32[L+2]=b,t}}gn.prototype.bytesPerElement=12,Vt(gn,"StructArrayLayout2i4ub1f12");class Gn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,h)}emplace(t,s,c,h,p){const g=4*t;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=h,this.float32[g+3]=p,t}}Gn.prototype.bytesPerElement=16,Vt(Gn,"StructArrayLayout4f16");class Xn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x,b,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,t,s,c,h,p,g,x,b,S,C)}emplace(t,s,c,h,p,g,x,b,S,C,L){const z=10*t;return this.uint16[z+0]=s,this.uint16[z+1]=c,this.uint16[z+2]=h,this.uint16[z+3]=p,this.uint16[z+4]=g,this.uint16[z+5]=x,this.uint16[z+6]=b,this.uint16[z+7]=S,this.uint16[z+8]=C,this.uint16[z+9]=L,t}}Xn.prototype.bytesPerElement=20,Vt(Xn,"StructArrayLayout10ui20");class Ai extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,c,h,p,g,x,b)}emplace(t,s,c,h,p,g,x,b,S){const C=8*t;return this.uint16[C+0]=s,this.uint16[C+1]=c,this.uint16[C+2]=h,this.uint16[C+3]=p,this.uint16[C+4]=g,this.uint16[C+5]=x,this.uint16[C+6]=b,this.uint16[C+7]=S,t}}Ai.prototype.bytesPerElement=16,Vt(Ai,"StructArrayLayout8ui16");class Qn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,h,p,g)}emplace(t,s,c,h,p,g,x){const b=6*t;return this.int16[b+0]=s,this.int16[b+1]=c,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=g,this.int16[b+5]=x,t}}Qn.prototype.bytesPerElement=12,Vt(Qn,"StructArrayLayout6i12");class Br extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x,b,S,C,L,z){const O=this.length;return this.resize(O+1),this.emplace(O,t,s,c,h,p,g,x,b,S,C,L,z)}emplace(t,s,c,h,p,g,x,b,S,C,L,z,O){const U=12*t;return this.int16[U+0]=s,this.int16[U+1]=c,this.int16[U+2]=h,this.int16[U+3]=p,this.uint16[U+4]=g,this.uint16[U+5]=x,this.uint16[U+6]=b,this.uint16[U+7]=S,this.int16[U+8]=C,this.int16[U+9]=L,this.int16[U+10]=z,this.int16[U+11]=O,t}}Br.prototype.bytesPerElement=24,Vt(Br,"StructArrayLayout4i4ui4i24");class Io extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,h,p,g)}emplace(t,s,c,h,p,g,x){const b=10*t,S=5*t;return this.int16[b+0]=s,this.int16[b+1]=c,this.int16[b+2]=h,this.float32[S+2]=p,this.float32[S+3]=g,this.float32[S+4]=x,t}}Io.prototype.bytesPerElement=20,Vt(Io,"StructArrayLayout3i3f20");class Xo extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}Xo.prototype.bytesPerElement=4,Vt(Xo,"StructArrayLayout1ul4");class ri extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x,b,S,C,L,z,O){const U=this.length;return this.resize(U+1),this.emplace(U,t,s,c,h,p,g,x,b,S,C,L,z,O)}emplace(t,s,c,h,p,g,x,b,S,C,L,z,O,U){const X=20*t,se=10*t;return this.int16[X+0]=s,this.int16[X+1]=c,this.int16[X+2]=h,this.int16[X+3]=p,this.int16[X+4]=g,this.float32[se+3]=x,this.float32[se+4]=b,this.float32[se+5]=S,this.float32[se+6]=C,this.int16[X+14]=L,this.uint32[se+8]=z,this.uint16[X+18]=O,this.uint16[X+19]=U,t}}ri.prototype.bytesPerElement=40,Vt(ri,"StructArrayLayout5i4f1i1ul2ui40");class li extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,c,h,p,g,x)}emplace(t,s,c,h,p,g,x,b){const S=8*t;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=h,this.int16[S+4]=p,this.int16[S+5]=g,this.int16[S+6]=x,this.int16[S+7]=b,t}}li.prototype.bytesPerElement=16,Vt(li,"StructArrayLayout3i2i2i16");class Wn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,c,h,p)}emplace(t,s,c,h,p,g){const x=4*t,b=8*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[b+6]=p,this.int16[b+7]=g,t}}Wn.prototype.bytesPerElement=16,Vt(Wn,"StructArrayLayout2f1f2i16");class ki extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,h)}emplace(t,s,c,h,p){const g=12*t,x=3*t;return this.uint8[g+0]=s,this.uint8[g+1]=c,this.float32[x+1]=h,this.float32[x+2]=p,t}}ki.prototype.bytesPerElement=12,Vt(ki,"StructArrayLayout2ub2f12");class Qi extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const p=3*t;return this.float32[p+0]=s,this.float32[p+1]=c,this.float32[p+2]=h,t}}Qi.prototype.bytesPerElement=12,Vt(Qi,"StructArrayLayout3f12");class kn extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const p=3*t;return this.uint16[p+0]=s,this.uint16[p+1]=c,this.uint16[p+2]=h,t}}kn.prototype.bytesPerElement=6,Vt(kn,"StructArrayLayout3ui6");class Mr extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se,de,Me,be,Ie,De){const ke=this.length;return this.resize(ke+1),this.emplace(ke,t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se,de,Me,be,Ie,De)}emplace(t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se,de,Me,be,Ie,De,ke){const We=30*t,$e=15*t,nt=60*t;return this.int16[We+0]=s,this.int16[We+1]=c,this.int16[We+2]=h,this.float32[$e+2]=p,this.float32[$e+3]=g,this.uint16[We+8]=x,this.uint16[We+9]=b,this.uint32[$e+5]=S,this.uint32[$e+6]=C,this.uint32[$e+7]=L,this.uint16[We+16]=z,this.uint16[We+17]=O,this.uint16[We+18]=U,this.float32[$e+10]=X,this.float32[$e+11]=se,this.uint8[nt+48]=de,this.uint8[nt+49]=Me,this.uint8[nt+50]=be,this.uint32[$e+13]=Ie,this.int16[We+28]=De,this.uint8[nt+58]=ke,t}}Mr.prototype.bytesPerElement=60,Vt(Mr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Js extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se,de,Me,be,Ie,De,ke,We,$e,nt,ht,Oe,Qe,dt,ft){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se,de,Me,be,Ie,De,ke,We,$e,nt,ht,Oe,Qe,dt,ft)}emplace(t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se,de,Me,be,Ie,De,ke,We,$e,nt,ht,Oe,Qe,dt,ft,Ot){const lt=38*t,zt=19*t;return this.int16[lt+0]=s,this.int16[lt+1]=c,this.int16[lt+2]=h,this.float32[zt+2]=p,this.float32[zt+3]=g,this.int16[lt+8]=x,this.int16[lt+9]=b,this.int16[lt+10]=S,this.int16[lt+11]=C,this.int16[lt+12]=L,this.int16[lt+13]=z,this.uint16[lt+14]=O,this.uint16[lt+15]=U,this.uint16[lt+16]=X,this.uint16[lt+17]=se,this.uint16[lt+18]=de,this.uint16[lt+19]=Me,this.uint16[lt+20]=be,this.uint16[lt+21]=Ie,this.uint16[lt+22]=De,this.uint16[lt+23]=ke,this.uint16[lt+24]=We,this.uint16[lt+25]=$e,this.uint16[lt+26]=nt,this.uint16[lt+27]=ht,this.uint16[lt+28]=Oe,this.uint32[zt+15]=Qe,this.float32[zt+16]=dt,this.float32[zt+17]=ft,this.float32[zt+18]=Ot,t}}Js.prototype.bytesPerElement=76,Vt(Js,"StructArrayLayout3i2f6i15ui1ul3f76");class po extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}po.prototype.bytesPerElement=4,Vt(po,"StructArrayLayout1f4");class Ga extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,s,c,h,p,g,x)}emplace(t,s,c,h,p,g,x,b){const S=7*t;return this.float32[S+0]=s,this.float32[S+1]=c,this.float32[S+2]=h,this.float32[S+3]=p,this.float32[S+4]=g,this.float32[S+5]=x,this.float32[S+6]=b,t}}Ga.prototype.bytesPerElement=28,Vt(Ga,"StructArrayLayout7f28");class ja extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,c,h,p)}emplace(t,s,c,h,p,g){const x=5*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=h,this.float32[x+3]=p,this.float32[x+4]=g,t}}ja.prototype.bytesPerElement=20,Vt(ja,"StructArrayLayout5f20");class xs extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c,h)}emplace(t,s,c,h,p){const g=6*t;return this.uint32[3*t+0]=s,this.uint16[g+2]=c,this.uint16[g+3]=h,this.uint16[g+4]=p,t}}xs.prototype.bytesPerElement=12,Vt(xs,"StructArrayLayout1ul3ui12");class Ri extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=c,t}}Ri.prototype.bytesPerElement=4,Vt(Ri,"StructArrayLayout2ui4");class Po extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Po.prototype.bytesPerElement=2,Vt(Po,"StructArrayLayout1ui2");class Yo extends _t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const h=2*t;return this.float32[h+0]=s,this.float32[h+1]=c,t}}Yo.prototype.bytesPerElement=8,Vt(Yo,"StructArrayLayout2f8");class oc extends Tt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}oc.prototype.size=12;class Y1 extends Qn{get(t){return new oc(this,t)}}Vt(Y1,"FillExtrusionExtArray");class K1 extends Tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}K1.prototype.size=40;class Ey extends ri{get(t){return new K1(this,t)}}Vt(Ey,"CollisionBoxArray");class J1 extends Tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}J1.prototype.size=60;class Q1 extends Mr{get(t){return new J1(this,t)}}Vt(Q1,"PlacedSymbolArray");class ew extends Tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ew.prototype.size=76;class tw extends Js{get(t){return new ew(this,t)}}Vt(tw,"SymbolInstanceArray");class nw extends po{getoffsetX(t){return this.float32[1*t+0]}}Vt(nw,"GlyphOffsetArray");class iw extends vn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Vt(iw,"SymbolLineVertexArray");class rw extends Tt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rw.prototype.size=12;class ow extends xs{get(t){return new rw(this,t)}}Vt(ow,"FeatureIndexArray");class sw extends Tt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}sw.prototype.size=4;class aw extends Ri{get(t){return new sw(this,t)}}Vt(aw,"FillExtrusionCentroidArray");class lw extends Tt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}lw.prototype.size=12;class cw extends Qn{get(t){return new lw(this,t)}}Vt(cw,"CircleGlobeExtArray");const hA=St([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),dA=St([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var uw=Aa(function(o){o.exports=function(t,s){var c,h,p,g,x,b,S,C;for(h=t.length-(c=3&t.length),p=s,x=3432918353,b=461845907,C=0;C<h;)S=255&t.charCodeAt(C)|(255&t.charCodeAt(++C))<<8|(255&t.charCodeAt(++C))<<16|(255&t.charCodeAt(++C))<<24,++C,p=27492+(65535&(g=5*(65535&(p=(p^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&t.charCodeAt(C+2))<<16;case 2:S^=(255&t.charCodeAt(C+1))<<8;case 1:p^=S=(65535&(S=(S=(65535&(S^=255&t.charCodeAt(C)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return p^=t.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),fA=Aa(function(o){o.exports=function(t,s){for(var c,h=t.length,p=s^h,g=0;h>=4;)c=1540483477*(65535&(c=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(c>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:p^=(255&t.charCodeAt(g+2))<<16;case 2:p^=(255&t.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&t.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),qd=uw,pA=fA;qd.murmur3=uw,qd.murmur2=pA;class Tm{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,c,h){this.ids.push(hw(t)),this.positions.push(s,c,h)}getPositions(t){const s=hw(t);let c=0,h=this.ids.length-1;for(;c<h;){const g=c+h>>1;this.ids[g]>=s?h=g:c=g+1}const p=[];for(;this.ids[c]===s;)p.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return p}static serialize(t,s){const c=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Cy(c,h,0,c.length-1),s&&s.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(t){const s=new Tm;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function hw(o){const t=+o;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:qd(String(o))}function Cy(o,t,s,c){for(;s<c;){const h=o[s+c>>1];let p=s-1,g=c+1;for(;;){do p++;while(o[p]<h);do g--;while(o[g]>h);if(p>=g)break;Em(o,p,g),Em(t,3*p,3*g),Em(t,3*p+1,3*g+1),Em(t,3*p+2,3*g+2)}g-s<c-g?(Cy(o,t,s,g),s=g+1):(Cy(o,t,g+1,c),c=g)}}function Em(o,t,s){const c=o[t];o[t]=o[s],o[s]=c}Vt(Tm,"FeaturePositionMap");class Qs{constructor(t,s){this.gl=t.gl,this.location=s}}class Cm extends Qs{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class dw extends Qs{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class fw extends Qs{constructor(t,s){super(t,s),this.current=vi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const mA=new Float32Array(16),_A=new Float32Array(9),gA=new Float32Array(4);function Ay(o){return[Jt(255*o.r,255*o.g),Jt(255*o.b,255*o.a)]}class Zd{constructor(t,s,c){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=c}setUniform(t,s,c){t.set(c.constantOr(this.value))}getBinding(t,s,c){return this.type==="color"?new fw(t,s):new Cm(t,s)}}class Ou{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=s.tl.concat(s.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,s,c,h){const p=h==="u_pattern_to"||h==="u_dash_to"?this.patternTo:h==="u_pattern_from"||h==="u_dash_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,s,c){return c==="u_pattern_from"||c==="u_pattern_to"||c==="u_dash_from"||c==="u_dash_to"?new dw(t,s):new Cm(t,s)}}class ea{constructor(t,s,c,h){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,c,h,p,g){const x=this.paintVertexArray.length,b=this.expression.evaluate(new ae(0),s,{},p,h,g);this.paintVertexArray.resize(t),this._setPaintValue(x,t,b)}updatePaintArray(t,s,c,h,p){const g=this.expression.evaluate({zoom:0},c,h,void 0,p);this._setPaintValue(t,s,g)}_setPaintValue(t,s,c){if(this.type==="color"){const h=Ay(c);for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ko{constructor(t,s,c,h,p,g){this.expression=t,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,s,c,h,p,g){const x=this.expression.evaluate(new ae(this.zoom),s,{},p,h,g),b=this.expression.evaluate(new ae(this.zoom+1),s,{},p,h,g),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,x,b)}updatePaintArray(t,s,c,h,p){const g=this.expression.evaluate({zoom:this.zoom},c,h,void 0,p),x=this.expression.evaluate({zoom:this.zoom+1},c,h,void 0,p);this._setPaintValue(t,s,g,x)}_setPaintValue(t,s,c,h){if(this.type==="color"){const p=Ay(c),g=Ay(h);for(let x=t;x<s;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=K(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,s,c){return new Cm(t,s)}}class Wa{constructor(t,s,c,h,p,g,x){this.expression=t,this.type=c,this.useIntegerZoom=h,this.zoom=p,this.layerId=x,this.paintVertexAttributes=(c==="array"?dA:hA).members;for(let b=0;b<s.length;++b);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,s,c){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,h,p,g){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],g)}_setPaintValues(t,s,c,h){if(!h||!c)return;const{min:p,mid:g,max:x}=c,b=h[p],S=h[g],C=h[x];if(b&&S&&C)for(let L=t;L<s;L++)this._setPaintValue(this.zoomInPaintVertexArray,L,S,b),this._setPaintValue(this.zoomOutPaintVertexArray,L,S,C)}_setPaintValue(t,s,c,h){t.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],c.pixelRatio,h.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ha{constructor(t,s,c=()=>!0){this.binders={},this._buffers=[];const h=[];for(const p in t.paint._values){if(!c(p))continue;const g=t.paint.get(p);if(!(g instanceof He&&Fa(g.property.specification)))continue;const x=xA(p,t.type),b=g.value,S=g.property.specification.type,C=g.property.useIntegerZoom,L=g.property.specification["property-type"],z=L==="cross-faded"||L==="cross-faded-data-driven",O=String(p)==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||O)if(b.kind==="source"||O||z){const U=pw(p,S,"source");this.binders[p]=z?new Wa(b,x,S,C,s,U,t.id):new ea(b,x,S,U),h.push(`/a_${p}`)}else{const U=pw(p,S,"composite");this.binders[p]=new Ko(b,x,S,C,s,U),h.push(`/z_${p}`)}else this.binders[p]=z?new Ou(b.value,x):new Zd(b.value,x,S),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof ea||s instanceof Ko?s.maxValue:0}populatePaintArrays(t,s,c,h,p,g){for(const x in this.binders){const b=this.binders[x];(b instanceof ea||b instanceof Ko||b instanceof Wa)&&b.populatePaintArray(t,s,c,h,p,g)}}setConstantPatternPositions(t,s){for(const c in this.binders){const h=this.binders[c];h instanceof Ou&&h.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,c,h,p,g){let x=!1;for(const b in t){const S=s.getPositions(b);for(const C of S){const L=c.feature(C.index);for(const z in this.binders){const O=this.binders[z];if((O instanceof ea||O instanceof Ko||O instanceof Wa)&&O.expression.isStateDependent===!0){const U=h.paint.get(z);O.expression=U.value,O.updatePaintArray(C.start,C.end,L,t[b],p,g),x=!0}}}}return x}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Zd||c instanceof Ou)&&t.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ea||c instanceof Ko||c instanceof Wa)for(let h=0;h<c.paintVertexAttributes.length;h++)t.push(c.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Zd||c instanceof Ou||c instanceof Ko)for(const h of c.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const c=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Zd||p instanceof Ou||p instanceof Ko){for(const g of p.uniformNames)if(s[g]){const x=p.getBinding(t,s[g],g);c.push({name:g,property:h,binding:x})}}}return c}setUniforms(t,s,c,h){for(const{name:p,property:g,binding:x}of s)this.binders[g].setUniform(x,h,c.get(g),p)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(t&&c instanceof Wa){const h=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(c instanceof ea||c instanceof Ko)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof ea||c instanceof Ko||c instanceof Wa)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof ea||s instanceof Ko||s instanceof Wa)&&s.destroy()}}}class sc{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Ha(h,s,c);this.needsUpload=!1,this._featureMap=new Tm,this._bufferOffset=0}populatePaintArrays(t,s,c,h,p,g,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,s,h,p,g,x);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,h,p){for(const g of c)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,s,g,h,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const yA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function xA(o,t){return yA[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}const vA={"line-pattern":{source:Xn,composite:Xn},"fill-pattern":{source:Xn,composite:Xn},"fill-extrusion-pattern":{source:Xn,composite:Xn},"line-dasharray":{source:Ai,composite:Ai}},wA={color:{source:Yo,composite:Gn},number:{source:po,composite:Yo}};function pw(o,t,s){const c=vA[o];return c&&c[s]||wA[t][s]}Vt(Zd,"ConstantBinder"),Vt(Ou,"CrossFadedConstantBinder"),Vt(ea,"SourceExpressionBinder"),Vt(Wa,"CrossFadedCompositeBinder"),Vt(Ko,"CompositeExpressionBinder"),Vt(Ha,"ProgramConfiguration",{omit:["_buffers"]}),Vt(sc,"ProgramConfigurationSet");const Am="-transition";class Jo extends Pn{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new Ve(s.layout)),s.paint)){this._transitionablePaint=new pe(s.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ge(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,c={}){s!=null&&this._validate(Ty,`layers.${this.id}.layout.${t}`,t,s,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return ct(t,Am)?this._transitionablePaint.getTransition(t.slice(0,-Am.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,c={}){if(s!=null&&this._validate(hm,`layers.${this.id}.paint.${t}`,t,s,c))return!1;if(ct(t,Am))return this._transitionablePaint.setTransition(t.slice(0,-Am.length),s||void 0),!1;{const h=this._transitionablePaint._values[t],p=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(t,x,b)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ne(t,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(t,s,c,h,p={}){return(!p||p.validate!==!1)&&dm(this,t.call(um,{key:s,layerType:this.type,objectKey:c,value:h,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof He&&Fa(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ys(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const bA=St([{name:"a_pos",components:2,type:"Int16"}],4),SA=St([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ii{constructor(t=[]){this.segments=t}prepareSegment(t,s,c,h){let p=this.segments[this.segments.length-1];return t>Ii.MAX_VERTEX_ARRAY_LENGTH&&et(`Max vertices per segment is ${Ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>Ii.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,h){return new Ii([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}Ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt(Ii,"SegmentVector");var on=8192;class $a{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Yn?new Yn(t.lng,t.lat):Yn.convert(t),this}setSouthWest(t){return this._sw=t instanceof Yn?new Yn(t.lng,t.lat):Yn.convert(t),this}extend(t){const s=this._sw,c=this._ne;let h,p;if(t instanceof Yn)h=t,p=t;else{if(!(t instanceof $a))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend($a.convert(t)):this.extend(Yn.convert(t)):this;if(h=t._sw,p=t._ne,!h||!p)return this}return s||c?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new Yn(h.lng,h.lat),this._ne=new Yn(p.lng,p.lat)),this}getCenter(){return new Yn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yn(this.getWest(),this.getNorth())}getSouthEast(){return new Yn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=Yn.convert(t);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(t){return!t||t instanceof $a?t:new $a(t)}}const Iy=63710088e-1;class Yn{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yn(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,h=t.lat*s,p=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return Iy*Math.acos(Math.min(p,1))}toBounds(t=0){const s=360*t/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new $a(new Yn(this.lng-c,this.lat-s),new Yn(this.lng+c,this.lat+s))}static convert(t){if(t instanceof Yn)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Yn(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Yn(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const mw=2*Math.PI*Iy;function Py(o){return mw*Math.cos(o*Math.PI/180)}function ac(o){return(180+o)/360}function lc(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Lo(o,t){return o/Py(t)}function Tr(o){return 360*o-180}function Gi(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function _w(o,t){return o*Py(Gi(t))}const vs=85.051129;class Nu{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=Yn.convert(t);return new Nu(ac(c.lng),lc(c.lat),Lo(s,c.lat))}toLngLat(){return new Yn(Tr(this.x),Gi(this.y))}toAltitude(){return _w(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/mw*(t=Gi(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ly(o,t,s,c,h,p,g,x,b){const S=(t+c)/2,C=(s+h)/2,L=new P(S,C);x(L),function(z,O,U,X,se,de){const Me=U-se,be=X-de;return Math.abs((X-O)*Me-(U-z)*be)/Math.hypot(Me,be)}(L.x,L.y,p.x,p.y,g.x,g.y)>=b?(Ly(o,t,s,S,C,p,L,x,b),Ly(o,S,C,c,h,L,g,x,b)):o.push(g)}function gw(o,t,s){let c=o[0],h=c.x,p=c.y;t(c);const g=[c];for(let x=1;x<o.length;x++){const b=o[x],{x:S,y:C}=b;t(b),Ly(g,h,p,S,C,c,b,t,s),h=S,p=C,c=b}return g}function Dy(o,t,s,c,h){if(h(t,s)){const p=t.add(s).mult(.5);c(p),Dy(o,t,p,c,h),Dy(o,p,s,c,h)}else o.push(s)}function MA(o,t,s){let c=o[0];t(c);const h=[c];for(let p=1;p<o.length;p++){const g=o[p];t(g),Dy(h,c,g,t,s),c=g}return h}const zy=Math.pow(2,14)-1,yw=-zy-1;function TA(o,t){const s=Math.round(o.x*t),c=Math.round(o.y*t);return o.x=K(s,yw,zy),o.y=K(c,yw,zy),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function ta(o,t,s){const c=o.loadGeometry(),h=o.extent,p=on/h;if(t&&s&&s.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:x,x:b,y:S,projection:C}=s,L=z=>{const O=Tr((t.x+z.x/h)/g),U=Gi((t.y+z.y/h)/g),X=C.project(O,U);z.x=(X.x*x-b)*h,z.y=(X.y*x-S)*h};for(let z=0;z<c.length;z++)if(o.type!==1)c[z]=gw(c[z],L,1);else{const O=[];for(const U of c[z])U.x<0||U.x>=h||U.y<0||U.y>=h||(L(U),O.push(U));c[z]=O}}for(const g of c)for(const x of g)TA(x,p);return c}function cc(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?ta(o):[]}}function Im(o,t,s,c,h){o.emplaceBack(2*t+(c+1)/2,2*s+(h+1)/2)}function Pm(o,t,s){o.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class ky{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new en,this.indexArray=new kn,this.segments=new Ii,this.programConfigurations=new sc(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c,h){const p=this.layers[0],g=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:S,id:C,index:L,sourceLayerIndex:z}of t){const O=this.layers[0]._featureFilter.needGeometry,U=cc(S,O);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),U,c))continue;const X=x?x.evaluate(U,{},c):void 0,se={id:C,properties:S.properties,type:S.type,sourceLayerIndex:z,index:L,geometry:O?U.geometry:ta(S,c,h),patterns:{},sortKey:X};g.push(se)}x&&g.sort((S,C)=>S.sortKey-C.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new cw,b=h.projection);for(const S of g){const{geometry:C,index:L,sourceLayerIndex:z}=S,O=t[L].feature;this.addFeature(S,C,L,s.availableImages,c,b),s.featureIndex.insert(O,C,L,z,this.index)}}update(t,s,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,SA.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,s,c,h,p,g){for(const x of s)for(const b of x){const S=b.x,C=b.y;if(S<0||S>=on||C<0||C>=on)continue;if(g){const O=g.projectTilePoint(S,C,p),U=g.upVector(p,S,C),X=this.globeExtVertexArray;Pm(X,O,U),Pm(X,O,U),Pm(X,O,U),Pm(X,O,U)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=L.vertexLength;Im(this.layoutVertexArray,S,C,-1,-1),Im(this.layoutVertexArray,S,C,1,-1),Im(this.layoutVertexArray,S,C,1,1),Im(this.layoutVertexArray,S,C,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},h,p)}}function xw(o,t){for(let s=0;s<o.length;s++)if(uc(t,o[s]))return!0;for(let s=0;s<t.length;s++)if(uc(o,t[s]))return!0;return!!Ry(o,t)}function EA(o,t,s){return!!uc(o,t)||!!Fy(t,o,s)}function vw(o,t){if(o.length===1)return bw(t,o[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let h=0;h<c.length;h++)if(uc(o,c[h]))return!0}for(let s=0;s<o.length;s++)if(bw(t,o[s]))return!0;for(let s=0;s<t.length;s++)if(Ry(o,t[s]))return!0;return!1}function CA(o,t,s){if(o.length>1){if(Ry(o,t))return!0;for(let c=0;c<t.length;c++)if(Fy(t[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Fy(o[c],t,s))return!0;return!1}function Ry(o,t){if(o.length===0||t.length===0)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],h=o[s+1];for(let p=0;p<t.length-1;p++)if(AA(c,h,t[p],t[p+1]))return!0}return!1}function AA(o,t,s,c){return gt(o,s,c)!==gt(t,s,c)&&gt(o,t,s)!==gt(o,t,c)}function Fy(o,t,s){const c=s*s;if(t.length===1)return o.distSqr(t[0])<c;for(let h=1;h<t.length;h++)if(ww(o,t[h-1],t[h])<c)return!0;return!1}function ww(o,t,s){const c=t.distSqr(s);if(c===0)return o.distSqr(t);const h=((o.x-t.x)*(s.x-t.x)+(o.y-t.y)*(s.y-t.y))/c;return o.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function bw(o,t){let s,c,h,p=!1;for(let g=0;g<o.length;g++){s=o[g];for(let x=0,b=s.length-1;x<s.length;b=x++)c=s[x],h=s[b],c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(p=!p)}return p}function uc(o,t){let s=!1;for(let c=0,h=o.length-1;c<o.length;h=c++){const p=o[c],g=o[h];p.y>t.y!=g.y>t.y&&t.x<(g.x-p.x)*(t.y-p.y)/(g.y-p.y)+p.x&&(s=!s)}return s}function Sw(o,t,s,c,h){for(const g of o)if(t<=g.x&&s<=g.y&&c>=g.x&&h>=g.y)return!0;const p=[new P(t,s),new P(t,h),new P(c,h),new P(c,s)];if(o.length>2){for(const g of p)if(uc(o,g))return!0}for(let g=0;g<o.length-1;g++)if(IA(o[g],o[g+1],p))return!0;return!1}function IA(o,t,s){const c=s[0],h=s[2];if(o.x<c.x&&t.x<c.x||o.x>h.x&&t.x>h.x||o.y<c.y&&t.y<c.y||o.y>h.y&&t.y>h.y)return!1;const p=gt(o,t,s[0]);return p!==gt(o,t,s[1])||p!==gt(o,t,s[2])||p!==gt(o,t,s[3])}function Uu(o,t,s){const c=t.paint.get(o).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(o)}function Lm(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Mw(o,t,s,c,h){if(!t[0]&&!t[1])return o;const p=P.convert(t)._mult(h);s==="viewport"&&p._rotate(-c);const g=[];for(let x=0;x<o.length;x++)g.push(o[x].sub(p));return g}function Tw(o,t,s,c){const h=P.convert(o)._mult(c);return t==="viewport"&&h._rotate(-s),h}Vt(ky,"CircleBucket",{omit:["layers"]});const PA=new Ke({"circle-sort-key":new ve(Re.layout_circle["circle-sort-key"])});var LA={paint:new Ke({"circle-radius":new ve(Re.paint_circle["circle-radius"]),"circle-color":new ve(Re.paint_circle["circle-color"]),"circle-blur":new ve(Re.paint_circle["circle-blur"]),"circle-opacity":new ve(Re.paint_circle["circle-opacity"]),"circle-translate":new Ue(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new Ue(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ue(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ue(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ve(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ve(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ve(Re.paint_circle["circle-stroke-opacity"])}),layout:PA},Dm=1e-6,Kr=typeof Float32Array!="undefined"?Float32Array:Array;function Ew(){var o=new Kr(9);return Kr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Jr(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function qa(o,t,s){var c=t[0],h=t[1],p=t[2],g=t[3],x=t[4],b=t[5],S=t[6],C=t[7],L=t[8],z=t[9],O=t[10],U=t[11],X=t[12],se=t[13],de=t[14],Me=t[15],be=s[0],Ie=s[1],De=s[2],ke=s[3];return o[0]=be*c+Ie*x+De*L+ke*X,o[1]=be*h+Ie*b+De*z+ke*se,o[2]=be*p+Ie*S+De*O+ke*de,o[3]=be*g+Ie*C+De*U+ke*Me,o[4]=(be=s[4])*c+(Ie=s[5])*x+(De=s[6])*L+(ke=s[7])*X,o[5]=be*h+Ie*b+De*z+ke*se,o[6]=be*p+Ie*S+De*O+ke*de,o[7]=be*g+Ie*C+De*U+ke*Me,o[8]=(be=s[8])*c+(Ie=s[9])*x+(De=s[10])*L+(ke=s[11])*X,o[9]=be*h+Ie*b+De*z+ke*se,o[10]=be*p+Ie*S+De*O+ke*de,o[11]=be*g+Ie*C+De*U+ke*Me,o[12]=(be=s[12])*c+(Ie=s[13])*x+(De=s[14])*L+(ke=s[15])*X,o[13]=be*h+Ie*b+De*z+ke*se,o[14]=be*p+Ie*S+De*O+ke*de,o[15]=be*g+Ie*C+De*U+ke*Me,o}function hc(o,t,s){var c,h,p,g,x,b,S,C,L,z,O,U,X=s[0],se=s[1],de=s[2];return t===o?(o[12]=t[0]*X+t[4]*se+t[8]*de+t[12],o[13]=t[1]*X+t[5]*se+t[9]*de+t[13],o[14]=t[2]*X+t[6]*se+t[10]*de+t[14],o[15]=t[3]*X+t[7]*se+t[11]*de+t[15]):(h=t[1],p=t[2],g=t[3],x=t[4],b=t[5],S=t[6],C=t[7],L=t[8],z=t[9],O=t[10],U=t[11],o[0]=c=t[0],o[1]=h,o[2]=p,o[3]=g,o[4]=x,o[5]=b,o[6]=S,o[7]=C,o[8]=L,o[9]=z,o[10]=O,o[11]=U,o[12]=c*X+x*se+L*de+t[12],o[13]=h*X+b*se+z*de+t[13],o[14]=p*X+S*se+O*de+t[14],o[15]=g*X+C*se+U*de+t[15]),o}function ws(o,t,s){var c=s[0],h=s[1],p=s[2];return o[0]=t[0]*c,o[1]=t[1]*c,o[2]=t[2]*c,o[3]=t[3]*c,o[4]=t[4]*h,o[5]=t[5]*h,o[6]=t[6]*h,o[7]=t[7]*h,o[8]=t[8]*p,o[9]=t[9]*p,o[10]=t[10]*p,o[11]=t[11]*p,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function zm(o,t,s){var c=Math.sin(s),h=Math.cos(s),p=t[4],g=t[5],x=t[6],b=t[7],S=t[8],C=t[9],L=t[10],z=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=p*h+S*c,o[5]=g*h+C*c,o[6]=x*h+L*c,o[7]=b*h+z*c,o[8]=S*h-p*c,o[9]=C*h-g*c,o[10]=L*h-x*c,o[11]=z*h-b*c,o}function km(o,t,s){var c=Math.sin(s),h=Math.cos(s),p=t[0],g=t[1],x=t[2],b=t[3],S=t[8],C=t[9],L=t[10],z=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=p*h-S*c,o[1]=g*h-C*c,o[2]=x*h-L*c,o[3]=b*h-z*c,o[8]=p*c+S*h,o[9]=g*c+C*h,o[10]=x*c+L*h,o[11]=b*c+z*h,o}function Cw(o,t,s){var c,h,p,g=s[0],x=s[1],b=s[2],S=Math.hypot(g,x,b);return S<Dm?null:(g*=S=1/S,x*=S,b*=S,c=Math.sin(t),h=Math.cos(t),o[0]=g*g*(p=1-h)+h,o[1]=x*g*p+b*c,o[2]=b*g*p-x*c,o[3]=0,o[4]=g*x*p-b*c,o[5]=x*x*p+h,o[6]=b*x*p+g*c,o[7]=0,o[8]=g*b*p+x*c,o[9]=x*b*p-g*c,o[10]=b*b*p+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var DA=qa;function By(){var o=new Kr(3);return Kr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Aw(o){var t=new Kr(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function Xd(o){return Math.hypot(o[0],o[1],o[2])}function Vu(o,t,s){var c=new Kr(3);return c[0]=o,c[1]=t,c[2]=s,c}function Za(o,t,s){return o[0]=t[0]+s[0],o[1]=t[1]+s[1],o[2]=t[2]+s[2],o}function Oy(o,t,s){return o[0]=t[0]-s[0],o[1]=t[1]-s[1],o[2]=t[2]-s[2],o}function Iw(o,t,s){return o[0]=t[0]*s[0],o[1]=t[1]*s[1],o[2]=t[2]*s[2],o}function Rm(o,t,s){return o[0]=Math.min(t[0],s[0]),o[1]=Math.min(t[1],s[1]),o[2]=Math.min(t[2],s[2]),o}function Fm(o,t,s){return o[0]=Math.max(t[0],s[0]),o[1]=Math.max(t[1],s[1]),o[2]=Math.max(t[2],s[2]),o}function bs(o,t,s){return o[0]=t[0]*s,o[1]=t[1]*s,o[2]=t[2]*s,o}function Bm(o,t,s,c){return o[0]=t[0]+s[0]*c,o[1]=t[1]+s[1]*c,o[2]=t[2]+s[2]*c,o}function Er(o,t){var s=t[0],c=t[1],h=t[2],p=s*s+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),o[0]=t[0]*p,o[1]=t[1]*p,o[2]=t[2]*p,o}function Do(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function Ny(o,t,s){var c=t[0],h=t[1],p=t[2],g=s[0],x=s[1],b=s[2];return o[0]=h*b-p*x,o[1]=p*g-c*b,o[2]=c*x-h*g,o}function lr(o,t,s){var c=t[0],h=t[1],p=t[2],g=s[3]*c+s[7]*h+s[11]*p+s[15];return o[0]=(s[0]*c+s[4]*h+s[8]*p+s[12])/(g=g||1),o[1]=(s[1]*c+s[5]*h+s[9]*p+s[13])/g,o[2]=(s[2]*c+s[6]*h+s[10]*p+s[14])/g,o}function Pw(o,t,s){var c=s[0],h=s[1],p=s[2],g=t[0],x=t[1],b=t[2],S=h*b-p*x,C=p*g-c*b,L=c*x-h*g,z=h*L-p*C,O=p*S-c*L,U=c*C-h*S,X=2*s[3];return C*=X,L*=X,O*=2,U*=2,o[0]=g+(S*=X)+(z*=2),o[1]=x+C+O,o[2]=b+L+U,o}var Yd,zo=Oy,zA=Iw,kA=Xd;function Lw(o,t,s){return o[0]=t[0]*s,o[1]=t[1]*s,o[2]=t[2]*s,o[3]=t[3]*s,o}function dc(o,t,s){var c=t[0],h=t[1],p=t[2],g=t[3];return o[0]=s[0]*c+s[4]*h+s[8]*p+s[12]*g,o[1]=s[1]*c+s[5]*h+s[9]*p+s[13]*g,o[2]=s[2]*c+s[6]*h+s[10]*p+s[14]*g,o[3]=s[3]*c+s[7]*h+s[11]*p+s[15]*g,o}function Dw(){var o=new Kr(4);return Kr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function zw(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function kw(o,t,s){s*=.5;var c=t[0],h=t[1],p=t[2],g=t[3],x=Math.sin(s),b=Math.cos(s);return o[0]=c*b+g*x,o[1]=h*b+p*x,o[2]=p*b-h*x,o[3]=g*b-c*x,o}function Rw(o,t,s){s*=.5;var c=t[0],h=t[1],p=t[2],g=t[3],x=Math.sin(s),b=Math.cos(s);return o[0]=c*b-p*x,o[1]=h*b+g*x,o[2]=p*b+c*x,o[3]=g*b-h*x,o}By(),Yd=new Kr(4),Kr!=Float32Array&&(Yd[0]=0,Yd[1]=0,Yd[2]=0,Yd[3]=0),By(),Vu(1,0,0),Vu(0,1,0),Dw(),Dw(),Ew();class Uy{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,c){const h=Do(s,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(t,s,c){if(function(O,U){var X=O[0],se=O[1],de=O[2],Me=U[0],be=U[1],Ie=U[2];return Math.abs(X-Me)<=Dm*Math.max(1,Math.abs(X),Math.abs(Me))&&Math.abs(se-be)<=Dm*Math.max(1,Math.abs(se),Math.abs(be))&&Math.abs(de-Ie)<=Dm*Math.max(1,Math.abs(de),Math.abs(Ie))}(this.pos,t)||s===0)return c[0]=c[1]=c[2]=0,!1;const[h,p,g]=this.dir,x=this.pos[0]-t[0],b=this.pos[1]-t[1],S=this.pos[2]-t[2],C=h*h+p*p+g*g,L=2*(x*h+b*p+S*g),z=L*L-4*C*(x*x+b*b+S*S-s*s);if(z<0){const O=Math.max(-L/2,0),U=x+h*O,X=b+p*O,se=S+g*O,de=Math.hypot(U,X,se);return c[0]=U*s/de,c[1]=X*s/de,c[2]=se*s/de,!1}{const O=(-L-Math.sqrt(z))/(2*C);if(O<0){const U=Math.hypot(x,b,S);return c[0]=x*s/U,c[1]=b*s/U,c[2]=S*s/U,!1}return c[0]=x+h*O,c[1]=b+p*O,c[2]=S+g*O,!0}}}class Vy{constructor(t,s,c,h,p){this.TL=t,this.TR=s,this.BR=c,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(t,s,c){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],x=[-1,-1,1],b=lr(h,h,t),S=lr(p,p,t),C=lr(g,g,t),L=lr(x,x,t);return new Vy(b,S,C,L,s/c)}}class Gy{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c,h){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=dc([],b,t),C=1/S[3]/s*p;return function(L,z,O){return L[0]=z[0]*O[0],L[1]=z[1]*O[1],L[2]=z[2]*O[2],L[3]=z[3]*O[3],L}(S,S,[C,C,h?1/S[3]:C,C])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=Er([],Ny([],zo([],g[b[0]],g[b[1]]),zo([],g[b[2]],g[b[1]]))),C=-Do(S,g[b[1]]);return S.concat(C)});return new Gy(g,x)}}class mo{constructor(t,s){this.min=t,this.max=s,this.center=bs([],Za([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=Aw(this.min),h=Aw(this.max);for(let p=0;p<s.length;p++)c[p]=s[p]?this.min[p]:this.center[p],h[p]=s[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new mo(c,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){const s=this.getCorners();let c=!0;for(let h=0;h<t.planes.length;h++){const p=t.planes[h];let g=0;for(let x=0;x<s.length;x++)g+=Do(p,s[x])+p[3]>=0;if(g===0)return 0;g!==s.length&&(c=!1)}if(c)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const b=t.points[x][h]-this.min[h];p=Math.min(p,b),g=Math.max(g,b)}if(g<0||p>this.max[h]-this.min[h])return 0}return 1}}function Fw(o,t,s,c,h,p,g,x,b){if(p&&o.queryGeometry.isAboveHorizon)return!1;p&&(b*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,C=s.projection.upVectorScale(S,s.center.lat,s.worldSize).metersToTile;for(const L of t)for(const z of L){const O=z.add(x),U=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,X=s.projection.projectTilePoint(O.x,O.y,S);if(U>0){const be=s.projection.upVector(S,O.x,O.y);X.x+=be[0]*C*U,X.y+=be[1]*C*U,X.z+=be[2]*C*U}const se=p?O:RA(X.x,X.y,X.z,c),de=p?o.tilespaceRays.map(be=>BA(be,U)):o.queryGeometry.screenGeometry,Me=dc([],[X.x,X.y,X.z,1],c);if(!g&&p?b*=Me[3]/s.cameraToCenterDistance:g&&!p&&(b*=s.cameraToCenterDistance/Me[3]),p){const be=Gi((z.y/on+S.y)/(1<<S.z));b/=s.projection.pixelsPerMeter(be,1)/Lo(1,be)}if(EA(de,se,b))return!0}return!1}function RA(o,t,s,c){const h=dc([],[o,t,s,1],c);return new P(h[0]/h[3],h[1]/h[3])}const Bw=Vu(0,0,0),FA=Vu(0,0,1);function BA(o,t){const s=By();return Bw[2]=t,o.intersectsPlane(Bw,FA,s),new P(s[0],s[1])}class Ow extends ky{}function Nw(o,{width:t,height:s},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*s*c);return o.width=t,o.height=s,o.data=h,o}function Uw(o,t,s){const{width:c,height:h}=t;c===o.width&&h===o.height||(jy(o,t,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,h)},s),o.width=c,o.height=h,o.data=t.data)}function jy(o,t,s,c,h,p){if(h.width===0||h.height===0)return t;if(h.width>o.width||h.height>o.height||s.x>o.width-h.width||s.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||c.x>t.width-h.width||c.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=o.data,x=t.data;for(let b=0;b<h.height;b++){const S=((s.y+b)*o.width+s.x)*p,C=((c.y+b)*t.width+c.x)*p;for(let L=0;L<h.width*p;L++)x[C+L]=g[S+L]}return t}Vt(Ow,"HeatmapBucket",{omit:["layers"]});class na{constructor(t,s){Nw(this,t,1,s)}resize(t){Uw(this,new na(t),1)}clone(){return new na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,h,p){jy(t,s,c,h,p,1)}}class Qr{constructor(t,s){Nw(this,t,4,s)}resize(t){Uw(this,new Qr(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,h,p){jy(t,s,c,h,p,4)}}Vt(na,"AlphaImage"),Vt(Qr,"RGBAImage");var OA={paint:new Ke({"heatmap-radius":new ve(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ve(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ue(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new It(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ue(Re.paint_heatmap["heatmap-opacity"])})};function Wy(o){const t={},s=o.resolution||256,c=o.clips?o.clips.length:1,h=o.image||new Qr({width:s,height:c}),p=(g,x,b)=>{t[o.evaluationKey]=b;const S=o.expression.evaluate(t);h.data[g+x+0]=Math.floor(255*S.r/S.a),h.data[g+x+1]=Math.floor(255*S.g/S.a),h.data[g+x+2]=Math.floor(255*S.b/S.a),h.data[g+x+3]=Math.floor(255*S.a)};if(o.clips)for(let g=0,x=0;g<c;++g,x+=4*s)for(let b=0,S=0;b<s;b++,S+=4){const C=b/(s-1),{start:L,end:z}=o.clips[g];p(x,S,L*(1-C)+z*C)}else for(let g=0,x=0;g<s;g++,x+=4)p(0,x,g/(s-1));return h}var NA={paint:new Ke({"hillshade-illumination-direction":new Ue(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ue(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ue(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ue(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ue(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ue(Re.paint_hillshade["hillshade-accent-color"])})};const UA=St([{name:"a_pos",components:2,type:"Int16"}],4),{members:VA}=UA;var Om=Nm,GA=Nm;function Nm(o,t,s){s=s||2;var c,h,p,g,x,b,S,C=t&&t.length,L=C?t[0]*s:o.length,z=Vw(o,0,L,s,!0),O=[];if(!z||z.next===z.prev)return O;if(C&&(z=function(X,se,de,Me){var be,Ie,De,ke=[];for(be=0,Ie=se.length;be<Ie;be++)(De=Vw(X,se[be]*Me,be<Ie-1?se[be+1]*Me:X.length,Me,!1))===De.next&&(De.steiner=!0),ke.push(YA(De));for(ke.sort(qA),be=0;be<ke.length;be++)de=Xa(de=ZA(ke[be],de),de.next);return de}(o,t,z,s)),o.length>80*s){c=p=o[0],h=g=o[1];for(var U=s;U<L;U+=s)(x=o[U])<c&&(c=x),(b=o[U+1])<h&&(h=b),x>p&&(p=x),b>g&&(g=b);S=(S=Math.max(p-c,g-h))!==0?1/S:0}return Kd(z,O,s,c,h,S),O}function Vw(o,t,s,c,h){var p,g;if(h===qy(o,t,s,c)>0)for(p=t;p<s;p+=c)g=Ww(p,o[p],o[p+1],g);else for(p=s-c;p>=t;p-=c)g=Ww(p,o[p],o[p+1],g);return g&&Um(g,g.next)&&(Qd(g),g=g.next),g}function Xa(o,t){if(!o)return o;t||(t=o);var s,c=o;do if(s=!1,c.steiner||!Um(c,c.next)&&Fi(c.prev,c,c.next)!==0)c=c.next;else{if(Qd(c),(c=t=c.prev)===c.next)break;s=!0}while(s||c!==t);return t}function Kd(o,t,s,c,h,p,g){if(o){!g&&p&&function(C,L,z,O){var U=C;do U.z===null&&(U.z=Hy(U.x,U.y,L,z,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function(X){var se,de,Me,be,Ie,De,ke,We,$e=1;do{for(de=X,X=null,Ie=null,De=0;de;){for(De++,Me=de,ke=0,se=0;se<$e&&(ke++,Me=Me.nextZ);se++);for(We=$e;ke>0||We>0&&Me;)ke!==0&&(We===0||!Me||de.z<=Me.z)?(be=de,de=de.nextZ,ke--):(be=Me,Me=Me.nextZ,We--),Ie?Ie.nextZ=be:X=be,be.prevZ=Ie,Ie=be;de=Me}Ie.nextZ=null,$e*=2}while(De>1)}(U)}(o,c,h,p);for(var x,b,S=o;o.prev!==o.next;)if(x=o.prev,b=o.next,p?WA(o,c,h,p):jA(o))t.push(x.i/s),t.push(o.i/s),t.push(b.i/s),Qd(o),o=b.next,S=b.next;else if((o=b)===S){g?g===1?Kd(o=HA(Xa(o),t,s),t,s,c,h,p,2):g===2&&$A(o,t,s,c,h,p):Kd(Xa(o),t,s,c,h,p,1);break}}}function jA(o){var t=o.prev,s=o,c=o.next;if(Fi(t,s,c)>=0)return!1;for(var h=o.next.next;h!==o.prev;){if(Gu(t.x,t.y,s.x,s.y,c.x,c.y,h.x,h.y)&&Fi(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function WA(o,t,s,c){var h=o.prev,p=o,g=o.next;if(Fi(h,p,g)>=0)return!1;for(var x=h.x>p.x?h.x>g.x?h.x:g.x:p.x>g.x?p.x:g.x,b=h.y>p.y?h.y>g.y?h.y:g.y:p.y>g.y?p.y:g.y,S=Hy(h.x<p.x?h.x<g.x?h.x:g.x:p.x<g.x?p.x:g.x,h.y<p.y?h.y<g.y?h.y:g.y:p.y<g.y?p.y:g.y,t,s,c),C=Hy(x,b,t,s,c),L=o.prevZ,z=o.nextZ;L&&L.z>=S&&z&&z.z<=C;){if(L!==o.prev&&L!==o.next&&Gu(h.x,h.y,p.x,p.y,g.x,g.y,L.x,L.y)&&Fi(L.prev,L,L.next)>=0||(L=L.prevZ,z!==o.prev&&z!==o.next&&Gu(h.x,h.y,p.x,p.y,g.x,g.y,z.x,z.y)&&Fi(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;L&&L.z>=S;){if(L!==o.prev&&L!==o.next&&Gu(h.x,h.y,p.x,p.y,g.x,g.y,L.x,L.y)&&Fi(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;z&&z.z<=C;){if(z!==o.prev&&z!==o.next&&Gu(h.x,h.y,p.x,p.y,g.x,g.y,z.x,z.y)&&Fi(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function HA(o,t,s){var c=o;do{var h=c.prev,p=c.next.next;!Um(h,p)&&Gw(h,c,c.next,p)&&Jd(h,p)&&Jd(p,h)&&(t.push(h.i/s),t.push(c.i/s),t.push(p.i/s),Qd(c),Qd(c.next),c=o=p),c=c.next}while(c!==o);return Xa(c)}function $A(o,t,s,c,h,p){var g=o;do{for(var x=g.next.next;x!==g.prev;){if(g.i!==x.i&&KA(g,x)){var b=jw(g,x);return g=Xa(g,g.next),b=Xa(b,b.next),Kd(g,t,s,c,h,p),void Kd(b,t,s,c,h,p)}x=x.next}g=g.next}while(g!==o)}function qA(o,t){return o.x-t.x}function ZA(o,t){var s=function(p,g){var x,b=g,S=p.x,C=p.y,L=-1/0;do{if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){var z=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(z<=S&&z>L){if(L=z,z===S){if(C===b.y)return b;if(C===b.next.y)return b.next}x=b.x<b.next.x?b:b.next}}b=b.next}while(b!==g);if(!x)return null;if(S===L)return x;var O,U=x,X=x.x,se=x.y,de=1/0;b=x;do S>=b.x&&b.x>=X&&S!==b.x&&Gu(C<se?S:L,C,X,se,C<se?L:S,C,b.x,b.y)&&(O=Math.abs(C-b.y)/(S-b.x),Jd(b,p)&&(O<de||O===de&&(b.x>x.x||b.x===x.x&&XA(x,b)))&&(x=b,de=O)),b=b.next;while(b!==U);return x}(o,t);if(!s)return t;var c=jw(s,o),h=Xa(s,s.next);return Xa(c,c.next),t===s?h:t}function XA(o,t){return Fi(o.prev,o,t.prev)<0&&Fi(t.next,o,o.next)<0}function Hy(o,t,s,c,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*h)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-c)*h)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function YA(o){var t=o,s=o;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==o);return s}function Gu(o,t,s,c,h,p,g,x){return(h-g)*(t-x)-(o-g)*(p-x)>=0&&(o-g)*(c-x)-(s-g)*(t-x)>=0&&(s-g)*(p-x)-(h-g)*(c-x)>=0}function KA(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(s,c){var h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==c.i&&h.next.i!==c.i&&Gw(h,h.next,s,c))return!0;h=h.next}while(h!==s);return!1}(o,t)&&(Jd(o,t)&&Jd(t,o)&&function(s,c){var h=s,p=!1,g=(s.x+c.x)/2,x=(s.y+c.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&g<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==s);return p}(o,t)&&(Fi(o.prev,o,t.prev)||Fi(o,t.prev,t))||Um(o,t)&&Fi(o.prev,o,o.next)>0&&Fi(t.prev,t,t.next)>0)}function Fi(o,t,s){return(t.y-o.y)*(s.x-t.x)-(t.x-o.x)*(s.y-t.y)}function Um(o,t){return o.x===t.x&&o.y===t.y}function Gw(o,t,s,c){var h=Gm(Fi(o,t,s)),p=Gm(Fi(o,t,c)),g=Gm(Fi(s,c,o)),x=Gm(Fi(s,c,t));return h!==p&&g!==x||!(h!==0||!Vm(o,s,t))||!(p!==0||!Vm(o,c,t))||!(g!==0||!Vm(s,o,c))||!(x!==0||!Vm(s,t,c))}function Vm(o,t,s){return t.x<=Math.max(o.x,s.x)&&t.x>=Math.min(o.x,s.x)&&t.y<=Math.max(o.y,s.y)&&t.y>=Math.min(o.y,s.y)}function Gm(o){return o>0?1:o<0?-1:0}function Jd(o,t){return Fi(o.prev,o,o.next)<0?Fi(o,t,o.next)>=0&&Fi(o,o.prev,t)>=0:Fi(o,t,o.prev)<0||Fi(o,o.next,t)<0}function jw(o,t){var s=new $y(o.i,o.x,o.y),c=new $y(t.i,t.x,t.y),h=o.next,p=t.prev;return o.next=t,t.prev=o,s.next=h,h.prev=s,c.next=s,s.prev=c,p.next=c,c.prev=p,c}function Ww(o,t,s,c){var h=new $y(o,t,s);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function Qd(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function $y(o,t,s){this.i=o,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qy(o,t,s,c){for(var h=0,p=t,g=s-c;p<s;p+=c)h+=(o[g]-o[p])*(o[p+1]+o[g+1]),g=p;return h}function JA(o,t,s,c,h){Hw(o,t,s||0,c||o.length-1,h||QA)}function Hw(o,t,s,c,h){for(;c>s;){if(c-s>600){var p=c-s+1,g=t-s+1,x=Math.log(p),b=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*b*(p-b)/p)*(g-p/2<0?-1:1);Hw(o,t,Math.max(s,Math.floor(t-g*b/p+S)),Math.min(c,Math.floor(t+(p-g)*b/p+S)),h)}var C=o[t],L=s,z=c;for(ef(o,s,t),h(o[c],C)>0&&ef(o,s,c);L<z;){for(ef(o,L,z),L++,z--;h(o[L],C)<0;)L++;for(;h(o[z],C)>0;)z--}h(o[s],C)===0?ef(o,s,z):ef(o,++z,c),z<=t&&(s=z+1),t<=z&&(c=z-1)}}function ef(o,t,s){var c=o[t];o[t]=o[s],o[s]=c}function QA(o,t){return o<t?-1:o>t?1:0}function Zy(o,t){const s=o.length;if(s<=1)return[o];const c=[];let h,p;for(let g=0;g<s;g++){const x=jt(o[g]);x!==0&&(o[g].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(h&&c.push(h),h=[o[g]]):h.push(o[g]))}if(h&&c.push(h),t>1)for(let g=0;g<c.length;g++)c[g].length<=t||(JA(c[g],t,1,c[g].length-1,eI),c[g]=c[g].slice(0,t));return c}function eI(o,t){return t.area-o.area}function Xy(o,t,s){const c=s.patternDependencies;let h=!1;for(const p of t){const g=p.paint.get(`${o}-pattern`);g.isConstant()||(h=!0);const x=g.constantOr(null);x&&(h=!0,c[x.to]=!0,c[x.from]=!0)}return h}function Yy(o,t,s,c,h){const p=h.patternDependencies;for(const g of t){const x=g.paint.get(`${o}-pattern`).value;if(x.kind!=="constant"){let b=x.evaluate({zoom:c-1},s,{},h.availableImages),S=x.evaluate({zoom:c},s,{},h.availableImages),C=x.evaluate({zoom:c+1},s,{},h.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,C=C&&C.name?C.name:C,p[b]=!0,p[S]=!0,p[C]=!0,s.patterns[g.id]={min:b,mid:S,max:C}}}return s}Nm.deviation=function(o,t,s,c){var h=t&&t.length,p=Math.abs(qy(o,0,h?t[0]*s:o.length,s));if(h)for(var g=0,x=t.length;g<x;g++)p-=Math.abs(qy(o,t[g]*s,g<x-1?t[g+1]*s:o.length,s));var b=0;for(g=0;g<c.length;g+=3){var S=c[g]*s,C=c[g+1]*s,L=c[g+2]*s;b+=Math.abs((o[S]-o[L])*(o[C+1]-o[S+1])-(o[S]-o[C])*(o[L+1]-o[S+1]))}return p===0&&b===0?0:Math.abs((b-p)/p)},Nm.flatten=function(o){for(var t=o[0][0].length,s={vertices:[],holes:[],dimensions:t},c=0,h=0;h<o.length;h++){for(var p=0;p<o[h].length;p++)for(var g=0;g<t;g++)s.vertices.push(o[h][p][g]);h>0&&s.holes.push(c+=o[h-1].length)}return s},Om.default=GA;class jm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new en,this.indexArray=new kn,this.indexArray2=new Ri,this.programConfigurations=new sc(t.layers,t.zoom),this.segments=new Ii,this.segments2=new Ii,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection}populate(t,s,c,h){this.hasPattern=Xy("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:b,index:S,sourceLayerIndex:C}of t){const L=this.layers[0]._featureFilter.needGeometry,z=cc(x,L);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),z,c))continue;const O=p?p.evaluate(z,{},c,s.availableImages):void 0,U={id:b,properties:x.properties,type:x.type,sourceLayerIndex:C,index:S,geometry:L?z.geometry:ta(x,c,h),patterns:{},sortKey:O};g.push(U)}p&&g.sort((x,b)=>x.sortKey-b.sortKey);for(const x of g){const{geometry:b,index:S,sourceLayerIndex:C}=x;if(this.hasPattern){const L=Yy("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(L)}else this.addFeature(x,b,S,c,{},s.availableImages);s.featureIndex.insert(t[S].feature,b,S,C,this.index)}}update(t,s,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,h)}addFeatures(t,s,c,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,VA),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,h,p,g=[]){for(const x of Zy(s,500)){let b=0;for(const U of x)b+=U.length;const S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),C=S.vertexLength,L=[],z=[];for(const U of x){if(U.length===0)continue;U!==x[0]&&z.push(L.length/2);const X=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),se=X.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(se+U.length-1,se),L.push(U[0].x),L.push(U[0].y);for(let de=1;de<U.length;de++)this.layoutVertexArray.emplaceBack(U[de].x,U[de].y),this.indexArray2.emplaceBack(se+de-1,se+de),L.push(U[de].x),L.push(U[de].y);X.vertexLength+=U.length,X.primitiveLength+=U.length}const O=Om(L,z);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(C+O[U],C+O[U+1],C+O[U+2]);S.vertexLength+=b,S.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,g,h)}}Vt(jm,"FillBucket",{omit:["layers","patternFeatures"]});const tI=new Ke({"fill-sort-key":new ve(Re.layout_fill["fill-sort-key"])});var nI={paint:new Ke({"fill-antialias":new Ue(Re.paint_fill["fill-antialias"]),"fill-opacity":new ve(Re.paint_fill["fill-opacity"]),"fill-color":new ve(Re.paint_fill["fill-color"]),"fill-outline-color":new ve(Re.paint_fill["fill-outline-color"]),"fill-translate":new Ue(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new Ue(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new at(Re.paint_fill["fill-pattern"])}),layout:tI};const iI=St([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),rI=St([{name:"a_centroid_pos",components:2,type:"Uint16"}]),oI=St([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:sI}=iI;var $w=ju;function ju(o,t,s,c,h){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=h,o.readFields(aI,this,t)}function aI(o,t,s){o==1?t.id=s.readVarint():o==2?function(c,h){for(var p=c.readVarint()+c.pos;c.pos<p;){var g=h._keys[c.readVarint()],x=h._values[c.readVarint()];h.properties[g]=x}}(s,t):o==3?t.type=s.readVarint():o==4&&(t._geometry=s.pos)}function lI(o){for(var t,s,c=0,h=0,p=o.length,g=p-1;h<p;g=h++)c+=((s=o[g]).x-(t=o[h]).x)*(t.y+s.y);return c}ju.types=["Unknown","Point","LineString","Polygon"],ju.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var t,s=o.readVarint()+o.pos,c=1,h=0,p=0,g=0,x=[];o.pos<s;){if(h<=0){var b=o.readVarint();c=7&b,h=b>>3}if(h--,c===1||c===2)p+=o.readSVarint(),g+=o.readSVarint(),c===1&&(t&&x.push(t),t=[]),t.push(new P(p,g));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&x.push(t),x},ju.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var t=o.readVarint()+o.pos,s=1,c=0,h=0,p=0,g=1/0,x=-1/0,b=1/0,S=-1/0;o.pos<t;){if(c<=0){var C=o.readVarint();s=7&C,c=C>>3}if(c--,s===1||s===2)(h+=o.readSVarint())<g&&(g=h),h>x&&(x=h),(p+=o.readSVarint())<b&&(b=p),p>S&&(S=p);else if(s!==7)throw new Error("unknown command "+s)}return[g,b,x,S]},ju.prototype.toGeoJSON=function(o,t,s){var c,h,p=this.extent*Math.pow(2,s),g=this.extent*o,x=this.extent*t,b=this.loadGeometry(),S=ju.types[this.type];function C(O){for(var U=0;U<O.length;U++){var X=O[U];O[U]=[360*(X.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+x)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(c=0;c<b.length;c++)L[c]=b[c][0];C(b=L);break;case 2:for(c=0;c<b.length;c++)C(b[c]);break;case 3:for(b=function(O){var U=O.length;if(U<=1)return[O];for(var X,se,de=[],Me=0;Me<U;Me++){var be=lI(O[Me]);be!==0&&(se===void 0&&(se=be<0),se===be<0?(X&&de.push(X),X=[O[Me]]):X.push(O[Me]))}return X&&de.push(X),de}(b),c=0;c<b.length;c++)for(h=0;h<b[c].length;h++)C(b[c][h])}b.length===1?b=b[0]:S="Multi"+S;var z={type:"Feature",geometry:{type:S,coordinates:b},properties:this.properties};return"id"in this&&(z.id=this.id),z};var qw=Zw;function Zw(o,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(cI,this,t),this.length=this._features.length}function cI(o,t,s){o===15?t.version=s.readVarint():o===1?t.name=s.readString():o===5?t.extent=s.readVarint():o===2?t._features.push(s.pos):o===3?t._keys.push(s.readString()):o===4&&t._values.push(function(c){for(var h=null,p=c.readVarint()+c.pos;c.pos<p;){var g=c.readVarint()>>3;h=g===1?c.readString():g===2?c.readFloat():g===3?c.readDouble():g===4?c.readVarint64():g===5?c.readVarint():g===6?c.readSVarint():g===7?c.readBoolean():null}return h}(s))}function uI(o,t,s){if(o===3){var c=new qw(s,s.readVarint()+s.pos);c.length&&(t[c.name]=c)}}Zw.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var t=this._pbf.readVarint()+this._pbf.pos;return new $w(this._pbf,t,this.extent,this._keys,this._values)};var fc={VectorTile:function(o,t){this.layers=o.readFields(uI,{},t)},VectorTileFeature:$w,VectorTileLayer:qw};function Wm(o,t,s,c){const h=[],p=c===0?(g,x,b,S,C,L)=>{g.push(new P(L,b+(L-x)/(S-x)*(C-b)))}:(g,x,b,S,C,L)=>{g.push(new P(x+(L-b)/(C-b)*(S-x),L))};for(const g of o){const x=[];for(const b of g){if(b.length<=2)continue;const S=[];for(let z=0;z<b.length-1;z++){const O=b[z].x,U=b[z].y,X=b[z+1].x,se=b[z+1].y,de=c===0?O:U,Me=c===0?X:se;de<t?Me>t&&p(S,O,U,X,se,t):de>s?Me<s&&p(S,O,U,X,se,s):S.push(b[z]),Me<t&&de>=t&&p(S,O,U,X,se,t),Me>s&&de<=s&&p(S,O,U,X,se,s)}let C=b[b.length-1];const L=c===0?C.x:C.y;L>=t&&L<=s&&S.push(C),S.length&&(C=S[S.length-1],S[0].x===C.x&&S[0].y===C.y||S.push(S[0]),x.push(S))}x.length&&h.push(x)}return h}const hI=fc.VectorTileFeature.types,dI=Math.pow(2,13);function tf(o,t,s,c,h,p,g,x){o.emplaceBack((t<<1)+g,(s<<1)+p,(Math.floor(c*dI)<<1)+h,Math.round(x))}function nf(o,t,s){o.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Xw{constructor(){this.acc=new P(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new P(t.x,t.y),this.max=new P(t.x,t.y))}append(t,s){this.currentPolyCount.edges++,this.acc._add(t);const c=this.min,h=this.max;t.x<c.x?c.x=t.x:t.x>h.x&&(h.x=t.x),t.y<c.y?c.y=t.y:t.y>h.y&&(h.y=t.y),((t.x===0||t.x===on)&&t.x===s.x)!=((t.y===0||t.y===on)&&t.y===s.y)&&this.processBorderOverlap(t,s),s.x<0!=t.x<0&&this.addBorderIntersection(0,Rn(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>on!=t.x>on&&this.addBorderIntersection(1,Rn(s.y,t.y,(on-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,Rn(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>on!=t.y>on&&this.addBorderIntersection(3,Rn(s.x,t.x,(on-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,t.x)}}centroid(){const t=this.polyCount.reduce((s,c)=>s+c.edges,0);return t!==0?this.acc.div(t)._round():new P(0,0)}span(){return new P(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0)}}class rf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Kt,this.centroidVertexArray=new aw,this.indexArray=new kn,this.programConfigurations=new sc(t.layers,t.zoom),this.segments=new Ii,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=t.enableTerrain}populate(t,s,c,h){this.features=[],this.hasPattern=Xy("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/on/(1<<p.z)}(c);for(const{feature:p,id:g,index:x,sourceLayerIndex:b}of t){const S=this.layers[0]._featureFilter.needGeometry,C=cc(p,S);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),C,c))continue;const L={id:g,sourceLayerIndex:b,index:x,geometry:S?C.geometry:ta(p,c,h),properties:p.properties,type:p.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Yy("fill-extrusion",this.layers,L,this.zoom,s)):this.addFeature(L,L.geometry,x,c,{},s.availableImages,h),s.featureIndex.insert(p,L.geometry,x,b,this.index,z)}this.sortBorders()}addFeatures(t,s,c,h,p){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,s,c,h,p)}this.sortBorders()}update(t,s,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sI),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,oI.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,rI.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,h,p,g,x){const b=[new P(0,0),new P(on,on)],S=x.projection,C=S.name==="globe",L=this.enableTerrain&&!C?new Xw:null;C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Y1);const z=Zy(s,500);for(let X=z.length-1;X>=0;X--){const se=z[X];(se.length===0||(O=se[0]).every(de=>de.x<=0)||O.every(de=>de.x>=on)||O.every(de=>de.y<=0)||O.every(de=>de.y>=on))&&z.splice(X,1)}var O;let U;if(C)U=Kw(z,b,h);else{U=[];for(const X of z)U.push({polygon:X,bounds:b})}for(const X of U){const se=X.polygon;let de=0,Me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let We=0;We<se.length;We++){const $e=se[We];if($e.length===0)continue;de+=$e.length;let nt=0;L&&L.startRing($e[0]);for(let ht=0;ht<$e.length;ht++){const Oe=$e[ht];if(ht>=1){const Qe=$e[ht-1];if(!fI(Oe,Qe,X.bounds)){L&&L.append(Oe,Qe),Me.vertexLength+4>Ii.MAX_VERTEX_ARRAY_LENGTH&&(Me=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const dt=Oe.sub(Qe)._perp(),ft=dt.x/(Math.abs(dt.x)+Math.abs(dt.y)),Ot=dt.y>0?1:0,lt=Qe.dist(Oe);nt+lt>32768&&(nt=0),tf(this.layoutVertexArray,Oe.x,Oe.y,ft,Ot,0,0,nt),tf(this.layoutVertexArray,Oe.x,Oe.y,ft,Ot,0,1,nt),nt+=lt,tf(this.layoutVertexArray,Qe.x,Qe.y,ft,Ot,0,0,nt),tf(this.layoutVertexArray,Qe.x,Qe.y,ft,Ot,0,1,nt);const zt=Me.vertexLength;if(this.indexArray.emplaceBack(zt,zt+2,zt+1),this.indexArray.emplaceBack(zt+1,zt+2,zt+3),Me.vertexLength+=4,Me.primitiveLength+=2,C){const yn=this.layoutVertexExtArray,Mn=S.projectTilePoint(Oe.x,Oe.y,h),Qt=S.projectTilePoint(Qe.x,Qe.y,h),Gt=S.upVector(h,Oe.x,Oe.y),En=S.upVector(h,Qe.x,Qe.y);nf(yn,Mn,Gt),nf(yn,Mn,Gt),nf(yn,Qt,En),nf(yn,Qt,En)}}}}}if(Me.vertexLength+de>Ii.MAX_VERTEX_ARRAY_LENGTH&&(Me=this.segments.prepareSegment(de,this.layoutVertexArray,this.indexArray)),hI[t.type]!=="Polygon")continue;const be=[],Ie=[],De=Me.vertexLength;for(let We=0;We<se.length;We++){const $e=se[We];if($e.length!==0){$e!==se[0]&&Ie.push(be.length/2);for(let nt=0;nt<$e.length;nt++){const ht=$e[nt];tf(this.layoutVertexArray,ht.x,ht.y,0,0,1,1,0),be.push(ht.x),be.push(ht.y),L&&L.currentPolyCount.top++,C&&nf(this.layoutVertexExtArray,S.projectTilePoint(ht.x,ht.y,h),S.upVector(h,ht.x,ht.y))}}}const ke=Om(be,Ie);for(let We=0;We<ke.length;We+=3)this.indexArray.emplaceBack(De+ke[We],De+ke[We+2],De+ke[We+1]);Me.primitiveLength+=ke.length/3,Me.vertexLength+=de}if(L&&L.polyCount.length>0){if(L.borders){L.vertexArrayOffset=this.centroidVertexArray.length;const X=L.borders,se=this.featuresOnBorder.push(L)-1;for(let de=0;de<4;de++)X[de][0]!==Number.MAX_VALUE&&this.borders[de].push(se)}this.encodeCentroid(L.borders?void 0:L.centroid(),L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,g,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((s,c)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}encodeCentroid(t,s,c=!0){let h,p;if(t)if(t.y!==0){const x=s.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(x.x/10)),p=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(t.x+450)),p=0;else h=0,p=+c;let g=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let b=0;b<2*x.edges;b++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,h,p);for(let b=0;b<x.top;b++)this.centroidVertexArray.emplace(g++,h,p)}}}function fI(o,t,s){return o.x===t.x&&(o.x<s[0].x||o.x>s[1].x)||o.y===t.y&&(o.y<s[0].y||o.y>s[1].y)}function Yw(){const o=Math.PI/32,t=Math.tan(o),s=Iy;return s*Math.sqrt(1+2*t*t)-s}function Kw(o,t,s){const c=1<<s.z,h=Tr(s.x/c),p=Tr((s.x+1)/c),g=Gi(s.y/c),x=Gi((s.y+1)/c);return function(b,S,C,L,z=0,O){const U=[];if(!b.length||!C||!L)return U;const X=(ke,We)=>{for(const $e of ke)U.push({polygon:$e,bounds:We})},se=Math.ceil(Math.log2(C)),de=Math.ceil(Math.log2(L)),Me=se-de,be=[];for(let ke=0;ke<Math.abs(Me);ke++)be.push(Me>0?0:1);for(let ke=0;ke<Math.min(se,de);ke++)be.push(0),be.push(1);let Ie=b;if(Ie=Wm(Ie,S[0].y-z,S[1].y+z,1),Ie=Wm(Ie,S[0].x-z,S[1].x+z,0),!Ie.length)return U;const De=[];for(be.length?De.push({polygons:Ie,bounds:S,depth:0}):X(Ie,S);De.length;){const ke=De.pop(),We=ke.depth,$e=be[We],nt=ke.bounds[0],ht=ke.bounds[1],Oe=$e===0?nt.x:nt.y,Qe=$e===0?ht.x:ht.y,dt=O?O($e,Oe,Qe):.5*(Oe+Qe),ft=Wm(ke.polygons,Oe-z,dt+z,$e),Ot=Wm(ke.polygons,dt-z,Qe+z,$e);if(ft.length){const lt=[nt,new P($e===0?dt:ht.x,$e===1?dt:ht.y)];be.length>We+1?De.push({polygons:ft,bounds:lt,depth:We+1}):X(ft,lt)}if(Ot.length){const lt=[new P($e===0?dt:nt.x,$e===1?dt:nt.y),ht];be.length>We+1?De.push({polygons:Ot,bounds:lt,depth:We+1}):X(Ot,lt)}}return U}(o,t,Math.ceil((p-h)/11.25),Math.ceil((g-x)/11.25),1,(b,S,C)=>{if(b===0)return .5*(S+C);{const L=Gi((s.y+S/on)/c);return(lc(.5*(Gi((s.y+C/on)/c)+L))*c-s.y)*on}})}Vt(rf,"FillExtrusionBucket",{omit:["layers","features"]}),Vt(Xw,"PartMetadata");var pI={paint:new Ke({"fill-extrusion-opacity":new Ue(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ve(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ue(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ue(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new at(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ve(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ve(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ue(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Jw(o,t,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class Hm{constructor(t,s,c){this.z=t,this.x=s,this.y=c,this.key=of(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const c=function(p,g,x){var b=Jw(256*p,256*(g=Math.pow(2,x)-g-1),x),S=Jw(256*(p+1),256*(g+1),x);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),h=function(p,g,x){let b,S="";for(let C=p;C>0;C--)b=1<<C-1,S+=(g&b?1:0)+(x&b?2:0);return S}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qw{constructor(t,s){this.wrap=t,this.canonical=s,this.key=of(t,s.z,s.z,s.x,s.y)}}class Cr{constructor(t,s,c,h,p){this.overscaledZ=t,this.wrap=s,this.canonical=new Hm(c,+h,+p),this.key=s===0&&t===c?this.canonical.key:of(s,t,c,h,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new Cr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cr(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return of(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return of(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Cr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new Cr(s,this.wrap,s,c,h),new Cr(s,this.wrap,s,c+1,h),new Cr(s,this.wrap,s,c,h+1),new Cr(s,this.wrap,s,c+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Cr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Cr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function of(o,t,s,c,h){const p=1<<Math.min(s,22);let g=p*(h%p)+c%p;return o&&s<22&&(g+=p*p*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*g+s)+(t-s)}function sf(o,t){return o.x*t.x+o.y*t.y}function eb(o,t){if(o.length===1){let s=0;const c=t[s++];let h;for(;!h||c.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){const p=t[s],g=o[0],x=h.sub(c),b=p.sub(c),S=g.sub(c),C=sf(x,x),L=sf(x,b),z=sf(b,b),O=sf(S,x),U=sf(S,b),X=C*z-L*L,se=(z*O-L*U)/X,de=(C*U-L*O)/X,Me=c.z*(1-se-de)+h.z*se+p.z*de;if(isFinite(Me))return Me}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}function $m(o){const t=new P(o[0],o[1]);return t.z=o[2],t}function tb(o,t,s,c,h,p,g,x){const b=g*h.getElevationAt(o,t,!0,!0),S=p[0]!==0,C=S?p[1]===0?g*(p[0]/7-450):g*function(L,z,O){const U=Math.floor(z[0]/8),X=Math.floor(z[1]/8),se=10*(z[0]-8*U),de=10*(z[1]-8*X),Me=L.getElevationAt(U,X,!0,!0),be=L.getMeterToDEM(O),Ie=Math.floor(.5*(se*be-1)),De=Math.floor(.5*(de*be-1)),ke=L.tileCoordToPixel(U,X),We=2*Ie+1,$e=2*De+1,nt=function(Ot,lt,zt,yn,Mn){return[Ot.getElevationAtPixel(lt,zt,!0),Ot.getElevationAtPixel(lt+Mn,zt,!0),Ot.getElevationAtPixel(lt,zt+Mn,!0),Ot.getElevationAtPixel(lt+yn,zt+Mn,!0)]}(L,ke.x-Ie,ke.y-De,We,$e),ht=Math.abs(nt[0]-nt[1]),Oe=Math.abs(nt[2]-nt[3]),Qe=Math.abs(nt[0]-nt[2])+Math.abs(nt[1]-nt[3]),dt=Math.min(.25,.5*be*(ht+Oe)/We),ft=Math.min(.25,.5*be*Qe/$e);return Me+Math.max(dt*se,ft*de)}(h,p,x):b;return{base:b+(s===0)?-1:s,top:S?Math.max(C+c,b+s+2):b+c}}Vt(Hm,"CanonicalTileID"),Vt(Cr,"OverscaledTileID",{omit:["projMatrix"]});const mI=St([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:_I}=mI,gI=St([{name:"a_packed",components:4,type:"Float32"}]),{members:yI}=gI,xI=fc.VectorTileFeature.types,vI=Math.cos(Math.PI/180*37.5);class qm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new gn,this.layoutVertexArray2=new Gn,this.indexArray=new kn,this.programConfigurations=new sc(t.layers,t.zoom),this.segments=new Ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,c,h){this.hasPattern=Xy("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:C,id:L,index:z,sourceLayerIndex:O}of t){const U=this.layers[0]._featureFilter.needGeometry,X=cc(C,U);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),X,c))continue;const se=p?p.evaluate(X,{},c):void 0,de={id:L,properties:C.properties,type:C.type,sourceLayerIndex:O,index:z,geometry:U?X.geometry:ta(C,c,h),patterns:{},sortKey:se};g.push(de)}p&&g.sort((C,L)=>C.sortKey-L.sortKey);const{lineAtlas:x,featureIndex:b}=s,S=this.addConstantDashes(x);for(const C of g){const{geometry:L,index:z,sourceLayerIndex:O}=C;if(S&&this.addFeatureDashes(C,x),this.hasPattern){const U=Yy("line",this.layers,C,this.zoom,s);this.patternFeatures.push(U)}else this.addFeature(C,L,z,c,x.positions,s.availableImages);b.insert(t[z].feature,L,z,O,this.index)}}addConstantDashes(t){let s=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")s=!0;else{const g=p.value,x=h.value;if(!x)continue;t.addDash(x.from,g),t.addDash(x.to,g),x.other&&t.addDash(x.other,g)}}return s}addFeatureDashes(t,s){const c=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let x,b,S,C,L,z;if(p.kind==="constant"){const se=p.value;if(!se)continue;x=se.other||se.to,b=se.to,S=se.from}else x=p.evaluate({zoom:c-1},t),b=p.evaluate({zoom:c},t),S=p.evaluate({zoom:c+1},t);g.kind==="constant"?C=L=z=g.value:(C=g.evaluate({zoom:c-1},t),L=g.evaluate({zoom:c},t),z=g.evaluate({zoom:c+1},t)),s.addDash(x,C),s.addDash(b,L),s.addDash(S,z);const O=s.getKey(x,C),U=s.getKey(b,L),X=s.getKey(S,z);t.patterns[h.id]={min:O,mid:U,max:X}}}update(t,s,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,c,h)}addFeatures(t,s,c,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,yI)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_I),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,h,p,g){const x=this.layers[0].layout,b=x.get("line-join").evaluate(t,{}),S=x.get("line-cap").evaluate(t,{}),C=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of s)this.addLine(z,t,b,S,C,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,p,g,h)}addLine(t,s,c,h,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<t.length-1;de++)this.totalDistance+=t[de].dist(t[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=xI[s.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let S=0;for(;S<b-1&&t[S].equals(t[S+1]);)S++;if(b<(x?3:2))return;c==="bevel"&&(p=1.05);const C=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let z,O,U,X,se;this.e1=this.e2=-1,x&&(z=t[b-2],se=t[S].sub(z)._unit()._perp());for(let de=S;de<b;de++){if(U=de===b-1?x?t[S+1]:void 0:t[de+1],U&&t[de].equals(U))continue;se&&(X=se),z&&(O=z),z=t[de],se=U?U.sub(z)._unit()._perp():X,X=X||se;let Me=X.add(se);Me.x===0&&Me.y===0||Me._unit();const be=X.x*se.x+X.y*se.y,Ie=Me.x*se.x+Me.y*se.y,De=Ie!==0?1/Ie:1/0,ke=2*Math.sqrt(2-2*Ie),We=Ie<vI&&O&&U,$e=X.x*se.y-X.y*se.x>0;if(We&&de>S){const Oe=z.dist(O);if(Oe>2*C){const Qe=z.sub(z.sub(O)._mult(C/Oe)._round());this.updateDistance(O,Qe),this.addCurrentVertex(Qe,X,0,0,L),O=Qe}}const nt=O&&U;let ht=nt?c:x?"butt":h;if(nt&&ht==="round"&&(De<g?ht="miter":De<=2&&(ht="fakeround")),ht==="miter"&&De>p&&(ht="bevel"),ht==="bevel"&&(De>2&&(ht="flipbevel"),De<p&&(ht="miter")),O&&this.updateDistance(O,z),ht==="miter")Me._mult(De),this.addCurrentVertex(z,Me,0,0,L);else if(ht==="flipbevel"){if(De>100)Me=se.mult(-1);else{const Oe=De*X.add(se).mag()/X.sub(se).mag();Me._perp()._mult(Oe*($e?-1:1))}this.addCurrentVertex(z,Me,0,0,L),this.addCurrentVertex(z,Me.mult(-1),0,0,L)}else if(ht==="bevel"||ht==="fakeround"){const Oe=-Math.sqrt(De*De-1),Qe=$e?Oe:0,dt=$e?0:Oe;if(O&&this.addCurrentVertex(z,X,Qe,dt,L),ht==="fakeround"){const ft=Math.round(180*ke/Math.PI/20);for(let Ot=1;Ot<ft;Ot++){let lt=Ot/ft;if(lt!==.5){const yn=lt-.5;lt+=lt*yn*(lt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*yn*yn+(.848013+be*(.215638*be-1.06021)))}const zt=se.sub(X)._mult(lt)._add(X)._unit()._mult($e?-1:1);this.addHalfVertex(z,zt.x,zt.y,!1,$e,0,L)}}U&&this.addCurrentVertex(z,se,-Qe,-dt,L)}else if(ht==="butt")this.addCurrentVertex(z,Me,0,0,L);else if(ht==="square"){const Oe=O?1:-1;O||this.addCurrentVertex(z,Me,Oe,Oe,L),this.addCurrentVertex(z,Me,0,0,L),O&&this.addCurrentVertex(z,Me,Oe,Oe,L)}else ht==="round"&&(O&&(this.addCurrentVertex(z,X,0,0,L),this.addCurrentVertex(z,X,1,1,L,!0)),U&&(this.addCurrentVertex(z,se,-1,-1,L,!0),this.addCurrentVertex(z,se,0,0,L)));if(We&&de<b-1){const Oe=z.dist(U);if(Oe>2*C){const Qe=z.add(U.sub(z)._mult(C/Oe)._round());this.updateDistance(z,Qe),this.addCurrentVertex(Qe,se,0,0,L),z=Qe}}}}addCurrentVertex(t,s,c,h,p,g=!1){const x=s.y*h-s.x,b=-s.y-s.x*h;this.addHalfVertex(t,s.x+s.y*c,s.y-s.x*c,g,!1,c,p),this.addHalfVertex(t,x,b,g,!0,-h,p)}addHalfVertex({x:t,y:s},c,h,p,g,x,b){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(s<<1)+(g?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),b.primitiveLength++),g?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}Vt(qm,"LineBucket",{omit:["layers","patternFeatures"]});const wI=new Ke({"line-cap":new ve(Re.layout_line["line-cap"]),"line-join":new ve(Re.layout_line["line-join"]),"line-miter-limit":new Ue(Re.layout_line["line-miter-limit"]),"line-round-limit":new Ue(Re.layout_line["line-round-limit"]),"line-sort-key":new ve(Re.layout_line["line-sort-key"])});var nb={paint:new Ke({"line-opacity":new ve(Re.paint_line["line-opacity"]),"line-color":new ve(Re.paint_line["line-color"]),"line-translate":new Ue(Re.paint_line["line-translate"]),"line-translate-anchor":new Ue(Re.paint_line["line-translate-anchor"]),"line-width":new ve(Re.paint_line["line-width"]),"line-gap-width":new ve(Re.paint_line["line-gap-width"]),"line-offset":new ve(Re.paint_line["line-offset"]),"line-blur":new ve(Re.paint_line["line-blur"]),"line-dasharray":new at(Re.paint_line["line-dasharray"]),"line-pattern":new at(Re.paint_line["line-pattern"]),"line-gradient":new It(Re.paint_line["line-gradient"]),"line-trim-offset":new Ue(Re.paint_line["line-trim-offset"])}),layout:wI};const ib=new class extends ve{possiblyEvaluate(o,t){return t=new ae(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(o,t)}evaluate(o,t,s,c){return t=Fe({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(o,t,s,c)}}(nb.paint.properties["line-width"].specification);function rb(o,t){return t>0?t+2*o:o}ib.useIntegerZoom=!0;const bI=St([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),SI=St([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),MI=St([{name:"a_projected_pos",components:4,type:"Float32"}],4);St([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const TI=St([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),EI=St([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);St([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ob=St([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),CI=St([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);St([{name:"triangle",components:3,type:"Uint16"}]),St([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),St([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),St([{type:"Float32",name:"offsetX"}]),St([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cr=24;const Ss=128;function Ky(o,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new ae(o+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:h}=s;let p=0;for(;p<c.length&&c[p]<=o;)p++;p=Math.max(0,p-1);let g=p;for(;g<c.length&&c[g]<o+1;)g++;g=Math.min(c.length-1,g);const x=c[p],b=c[g];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:b,minSize:s.evaluate(new ae(x)),maxSize:s.evaluate(new ae(b)),interpolationType:h}}}function Zm(o,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:h}){return o.kind==="source"?c/Ss:o.kind==="composite"?Rn(c/Ss,h/Ss,s):t}function Wu(o,t){let s=0,c=0;if(o.kind==="constant")c=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:g}=o,x=h?K(Co.interpolationFactor(h,t,p,g),0,1):0;o.kind==="camera"?c=Rn(o.minSize,o.maxSize,x):s=x}return{uSizeT:s,uSize:c}}var AI=Object.freeze({__proto__:null,getSizeData:Ky,evaluateSizeForFeature:Zm,evaluateSizeForZoom:Wu,SIZE_PACK_FACTOR:Ss});function II(o,t,s){return o.sections.forEach(c=>{c.text=function(h,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),Q.applyArabicShaping&&(h=Q.applyArabicShaping(h)),h}(c.text,t,s)}),o}const af={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function PI(o){return o==="\uFE36"||o==="\uFE48"||o==="\uFE38"||o==="\uFE44"||o==="\uFE42"||o==="\uFE3E"||o==="\uFE3C"||o==="\uFE3A"||o==="\uFE18"||o==="\uFE40"||o==="\uFE10"||o==="\uFE13"||o==="\uFE14"||o==="\uFF40"||o==="\uFFE3"||o==="\uFE11"||o==="\uFE12"}function LI(o){return o==="\uFE35"||o==="\uFE47"||o==="\uFE37"||o==="\uFE43"||o==="\uFE41"||o==="\uFE3D"||o==="\uFE3B"||o==="\uFE39"||o==="\uFE17"||o==="\uFE3F"}var sb=function(o,t,s,c,h){var p,g,x=8*h-c-1,b=(1<<x)-1,S=b>>1,C=-7,L=s?h-1:0,z=s?-1:1,O=o[t+L];for(L+=z,p=O&(1<<-C)-1,O>>=-C,C+=x;C>0;p=256*p+o[t+L],L+=z,C-=8);for(g=p&(1<<-C)-1,p>>=-C,C+=c;C>0;g=256*g+o[t+L],L+=z,C-=8);if(p===0)p=1-S;else{if(p===b)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,c),p-=S}return(O?-1:1)*g*Math.pow(2,p-c)},ab=function(o,t,s,c,h,p){var g,x,b,S=8*p-h-1,C=(1<<S)-1,L=C>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=c?0:p-1,U=c?1:-1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,g=C):(g=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-g))<1&&(g--,b*=2),(t+=g+L>=1?z/b:z*Math.pow(2,1-L))*b>=2&&(g++,b/=2),g+L>=C?(x=0,g=C):g+L>=1?(x=(t*b-1)*Math.pow(2,h),g+=L):(x=t*Math.pow(2,L-1)*Math.pow(2,h),g=0));h>=8;o[s+O]=255&x,O+=U,x/=256,h-=8);for(g=g<<h|x,S+=h;S>0;o[s+O]=255&g,O+=U,g/=256,S-=8);o[s+O-U]|=128*X},lf=ti;function ti(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}ti.Varint=0,ti.Fixed64=1,ti.Bytes=2,ti.Fixed32=5;var Jy=4294967296,lb=1/Jy,cb=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ia(o){return o.type===ti.Bytes?o.readVarint()+o.pos:o.pos+1}function Hu(o,t,s){return s?4294967296*t+(o>>>0):4294967296*(t>>>0)+(o>>>0)}function ub(o,t,s){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(c);for(var h=s.pos-1;h>=o;h--)s.buf[h+c]=s.buf[h]}function DI(o,t){for(var s=0;s<o.length;s++)t.writeVarint(o[s])}function zI(o,t){for(var s=0;s<o.length;s++)t.writeSVarint(o[s])}function kI(o,t){for(var s=0;s<o.length;s++)t.writeFloat(o[s])}function RI(o,t){for(var s=0;s<o.length;s++)t.writeDouble(o[s])}function FI(o,t){for(var s=0;s<o.length;s++)t.writeBoolean(o[s])}function BI(o,t){for(var s=0;s<o.length;s++)t.writeFixed32(o[s])}function OI(o,t){for(var s=0;s<o.length;s++)t.writeSFixed32(o[s])}function NI(o,t){for(var s=0;s<o.length;s++)t.writeFixed64(o[s])}function UI(o,t){for(var s=0;s<o.length;s++)t.writeSFixed64(o[s])}function Xm(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+16777216*o[t+3]}function $u(o,t,s){o[s]=t,o[s+1]=t>>>8,o[s+2]=t>>>16,o[s+3]=t>>>24}function hb(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+(o[t+3]<<24)}function VI(o,t,s){t.glyphs=[],o===1&&s.readMessage(GI,t)}function GI(o,t,s){if(o===3){const{id:c,bitmap:h,width:p,height:g,left:x,top:b,advance:S}=s.readMessage(jI,{});t.glyphs.push({id:c,bitmap:new na({width:p+6,height:g+6},h),metrics:{width:p,height:g,left:x,top:b,advance:S}})}else o===4?t.ascender=s.readSVarint():o===5&&(t.descender=s.readSVarint())}function jI(o,t,s){o===1?t.id=s.readVarint():o===2?t.bitmap=s.readBytes():o===3?t.width=s.readVarint():o===4?t.height=s.readVarint():o===5?t.left=s.readSVarint():o===6?t.top=s.readSVarint():o===7&&(t.advance=s.readVarint())}function Qy(o){let t=0,s=0;for(const g of o)t+=g.w*g.h,s=Math.max(s,g.w);o.sort((g,x)=>x.h-g.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let h=0,p=0;for(const g of o)for(let x=c.length-1;x>=0;x--){const b=c[x];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){const S=c.pop();x<c.length&&(c[x]=S)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(c.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:p,fill:t/(h*p)||0}}ti.prototype={destroy:function(){this.buf=null},readFields:function(o,t,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),h=c>>3,p=this.pos;this.type=7&c,o(h,t,this),this.pos===p&&this.skip(c)}return t},readMessage:function(o,t){return this.readFields(o,t,this.readVarint()+this.pos)},readFixed32:function(){var o=Xm(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=hb(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Xm(this.buf,this.pos)+Xm(this.buf,this.pos+4)*Jy;return this.pos+=8,o},readSFixed64:function(){var o=Xm(this.buf,this.pos)+hb(this.buf,this.pos+4)*Jy;return this.pos+=8,o},readFloat:function(){var o=sb(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=sb(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var t,s,c=this.buf;return t=127&(s=c[this.pos++]),s<128?t:(t|=(127&(s=c[this.pos++]))<<7,s<128?t:(t|=(127&(s=c[this.pos++]))<<14,s<128?t:(t|=(127&(s=c[this.pos++]))<<21,s<128?t:function(h,p,g){var x,b,S=g.buf;if(x=(112&(b=S[g.pos++]))>>4,b<128||(x|=(127&(b=S[g.pos++]))<<3,b<128)||(x|=(127&(b=S[g.pos++]))<<10,b<128)||(x|=(127&(b=S[g.pos++]))<<17,b<128)||(x|=(127&(b=S[g.pos++]))<<24,b<128)||(x|=(1&(b=S[g.pos++]))<<31,b<128))return Hu(h,x,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,t=this.pos;return this.pos=o,o-t>=12&&cb?function(s,c,h){return cb.decode(s.subarray(c,h))}(this.buf,t,o):function(s,c,h){for(var p="",g=c;g<h;){var x,b,S,C=s[g],L=null,z=C>239?4:C>223?3:C>191?2:1;if(g+z>h)break;z===1?C<128&&(L=C):z===2?(192&(x=s[g+1]))==128&&(L=(31&C)<<6|63&x)<=127&&(L=null):z===3?(b=s[g+2],(192&(x=s[g+1]))==128&&(192&b)==128&&((L=(15&C)<<12|(63&x)<<6|63&b)<=2047||L>=55296&&L<=57343)&&(L=null)):z===4&&(b=s[g+2],S=s[g+3],(192&(x=s[g+1]))==128&&(192&b)==128&&(192&S)==128&&((L=(15&C)<<18|(63&x)<<12|(63&b)<<6|63&S)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,z=1):L>65535&&(L-=65536,p+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),p+=String.fromCharCode(L),g+=z}return p}(this.buf,t,o)},readBytes:function(){var o=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,o);return this.pos=o,t},readPackedVarint:function(o,t){if(this.type!==ti.Bytes)return o.push(this.readVarint(t));var s=ia(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(t));return o},readPackedSVarint:function(o){if(this.type!==ti.Bytes)return o.push(this.readSVarint());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==ti.Bytes)return o.push(this.readBoolean());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==ti.Bytes)return o.push(this.readFloat());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==ti.Bytes)return o.push(this.readDouble());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==ti.Bytes)return o.push(this.readFixed32());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==ti.Bytes)return o.push(this.readSFixed32());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==ti.Bytes)return o.push(this.readFixed64());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==ti.Bytes)return o.push(this.readSFixed64());var t=ia(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed64());return o},skip:function(o){var t=7&o;if(t===ti.Varint)for(;this.buf[this.pos++]>127;);else if(t===ti.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ti.Fixed32)this.pos+=4;else{if(t!==ti.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(o,t){this.writeVarint(o<<3|t)},realloc:function(o){for(var t=this.length||16;t<this.pos+o;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),$u(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),$u(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),$u(this.buf,-1&o,this.pos),$u(this.buf,Math.floor(o*lb),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),$u(this.buf,-1&o,this.pos),$u(this.buf,Math.floor(o*lb),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(t,s){var c,h;if(t>=0?(c=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,g,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(c,0,s),function(p,g){var x=(7&p)<<4;g.buf[g.pos++]|=x|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(h,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var t=this.pos;this.pos=function(c,h,p){for(var g,x,b=0;b<h.length;b++){if((g=h.charCodeAt(b))>55295&&g<57344){if(!x){g>56319||b+1===h.length?(c[p++]=239,c[p++]=191,c[p++]=189):x=g;continue}if(g<56320){c[p++]=239,c[p++]=191,c[p++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(c[p++]=239,c[p++]=191,c[p++]=189,x=null);g<128?c[p++]=g:(g<2048?c[p++]=g>>6|192:(g<65536?c[p++]=g>>12|224:(c[p++]=g>>18|240,c[p++]=g>>12&63|128),c[p++]=g>>6&63|128),c[p++]=63&g|128)}return p}(this.buf,o,this.pos);var s=this.pos-t;s>=128&&ub(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),ab(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),ab(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var t=o.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,t){this.pos++;var s=this.pos;o(t,this);var c=this.pos-s;c>=128&&ub(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,t,s){this.writeTag(o,ti.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(o,t){t.length&&this.writeMessage(o,DI,t)},writePackedSVarint:function(o,t){t.length&&this.writeMessage(o,zI,t)},writePackedBoolean:function(o,t){t.length&&this.writeMessage(o,FI,t)},writePackedFloat:function(o,t){t.length&&this.writeMessage(o,kI,t)},writePackedDouble:function(o,t){t.length&&this.writeMessage(o,RI,t)},writePackedFixed32:function(o,t){t.length&&this.writeMessage(o,BI,t)},writePackedSFixed32:function(o,t){t.length&&this.writeMessage(o,OI,t)},writePackedFixed64:function(o,t){t.length&&this.writeMessage(o,NI,t)},writePackedSFixed64:function(o,t){t.length&&this.writeMessage(o,UI,t)},writeBytesField:function(o,t){this.writeTag(o,ti.Bytes),this.writeBytes(t)},writeFixed32Field:function(o,t){this.writeTag(o,ti.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(o,t){this.writeTag(o,ti.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(o,t){this.writeTag(o,ti.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(o,t){this.writeTag(o,ti.Fixed64),this.writeSFixed64(t)},writeVarintField:function(o,t){this.writeTag(o,ti.Varint),this.writeVarint(t)},writeSVarintField:function(o,t){this.writeTag(o,ti.Varint),this.writeSVarint(t)},writeStringField:function(o,t){this.writeTag(o,ti.Bytes),this.writeString(t)},writeFloatField:function(o,t){this.writeTag(o,ti.Fixed32),this.writeFloat(t)},writeDoubleField:function(o,t){this.writeTag(o,ti.Fixed64),this.writeDouble(t)},writeBooleanField:function(o,t){this.writeVarintField(o,Boolean(t))}};class e0{constructor(t,{pixelRatio:s,version:c,stretchX:h,stretchY:p,content:g}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=h,this.stretchY=p,this.content=g,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class db{constructor(t,s){const c={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,c,p),this.addImages(s,h,p);const{w:g,h:x}=Qy(p),b=new Qr({width:g||1,height:x||1});for(const S in t){const C=t[S],L=c[S].paddedRect;Qr.copy(C.data,b,{x:0,y:0},{x:L.x+1,y:L.y+1},C.data)}for(const S in s){const C=s[S],L=h[S].paddedRect,z=L.x+1,O=L.y+1,U=C.data.width,X=C.data.height;Qr.copy(C.data,b,{x:0,y:0},{x:z,y:O},C.data),Qr.copy(C.data,b,{x:0,y:X-1},{x:z,y:O-1},{width:U,height:1}),Qr.copy(C.data,b,{x:0,y:0},{x:z,y:O+X},{width:U,height:1}),Qr.copy(C.data,b,{x:U-1,y:0},{x:z-1,y:O},{width:1,height:X}),Qr.copy(C.data,b,{x:0,y:0},{x:z+U,y:O},{width:1,height:X})}this.image=b,this.iconPositions=c,this.patternPositions=h}addImages(t,s,c){for(const h in t){const p=t[h],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};c.push(g),s[h]=new e0(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>t.hasImage(c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[h,p]=t.tl;c.update(s.data,void 0,{x:h,y:p})}}Vt(e0,"ImagePosition"),Vt(db,"ImageAtlas");const _o={horizontal:1,vertical:2,horizontalOnly:3};class cf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new cf;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new cf;return s.imageName=t,s}}class qu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new qu;for(let h=0;h<t.sections.length;h++){const p=t.sections[h];p.image?c.addImageSection(p):c.addTextSection(p,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(s,c){let h="";for(let p=0;p<s.length;p++){const g=s.charCodeAt(p+1)||null,x=s.charCodeAt(p-1)||null;h+=!c&&(g&&u(g)&&!af[s[p+1]]||x&&u(x)&&!af[s[p-1]])||!af[s[p]]?s[p]:af[s[p]]}return h}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&Ym[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Ym[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new qu;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(cf.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void et("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(cf.forImage(s)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function t0(o,t,s,c,h,p,g,x,b,S,C,L,z,O,U,X){const se=qu.fromFeature(o,h);let de;L===_o.vertical&&se.verticalizePunctuation(z);const{processBidirectionalText:Me,processStyledBidirectionalText:be}=Q;if(Me&&se.sections.length===1){de=[];const ke=Me(se.toString(),n0(se,S,p,t,c,O,U));for(const We of ke){const $e=new qu;$e.text=We,$e.sections=se.sections;for(let nt=0;nt<We.length;nt++)$e.sectionIndex.push(0);de.push($e)}}else if(be){de=[];const ke=be(se.text,se.sectionIndex,n0(se,S,p,t,c,O,U));for(const We of ke){const $e=new qu;$e.text=We[0],$e.sectionIndex=We[1],$e.sections=se.sections,de.push($e)}}else de=function(ke,We){const $e=[],nt=ke.text;let ht=0;for(const Oe of We)$e.push(ke.substring(ht,Oe)),ht=Oe;return ht<nt.length&&$e.push(ke.substring(ht,nt.length)),$e}(se,n0(se,S,p,t,c,O,U));const Ie=[],De={positionedLines:Ie,text:se.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,We,$e,nt,ht,Oe,Qe,dt,ft,Ot,lt,zt){let yn=0,Mn=0,Qt=0;const Gt=dt==="right"?1:dt==="left"?0:.5;let En=!1;for(const Cn of ht){const Bn=Cn.getSections();for(const ni of Bn){if(ni.imageName)continue;const ei=We[ni.fontStack];if(ei&&(En=ei.ascender!==void 0&&ei.descender!==void 0,!En))break}if(!En)break}let wn=0;for(const Cn of ht){Cn.trim();const Bn=Cn.getMaxScale(),ni=(Bn-1)*cr,ei={positionedGlyphs:[],lineOffset:0};ke.positionedLines[wn]=ei;const Kn=ei.positionedGlyphs;let oi=0;if(!Cn.length()){Mn+=Oe,++wn;continue}let fi=0,er=0;for(let Dn=0;Dn<Cn.length();Dn++){const bi=Cn.getSection(Dn),gr=Cn.getSectionIndex(Dn),Hn=Cn.getCharCode(Dn);let pi=bi.scale,Ir=null,ci=null,Li=null,tr=cr,Zi=0;const ur=!(ft===_o.horizontal||!lt&&!r(Hn)||lt&&(Ym[Hn]||(Yt=Hn,_m(Yt)||gm(Yt)||ic(Yt)||Gd(Yt)||Hd(Yt))));if(bi.imageName){const Pr=nt[bi.imageName];if(!Pr)continue;Li=bi.imageName,ke.iconsInText=ke.iconsInText||!0,ci=Pr.paddedRect;const nr=Pr.displaySize;pi=pi*cr/zt,Ir={width:nr[0],height:nr[1],left:1,top:-3,advance:ur?nr[1]:nr[0],localGlyph:!1},Zi=En?-Ir.height*pi:Bn*cr-17-nr[1]*pi,tr=Ir.advance;const oa=(ur?nr[0]:nr[1])*pi-cr*Bn;oa>0&&oa>oi&&(oi=oa)}else{const Pr=$e[bi.fontStack];if(!Pr)continue;Pr[Hn]&&(ci=Pr[Hn]);const nr=We[bi.fontStack];if(!nr)continue;const oa=nr.glyphs[Hn];if(!oa)continue;if(Ir=oa.metrics,tr=Hn!==8203?cr:0,En){const Qu=nr.ascender!==void 0?Math.abs(nr.ascender):0,xf=nr.descender!==void 0?Math.abs(nr.descender):0,vf=(Qu+xf)*pi;fi<vf&&(fi=vf,er=(Qu-xf)/2*pi),Zi=-Qu*pi}else Zi=(Bn-pi)*cr-17}ur?(ke.verticalizable=!0,Kn.push({glyph:Hn,imageName:Li,x:yn,y:Mn+Zi,vertical:ur,scale:pi,localGlyph:Ir.localGlyph,fontStack:bi.fontStack,sectionIndex:gr,metrics:Ir,rect:ci}),yn+=tr*pi+Ot):(Kn.push({glyph:Hn,imageName:Li,x:yn,y:Mn+Zi,vertical:ur,scale:pi,localGlyph:Ir.localGlyph,fontStack:bi.fontStack,sectionIndex:gr,metrics:Ir,rect:ci}),yn+=Ir.advance*pi+Ot)}Kn.length!==0&&(Qt=Math.max(yn-Ot,Qt),En?gb(Kn,Gt,oi,er,Oe*Bn/2):gb(Kn,Gt,oi,0,Oe/2)),yn=0;const Or=Oe*Bn+oi;ei.lineOffset=Math.max(oi,ni),Mn+=Or,++wn}var Yt;const ji=Mn,{horizontalAlign:Pi,verticalAlign:wi}=i0(Qe);(function(Cn,Bn,ni,ei,Kn,oi){const fi=(Bn-ni)*Kn,er=-oi*ei;for(const Or of Cn)for(const Dn of Or.positionedGlyphs)Dn.x+=fi,Dn.y+=er})(ke.positionedLines,Gt,Pi,wi,Qt,ji),ke.top+=-wi*ji,ke.bottom=ke.top+ji,ke.left+=-Pi*Qt,ke.right=ke.left+Qt,ke.hasBaseline=En}(De,t,s,c,de,g,x,b,L,S,z,X),!function(ke){for(const We of ke)if(We.positionedGlyphs.length!==0)return!1;return!0}(Ie)&&De}const Ym={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},WI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fb(o,t,s,c,h,p){if(t.imageName){const g=c[t.imageName];return g?g.displaySize[0]*t.scale*cr/p+h:0}{const g=s[t.fontStack],x=g&&g.glyphs[o];return x?x.metrics.advance*t.scale+h:0}}function pb(o,t,s,c){const h=Math.pow(o-t,2);return c?o<t?h/2:2*h:h+Math.abs(s)*s}function HI(o,t,s){let c=0;return o===10&&(c-=1e4),s&&(c+=150),o!==40&&o!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function mb(o,t,s,c,h,p){let g=null,x=pb(t,s,h,p);for(const b of c){const S=pb(t-b.x,s,h,p)+b.badness;S<=x&&(g=b,x=S)}return{index:o,x:t,priorBreak:g,badness:x}}function _b(o){return o?_b(o.priorBreak).concat(o.index):[]}function n0(o,t,s,c,h,p,g){if(p!=="point")return[];if(!o)return[];const x=[],b=function(z,O,U,X,se,de){let Me=0;for(let be=0;be<z.length();be++){const Ie=z.getSection(be);Me+=fb(z.getCharCode(be),Ie,X,se,O,de)}return Me/Math.max(1,Math.ceil(Me/U))}(o,t,s,c,h,g),S=o.text.indexOf("\u200B")>=0;let C=0;for(let z=0;z<o.length();z++){const O=o.getSection(z),U=o.getCharCode(z);if(Ym[U]||(C+=fb(U,O,c,h,t,g)),z<o.length()-1){const X=!((L=U)<11904||!(Od(L)||Bd(L)||jd(L)||Sm(L)||ku(L)||ym(L)||Nd(L)||Pu(L)||vm(L)||Vd(L)||zu(L)||$d(L)||Lu(L)||rc(L)||xm(L)||Ud(L)||Du(L)||Mm(L)||Ru(L)||wm(L)));(WI[U]||X||O.imageName)&&x.push(mb(z+1,C,b,x,HI(U,o.getCharCode(z+1),X&&S),!1))}}var L;return _b(mb(o.length(),C,b,x,0,!0))}function i0(o){let t=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function gb(o,t,s,c,h){if(!(t||s||c||h))return;const p=o.length-1,g=o[p],x=(g.x+g.metrics.advance*g.scale)*t;for(let b=0;b<=p;b++)o[b].x-=x,o[b].y+=s+c+h}function $I(o,t,s){const{horizontalAlign:c,verticalAlign:h}=i0(s),p=t[0]-o.displaySize[0]*c,g=t[1]-o.displaySize[1]*h;return{image:o,top:g,bottom:g+o.displaySize[1],left:p,right:p+o.displaySize[0]}}function yb(o,t,s,c,h,p){const g=o.image;let x;if(g.content){const se=g.content,de=g.pixelRatio||1;x=[se[0]/de,se[1]/de,g.displaySize[0]-se[2]/de,g.displaySize[1]-se[3]/de]}const b=t.left*p,S=t.right*p;let C,L,z,O;s==="width"||s==="both"?(O=h[0]+b-c[3],L=h[0]+S+c[1]):(O=h[0]+(b+S-g.displaySize[0])/2,L=O+g.displaySize[0]);const U=t.top*p,X=t.bottom*p;return s==="height"||s==="both"?(C=h[1]+U-c[0],z=h[1]+X+c[2]):(C=h[1]+(U+X-g.displaySize[1])/2,z=C+g.displaySize[1]),{image:g,top:C,right:L,bottom:z,left:O,collisionPadding:x}}class ra extends P{constructor(t,s,c,h,p){super(t,s),this.angle=h,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new ra(this.x,this.y,this.z,this.angle,this.segment)}}function xb(o,t,s,c,h){if(t.segment===void 0)return!0;let p=t,g=t.segment+1,x=0;for(;x>-s/2;){if(g--,g<0)return!1;x-=o[g].dist(p),p=o[g]}x+=o[g].dist(o[g+1]),g++;const b=[];let S=0;for(;x<s/2;){const C=o[g],L=o[g+1];if(!L)return!1;let z=o[g-1].angleTo(C)-C.angleTo(L);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:x,angleDelta:z}),S+=z;x-b[0].distance>c;)S-=b.shift().angleDelta;if(S>h)return!1;g++,x+=C.dist(L)}return!0}function vb(o){let t=0;for(let s=0;s<o.length-1;s++)t+=o[s].dist(o[s+1]);return t}function wb(o,t,s){return o?.6*t*s:0}function bb(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function qI(o,t,s,c,h,p){const g=wb(s,h,p),x=bb(s,c)*p;let b=0;const S=vb(o)/2;for(let C=0;C<o.length-1;C++){const L=o[C],z=o[C+1],O=L.dist(z);if(b+O>S){const U=(S-b)/O,X=Rn(L.x,z.x,U),se=Rn(L.y,z.y,U),de=new ra(X,se,0,z.angleTo(L),C);return!g||xb(o,de,x,g,t)?de:void 0}b+=O}}function ZI(o,t,s,c,h,p,g,x,b){const S=wb(c,p,g),C=bb(c,h),L=C*g,z=o[0].x===0||o[0].x===b||o[0].y===0||o[0].y===b;return t-L<t/4&&(t=L+t/4),Sb(o,z?t/2*x%t:(C/2+2*p)*g*x%t,t,S,s,L,z,!1,b)}function Sb(o,t,s,c,h,p,g,x,b){const S=p/2,C=vb(o);let L=0,z=t-s,O=[];for(let U=0;U<o.length-1;U++){const X=o[U],se=o[U+1],de=X.dist(se),Me=se.angleTo(X);for(;z+s<L+de;){z+=s;const be=(z-L)/de,Ie=Rn(X.x,se.x,be),De=Rn(X.y,se.y,be);if(Ie>=0&&Ie<b&&De>=0&&De<b&&z-S>=0&&z+S<=C){const ke=new ra(Ie,De,0,Me,U);ke._round(),c&&!xb(o,ke,p,c,h)||O.push(ke)}}L+=de}return x||O.length||g||(O=Sb(o,L/2,s,c,h,p,g,!0,b)),O}function Mb(o,t,s,c,h){const p=[];for(let g=0;g<o.length;g++){const x=o[g];let b;for(let S=0;S<x.length-1;S++){let C=x[S],L=x[S+1];C.x<t&&L.x<t||(C.x<t?C=new P(t,C.y+(t-C.x)/(L.x-C.x)*(L.y-C.y))._round():L.x<t&&(L=new P(t,C.y+(t-C.x)/(L.x-C.x)*(L.y-C.y))._round()),C.y<s&&L.y<s||(C.y<s?C=new P(C.x+(s-C.y)/(L.y-C.y)*(L.x-C.x),s)._round():L.y<s&&(L=new P(C.x+(s-C.y)/(L.y-C.y)*(L.x-C.x),s)._round()),C.x>=c&&L.x>=c||(C.x>=c?C=new P(c,C.y+(c-C.x)/(L.x-C.x)*(L.y-C.y))._round():L.x>=c&&(L=new P(c,C.y+(c-C.x)/(L.x-C.x)*(L.y-C.y))._round()),C.y>=h&&L.y>=h||(C.y>=h?C=new P(C.x+(h-C.y)/(L.y-C.y)*(L.x-C.x),h)._round():L.y>=h&&(L=new P(C.x+(h-C.y)/(L.y-C.y)*(L.x-C.x),h)._round()),b&&C.equals(b[b.length-1])||(b=[C],p.push(b)),b.push(L)))))}}return p}Vt(ra,"Anchor");const uf=1e20;function Tb(o,t,s,c,h,p,g,x,b){for(let S=t;S<t+c;S++)Eb(o,s*p+S,p,h,g,x,b);for(let S=s;S<s+h;S++)Eb(o,S*p+t,1,c,g,x,b)}function Eb(o,t,s,c,h,p,g){p[0]=0,g[0]=-uf,g[1]=uf,h[0]=o[t];for(let x=1,b=0,S=0;x<c;x++){h[x]=o[t+x*s];const C=x*x;do{const L=p[b];S=(h[x]-h[L]+C-L*L)/(x-L)/2}while(S<=g[b]&&--b>-1);b++,p[b]=x,g[b]=S,g[b+1]=uf}for(let x=0,b=0;x<c;x++){for(;g[b+1]<x;)b++;const S=p[b],C=x-S;o[t+x*s]=h[S]+C*C}}const r0={none:0,ideographs:1,all:2};class Zu{constructor(t,s,c){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const h in t)for(const p of t[h])c.push({stack:h,id:p});ee(c,({stack:h,id:p},g)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=x.glyphs[p];if(b!==void 0)return void g(null,{stack:h,id:p,glyph:b});if(b=this._tinySDF(x,h,p),b)return x.glyphs[p]=b,void g(null,{stack:h,id:p,glyph:b});const S=Math.floor(p/256);if(256*S>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void g(null,{stack:h,id:p,glyph:b});let C=x.requests[S];C||(C=x.requests[S]=[],Zu.loadGlyphRange(h,S,this.url,this.requestManager,(L,z)=>{if(z){x.ascender=z.ascender,x.descender=z.descender;for(const O in z.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=z.glyphs[+O]);x.ranges[S]=!0}for(const O of C)O(L,z);delete x.requests[S]})),C.push((L,z)=>{L?g(L):z&&g(null,{stack:h,id:p,glyph:z.glyphs[p]||null})})},(h,p)=>{if(h)s(h);else if(p){const g={};for(const{stack:x,id:b,glyph:S}of p)g[x]===void 0&&(g[x]={}),g[x].glyphs===void 0&&(g[x].glyphs={}),g[x].glyphs[b]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},g[x].ascender=this.entries[x].ascender,g[x].descender=this.entries[x].descender;s(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==r0.none&&(this.localGlyphMode===r0.all?!!this.localFontFamily:!!this.localFontFamily&&(Vd(t)||bm(t)||Lu(t)||Du(t)||Pu(t)))}_tinySDF(t,s,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let p=t.tinySDF;if(!p){let X="400";/bold/i.test(s)?X="900":/medium/i.test(s)?X="500":/light/i.test(s)&&(X="200"),p=t.tinySDF=new Zu.TinySDF({fontFamily:h,fontWeight:X,fontSize:48,buffer:6,radius:16}),p.fontWeight=X}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const g=String.fromCharCode(c),{data:x,width:b,height:S,glyphWidth:C,glyphHeight:L,glyphLeft:z,glyphTop:O,glyphAdvance:U}=p.draw(g);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new na({width:b,height:S},x),metrics:{width:C/2,height:L/2,left:z/2,top:O/2-27,advance:U/2,localGlyph:!0}}}}function Cb(o,t,s,c){const h=[],p=o.image,g=p.pixelRatio,x=p.paddedRect.w-2,b=p.paddedRect.h-2,S=o.right-o.left,C=o.bottom-o.top,L=p.stretchX||[[0,x]],z=p.stretchY||[[0,b]],O=(Oe,Qe)=>Oe+Qe[1]-Qe[0],U=L.reduce(O,0),X=z.reduce(O,0),se=x-U,de=b-X;let Me=0,be=U,Ie=0,De=X,ke=0,We=se,$e=0,nt=de;if(p.content&&c){const Oe=p.content;Me=Km(L,0,Oe[0]),Ie=Km(z,0,Oe[1]),be=Km(L,Oe[0],Oe[2]),De=Km(z,Oe[1],Oe[3]),ke=Oe[0]-Me,$e=Oe[1]-Ie,We=Oe[2]-Oe[0]-be,nt=Oe[3]-Oe[1]-De}const ht=(Oe,Qe,dt,ft)=>{const Ot=Jm(Oe.stretch-Me,be,S,o.left),lt=Qm(Oe.fixed-ke,We,Oe.stretch,U),zt=Jm(Qe.stretch-Ie,De,C,o.top),yn=Qm(Qe.fixed-$e,nt,Qe.stretch,X),Mn=Jm(dt.stretch-Me,be,S,o.left),Qt=Qm(dt.fixed-ke,We,dt.stretch,U),Gt=Jm(ft.stretch-Ie,De,C,o.top),En=Qm(ft.fixed-$e,nt,ft.stretch,X),wn=new P(Ot,zt),Yt=new P(Mn,zt),ji=new P(Mn,Gt),Pi=new P(Ot,Gt),wi=new P(lt/g,yn/g),Cn=new P(Qt/g,En/g),Bn=t*Math.PI/180;if(Bn){const Kn=Math.sin(Bn),oi=Math.cos(Bn),fi=[oi,-Kn,Kn,oi];wn._matMult(fi),Yt._matMult(fi),Pi._matMult(fi),ji._matMult(fi)}const ni=Oe.stretch+Oe.fixed,ei=Qe.stretch+Qe.fixed;return{tl:wn,tr:Yt,bl:Pi,br:ji,tex:{x:p.paddedRect.x+1+ni,y:p.paddedRect.y+1+ei,w:dt.stretch+dt.fixed-ni,h:ft.stretch+ft.fixed-ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wi,pixelOffsetBR:Cn,minFontScaleX:We/g/S,minFontScaleY:nt/g/C,isSDF:s}};if(c&&(p.stretchX||p.stretchY)){const Oe=Ab(L,se,U),Qe=Ab(z,de,X);for(let dt=0;dt<Oe.length-1;dt++){const ft=Oe[dt],Ot=Oe[dt+1];for(let lt=0;lt<Qe.length-1;lt++)h.push(ht(ft,Qe[lt],Ot,Qe[lt+1]))}}else h.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:b+1}));return h}function Km(o,t,s){let c=0;for(const h of o)c+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return c}function Ab(o,t,s){const c=[{fixed:-1,stretch:0}];for(const[h,p]of o){const g=c[c.length-1];c.push({fixed:h-g.stretch,stretch:g.stretch}),c.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return c.push({fixed:t+1,stretch:s}),c}function Jm(o,t,s,c){return o/t*s+c}function Qm(o,t,s,c){return o-t*s/c}function XI(o,t,s,c){const h=t+o.positionedLines[c].lineOffset;return c===0?s+h/2:s+(h+(t+o.positionedLines[c-1].lineOffset))/2}Zu.loadGlyphRange=function(o,t,s,c,h){const p=256*t,g=p+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${p}-${g}`),xe.Glyphs);te(x,(b,S)=>{if(b)h(b);else if(S){const C={},L=function(z){return new lf(z).readFields(VI,{})}(S);for(const z of L.glyphs)C[z.id]=z;h(null,{glyphs:C,ascender:L.ascender,descender:L.descender})}})},Zu.TinySDF=class{constructor({fontSize:o=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const x=this.size=o+4*t,b=this._createCanvas(x),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${p} ${o}px ${h}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const t=document.createElement("canvas");return t.width=t.height=o,t}draw(o){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(o),g=Math.ceil(s),x=Math.min(this.size-this.buffer,Math.ceil(p-h)),b=Math.min(this.size-this.buffer,g+Math.ceil(c)),S=x+2*this.buffer,C=b+2*this.buffer,L=Math.max(S*C,0),z=new Uint8ClampedArray(L),O={data:z,width:S,height:C,glyphWidth:x,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(x===0||b===0)return O;const{ctx:U,buffer:X,gridInner:se,gridOuter:de}=this;U.clearRect(X,X,x,b),U.fillText(o,X,X+g);const Me=U.getImageData(X,X,x,b);de.fill(uf,0,L),se.fill(0,0,L);for(let be=0;be<b;be++)for(let Ie=0;Ie<x;Ie++){const De=Me.data[4*(be*x+Ie)+3]/255;if(De===0)continue;const ke=(be+X)*S+Ie+X;if(De===1)de[ke]=0,se[ke]=uf;else{const We=.5-De;de[ke]=We>0?We*We:0,se[ke]=We<0?We*We:0}}Tb(de,0,0,S,C,S,this.f,this.v,this.z),Tb(se,X,X,x,b,S,this.f,this.v,this.z);for(let be=0;be<L;be++){const Ie=Math.sqrt(de[be])-Math.sqrt(se[be]);z[be]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return O}};class YI{constructor(t=[],s=KI){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,h=s[t];for(;t>0;){const p=t-1>>1,g=s[p];if(c(h,g)>=0)break;s[t]=g,t=p}s[t]=h}_down(t){const{data:s,compare:c}=this,h=this.length>>1,p=s[t];for(;t<h;){let g=1+(t<<1),x=s[g];const b=g+1;if(b<this.length&&c(s[b],x)<0&&(g=b,x=s[b]),c(x,p)>=0)break;s[t]=x,t=g}s[t]=p}}function KI(o,t){return o<t?-1:o>t?1:0}function JI(o,t=1,s=!1){let c=1/0,h=1/0,p=-1/0,g=-1/0;const x=o[0];for(let O=0;O<x.length;O++){const U=x[O];(!O||U.x<c)&&(c=U.x),(!O||U.y<h)&&(h=U.y),(!O||U.x>p)&&(p=U.x),(!O||U.y>g)&&(g=U.y)}const b=Math.min(p-c,g-h);let S=b/2;const C=new YI([],QI);if(b===0)return new P(c,h);for(let O=c;O<p;O+=b)for(let U=h;U<g;U+=b)C.push(new Xu(O+S,U+S,S,o));let L=function(O){let U=0,X=0,se=0;const de=O[0];for(let Me=0,be=de.length,Ie=be-1;Me<be;Ie=Me++){const De=de[Me],ke=de[Ie],We=De.x*ke.y-ke.x*De.y;X+=(De.x+ke.x)*We,se+=(De.y+ke.y)*We,U+=3*We}return new Xu(X/U,se/U,0,O)}(o),z=C.length;for(;C.length;){const O=C.pop();(O.d>L.d||!L.d)&&(L=O,s&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,z)),O.max-L.d<=t||(S=O.h/2,C.push(new Xu(O.p.x-S,O.p.y-S,S,o)),C.push(new Xu(O.p.x+S,O.p.y-S,S,o)),C.push(new Xu(O.p.x-S,O.p.y+S,S,o)),C.push(new Xu(O.p.x+S,O.p.y+S,S,o)),z+=4)}return s&&(console.log(`num probes: ${z}`),console.log(`best distance: ${L.d}`)),L.p}function QI(o,t){return t.max-o.max}function Xu(o,t,s,c){this.p=new P(o,t),this.h=s,this.d=function(h,p){let g=!1,x=1/0;for(let b=0;b<p.length;b++){const S=p[b];for(let C=0,L=S.length,z=L-1;C<L;z=C++){const O=S[C],U=S[z];O.y>h.y!=U.y>h.y&&h.x<(U.x-O.x)*(h.y-O.y)/(U.y-O.y)+O.x&&(g=!g),x=Math.min(x,ww(h,O,U))}}return(g?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const o0=Number.POSITIVE_INFINITY,e3=Math.sqrt(2);function Ib(o,t){return t[1]!==o0?function(s,c,h){let p=0,g=0;switch(c=Math.abs(c),h=Math.abs(h),s){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(s){case"top-right":case"bottom-right":case"right":p=-c;break;case"top-left":case"bottom-left":case"left":p=c}return[p,g]}(o,t[0],t[1]):function(s,c){let h=0,p=0;c<0&&(c=0);const g=c/e3;switch(s){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-c;break;case"top":p=c-7}switch(s){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=c;break;case"right":h=-c}return[h,p]}(o,t[0])}function t3(o,t,s,c,h,p,g,x,b,S){o.createArrays(),o.tilePixelRatio=on/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const C=o.layers[0].layout,L=o.layers[0]._unevaluatedLayout._values,z={};if(o.textSizeData.kind==="composite"){const{minZoom:X,maxZoom:se}=o.textSizeData;z.compositeTextSizes=[L["text-size"].possiblyEvaluate(new ae(X),x),L["text-size"].possiblyEvaluate(new ae(se),x)]}if(o.iconSizeData.kind==="composite"){const{minZoom:X,maxZoom:se}=o.iconSizeData;z.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new ae(X),x),L["icon-size"].possiblyEvaluate(new ae(se),x)]}z.layoutTextSize=L["text-size"].possiblyEvaluate(new ae(b+1),x),z.layoutIconSize=L["icon-size"].possiblyEvaluate(new ae(b+1),x),z.textMaxSize=L["text-size"].possiblyEvaluate(new ae(18),x);const O=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",U=C.get("text-size");for(const X of o.features){const se=C.get("text-font").evaluate(X,{},x).join(","),de=U.evaluate(X,{},x),Me=z.layoutTextSize.evaluate(X,{},x),be=(z.layoutIconSize.evaluate(X,{},x),{horizontal:{},vertical:void 0}),Ie=X.text;let De,ke=[0,0];if(Ie){const nt=Ie.toString(),ht=C.get("text-letter-spacing").evaluate(X,{},x)*cr,Oe=C.get("text-line-height").evaluate(X,{},x)*cr,Qe=Bu(nt)?ht:0,dt=C.get("text-anchor").evaluate(X,{},x),ft=C.get("text-variable-anchor");if(!ft){const Qt=C.get("text-radial-offset").evaluate(X,{},x);ke=Qt?Ib(dt,[Qt*cr,o0]):C.get("text-offset").evaluate(X,{},x).map(Gt=>Gt*cr)}let Ot=O?"center":C.get("text-justify").evaluate(X,{},x);const lt=C.get("symbol-placement"),zt=lt==="point",yn=lt==="point"?C.get("text-max-width").evaluate(X,{},x)*cr:0,Mn=Qt=>{o.allowVerticalPlacement&&Fu(nt)&&(be.vertical=t0(Ie,t,s,h,se,yn,Oe,dt,Qt,Qe,ke,_o.vertical,!0,lt,Me,de))};if(!O&&ft){const Qt=Ot==="auto"?ft.map(En=>s0(En)):[Ot];let Gt=!1;for(let En=0;En<Qt.length;En++){const wn=Qt[En];if(!be.horizontal[wn])if(Gt)be.horizontal[wn]=be.horizontal[0];else{const Yt=t0(Ie,t,s,h,se,yn,Oe,"center",wn,Qe,ke,_o.horizontal,!1,lt,Me,de);Yt&&(be.horizontal[wn]=Yt,Gt=Yt.positionedLines.length===1)}}Mn("left")}else{if(Ot==="auto"&&(Ot=s0(dt)),zt||C.get("text-writing-mode").indexOf("horizontal")>=0||!Fu(nt)){const Qt=t0(Ie,t,s,h,se,yn,Oe,dt,Ot,Qe,ke,_o.horizontal,!1,lt,Me,de);Qt&&(be.horizontal[Ot]=Qt)}Mn(lt==="point"?"left":Ot)}}let We=!1;if(X.icon&&X.icon.name){const nt=c[X.icon.name];nt&&(De=$I(h[X.icon.name],C.get("icon-offset").evaluate(X,{},x),C.get("icon-anchor").evaluate(X,{},x)),We=nt.sdf,o.sdfIcons===void 0?o.sdfIcons=nt.sdf:o.sdfIcons!==nt.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==o.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const $e=Lb(be.horizontal)||be.vertical;o.iconsInText||(o.iconsInText=!!$e&&$e.iconsInText),($e||De)&&n3(o,X,be,De,c,z,Me,0,ke,We,g,x,S)}p&&o.generateCollisionDebugBuffers(b,o.collisionBoxArray)}function s0(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function n3(o,t,s,c,h,p,g,x,b,S,C,L,z){let O=p.textMaxSize.evaluate(t,{},L);O===void 0&&(O=g);const U=o.layers[0].layout,X=U.get("icon-offset").evaluate(t,{},L),se=Lb(s.horizontal)||s.vertical,de=z.name==="globe",Me=g/24,be=o.tilePixelRatio*O/24,Ie=(Qe=o.overscaling,o.zoom>18&&Qe>2&&(Qe>>=1),Math.max(on/(512*Qe),1)*U.get("symbol-spacing")),De=U.get("text-padding")*o.tilePixelRatio,ke=U.get("icon-padding")*o.tilePixelRatio,We=F(U.get("text-max-angle")),$e=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",nt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",ht=U.get("symbol-placement"),Oe=Ie/2;var Qe;const dt=U.get("icon-text-fit");let ft;c&&dt!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(ft=yb(c,s.vertical,dt,U.get("icon-text-fit-padding"),X,Me)),se&&(c=yb(c,se,dt,U.get("icon-text-fit-padding"),X,Me)));const Ot=(lt,zt,yn)=>{if(zt.x<0||zt.x>=on||zt.y<0||zt.y>=on)return;let Mn=null;if(de){const{x:Qt,y:Gt,z:En}=z.projectTilePoint(zt.x,zt.y,yn);Mn={anchor:new ra(Qt,Gt,En,0,void 0),up:z.upVector(yn,zt.x,zt.y)}}(function(Qt,Gt,En,wn,Yt,ji,Pi,wi,Cn,Bn,ni,ei,Kn,oi,fi,er,Or,Dn,bi,gr,Hn,pi,Ir,ci,Li){const tr=Qt.addToLineVertexArray(Gt,wn);let Zi,ur,Pr,nr,oa,Qu,xf,vf=0,pS=0,mS=0,_S=0,S0=-1,M0=-1;const As={};let gS=qd("");const gc=En?En.anchor:Gt;let T0=0,E0=0;if(Cn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[T0,E0]=Cn.layout.get("text-offset").evaluate(Hn,{},Li).map(no=>no*cr):(T0=Cn.layout.get("text-radial-offset").evaluate(Hn,{},Li)*cr,E0=o0),Qt.allowVerticalPlacement&&Yt.vertical){const no=Yt.vertical;if(fi)Qu=a0(no),wi&&(xf=a0(wi));else{const io=Cn.layout.get("text-rotate").evaluate(Hn,{},Li)+90;Pr=e_(Bn,gc,Gt,ni,ei,Kn,no,oi,io,er),wi&&(nr=e_(Bn,gc,Gt,ni,ei,Kn,wi,Dn,io))}}if(ji){const no=Cn.layout.get("icon-rotate").evaluate(Hn,{},Li),io=Cn.layout.get("icon-text-fit")!=="none",wf=Cb(ji,no,Ir,io),A0=wi?Cb(wi,no,Ir,io):void 0;ur=e_(Bn,gc,Gt,ni,ei,Kn,ji,Dn,no),vf=4*wf.length;const yS=Qt.iconSizeData;let yc=null;yS.kind==="source"?(yc=[Ss*Cn.layout.get("icon-size").evaluate(Hn,{},Li)],yc[0]>Ya&&et(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):yS.kind==="composite"&&(yc=[Ss*pi.compositeIconSizes[0].evaluate(Hn,{},Li),Ss*pi.compositeIconSizes[1].evaluate(Hn,{},Li)],(yc[0]>Ya||yc[1]>Ya)&&et(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,wf,yc,gr,bi,Hn,!1,En,Gt,tr.lineStartIndex,tr.lineLength,-1,ci,Li),S0=Qt.icon.placedSymbolArray.length-1,A0&&(pS=4*A0.length,Qt.addSymbols(Qt.icon,A0,yc,gr,bi,Hn,_o.vertical,En,Gt,tr.lineStartIndex,tr.lineLength,-1,ci,Li),M0=Qt.icon.placedSymbolArray.length-1)}for(const no in Yt.horizontal){const io=Yt.horizontal[no];Zi||(gS=qd(io.text),fi?oa=a0(io):Zi=e_(Bn,gc,Gt,ni,ei,Kn,io,oi,Cn.layout.get("text-rotate").evaluate(Hn,{},Li),er));const wf=io.positionedLines.length===1;if(mS+=Pb(Qt,En,Gt,io,Pi,Cn,fi,Hn,er,tr,Yt.vertical?_o.horizontal:_o.horizontalOnly,wf?Object.keys(Yt.horizontal):[no],As,S0,pi,ci,Li),wf)break}Yt.vertical&&(_S+=Pb(Qt,En,Gt,Yt.vertical,Pi,Cn,fi,Hn,er,tr,_o.vertical,["vertical"],As,M0,pi,ci,Li));let nl=-1;const C0=(no,io)=>no?Math.max(no,io):io;nl=C0(oa,nl),nl=C0(Qu,nl),nl=C0(xf,nl);const k3=nl>-1?1:0;Qt.glyphOffsetArray.length>=Ja.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hn.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,Hn.sortKey),Qt.symbolInstances.emplaceBack(gc.x,gc.y,gc.z,Gt.x,Gt.y,As.right>=0?As.right:-1,As.center>=0?As.center:-1,As.left>=0?As.left:-1,As.vertical>=0?As.vertical:-1,S0,M0,gS,Zi!==void 0?Zi:Qt.collisionBoxArray.length,Zi!==void 0?Zi+1:Qt.collisionBoxArray.length,Pr!==void 0?Pr:Qt.collisionBoxArray.length,Pr!==void 0?Pr+1:Qt.collisionBoxArray.length,ur!==void 0?ur:Qt.collisionBoxArray.length,ur!==void 0?ur+1:Qt.collisionBoxArray.length,nr||Qt.collisionBoxArray.length,nr?nr+1:Qt.collisionBoxArray.length,ni,mS,_S,vf,pS,k3,0,T0,E0,nl)})(o,zt,Mn,lt,s,c,h,ft,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,De,$e,b,0,ke,nt,X,t,p,S,C,L)};if(ht==="line")for(const lt of Mb(t.geometry,0,0,on,on)){const zt=ZI(lt,Ie,We,s.vertical||se,c,24,be,o.overscaling,on);for(const yn of zt){const Mn=se;Mn&&i3(o,Mn.text,Oe,yn)||Ot(lt,yn,L)}}else if(ht==="line-center"){for(const lt of t.geometry)if(lt.length>1){const zt=qI(lt,We,s.vertical||se,c,24,be);zt&&Ot(lt,zt,L)}}else if(t.type==="Polygon")for(const lt of Zy(t.geometry,0)){const zt=JI(lt,16);Ot(lt[0],new ra(zt.x,zt.y,0,0,void 0),L)}else if(t.type==="LineString")for(const lt of t.geometry)Ot(lt,new ra(lt[0].x,lt[0].y,0,0,void 0),L);else if(t.type==="Point")for(const lt of t.geometry)for(const zt of lt)Ot([zt],new ra(zt.x,zt.y,0,0,void 0),L)}const Ya=32640;function Pb(o,t,s,c,h,p,g,x,b,S,C,L,z,O,U,X,se){const de=function(Ie,De,ke,We,$e,nt,ht,Oe){const Qe=[];if(De.positionedLines.length===0)return Qe;const dt=We.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,ft=function(Mn){const Qt=Mn[0],Gt=Mn[1],En=Qt*Gt;return En>0?[Qt,-Gt]:En<0?[-Qt,Gt]:Qt===0?[Gt,Qt]:[Gt,-Qt]}(ke);let Ot=Math.abs(De.top-De.bottom);for(const Mn of De.positionedLines)Ot-=Mn.lineOffset;const lt=De.positionedLines.length,zt=Ot/lt;let yn=De.top-ke[1];for(let Mn=0;Mn<lt;++Mn){const Qt=De.positionedLines[Mn];yn=XI(De,zt,yn,Mn);for(const Gt of Qt.positionedGlyphs){if(!Gt.rect)continue;const En=Gt.rect||{};let wn=4,Yt=!0,ji=1,Pi=0;if(Gt.imageName){const ci=ht[Gt.imageName];if(!ci)continue;if(ci.sdf){et("SDF images are not supported in formatted text and will be ignored.");continue}Yt=!1,ji=ci.pixelRatio,wn=1/ji}const wi=($e||Oe)&&Gt.vertical,Cn=Gt.metrics.advance*Gt.scale/2,Bn=Gt.metrics,ni=Gt.rect;if(ni===null)continue;Oe&&De.verticalizable&&(Pi=Gt.imageName?Cn-Gt.metrics.width*Gt.scale/2:0);const ei=$e?[Gt.x+Cn,Gt.y]:[0,0];let Kn=[0,0],oi=[0,0],fi=!1;$e||(wi?(oi=[Gt.x+Cn+ft[0],Gt.y+ft[1]-Pi],fi=!0):Kn=[Gt.x+Cn+ke[0],Gt.y+ke[1]-Pi]);const er=ni.w*Gt.scale/(ji*(Gt.localGlyph?2:1)),Or=ni.h*Gt.scale/(ji*(Gt.localGlyph?2:1));let Dn,bi,gr,Hn;if(wi){const ci=Gt.y-yn,Li=new P(-Cn,Cn-ci),tr=-Math.PI/2,Zi=new P(...oi);Dn=new P(-Cn+Kn[0],Kn[1]),Dn._rotateAround(tr,Li)._add(Zi),Dn.x+=-ci+Cn,Dn.y-=(Bn.left-wn)*Gt.scale;const ur=Gt.imageName?Bn.advance*Gt.scale:cr*Gt.scale,Pr=String.fromCharCode(Gt.glyph);PI(Pr)?Dn.x+=(1-wn)*Gt.scale:LI(Pr)?Dn.x+=ur-Bn.height*Gt.scale+(-wn-1)*Gt.scale:Dn.x+=Gt.imageName||Bn.width+2*wn===ni.w&&Bn.height+2*wn===ni.h?(ur-Or)/2:(ur-(Bn.height+2*wn)*Gt.scale)/2,bi=new P(Dn.x,Dn.y-er),gr=new P(Dn.x+Or,Dn.y),Hn=new P(Dn.x+Or,Dn.y-er)}else{const ci=(Bn.left-wn)*Gt.scale-Cn+Kn[0],Li=(-Bn.top-wn)*Gt.scale+Kn[1],tr=ci+er,Zi=Li+Or;Dn=new P(ci,Li),bi=new P(tr,Li),gr=new P(ci,Zi),Hn=new P(tr,Zi)}if(dt){let ci;ci=$e?new P(0,0):fi?new P(ft[0],ft[1]):new P(ke[0],ke[1]),Dn._rotateAround(dt,ci),bi._rotateAround(dt,ci),gr._rotateAround(dt,ci),Hn._rotateAround(dt,ci)}const pi=new P(0,0),Ir=new P(0,0);Qe.push({tl:Dn,tr:bi,bl:gr,br:Hn,tex:En,writingMode:De.writingMode,glyphOffset:ei,sectionIndex:Gt.sectionIndex,isSDF:Yt,pixelOffsetTL:pi,pixelOffsetBR:Ir,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,c,b,p,g,x,h,o.allowVerticalPlacement),Me=o.textSizeData;let be=null;Me.kind==="source"?(be=[Ss*p.layout.get("text-size").evaluate(x,{},se)],be[0]>Ya&&et(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Me.kind==="composite"&&(be=[Ss*U.compositeTextSizes[0].evaluate(x,{},se),Ss*U.compositeTextSizes[1].evaluate(x,{},se)],(be[0]>Ya||be[1]>Ya)&&et(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,de,be,b,g,x,C,t,s,S.lineStartIndex,S.lineLength,O,X,se);for(const Ie of L)z[Ie]=o.text.placedSymbolArray.length-1;return 4*de.length}function Lb(o){for(const t in o)return o[t];return null}function e_(o,t,s,c,h,p,g,x,b,S){let C=g.top,L=g.bottom,z=g.left,O=g.right;const U=g.collisionPadding;if(U&&(z-=U[0],C-=U[1],O+=U[2],L+=U[3]),b){const X=new P(z,C),se=new P(O,C),de=new P(z,L),Me=new P(O,L),be=F(b);let Ie=new P(0,0);S&&(Ie=new P(S[0],S[1])),X._rotateAround(be,Ie),se._rotateAround(be,Ie),de._rotateAround(be,Ie),Me._rotateAround(be,Ie),z=Math.min(X.x,se.x,de.x,Me.x),O=Math.max(X.x,se.x,de.x,Me.x),C=Math.min(X.y,se.y,de.y,Me.y),L=Math.max(X.y,se.y,de.y,Me.y)}return o.emplaceBack(t.x,t.y,t.z,s.x,s.y,z,C,O,L,x,c,h,p),o.length-1}function a0(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const t=o.bottom-o.top;return t>0?Math.max(10,t):null}function i3(o,t,s,c){const h=o.compareText;if(t in h){const p=h[t];for(let g=p.length-1;g>=0;g--)if(c.dist(p[g])<s)return!0}else h[t]=[];return h[t].push(c),!1}const r3=St([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:Db}=r3,zb=St([{name:"a_pos_3",components:3,type:"Int16"}]);var hf=St([{name:"a_pos",type:"Int16",components:2}]);const pc=on/Math.PI/2,l0=2*Lo(1,0)*pc*Math.PI,Yu=[64,32,16],eo=-pc,to=pc,o3=[new mo([eo,eo,eo],[to,to,to]),new mo([eo,eo,eo],[0,0,to]),new mo([0,eo,eo],[to,0,to]),new mo([eo,0,eo],[0,to,to]),new mo([0,0,eo],[to,to,to])];function kb(o,t,s,c=!0){const h=bs([],o._camera.position,o.worldSize),p=[t,s,1,1];dc(p,p,o.pixelMatrixInverse),Lw(p,p,1/p[3]);const g=Er([],zo([],p,h)),x=o.globeMatrix,b=[x[12],x[13],x[14]],S=zo([],b,h),C=Xd(S),L=Er([],S),z=o.worldSize/(2*Math.PI),O=Do(L,g),U=Math.asin(z/C);if(U<Math.acos(O)){if(!c)return null;const ht=[],Oe=[];bs(ht,g,C/O),Er(Oe,zo(Oe,ht,S)),Er(g,Za(g,S,bs(g,Oe,Math.tan(U)*C)))}const X=[];new Uy(h,g).closestPointOnSphere(b,z,X);const se=Er([],Wt(x,0)),de=Er([],Wt(x,1)),Me=Er([],Wt(x,2)),be=Do(se,X),Ie=Do(de,X),De=Do(Me,X),ke=B(Math.asin(-Ie/z));let We=B(Math.atan2(be,De));We=o.center.lng+function(ht,Oe){const Qe=(Oe-ht+180)%360-180;return Qe<-180?Qe+360:Qe}(o.center.lng,We);const $e=ac(We),nt=K(lc(ke),0,1);return new Nu($e,nt)}class s3{constructor(t,s,c){this.a=zo([],t,c),this.b=zo([],s,c),this.center=c;const h=Er([],this.a),p=Er([],this.b);this.angle=Math.acos(Do(h,p))}}function c0(o,t){if(o.angle===0)return null;let s;return s=o.a[t]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[t]/o.a[t]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,h,p,g){const x=Math.sin(p);return c*(Math.sin((1-g)*p)/x)+h*(Math.sin(g*p)/x)}(o.a[t],o.b[t],o.angle,K(s,0,1))+o.center[t]}function Ms(o){if(o.z<=1)return o3[o.z+2*o.y+o.x];const[t,s]=u0(o),c=[Ar(t[0],t[1]),Ar(t[0],s[1]),Ar(s[0],t[1]),Ar(s[0],s[1])],h=[to,to,to],p=[eo,eo,eo];for(const g of c)h[0]=Math.min(h[0],g[0]),h[1]=Math.min(h[1],g[1]),h[2]=Math.min(h[2],g[2]),p[0]=Math.max(p[0],g[0]),p[1]=Math.max(p[1],g[1]),p[2]=Math.max(p[2],g[2]);return new mo(h,p)}function a3(o,t,s){const c=t/o.worldSize,h=Number.MAX_VALUE,p=[-h,-h,-h],g=[h,h,h],x=Jr(new Float64Array(16));if(ws(x,x,[c,c,c]),qa(x,x,o.globeMatrix),s.z<=1){const Oe=Ms(s).getCorners();for(let Qe=0;Qe<Oe.length;Qe++)lr(Oe[Qe],Oe[Qe],x),Rm(g,g,Oe[Qe]),Fm(p,p,Oe[Qe]);return new mo(g,p)}const[b,S]=u0(s),C=new $a;C.setSouthWest([b[1],S[0]]),C.setNorthEast([S[1],b[0]]);const L=[Ar(C.getSouth(),C.getWest()),Ar(C.getSouth(),C.getEast()),Ar(C.getNorth(),C.getEast()),Ar(C.getNorth(),C.getWest())];for(let Oe=0;Oe<L.length;Oe++)lr(L[Oe],L[Oe],x),Rm(g,g,L[Oe]),Fm(p,p,L[Oe]);if(C.contains(o.center)){p[2]=0;const Oe=o.point,Qe=[Oe.x*c,Oe.y*c,0];return Rm(g,g,Qe),Fm(p,p,Qe),new mo(g,p)}const z=[x[12],x[13],x[14]],O=o.center.lng,U=K(o.center.lat,-85.051129,vs),X=[ac(O),lc(U)],se=C.getCenter().lng,de=K(C.getCenter().lat,-85.051129,vs),Me=[ac(se),lc(de)];let be=new Array(3),Ie=0,De=X[0]-Me[0];const ke=X[1]-Me[1];if(De>.5?De-=1:De<-.5&&(De+=1),Math.abs(De)>Math.abs(ke))Ie=De>=0?1:3,be=z;else{Ie=ke>=0?0:2;const Oe=[x[4],x[5],x[6]];let Qe;Qe=ke>=0?-Math.sin(F(C.getSouth()))*pc:-Math.sin(F(C.getNorth()))*pc,be=Bm(be,z,Oe,Qe)}const We=L[Ie],$e=L[(Ie+1)%4],nt=new s3(We,$e,be),ht=[c0(nt,0)||We[0],c0(nt,1)||We[1],c0(nt,2)||We[2]];return g[2]=Math.min(We[2],$e[2]),Rm(g,g,ht),Fm(p,p,ht),new mo(g,p)}function u0(o){const t=1<<o.z,s=o.x/t,c=(o.x+1)/t,h=(o.y+1)/t;return[[Gi(o.y/t),Tr(s)],[Gi(h),Tr(c)]]}function Rb(o,t,s,c=pc){return s=F(s),[o*Math.sin(s)*c,-t*c,o*Math.cos(s)*c]}function Ar(o,t,s){return Rb(Math.cos(F(o)),Math.sin(F(o)),t,s)}function Fb(o,t,s){const c=Math.pow(2,s.z),h=(o/on+s.x)/c;return Ar(Gi((t/on+s.y)/c),Tr(h))}function t_(o){return 16383/Math.max(...zo([],o.max,o.min))}function df(o){const t=Jr(new Float64Array(16)),s=t_(o);var c,h;return ws(t,t,[s,s,s]),hc(t,t,((c=[])[0]=-(h=o.min)[0],c[1]=-h[1],c[2]=-h[2],c)),t}function Bb(o){const t=Jr(new Float64Array(16)),s=1/t_(o);return hc(t,t,o.min),ws(t,t,[s,s,s]),t}function Ob(o,t,s,c,h){const p=function(b){const S=on/(2*Math.PI);return b/(2*Math.PI)/S}(s),g=[o,t,-s/(2*Math.PI)],x=Jr(new Float64Array(16));return hc(x,x,g),ws(x,x,[p,p,p]),zm(x,x,F(-h)),km(x,x,F(-c)),x}function h0(o){return Ee(5,6,o)}function Nb(o,t){const s=Ar(t.lat,t.lng);return p=(c=Oy([],function(O){const U=Ar(O._center.lat,O._center.lng);let X=Ny([],Vu(0,1,0),U);const se=Cw([],-O.angle,U);X=lr(X,X,se),Cw(se,-O._pitch,X);const de=Er([],U);return bs(de,de,O.cameraToCenterDistance/O.pixelsPerMeter*l0),lr(de,de,se),Za([],U,de)}(o),s))[0],g=c[1],x=c[2],b=(h=s)[0],S=h[1],C=h[2],z=(L=Math.sqrt(p*p+g*g+x*x)*Math.sqrt(b*b+S*S+C*C))&&Do(c,h)/L,Math.acos(Math.min(Math.max(z,-1),1));var c,h,p,g,x,b,S,C,L,z}const Ub=F(85),l3=Math.cos(Ub),c3=Math.sin(Ub);function Vb(o,t){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*t:0,h=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),p=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),g=Math.sin(o._pitch)*p+h;return Math.min(1.01*g,h*(1/o._horizonShift))}function mc(o,t){if(!t.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:t};const s=Math.pow(2,-o.z),c=o.x*s,h=(o.x+1)*s,p=o.y*s,g=(o.y+1)*s,x=Tr(c),b=Tr(h),S=Gi(p),C=Gi(g),L=t.project(x,S),z=t.project(b,S),O=t.project(b,C),U=t.project(x,C);let X=Math.min(L.x,z.x,O.x,U.x),se=Math.min(L.y,z.y,O.y,U.y),de=Math.max(L.x,z.x,O.x,U.x),Me=Math.max(L.y,z.y,O.y,U.y);const be=s/16;function Ie(ke,We,$e,nt,ht,Oe){const Qe=($e+ht)/2,dt=(nt+Oe)/2,ft=t.project(Tr(Qe),Gi(dt)),Ot=Math.max(0,X-ft.x,se-ft.y,ft.x-de,ft.y-Me);X=Math.min(X,ft.x),de=Math.max(de,ft.x),se=Math.min(se,ft.y),Me=Math.max(Me,ft.y),Ot>be&&(Ie(ke,ft,$e,nt,Qe,dt),Ie(ft,We,Qe,dt,ht,Oe))}Ie(L,z,c,p,h,p),Ie(z,O,h,p,h,g),Ie(O,U,h,g,c,g),Ie(U,L,c,g,c,p),X-=be,se-=be,de+=be,Me+=be;const De=1/Math.max(de-X,Me-se);return{scale:De,x:X*De,y:se*De,x2:de*De,y2:Me*De,projection:t}}const u3=Jr(new Float32Array(16));class Ka{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new Yn(0,0)}projectTilePoint(t,s,c){return{x:t,y:s,z:0}}locationPoint(t,s,c=!0){return t._coordinatePoint(t.locationCoordinate(s),c)}pixelsPerMeter(t,s){return Lo(1,t)*s}pixelSpaceConversion(t,s,c){return 1}farthestPixelDistance(t){return Vb(t,t.pixelsPerMeter)}pointCoordinate(t,s,c,h){const p=t.horizonLineFromTop(!1),g=new P(s,Math.max(p,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,s,c){const h=new P(s,c);if(t.elevation)return t.elevation.pointCoordinate(h);{const p=this.pointCoordinate(t,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(t,s){if(t.elevation)return!this.pointCoordinate3D(t,s.x,s.y);const c=t.horizonLineFromTop();return s.y<c}createInversionMatrix(t,s){return u3}createTileMatrix(t,s,c){let h,p,g;const x=c.canonical,b=Jr(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=mc(x,this);h=1,p=S.x+c.wrap*S.scale,g=S.y,ws(b,b,[h/S.scale,h/S.scale,t.pixelsPerMeter/s])}else h=s/t.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*c.wrap)*h,g=x.y*h;return hc(b,b,[p,g,0]),ws(b,b,[h/on,h/on,1]),b}upVector(t,s,c){return[0,0,1]}upVectorScale(t,s,c){return{metersToTile:1}}}class h3 extends Ka{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[s,c]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(F(s));this.n=(h+Math.sin(F(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,s){const{n:c,c:h,r0:p}=this,g=F(t-this.center[0]),x=F(s),b=Math.sqrt(h-2*c*Math.sin(x))/c;return{x:b*Math.sin(g*c),y:b*Math.cos(g*c)-p,z:0}}unproject(t,s){const{n:c,c:h,r0:p}=this,g=p+s;let x=Math.atan2(t,Math.abs(g))*Math.sign(g);g*c<0&&(x-=Math.PI*Math.sign(t)*Math.sign(g));const b=F(this.center[0])*c;x=Te(x,-Math.PI-b,Math.PI-b);const S=B(x/c)+this.center[0],C=Math.asin(K((h-(t*t+g*g)*c*c)/(2*c),-1,1)),L=K(B(C),-85.051129,vs);return new Yn(S,L)}}const ff=1.340264,pf=-.081106,mf=893e-6,_f=.003796,n_=Math.sqrt(3)/2;class d3 extends Ka{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(n_*Math.sin(s)),h=c*c,p=h*h*h;return{x:.5*(t*Math.cos(c)/(n_*(ff+3*pf*h+p*(7*mf+9*_f*h)))/Math.PI+.5),y:1-.5*(c*(ff+pf*h+p*(mf+_f*h))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,h=c*c,p=h*h*h;for(let C,L,z,O=0;O<12&&(L=c*(ff+pf*h+p*(mf+_f*h))-s,z=ff+3*pf*h+p*(7*mf+9*_f*h),C=L/z,c=K(c-C,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(C)<1e-12));++O);const g=n_*t*(ff+3*pf*h+p*(7*mf+9*_f*h))/Math.cos(c),x=Math.asin(Math.sin(c)/n_),b=K(180*g/Math.PI,-180,180),S=K(180*x/Math.PI,-85.051129,vs);return new Yn(b,S)}}class f3 extends Ka{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){const c=360*(t-.5),h=K(360*(.5-s),-85.051129,vs);return new Yn(c,h)}}const Ku=Math.PI/2;function i_(o){return Math.tan((Ku+o)/2)}class p3 extends Ka{constructor(t){super(t),this.center=t.center||[0,30];const[s,c]=this.parallels=t.parallels||[30,30],h=F(s),p=F(c),g=Math.cos(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(i_(p)/i_(h)),this.f=g*Math.pow(i_(h),this.n)/this.n}project(t,s){s=F(s),t=F(t-this.center[0]);const c=1e-6,{n:h,f:p}=this;p>0?s<-Ku+c&&(s=-Ku+c):s>Ku-c&&(s=Ku-c);const g=p/Math.pow(i_(s),h),x=g*Math.sin(h*t),b=p-g*Math.cos(h*t);return{x:.5*(x/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,s=(2*(1-s)-.5)*Math.PI;const{n:c,f:h}=this,p=h-s,g=Math.sign(p),x=Math.sign(c)*Math.sqrt(t*t+p*p);let b=Math.atan2(t,Math.abs(p))*g;p*c<0&&(b-=Math.PI*Math.sign(t)*g);const S=K(B(b/c)+this.center[0],-180,180),C=K(B(2*Math.atan(Math.pow(h/x,1/c))-Ku),-85.051129,vs);return new Yn(S,C)}}class Gb extends Ka{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:ac(t),y:lc(s),z:0}}unproject(t,s){const c=Tr(t),h=Gi(s);return new Yn(c,h)}}const jb=F(vs);class m3 extends Ka{project(t,s){const c=(s=F(s))*s,h=c*c;return{x:.5*((t=F(t))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,h=25,p=0,g=c*c;do{g=c*c;const S=g*g;p=(c*(1.007226+g*(.015085+S*(.028874*g-.044475-.005916*S)))-s)/(1.007226+g*(.045255+S*(.259866*g-.311325-.005916*11*S))),c=K(c-p,-jb,jb)}while(Math.abs(p)>1e-6&&--h>0);g=c*c;const x=K(B(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=B(c);return new Yn(x,b)}}const Wb=F(vs);class _3 extends Ka{project(t,s){s=F(s),t=F(t);const c=Math.cos(s),h=2/Math.PI,p=Math.acos(c*Math.cos(t/2)),g=Math.sin(p)/p,x=.5*(t*h+2*c*Math.sin(t/2)/g)||0,b=.5*(s+Math.sin(s)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,s){let c=t=(2*t-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,p=25;const g=1e-6;let x=0,b=0;do{const S=Math.cos(h),C=Math.sin(h),L=2*C*S,z=C*C,O=S*S,U=Math.cos(c/2),X=Math.sin(c/2),se=2*U*X,de=X*X,Me=1-O*U*U,be=Me?1/Me:0,Ie=Me?Math.acos(S*U)*Math.sqrt(1/Me):0,De=.5*(2*Ie*S*X+2*c/Math.PI)-t,ke=.5*(Ie*C+h)-s,We=.5*be*(O*de+Ie*S*U*z)+1/Math.PI,$e=be*(se*L/4-Ie*C*X),nt=.125*be*(L*X-Ie*C*O*se),ht=.5*be*(z*U+Ie*de*S)+.5,Oe=$e*nt-ht*We;x=(ke*$e-De*ht)/Oe,b=(De*nt-ke*We)/Oe,c=K(c-x,-Math.PI,Math.PI),h=K(h-b,-Wb,Wb)}while((Math.abs(x)>g||Math.abs(b)>g)&&--p>0);return new Yn(B(c),B(h))}}class Hb extends Ka{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(F(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){const{scale:c,cosPhi:h}=this;return{x:F(t)*h*c+.5,y:-Math.sin(F(s))/h*c+.5,z:0}}unproject(t,s){const{scale:c,cosPhi:h}=this,p=-(s-.5)/c,g=K(B((t-.5)/c)/h,-180,180),x=Math.asin(K(p*h,-1,1)),b=K(B(x),-85.051129,vs);return new Yn(g,b)}}class g3 extends Gb{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,s,c){const h=Math.pow(2,c.z),p=(t/on+c.x)/h,g=Ar(Gi((s/on+c.y)/h),Tr(p));return lr(g,g,df(Ms(c))),{x:g[0],y:g[1],z:g[2]}}locationPoint(t,s){const c=Ar(s.lat,s.lng),h=Er([],c),p=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude;Bm(c,c,h,Lo(1,0)*on*p);const g=Jr(new Float64Array(16));return qa(g,t.pixelMatrix,t.globeMatrix),lr(c,c,g),new P(c[0],c[1])}pixelsPerMeter(t,s){return Lo(1,0)*s}pixelSpaceConversion(t,s,c){const h=Rn(Lo(1,45)*s,Lo(1,t)*s,c);return this.pixelsPerMeter(t,s)/h}createTileMatrix(t,s,c){const h=Bb(Ms(c.canonical));return qa(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,s){const{center:c}=t,h=Jr(new Float64Array(16));return qa(h,h,df(Ms(s))),km(h,h,F(c.lng)),zm(h,h,F(c.lat)),ws(h,h,[t._projectionScaler,t._projectionScaler,1]),Float32Array.from(h)}pointCoordinate(t,s,c,h){return kb(t,s,c,!0)||new Nu(0,0)}pointCoordinate3D(t,s,c){const h=this.pointCoordinate(t,s,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,s){return!kb(t,s.x,s.y,!1)}farthestPixelDistance(t){const s=function(h,p){const g=h.cameraToCenterDistance,x=h._centerAltitude*p,b=h._camera,S=h._camera.forward(),C=Za([],bs([],S,-g),[0,0,x]),L=h.worldSize/(2*Math.PI),z=[0,0,-L],O=h.width/h.height,U=Math.tan(h.fovAboveCenter),X=bs([],b.up(),U),se=bs([],b.right(),U*O),de=Er([],Za([],Za([],S,X),se)),Me=[];let be;if(new Uy(C,de).closestPointOnSphere(z,L,Me)){const Ie=Za([],Me,z),De=zo([],Ie,C);be=Math.cos(h.fovAboveCenter)*Xd(De)}else{const Ie=zo([],C,z),De=zo([],z,C);Er(De,De);const ke=Xd(Ie)-L;be=Math.sqrt(ke*(ke+2*L));const We=Math.acos(be/(L+ke))-Math.acos(Do(S,De));be*=Math.cos(We)}return 1.01*be}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=h0(t.zoom);if(c>0){const h=Vb(t,Lo(1,t.center.lat)*t.worldSize),p=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Rn(s,h+p*(1-Math.cos(g)),Math.pow(c,10))}return s}upVector(t,s,c){const h=1<<t.z,p=(s/on+t.x)/h;return Ar(Gi((c/on+t.y)/h),Tr(p),1)}upVectorScale(t){return{metersToTile:l0*t_(Ms(t))}}}function $b(o){const t=o.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(o.name){case"mercator":return new Gb(o);case"equirectangular":return new f3(o);case"naturalEarth":return new m3(o);case"equalEarth":return new d3(o);case"winkelTripel":return new _3(o);case"albers":return s?new Hb(o):new h3(o);case"lambertConformalConic":return s?new Hb(o):new p3(o);case"globe":return new g3(o)}throw new Error(`Invalid projection name: ${o.name}`)}const y3=fc.VectorTileFeature.types,x3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function r_(o,t,s,c,h,p,g,x,b,S,C,L,z){const O=x?Math.min(Ya,Math.round(x[0])):0,U=x?Math.min(Ya,Math.round(x[1])):0;o.emplaceBack(t,s,Math.round(32*c),Math.round(32*h),p,g,(O<<1)+(b?1:0),U,16*S,16*C,256*L,256*z)}function o_(o,t,s,c,h,p,g){o.emplaceBack(t,s,c,h,p,g)}function s_(o,t,s,c,h){o.emplaceBack(t,s,c,h),o.emplaceBack(t,s,c,h),o.emplaceBack(t,s,c,h),o.emplaceBack(t,s,c,h)}function v3(o){for(const t of o.sections)if(v(t.text))return!0;return!1}class d0{constructor(t){this.layoutVertexArray=new Br,this.indexArray=new kn,this.programConfigurations=t,this.segments=new Ii,this.dynamicLayoutVertexArray=new Gn,this.opacityVertexArray=new Xo,this.placedSymbolArray=new Q1,this.globeExtVertexArray=new Io}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bI.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,MI.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,x3,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,SI.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Vt(d0,"SymbolBuffers");class f0{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Ii,this.collisionVertexArray=new ki,this.collisionVertexArrayExt=new Qi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,TI.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,EI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Vt(f0,"CollisionBuffers");class Ja{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jr([]),this.placementViewportMatrix=Jr([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ky(this.zoom,s["text-size"]),this.iconSizeData=Ky(this.zoom,s["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(g=>_o[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new d0(new sc(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new d0(new sc(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new nw,this.lineVertexArray=new iw,this.symbolInstances=new tw}calculateGlyphDependencies(t,s,c,h,p){for(let g=0;g<t.length;g++)if(s[t.charCodeAt(g)]=!0,h&&p){const x=af[t.charAt(g)];x&&(s[x.charCodeAt(0)]=!0)}}populate(t,s,c,h){const p=this.layers[0],g=p.layout,x=this.projection.name==="globe",b=g.get("text-font"),S=g.get("text-field"),C=g.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof ar&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,O=g.get("symbol-sort-key");if(this.features=[],!L&&!z)return;const U=s.iconDependencies,X=s.glyphDependencies,se=s.availableImages,de=new ae(this.zoom);for(const{feature:Me,id:be,index:Ie,sourceLayerIndex:De}of t){const ke=p._featureFilter.needGeometry,We=cc(Me,ke);if(!p._featureFilter.filter(de,We,c))continue;if(ke||(We.geometry=ta(Me,c,h)),x&&Me.type!==1&&c.z<=5){const Oe=We.geometry,Qe=1<<c.z,dt=c.x,ft=c.y,Ot=.98078528056;for(let lt=0;lt<Oe.length;lt++)Oe[lt]=MA(Oe[lt],zt=>zt,(zt,yn)=>Do(Ar(Gi((zt.y/on+ft)/Qe),Tr((zt.x/on+dt)/Qe),1),Ar(Gi((yn.y/on+ft)/Qe),Tr((yn.x/on+dt)/Qe),1))<Ot)}let $e,nt;if(L){const Oe=p.getValueAndResolveTokens("text-field",We,c,se),Qe=ar.factory(Oe);v3(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||J()==="unavailable"||this.hasRTLText&&Q.isParsed())&&($e=II(Qe,p,We))}if(z){const Oe=p.getValueAndResolveTokens("icon-image",We,c,se);nt=Oe instanceof Zr?Oe:Zr.fromString(Oe)}if(!$e&&!nt)continue;const ht=this.sortFeaturesByKey?O.evaluate(We,{},c):void 0;if(this.features.push({id:be,text:$e,icon:nt,index:Ie,sourceLayerIndex:De,geometry:We.geometry,properties:Me.properties,type:y3[Me.type],sortKey:ht}),nt&&(U[nt.name]=!0),$e){const Oe=b.evaluate(We,{},c).join(","),Qe=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_o.vertical)>=0;for(const dt of $e.sections)if(dt.image)U[dt.image.name]=!0;else{const ft=Fu($e.toString()),Ot=dt.fontStack||Oe,lt=X[Ot]=X[Ot]||{};this.calculateGlyphDependencies(dt.text,lt,Qe,this.allowVerticalPlacement,ft)}}}g.get("symbol-placement")==="line"&&(this.features=function(Me){const be={},Ie={},De=[];let ke=0;function We(Oe){De.push(Me[Oe]),ke++}function $e(Oe,Qe,dt){const ft=Ie[Oe];return delete Ie[Oe],Ie[Qe]=ft,De[ft].geometry[0].pop(),De[ft].geometry[0]=De[ft].geometry[0].concat(dt[0]),ft}function nt(Oe,Qe,dt){const ft=be[Qe];return delete be[Qe],be[Oe]=ft,De[ft].geometry[0].shift(),De[ft].geometry[0]=dt[0].concat(De[ft].geometry[0]),ft}function ht(Oe,Qe,dt){const ft=dt?Qe[0][Qe[0].length-1]:Qe[0][0];return`${Oe}:${ft.x}:${ft.y}`}for(let Oe=0;Oe<Me.length;Oe++){const Qe=Me[Oe],dt=Qe.geometry,ft=Qe.text?Qe.text.toString():null;if(!ft){We(Oe);continue}const Ot=ht(ft,dt),lt=ht(ft,dt,!0);if(Ot in Ie&&lt in be&&Ie[Ot]!==be[lt]){const zt=nt(Ot,lt,dt),yn=$e(Ot,lt,De[zt].geometry);delete be[Ot],delete Ie[lt],Ie[ht(ft,De[yn].geometry,!0)]=yn,De[zt].geometry=null}else Ot in Ie?$e(Ot,lt,dt):lt in be?nt(Ot,lt,dt):(We(Oe),be[Ot]=ke-1,Ie[lt]=ke-1)}return De.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Me,be)=>Me.sortKey-be.sortKey)}update(t,s,c,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,c,h),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,c,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$b(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length,h=t.segment;if(h!==void 0){let p=t.dist(s[h+1]),g=t.dist(s[h]);const x={};for(let b=h+1;b<s.length;b++)x[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:p},b<s.length-1&&(p+=s[b+1].dist(s[b]));for(let b=h||0;b>=0;b--)x[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:g},b>0&&(g+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const S=x[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,h,p,g,x,b,S,C,L,z,O,U){const X=t.indexArray,se=t.layoutVertexArray,de=t.globeExtVertexArray,Me=t.segments.prepareSegment(4*s.length,se,X,this.canOverlap?g.sortKey:void 0),be=this.glyphOffsetArray.length,Ie=Me.vertexLength,De=this.allowVerticalPlacement&&x===_o.vertical?Math.PI/2:0,ke=g.text&&g.text.sections;for(let $e=0;$e<s.length;$e++){const{tl:nt,tr:ht,bl:Oe,br:Qe,tex:dt,pixelOffsetTL:ft,pixelOffsetBR:Ot,minFontScaleX:lt,minFontScaleY:zt,glyphOffset:yn,isSDF:Mn,sectionIndex:Qt}=s[$e],Gt=Me.vertexLength,En=yn[1];if(r_(se,S.x,S.y,nt.x,En+nt.y,dt.x,dt.y,c,Mn,ft.x,ft.y,lt,zt),r_(se,S.x,S.y,ht.x,En+ht.y,dt.x+dt.w,dt.y,c,Mn,Ot.x,ft.y,lt,zt),r_(se,S.x,S.y,Oe.x,En+Oe.y,dt.x,dt.y+dt.h,c,Mn,ft.x,Ot.y,lt,zt),r_(se,S.x,S.y,Qe.x,En+Qe.y,dt.x+dt.w,dt.y+dt.h,c,Mn,Ot.x,Ot.y,lt,zt),b){const wn=b.anchor,Yt=b.up;o_(de,wn.x,wn.y,wn.z,Yt[0],Yt[1],Yt[2]),o_(de,wn.x,wn.y,wn.z,Yt[0],Yt[1],Yt[2]),o_(de,wn.x,wn.y,wn.z,Yt[0],Yt[1],Yt[2]),o_(de,wn.x,wn.y,wn.z,Yt[0],Yt[1],Yt[2]),s_(t.dynamicLayoutVertexArray,wn.x,wn.y,wn.z,De)}else s_(t.dynamicLayoutVertexArray,S.x,S.y,S.z,De);X.emplaceBack(Gt,Gt+1,Gt+2),X.emplaceBack(Gt+1,Gt+2,Gt+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yn[0]),$e!==s.length-1&&Qt===s[$e+1].sectionIndex||t.programConfigurations.populatePaintArrays(se.length,g,g.index,{},O,U,ke&&ke[Qt])}const We=b?b.anchor:S;t.placedSymbolArray.emplaceBack(We.x,We.y,We.z,S.x,S.y,be,this.glyphOffsetArray.length-be,Ie,C,L,S.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,!1,0,z,0)}_commitLayoutVertex(t,s,c,h,p,g,x){t.emplaceBack(s,c,h,p,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(t,s,c,h,p,g,x){const b=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=b.vertexLength,C=x.tileAnchorX,L=x.tileAnchorY;for(let O=0;O<4;O++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-t.padding,-t.padding),c.collisionVertexArrayExt.emplaceBack(s,t.padding,-t.padding),c.collisionVertexArrayExt.emplaceBack(s,t.padding,t.padding),c.collisionVertexArrayExt.emplaceBack(s,-t.padding,t.padding),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,C,L,new P(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,C,L,new P(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,C,L,new P(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,p,g,C,L,new P(t.x1,t.y2)),b.vertexLength+=4;const z=c.indexArray;z.emplaceBack(S,S+1),z.emplaceBack(S+1,S+2),z.emplaceBack(S+2,S+3),z.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,c,h,p,g){for(let x=h;x<p;x++){const b=c.get(x),S=this.getSymbolInstanceTextSize(t,g,s,x);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,s,c,h,p,g){for(let x=h;x<p;x++){const b=c.get(x),S=this.getSymbolInstanceIconSize(t,s,x);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new f0(li,ob.members,Ri),this.iconCollisionBox=new f0(li,ob.members,Ri);const c=Wu(this.iconSizeData,t),h=Wu(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,t,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(c,t,s,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(c,t,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,s,c,h){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),g=Zm(this.textSizeData,t,p)/cr;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,s,c){const h=this.icon.placedSymbolArray.get(c),p=Zm(this.iconSizeData,t,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,s,c){t.emplaceBack(s,-c,-c),t.emplaceBack(s,c,-c),t.emplaceBack(s,c,c),t.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(t,s,c,h,p,g){for(let x=h;x<p;x++){const b=c.get(x),S=this.getSymbolInstanceTextSize(t,g,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,b.padding)}}_updateIconDebugCollisionBoxes(t,s,c,h,p){for(let g=h;g<p;g++){const x=c.get(g),b=this.getSymbolInstanceIconSize(t,s,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(t,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Wu(this.iconSizeData,t),h=Wu(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,t,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(c,t,s,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,t,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,c,h,p,g,x,b,S){const C={};for(let L=s;L<c;L++){const z=t.get(L);C.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},C.textFeatureIndex=z.featureIndex;break}for(let L=h;L<p;L++){const z=t.get(L);C.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},C.verticalTextFeatureIndex=z.featureIndex;break}for(let L=g;L<x;L++){const z=t.get(L);C.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},C.iconFeatureIndex=z.featureIndex;break}for(let L=b;L<S;L++){const z=t.get(L);C.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},C.verticalIconFeatureIndex=z.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),h=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<h;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),h=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const b=this.symbolInstances.get(x);h.push(0|Math.round(s*b.tileAnchorX+c*b.tileAnchorY)),p.push(b.featureIndex)}return g.sort((x,b)=>h[x]-h[b]||p[b]-p[x]),g}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((h,p,g)=>{h>=0&&g.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Vt(Ja,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ja.MAX_GLYPHS=65535,Ja.addDynamicAttributes=s_;const w3=new Ke({"symbol-placement":new Ue(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new Ue(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ue(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ve(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ue(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ue(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ue(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ue(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ue(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new ve(Re.layout_symbol["icon-size"]),"icon-text-fit":new Ue(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ue(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new ve(Re.layout_symbol["icon-image"]),"icon-rotate":new ve(Re.layout_symbol["icon-rotate"]),"icon-padding":new Ue(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new Ue(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new ve(Re.layout_symbol["icon-offset"]),"icon-anchor":new ve(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ue(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ue(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ue(Re.layout_symbol["text-rotation-alignment"]),"text-field":new ve(Re.layout_symbol["text-field"]),"text-font":new ve(Re.layout_symbol["text-font"]),"text-size":new ve(Re.layout_symbol["text-size"]),"text-max-width":new ve(Re.layout_symbol["text-max-width"]),"text-line-height":new ve(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new ve(Re.layout_symbol["text-letter-spacing"]),"text-justify":new ve(Re.layout_symbol["text-justify"]),"text-radial-offset":new ve(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ue(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new ve(Re.layout_symbol["text-anchor"]),"text-max-angle":new Ue(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new Ue(Re.layout_symbol["text-writing-mode"]),"text-rotate":new ve(Re.layout_symbol["text-rotate"]),"text-padding":new Ue(Re.layout_symbol["text-padding"]),"text-keep-upright":new Ue(Re.layout_symbol["text-keep-upright"]),"text-transform":new ve(Re.layout_symbol["text-transform"]),"text-offset":new ve(Re.layout_symbol["text-offset"]),"text-allow-overlap":new Ue(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ue(Re.layout_symbol["text-ignore-placement"]),"text-optional":new Ue(Re.layout_symbol["text-optional"])});var p0={paint:new Ke({"icon-opacity":new ve(Re.paint_symbol["icon-opacity"]),"icon-color":new ve(Re.paint_symbol["icon-color"]),"icon-halo-color":new ve(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new ve(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ve(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new Ue(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ue(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new ve(Re.paint_symbol["text-opacity"]),"text-color":new ve(Re.paint_symbol["text-color"],{runtimeType:Ci,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ve(Re.paint_symbol["text-halo-color"]),"text-halo-width":new ve(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new ve(Re.paint_symbol["text-halo-blur"]),"text-translate":new Ue(Re.paint_symbol["text-translate"]),"text-translate-anchor":new Ue(Re.paint_symbol["text-translate-anchor"])}),layout:w3};class qb{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wo,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt(qb,"FormatSectionOverride",{omit:["defaultValue"]});class a_ extends Jo{constructor(t){super(t,p0)}recalculate(t,s){super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const p of c)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,s,c,h){const p=this.layout.get(t).evaluate(s,{},c,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||vu(g.value)||!p?p:function(x,b){return b.replace(/{([^{}]+)}/g,(S,C)=>C in x?String(x[C]):"")}(s.properties,p)}createBucket(t){return new Ja(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of p0.paint.overridableProperties){if(!a_.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new qb(s),h=new xu(c,s.property.specification);let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new wu("source",h):new Xl("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new He(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&a_.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),h=p0.paint.properties[s];let p=!1;const g=x=>{for(const b of x)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof ar)g(c.value.value.sections);else if(c.value.kind==="source"){const x=S=>{p||(S instanceof Ol&&yi(S.value)===Ta?g(S.value.sections):S instanceof gs?g(S.sections):S.eachChild(x))},b=c.value;b._styleExpression&&x(b._styleExpression.expression)}return p}getProgramConfiguration(t){return new Ha(this,t)}}var b3={paint:new Ke({"background-color":new Ue(Re.paint_background["background-color"]),"background-pattern":new rt(Re.paint_background["background-pattern"]),"background-opacity":new Ue(Re.paint_background["background-opacity"])})},S3={paint:new Ke({"raster-opacity":new Ue(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ue(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ue(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ue(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new Ue(Re.paint_raster["raster-saturation"]),"raster-contrast":new Ue(Re.paint_raster["raster-contrast"]),"raster-resampling":new Ue(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new Ue(Re.paint_raster["raster-fade-duration"])})};class M3 extends Jo{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var T3={paint:new Ke({"sky-type":new Ue(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ue(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ue(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ue(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ue(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new It(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ue(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ue(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ue(Re.paint_sky["sky-opacity"])})};function m0(o,t,s){const c=[0,0,1],h=zw([]);return Rw(h,h,s?-F(o)+Math.PI:F(o)),kw(h,h,-F(t)),Pw(c,c,h),Er(c,c)}const E3={circle:class extends Jo{constructor(o){super(o,LA)}createBucket(o){return new ky(o)}queryRadius(o){const t=o;return Uu("circle-radius",this,t)+Uu("circle-stroke-width",this,t)+Lm(this.paint.get("circle-translate"))}queryIntersectsFeature(o,t,s,c,h,p,g,x){const b=Tw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return Fw(o,c,p,g,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Ha(this,o)}},heatmap:class extends Jo{createBucket(o){return new Ow(o)}constructor(o){super(o,OA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Uu("heatmap-radius",this,o)}queryIntersectsFeature(o,t,s,c,h,p,g,x){const b=this.paint.get("heatmap-radius").evaluate(t,s);return Fw(o,c,p,g,x,!0,!0,new P(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Ha(this,o)}},hillshade:class extends Jo{constructor(o){super(o,NA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Jo{constructor(o){super(o,nI)}getProgramIds(){const o=this.paint.get("fill-pattern"),t=o&&o.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Ha(this,o)}recalculate(o,t){super.recalculate(o,t);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new jm(o)}queryRadius(){return Lm(this.paint.get("fill-translate"))}queryIntersectsFeature(o,t,s,c,h,p){return!o.queryGeometry.isAboveHorizon&&vw(Mw(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Jo{constructor(o){super(o,pI)}createBucket(o){return new rf(o)}queryRadius(){return Lm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Ha(this,o)}queryIntersectsFeature(o,t,s,c,h,p,g,x,b){const S=Tw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(t,s),L=this.paint.get("fill-extrusion-base").evaluate(t,s),z=[0,0],O=x&&p.elevation,U=p.elevation?p.elevation.exaggeration():1,X=o.tile.getBucket(this);if(O&&X instanceof rf){const Me=X.centroidVertexArray,be=b+1;if(be<Me.length){const Ie=Me.get(be);z[0]=Ie.a_centroid_pos0,z[1]=Ie.a_centroid_pos1}}if(z[0]===0&&z[1]===1)return!1;p.projection.name==="globe"&&(c=Kw([c],[new P(0,0),new P(on,on)],o.tileID.canonical).map(Me=>Me.polygon).flat());const se=function(Me,be,Ie,De,ke,We,$e,nt,ht,Oe,Qe){return Me.projection.name==="globe"?function(dt,ft,Ot,lt,zt,yn,Mn,Qt,Gt,En,wn){const Yt=[],ji=[],Pi=dt.projection.upVectorScale(wn,dt.center.lat,dt.worldSize).metersToTile,wi=[0,0,0,1],Cn=[0,0,0,1],Bn=(ei,Kn,oi,fi)=>{ei[0]=Kn,ei[1]=oi,ei[2]=fi,ei[3]=1},ni=Yw();Ot>0&&(Ot+=ni),lt+=ni;for(const ei of ft){const Kn=[],oi=[];for(const fi of ei){const er=fi.x+zt.x,Or=fi.y+zt.y,Dn=dt.projection.projectTilePoint(er,Or,wn),bi=dt.projection.upVector(wn,fi.x,fi.y);let gr=Ot,Hn=lt;if(Mn){const pi=tb(er,Or,Ot,lt,Mn,Qt,Gt,En);gr+=pi.base,Hn+=pi.top}Ot!==0?Bn(wi,Dn.x+bi[0]*Pi*gr,Dn.y+bi[1]*Pi*gr,Dn.z+bi[2]*Pi*gr):Bn(wi,Dn.x,Dn.y,Dn.z),Bn(Cn,Dn.x+bi[0]*Pi*Hn,Dn.y+bi[1]*Pi*Hn,Dn.z+bi[2]*Pi*Hn),lr(wi,wi,yn),lr(Cn,Cn,yn),Kn.push($m(wi)),oi.push($m(Cn))}Yt.push(Kn),ji.push(oi)}return[Yt,ji]}(Me,be,Ie,De,ke,We,$e,nt,ht,Oe,Qe):$e?function(dt,ft,Ot,lt,zt,yn,Mn,Qt,Gt){const En=[],wn=[],Yt=[0,0,0,1];for(const ji of dt){const Pi=[],wi=[];for(const Cn of ji){const Bn=Cn.x+lt.x,ni=Cn.y+lt.y,ei=tb(Bn,ni,ft,Ot,yn,Mn,Qt,Gt);Yt[0]=Bn,Yt[1]=ni,Yt[2]=ei.base,Yt[3]=1,dc(Yt,Yt,zt),Yt[3]=Math.max(Yt[3],1e-5);const Kn=$m([Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]]);Yt[0]=Bn,Yt[1]=ni,Yt[2]=ei.top,Yt[3]=1,dc(Yt,Yt,zt),Yt[3]=Math.max(Yt[3],1e-5);const oi=$m([Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]]);Pi.push(Kn),wi.push(oi)}En.push(Pi),wn.push(wi)}return[En,wn]}(be,Ie,De,ke,We,$e,nt,ht,Oe):function(dt,ft,Ot,lt,zt){const yn=[],Mn=[],Qt=zt[8]*ft,Gt=zt[9]*ft,En=zt[10]*ft,wn=zt[11]*ft,Yt=zt[8]*Ot,ji=zt[9]*Ot,Pi=zt[10]*Ot,wi=zt[11]*Ot;for(const Cn of dt){const Bn=[],ni=[];for(const ei of Cn){const Kn=ei.x+lt.x,oi=ei.y+lt.y,fi=zt[0]*Kn+zt[4]*oi+zt[12],er=zt[1]*Kn+zt[5]*oi+zt[13],Or=zt[2]*Kn+zt[6]*oi+zt[14],Dn=zt[3]*Kn+zt[7]*oi+zt[15],bi=fi+Qt,gr=er+Gt,Hn=Or+En,pi=Math.max(Dn+wn,1e-5),Ir=fi+Yt,ci=er+ji,Li=Or+Pi,tr=Math.max(Dn+wi,1e-5),Zi=new P(bi/pi,gr/pi);Zi.z=Hn/pi,Bn.push(Zi);const ur=new P(Ir/tr,ci/tr);ur.z=Li/tr,ni.push(ur)}yn.push(Bn),Mn.push(ni)}return[yn,Mn]}(be,Ie,De,ke,We)}(p,c,L,C,S,g,O?x:null,z,U,p.center.lat,o.tileID.canonical),de=o.queryGeometry;return function(Me,be,Ie){let De=1/0;vw(Ie,be)&&(De=eb(Ie,be[0]));for(let ke=0;ke<be.length;ke++){const We=be[ke],$e=Me[ke];for(let nt=0;nt<We.length-1;nt++){const ht=We[nt],Oe=[ht,We[nt+1],$e[nt+1],$e[nt],ht];xw(Ie,Oe)&&(De=Math.min(De,eb(Ie,Oe)))}}return De!==1/0&&De}(se[0],se[1],de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends Jo{constructor(o){super(o,nb),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof lu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,t){super.recalculate(o,t),this.paint._values["line-floorwidth"]=ib.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new qm(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Ha(this,o)}queryRadius(o){const t=o,s=rb(Uu("line-width",this,t),Uu("line-gap-width",this,t)),c=Uu("line-offset",this,t);return s/2+Math.abs(c)+Lm(this.paint.get("line-translate"))}queryIntersectsFeature(o,t,s,c,h,p){if(o.queryGeometry.isAboveHorizon)return!1;const g=Mw(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*rb(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),b=this.paint.get("line-offset").evaluate(t,s);return b&&(c=function(S,C){const L=[],z=new P(0,0);for(let O=0;O<S.length;O++){const U=S[O],X=[];for(let se=0;se<U.length;se++){const de=U[se-1],Me=U[se],be=U[se+1],Ie=se===0?z:Me.sub(de)._unit()._perp(),De=se===U.length-1?z:be.sub(Me)._unit()._perp(),ke=Ie._add(De)._unit();ke._mult(1/(ke.x*De.x+ke.y*De.y)),X.push(ke._mult(C)._add(Me))}L.push(X)}return L}(c,b*o.pixelToTileUnitsFactor)),function(S,C,L){for(let z=0;z<C.length;z++){const O=C[z];if(S.length>=3){for(let U=0;U<O.length;U++)if(uc(S,O[U]))return!0}if(CA(S,O,L))return!0}return!1}(g,c,x)}isTileClipped(){return!0}},symbol:a_,background:class extends Jo{constructor(o){super(o,b3)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Jo{constructor(o){super(o,S3)}getProgramIds(){return["raster"]}},sky:class extends Jo{constructor(o){super(o,T3),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Wy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(o,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),h=!c,p=o.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&et("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?m0(g.azimuthal,90-g.polar,t):m0(c[0],90-c[1],t)}const s=this.paint.get("sky-gradient-center");return m0(s[0],90-s[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class gf{constructor(t,s,c,h){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,h)}update(t,s,c){const{width:h,height:p}=t,{context:g}=this,{gl:x}=g,{HTMLImageElement:b,HTMLCanvasElement:S,HTMLVideoElement:C,ImageData:L,ImageBitmap:z}=T;if(x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||s.premultiply!==!1)),c||this.size&&this.size[0]===h&&this.size[1]===p){const{x:O,y:U}=c||{x:0,y:0};t instanceof b||t instanceof S||t instanceof C||t instanceof L||z&&t instanceof z?x.texSubImage2D(x.TEXTURE_2D,0,O,U,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,O,U,h,p,x.RGBA,x.UNSIGNED_BYTE,t.data)}else this.size=[h,p],t instanceof b||t instanceof S||t instanceof C||t instanceof L||z&&t instanceof z?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,h,p,0,this.format,x.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(t,s){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class _0{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new na({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const c=this.getKey(t,s);return this.positions[c]}trim(){const t=this.width,s=this.height=je(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,c){const h=[];let p=t.length%2==1?-t[t.length-1]*c:0,g=t[0]*c,x=!0;h.push({left:p,right:g,isDash:x,zeroLength:t[0]===0});let b=t[0];for(let S=1;S<t.length;S++){x=!x;const C=t[S];p=b*c,b+=C,g=b*c,h.push({left:p,right:g,isDash:x,zeroLength:C===0})}return h}addRoundDash(t,s,c){const h=s/2;for(let p=-c;p<=c;p++){const g=this.width*(this.nextRow+c+p);let x=0,b=t[x];for(let S=0;S<this.width;S++){S/b.right>1&&(b=t[++x]);const C=Math.abs(S-b.left),L=Math.abs(S-b.right),z=Math.min(C,L);let O;const U=p/c*(h+1);if(b.isDash){const X=h-Math.abs(U);O=Math.sqrt(z*z+X*X)}else O=h-Math.sqrt(z*z+U*U);this.image.data[g+S]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,s){for(let b=t.length-1;b>=0;--b){const S=t[b],C=t[b+1];S.zeroLength?t.splice(b,1):C&&C.isDash===S.isDash&&(C.left=S.left,t.splice(b,1))}const c=t[0],h=t[t.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const p=this.width*this.nextRow;let g=0,x=t[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=t[++g]);const S=Math.abs(b-x.left),C=Math.abs(b-x.right),L=Math.min(S,C);this.image.data[p+b]=Math.max(0,Math.min(255,(x.isDash?L:-L)+s+128))}}addDash(t,s){const c=this.getKey(t,s);if(this.positions[c])return this.positions[c];const h=s==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return et("LineAtlas out of space"),null;t.length===0&&t.push(1);let x=0;for(let C=0;C<t.length;C++)t[C]<0&&(et("Negative value is found in line dasharray, replacing values with 0"),t[C]=0),x+=t[C];if(x!==0){const C=this.width/x,L=this.getDashRanges(t,this.width,C);h?this.addRoundDash(L,C,p):this.addRegularDash(L,s==="square"?.5*C:0)}const b=this.nextRow+p;this.nextRow+=g;const S={tl:[b,p],br:[x,0]};return this.positions[c]=S,S}}Vt(_0,"LineAtlas");class C3{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A3{constructor(){this.tasks={},this.taskQueue=[],tt(["process"],this),this.invoker=new C3(this.process),this.nextId=0}add(t,s){const c=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-x:p==="maybePrepare"&&g?400-x:500:200-x:100-x}(s);if(h===0){Xt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:t,metadata:s,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Xt();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<s&&(s=p.priority,t=h)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class Zb{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const I3=["tile","layer","source","sourceLayer","state"];class Xb{constructor(t,s,c,h,p){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=c,this._y=h,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const s of I3)this[s]!==void 0&&(t[s]=this[s]);return t}}const ko=32,Ts=33,Qa=new Uint16Array(8184);for(let o=0;o<2046;o++){let t=o+2,s=0,c=0,h=0,p=0,g=0,x=0;for(1&t?h=p=g=ko:s=c=x=ko;(t>>=1)>1;){const S=s+h>>1,C=c+p>>1;1&t?(h=s,p=c,s=g,c=x):(s=h,c=p,h=g,p=x),g=S,x=C}const b=4*o;Qa[b+0]=s,Qa[b+1]=c,Qa[b+2]=h,Qa[b+3]=p}const Es=new Uint16Array(2178),el=new Uint8Array(1089),l_=new Uint16Array(1089);function Yb(o){return o===0?-.03125:o===32?.03125:0}var Kb=St([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Jb={type:2,extent:on,loadGeometry:()=>[[new P(0,0),new P(8193,0),new P(8193,8193),new P(0,8193),new P(0,0)]]};class g0{constructor(t,s,c,h,p){this.tileID=t,this.uid=Pt(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<Zn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,p){const g={};if(!p)return g;for(const x of h){const b=x.layerIds.map(S=>p.getLayer(S)).filter(Boolean);if(b.length!==0){x.layers=b,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>b.filter(C=>C.id===S)[0]));for(const S of b)g[S.id]=x}}return g}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof Ja){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof Ja&&p.hasRTLText){this.hasRTLText=!0,Q.isLoading()||Q.isLoaded()||J()!=="deferred"||_e();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Ey}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const h=this.buckets[c];h.uploadPending()&&h.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gf(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gf(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new gf(t,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,h,p,g,x,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:g,params:p,tileTransform:this.tileTransform},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const h=c.loadVTLayers(),p=s?s.sourceLayer:"",g=h._geojsonTileLayer||h[p];if(!g)return;const x=Ys(s&&s.filter),{z:b,x:S,y:C}=this.tileID.canonical,L={z:b,x:S,y:C};for(let z=0;z<g.length;z++){const O=g.feature(z);if(x.needGeometry){const se=cc(O,!0);if(!x.filter(new ae(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!x.filter(new ae(this.tileID.overscaledZ),O))continue;const U=c.getId(O,p),X=new Xb(O,b,S,C,U);X.tile=L,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=ot(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let h=!1;if(this.expirationTime>c)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const p=this.expirationTime-s;p?this.expirationTime=c+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",b=c[x],S=t[x];if(!b||!S||Object.keys(S).length===0)continue;if(g.update(S,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof qm||g instanceof jm){const L=s.style._getSourceCache(g.layers[0].source);s._terrain&&s._terrain.enabled&&L&&g.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(L.id,this.tileID)}const C=s&&s.style&&s.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Zn.now()+t}setTexture(t,s){const c=s.context,h=c.gl;this.texture=s.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new gf(c,t,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(t,s){const c={};for(const h of s)c[h]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const h=this.dependencies[c];if(h){for(const p of s)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=ta(Jb,this.tileID.canonical,this.tileTransform)[0],h=new en,p=new Po;for(let g=0;g<c.length;g++){const{x,y:b}=c[g];h.emplaceBack(x,b),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,hf.members),this._tileDebugSegments=Ii.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=ta(Jb,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const g=function(x,b){const S=mc(x,b),C=Math.pow(2,x.z);for(let se=0;se<Ts;se++)for(let de=0;de<Ts;de++){const Me=Tr((x.x+(de+Yb(de))/ko)/C),be=Gi((x.y+(se+Yb(se))/ko)/C),Ie=b.project(Me,be),De=se*Ts+de;Es[2*De+0]=Math.round((Ie.x*S.scale-S.x)*on),Es[2*De+1]=Math.round((Ie.y*S.scale-S.y)*on)}el.fill(0),l_.fill(0);for(let se=2045;se>=0;se--){const de=4*se,Me=Qa[de+0],be=Qa[de+1],Ie=Qa[de+2],De=Qa[de+3],ke=Me+Ie>>1,We=be+De>>1,$e=ke+We-be,nt=We+Me-ke,ht=be*Ts+Me,Oe=De*Ts+Ie,Qe=We*Ts+ke,dt=Math.hypot((Es[2*ht+0]+Es[2*Oe+0])/2-Es[2*Qe+0],(Es[2*ht+1]+Es[2*Oe+1])/2-Es[2*Qe+1])>=16;if(el[Qe]=el[Qe]||(dt?1:0),se<1022){const ft=(be+nt>>1)*Ts+(Me+$e>>1),Ot=(De+nt>>1)*Ts+(Ie+$e>>1);el[Qe]=el[Qe]||el[ft]||el[Ot]}}const L=new Kt,z=new kn;let O=0;function U(se,de){const Me=de*Ts+se;return l_[Me]===0&&(L.emplaceBack(Es[2*Me+0],Es[2*Me+1],se*on/ko,de*on/ko),l_[Me]=++O),l_[Me]-1}function X(se,de,Me,be,Ie,De){const ke=se+Me>>1,We=de+be>>1;if(Math.abs(se-Ie)+Math.abs(de-De)>1&&el[We*Ts+ke])X(Ie,De,se,de,ke,We),X(Me,be,Ie,De,ke,We);else{const $e=U(se,de),nt=U(Me,be),ht=U(Ie,De);z.emplaceBack($e,nt,ht)}}return X(0,0,ko,ko,ko,0),X(ko,ko,0,0,0,ko),{vertices:L,indices:z}}(this.tileID.canonical,s);h=g.vertices,p=g.indices}else{h=new Kt,p=new kn;for(const{x,y:b}of c)h.emplaceBack(x,b,0,0);const g=Om(h.int16,void 0,4);for(let x=0;x<g.length;x+=3)p.emplaceBack(g[x],g[x+1],g[x+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,Kb.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=Ii.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(t,s){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!s||s.name!=="globe")return;const c=this.tileID.canonical,h=df(Ms(c));this._makeGlobeTileDebugBorderBuffer(t,c,h),this._makeGlobeTileDebugTextBuffer(t,c,h)}_makeGlobeTileDebugBorderBuffer(t,s,c){const h=new en,p=new Po,g=new vn,x=(S,C,L,z,O)=>{const U=(L-S)/(O-1),X=(z-C)/(O-1),se=h.length;for(let de=0;de<O;de++){const Me=S+de*U,be=C+de*X;h.emplaceBack(Me,be);const Ie=Fb(Me,be,s),De=lr(Ie,Ie,c);g.emplaceBack(De[0],De[1],De[2]),p.emplaceBack(se+de)}},b=on;x(0,0,b,0,16),x(b,0,b,b,16),x(b,b,0,b,16),x(0,b,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,hf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(g,zb.members),this._tileDebugSegments=Ii.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugTextBuffer(t,s,c){const h=new en,p=new kn,g=new vn,x=25;p.reserve(32),h.reserve(x),g.reserve(x);const b=(S,C)=>x*S+C;for(let S=0;S<x;S++){const C=2048*S;for(let L=0;L<x;L++){const z=2048*L;h.emplaceBack(z,C);const O=Fb(z,C,s),U=lr(O,O,c);g.emplaceBack(U[0],U[1],U[2])}}for(let S=0;S<4;S++)for(let C=0;C<4;C++){const L=b(S,C),z=b(S,C+1),O=b(S+1,C),U=b(S+1,C+1);p.emplaceBack(L,z,O),p.emplaceBack(O,z,U)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(p),this._tileDebugTextBuffer=t.createVertexBuffer(h,hf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(g,zb.members),this._tileDebugTextSegments=Ii.simpleSegment(0,0,x,32)}}class P3{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const h=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Fe(this.stateChanges[t][h],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==h&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const p in this.state[t][h])c[p]||(this.deletedStates[t][h][p]=null)}else for(const p in c)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][p]===null&&delete this.deletedStates[t][h][p]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const h=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(c in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][c]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),h=Fe({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][s];if(p===null)return{};for(const g in p)delete h[g]}return h}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),Fe(this.state[h][g],this.stateChanges[h][g]),p[g]=this.state[h][g];c[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const g in this.state[h])p[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(this.deletedStates[h][g]===null)this.state[h][g]={};else for(const x of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][x];p[g]=this.state[h][g]}c[h]=c[h]||{},Fe(c[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const h in t)t[h].setFeatureState(c,s)}}class Qb{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const c=this.toIdx(t,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function eS(o,t,s,c){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(c[g])<1e-15){if(s[g]<o[g]||s[g]>t[g])return null}else{const x=1/c[g];let b=(o[g]-s[g])*x,S=(t[g]-s[g])*x;if(b>S){const C=b;b=S,S=C}if(b>h&&(h=b),S<p&&(p=S),h>p)return null}return h}function tS(o,t,s,c,h,p,g,x,b,S,C){const L=c-o,z=h-t,O=p-s,U=g-o,X=x-t,se=b-s,de=C[1]*se-C[2]*X,Me=C[2]*U-C[0]*se,be=C[0]*X-C[1]*U,Ie=L*de+z*Me+O*be;if(Math.abs(Ie)<1e-15)return null;const De=1/Ie,ke=S[0]-o,We=S[1]-t,$e=S[2]-s,nt=(ke*de+We*Me+$e*be)*De;if(nt<0||nt>1)return null;const ht=We*O-$e*z,Oe=$e*L-ke*O,Qe=ke*z-We*L,dt=(C[0]*ht+C[1]*Oe+C[2]*Qe)*De;return dt<0||nt+dt>1?null:(U*ht+X*Oe+se*Qe)*De}function nS(o,t,s){return(o-t)/(s-t)}function iS(o,t,s,c,h,p,g,x,b){const S=1<<s,C=p-c,L=g-h,z=(o+1)/S*C+c,O=(t+0)/S*L+h,U=(t+1)/S*L+h;x[0]=(o+0)/S*C+c,x[1]=O,b[0]=z,b[1]=U}class rS{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const g=Math.ceil(Math.log2(p.dim/8)),x=[];let b=Math.ceil(Math.pow(2,g));const S=1/b,C=(O,U,X,se,de)=>{const Me=se?1:0,be=(O+1)*X-Me,Ie=U*X,De=(U+1)*X-Me;de[0]=O*X,de[1]=Ie,de[2]=be,de[3]=De};let L=new Qb(b);const z=[];for(let O=0;O<b*b;O++){C(O%b,Math.floor(O/b),S,!1,z);const U=tl(z[0],z[1],p),X=tl(z[2],z[1],p),se=tl(z[2],z[3],p),de=tl(z[0],z[3],p);L.minimums.push(Math.min(U,X,se,de)),L.maximums.push(Math.max(U,X,se,de)),L.leaves.push(1)}for(x.push(L),b/=2;b>=1;b/=2){const O=x[x.length-1];L=new Qb(b);for(let U=0;U<b*b;U++){C(U%b,Math.floor(U/b),2,!0,z);const X=O.getElevation(z[0],z[1]),se=O.getElevation(z[2],z[1]),de=O.getElevation(z[2],z[3]),Me=O.getElevation(z[0],z[3]),be=O.isLeaf(z[0],z[1]),Ie=O.isLeaf(z[2],z[1]),De=O.isLeaf(z[2],z[3]),ke=O.isLeaf(z[0],z[3]),We=Math.min(X.min,se.min,de.min,Me.min),$e=Math.max(X.max,se.max,de.max,Me.max),nt=be&&Ie&&De&&ke;L.maximums.push($e),L.minimums.push(We),L.leaves.push($e-We<=5&&nt?1:0)}x.push(L)}return x}(this.dem),c=s.length-1,h=s[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(t,s,c,h,p,g,x=1){return eS([t,s,-100],[c,h,this.maximums[0]*x],p,g)}raycast(t,s,c,h,p,g,x=1){if(!this.nodeCount)return null;const b=this.raycastRoot(t,s,c,h,p,g,x);if(b==null)return null;const S=[],C=[],L=[],z=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:U,t:X,nodex:se,nodey:de,depth:Me}=O.pop();if(this.leaves[U]){iS(se,de,Me,t,s,c,h,L,z);const Ie=1<<Me,De=(se+0)/Ie,ke=(se+1)/Ie,We=(de+0)/Ie,$e=(de+1)/Ie,nt=tl(De,We,this.dem)*x,ht=tl(ke,We,this.dem)*x,Oe=tl(ke,$e,this.dem)*x,Qe=tl(De,$e,this.dem)*x,dt=tS(L[0],L[1],nt,z[0],L[1],ht,z[0],z[1],Oe,p,g),ft=tS(z[0],z[1],Oe,L[0],z[1],Qe,L[0],L[1],nt,p,g),Ot=Math.min(dt!==null?dt:Number.MAX_VALUE,ft!==null?ft:Number.MAX_VALUE);if(Ot!==Number.MAX_VALUE)return Ot;{const lt=Bm([],p,g,X);if(oS(nt,ht,Qe,Oe,nS(lt[0],L[0],z[0]),nS(lt[1],L[1],z[1]))>=lt[2])return X}continue}let be=0;for(let Ie=0;Ie<this._siblingOffset.length;Ie++){iS((se<<1)+this._siblingOffset[Ie][0],(de<<1)+this._siblingOffset[Ie][1],Me+1,t,s,c,h,L,z),L[2]=-100,z[2]=this.maximums[this.childOffsets[U]+Ie]*x;const De=eS(L,z,p,g);if(De!=null){const ke=De;S[Ie]=ke;let We=!1;for(let $e=0;$e<be&&!We;$e++)ke>=S[C[$e]]&&(C.splice($e,0,Ie),We=!0);We||(C[be]=Ie),be++}}for(let Ie=0;Ie<be;Ie++){const De=C[Ie];O.push({idx:this.childOffsets[U]+De,t:S[De],nodex:(se<<1)+this._siblingOffset[De][0],nodey:(de<<1)+this._siblingOffset[De][1],depth:Me+1})}}return null}_addNode(t,s,c){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,c,h,p){if(t[h].isLeaf(s,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,x=t[g];let b=0,S=0;for(let C=0;C<this._siblingOffset.length;C++){const L=2*s+this._siblingOffset[C][0],z=2*c+this._siblingOffset[C][1],O=x.getElevation(L,z),U=x.isLeaf(L,z),X=this._addNode(O.min,O.max,U);U&&(b|=1<<C),S||(S=X)}for(let C=0;C<this._siblingOffset.length;C++)b&1<<C||this._construct(t,2*s+this._siblingOffset[C][0],2*c+this._siblingOffset[C][1],g,S+C)}}function oS(o,t,s,c,h,p){return Rn(Rn(o,s,p),Rn(t,c,p),h)}function tl(o,t,s){const c=s.dim,h=K(o*c-.5,0,c-1),p=K(t*c-.5,0,c-1),g=Math.floor(h),x=Math.floor(p),b=Math.min(g+1,c-1),S=Math.min(x+1,c-1);return oS(s.get(g,x),s.get(b,x),s.get(g,S),s.get(b,S),h-g,p-x)}const sS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class c_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,c,h=!1,p=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return et(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2,x=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=h,!h){for(let b=0;b<g;b++)x[this._idx(-1,b)]=x[this._idx(0,b)],x[this._idx(g,b)]=x[this._idx(g-1,b)],x[this._idx(b,-1)]=x[this._idx(b,0)],x[this._idx(b,g)]=x[this._idx(b,g-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(g,-1)]=x[this._idx(g-1,0)],x[this._idx(-1,g)]=x[this._idx(0,g-1)],x[this._idx(g,g)]=x[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new rS(this)}get(t,s,c=!1){c&&(t=K(t,-1,this.dim),s=K(s,-1,this.dim));const h=4*this._idx(t,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(t){return sS[t]}get unpackVector(){return sS[this.encoding]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}_unpackMapbox(t,s,c){return(256*t*256+256*s+c)/10-1e4}_unpackTerrarium(t,s,c){return 256*t+s+c/256-32768}static pack(t,s){const c=[0,0,0,0],h=c_.getUnpackVector(s);let p=Math.floor((t+h[3])/h[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new Qr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,p=s*this.dim+this.dim,g=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:h=p-1;break;case 1:p=h+1}switch(c){case-1:g=x-1;break;case 1:x=g+1}const b=-s*this.dim,S=-c*this.dim;for(let C=g;C<x;C++)for(let L=h;L<p;L++){const z=4*this._idx(L,C),O=4*this._idx(L+b,C+S);this.pixels[z+0]=t.pixels[O+0],this.pixels[z+1]=t.pixels[O+1],this.pixels[z+2]=t.pixels[O+2],this.pixels[z+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Vt(c_,"DEMData"),Vt(rS,"DemMinMaxQuadTree",{omit:["dem"]});class L3{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:s,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},c)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,h=s===void 0?0:this.data[c].indexOf(s),p=this.data[c][h];return this.data[c].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const h of this.data[c])t(h.value)||s.push(h);for(const c of s)this.remove(c.value.tileID,c)}}class Ju{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}Ju.ReadOnly=!1,Ju.ReadWrite=!0,Ju.disabled=new Ju(519,Ju.ReadOnly,[0,1]);const y0=7680;class x0{constructor(t,s,c,h,p,g){this.test=t,this.ref=s,this.mask=c,this.fail=h,this.depthFail=p,this.pass=g}}x0.disabled=new x0({func:519,mask:0},0,0,y0,y0,y0);class Cs{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}Cs.Replace=[1,0],Cs.disabled=new Cs(Cs.Replace,vi.transparent,[!1,!1,!1,!1]),Cs.unblended=new Cs(Cs.Replace,vi.transparent,[!0,!0,!0,!0]),Cs.alphaBlended=new Cs([1,771],vi.transparent,[!0,!0,!0,!0]);const v0=1029,w0=2305;class Qo{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}Qo.disabled=new Qo(!1,v0,w0),Qo.backCCW=new Qo(!0,v0,w0),Qo.backCW=new Qo(!0,v0,2304),Qo.frontCW=new Qo(!0,1028,2304),Qo.frontCCW=new Qo(!0,1028,w0);class _c extends Pn{constructor(t,s,c){super(),this.id=t,this._onlySymbols=c,s.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new L3(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new P3,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const s in this._tiles){const c=this._tiles[s];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(t),c.prepare(this.map.style.imageManager)}else for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Ae(this._tiles).map(t=>t.tileID).sort(aS).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,t)&&s.push(this._tiles[c]);return t?s.sort((c,h)=>{const p=c.tileID,g=h.tileID,x=new P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||b.y-x.y||b.x-x.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(aS).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,h){if(h)if(t.state="errored",h.status!==404)this._source.fire(new Un(h,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Zn.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new sn("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const p=s[h];if(t.neighboringTiles&&t.neighboringTiles[p]){const g=this.getTileByID(p);c(t,g),c(g,t)}}function c(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-h.tileID.canonical.x;const x=p.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),S=p.tileID.key;g===0&&x===0||Math.abs(x)>1||(Math.abs(g)>1&&(Math.abs(g+b)===1?g+=b:Math.abs(g-b)===1&&(g-=b)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,g,x),h.neighboringTiles&&h.neighboringTiles[S]&&(h.neighboringTiles[S].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,h){for(const p in this._tiles){let g=this._tiles[p];if(h[p]||!g.hasData()||g.tileID.overscaledZ<=s||g.tileID.overscaledZ>c)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>s+1;){const S=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[S.key],g&&g.hasData()&&(x=S)}let b=x;for(;b.overscaledZ>s;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){h[x.key]=x;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const h=t.scaledTo(c),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const c=Math.ceil(t.width/s)+1,h=Math.ceil(t.height/s)+1,p=Math.floor(c*h*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),c[p.tileID.key]=p}this._tiles=c;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,s,c){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let h;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Cr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const p=this._updateRetainedTiles(h);if(lS(this._source.type)&&h.length!==0){const x={},b={},S=Object.keys(p);for(const L of S){const z=p[L],O=this._tiles[L];if(!O||O.fadeEndTime&&O.fadeEndTime<=Zn.now())continue;const U=this.findLoadedParent(z,Math.max(z.overscaledZ-_c.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),x[U.tileID.key]=U.tileID),b[L]=z}const C=h[h.length-1].overscaledZ;for(const L in this._tiles){const z=this._tiles[L];if(p[L]||!z.hasData())continue;let O=z.tileID;for(;O.overscaledZ>C;){O=O.scaledTo(O.overscaledZ-1);const U=this._tiles[O.key];if(U&&U.hasData()&&b[O.key]){p[L]=z.tileID;break}}}for(const L in x)p[L]||(this._coveredTiles[L]=!0,p[L]=x[L])}for(const x in p)this._tiles[x].clearFadeHold();const g=function(x,b){const S=[];for(const C in x)C in b||S.push(C);return S}(this._tiles,p);for(const x of g){const b=this._tiles[x];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const c={},h=t.reduce((S,C)=>Math.min(S,C.overscaledZ),1/0),p=t[0].overscaledZ,g=Math.max(p-_c.maxOverzooming,this._source.minzoom),x=Math.max(p+_c.maxUnderzooming,this._source.minzoom),b={};for(const S of t){const C=this._addTile(S);s[S.key]=S,C.hasData()||h<this._source.maxzoom&&(b[S.key]=S)}this._retainLoadedChildren(b,h,x,s);for(const S of t){let C=this._tiles[S.key];if(C.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const z=S.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){s[z.key]=z;continue}}else{const z=S.children(this._source.maxzoom);if(s[z[0].key]&&s[z[1].key]&&s[z[2].key]&&s[z[3].key])continue}let L=C.wasRequested();for(let z=S.overscaledZ-1;z>=g;--z){const O=S.scaledTo(z);if(c[O.key]||(c[O.key]=!0,C=this.getTile(O),!C&&L&&(C=this._addTile(O)),C&&(s[O.key]=O,L=C.wasRequested(),C.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}s.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;h=p}for(const p of s)this._loadedParentTiles[p]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return this._source.prepareTile&&this._source.prepareTile(s),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=Boolean(s);if(!c){const h=this.map?this.map.painter:null;s=new g0(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(s)||this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,c||this._source.fire(new sn("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,c){const h=[],p=this.transform;if(!p)return h;const g=p.projection.name==="globe",x=ac(p.center.lng);for(const b in this._tiles){const S=this._tiles[b];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let C;if(g){const L=S.tileID.canonical;if(L.z===0){const z=[Math.abs(K(x,...yf(L,-1))-x),Math.abs(K(x,...yf(L,1))-x)];C=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(K(x,...yf(L,-1))-x),Math.abs(K(x,...yf(L,0))-x),Math.abs(K(x,...yf(L,1))-x)];C=[z.indexOf(Math.min(...z))-1]}}else C=[0];for(const L of C){const z=t.containsTile(S,p,s,L);z&&h.push(z)}}return h}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(lS(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=Zn.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const h=this._tiles[t];h&&h.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}_preloadTiles(t,s){const c=new Map,h=Array.isArray(t)?t:[t],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const x of h){const b=x.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of b)c.set(S.key,S);this.usedForTerrain&&x.updateElevation(!1)}ee(Array.from(c.values()),(x,b)=>{const S=new g0(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,C=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),b(C,S)})},s)}}function aS(o,t){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return o.overscaledZ-t.overscaledZ||c-s||t.canonical.y-o.canonical.y||t.canonical.x-o.canonical.x}function lS(o){return o==="raster"||o==="image"||o==="video"}function yf(o,t){const s=1<<o.z;return[o.x/s+t,(o.x+1)/s+t]}_c.maxOverzooming=10,_c.maxUnderzooming=3;class u_{constructor(t,s,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(t,s,c){const h=c||t.findDEMTileFor(s);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,x=1<<s.canonical.z-g.canonical.z;return new u_(h,h.tileSize/on/x,[(s.canonical.x/x-g.canonical.x)*p.dim,(s.canonical.y/x-g.canonical.y)*p.dim])}tileCoordToPixel(t,s){const c=s*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(c);return new P(h,p)}getElevationAt(t,s,c,h){const p=t*this._scale+this._offset[0],g=s*this._scale+this._offset[1],x=Math.floor(p),b=Math.floor(g),S=this._dem;return h=!!h,c?Rn(Rn(S.get(x,b,h),S.get(x,b+1,h),g-b),Rn(S.get(x+1,b,h),S.get(x+1,b+1,h),g-b),p-x):S.get(x,b,h)}getElevationAtPixel(t,s,c){return this._dem.get(t,s,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Lo(1,t)*this._dem.stride}}class cS{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Va(on,16,0),this.featureIndexArray=new ow,this.promoteId=s}insert(t,s,c,h,p,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,p,g);const b=this.grid;for(let S=0;S<s.length;S++){const C=s[S],L=[1/0,1/0,-1/0,-1/0];for(let z=0;z<C.length;z++){const O=C[z];L[0]=Math.min(L[0],O.x),L[1]=Math.min(L[1],O.y),L[2]=Math.max(L[2],O.x),L[3]=Math.max(L[3],O.y)}L[0]<on&&L[1]<on&&L[2]>=0&&L[3]>=0&&b.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fc.VectorTile(new lf(this.rawTileData)).layers,this.sourceLayerCoder=new Zb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s,c,h){this.loadVTLayers();const p=t.params||{},g=Ys(p.filter),x=t.tileResult,b=t.transform,S=x.bufferedTilespaceBounds,C=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(U,X,se,de)=>Sw(x.bufferedTilespaceGeometry,U,X,se,de));C.sort(D3);let L=null;b.elevation&&C.length>0&&(L=u_.create(b.elevation,this.tileID));const z={};let O;for(let U=0;U<C.length;U++){const X=C[U];if(X===O)continue;O=X;const se=this.featureIndexArray.get(X);let de=null;this.loadMatchingFeature(z,se,g,p.layers,p.availableImages,s,c,h,(Me,be,Ie,De=0)=>(de||(de=ta(Me,this.tileID.canonical,t.tileTransform)),be.queryIntersectsFeature(x,Me,Ie,de,this.z,t.transform,t.pixelPosMatrix,L,De)))}return z}loadMatchingFeature(t,s,c,h,p,g,x,b,S){const{featureIndex:C,bucketIndex:L,sourceLayerIndex:z,layoutVertexArrayOffset:O}=s,U=this.bucketLayerIDs[L];if(h&&!function(Me,be){for(let Ie=0;Ie<Me.length;Ie++)if(be.indexOf(Me[Ie])>=0)return!0;return!1}(h,U))return;const X=this.sourceLayerCoder.decode(z),se=this.vtLayers[X].feature(C);if(c.needGeometry){const Me=cc(se,!0);if(!c.filter(new ae(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!c.filter(new ae(this.tileID.overscaledZ),se))return;const de=this.getId(se,X);for(let Me=0;Me<U.length;Me++){const be=U[Me];if(h&&h.indexOf(be)<0)continue;const Ie=g[be];if(!Ie)continue;let De={};de!==void 0&&b&&(De=b.getState(Ie.sourceLayer||"_geojsonTileLayer",de));const ke=Fe({},x[be]);ke.paint=uS(ke.paint,Ie.paint,se,De,p),ke.layout=uS(ke.layout,Ie.layout,se,De,p);const We=!S||S(se,Ie,De,O);if(!We)continue;const $e=new Xb(se,this.z,this.x,this.y,de);$e.layer=ke;let nt=t[be];nt===void 0&&(nt=t[be]=[]),nt.push({featureIndex:C,feature:$e,intersectionZ:We})}}lookupSymbolFeatures(t,s,c,h,p,g,x,b){const S={};this.loadVTLayers();const C=Ys(p);for(const L of t)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:h,featureIndex:L,layoutVertexArrayOffset:0},C,g,x,b,s);return S}loadFeature(t){const{featureIndex:s,sourceLayerIndex:c}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),p=this.vtFeatures[h];if(p[s])return p[s];const g=this.vtLayers[h].feature(s);return p[s]=g,g}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function uS(o,t,s,c,h){return Be(o,(p,g)=>{const x=t instanceof Ge?t.get(g):null;return x&&x.evaluate?x.evaluate(s,c,h):x})}function D3(o,t){return t-o}Vt(cS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class hS{constructor(t){const s={},c=[];for(const x in t){const b=t[x],S=s[x]={};for(const C in b.glyphs){const L=b.glyphs[+C];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;const z=L.metrics.localGlyph?2:1,O={x:0,y:0,w:L.bitmap.width+2*z,h:L.bitmap.height+2*z};c.push(O),S[C]=O}}const{w:h,h:p}=Qy(c),g=new na({width:h||1,height:p||1});for(const x in t){const b=t[x];for(const S in b.glyphs){const C=b.glyphs[+S];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const L=s[x][S],z=C.metrics.localGlyph?2:1;na.copy(C.bitmap,g,{x:0,y:0},{x:L.x+z,y:L.y+z},C.bitmap)}}this.image=g,this.positions=s}}Vt(hS,"GlyphAtlas");class z3{constructor(t){this.tileID=new Cr(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=mc(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,s,c,h,p){this.status="parsing",this.data=t,this.collisionBoxArray=new Ey;const g=new Zb(Object.keys(t.layers).sort()),x=new cS(this.tileID,this.promoteId);x.bucketLayerIDs=[];const b={},S=new _0(256,256),C={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},L=s.familiesBySource[this.source];for(const De in L){const ke=t.layers[De];if(!ke)continue;let We=!1,$e=!1;for(const Oe of L[De])Oe[0].type==="symbol"?We=!0:$e=!0;if(this.isSymbolTile===!0&&!We||this.isSymbolTile===!1&&!$e)continue;ke.version===1&&et(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const nt=g.encode(De),ht=[];for(let Oe=0;Oe<ke.length;Oe++){const Qe=ke.feature(Oe),dt=x.getId(Qe,De);ht.push({feature:Qe,id:dt,index:Oe,sourceLayerIndex:nt})}for(const Oe of L[De]){const Qe=Oe[0];this.isSymbolTile!==void 0&&Qe.type==="symbol"!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||Qe.visibility!=="none"&&(b0(Oe,this.zoom,c),(b[Qe.id]=Qe.createBucket({index:x.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(ht,C,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Oe.map(dt=>dt.id)))}}let z,O,U,X;S.trim();const se={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},de=Be(C.glyphDependencies,De=>Object.keys(De).map(Number));Object.keys(de).length?h.send("getGlyphs",{uid:this.uid,stacks:de},(De,ke)=>{z||(z=De,O=ke,Ie.call(this))},void 0,!1,se):O={};const Me=Object.keys(C.iconDependencies);Me.length?h.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"icons"},(De,ke)=>{z||(z=De,U=ke,Ie.call(this))},void 0,!1,se):U={};const be=Object.keys(C.patternDependencies);function Ie(){if(z)return p(z);if(O&&U&&X){const De=new hS(O),ke=new db(U,X);for(const We in b){const $e=b[We];$e instanceof Ja?(b0($e.layers,this.zoom,c),t3($e,O,De.positions,U,ke.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):$e.hasPattern&&($e instanceof qm||$e instanceof jm||$e instanceof rf)&&(b0($e.layers,this.zoom,c),$e.addFeatures(C,this.tileID.canonical,ke.patternPositions,c,this.tileTransform))}this.status="done",p(null,{buckets:Ae(b).filter(We=>!We.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,lineAtlas:S,imageAtlas:ke,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?De.positions:null})}}be.length?h.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"patterns"},(De,ke)=>{z||(z=De,X=ke,Ie.call(this))},void 0,!1,se):X={},Ie.call(this)}}function b0(o,t,s){const c=new ae(t);for(const h of o)h.recalculate(c,s)}class dS{constructor(t){this.entries={},this.scheduler=t}request(t,s,c,h){const p=this.entries[t]=this.entries[t]||{callbacks:[]};if(p.result){const[g,x]=p.result;return this.scheduler?this.scheduler.add(()=>{h(g,x)},s):h(g,x),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=c((g,x)=>{p.result=[g,x];for(const b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,x)},s):b(g,x);setTimeout(()=>delete this.entries[t],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==h),p.callbacks.length||(p.cancel(),delete this.entries[t]))}}}function fS(o,t,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},h=>{const p=te(o.request,(g,x,b,S)=>{g?h(g):x&&h(null,{vectorTile:s?void 0:new fc.VectorTile(new lf(x)),rawData:x,cacheControl:b,expires:S})});return()=>{p.cancel(),h()}},t)}a.ARRAY_TYPE=Kr,a.AUTH_ERR_MSG=nn,a.Aabb=mo,a.Actor=class{constructor(o,t,s){this.target=o,this.parent=t,this.mapId=s,this.callbacks={},this.cancelCallbacks={},tt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Xt()?o:T,this.scheduler=new A3}send(o,t,s,c,h=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[g]=s);const x=fn(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:o,hasCallback:!!s,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:tc(t,x)},x),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const t=o.data,s=t.id;if(s&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(t.mustQueue||Xt()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,t),c&&c.metadata||{type:"message"})}else this.processTask(s,t)}processTask(o,t){if(t.type==="<response>"){const s=this.callbacks[o];delete this.callbacks[o],s&&(t.error?s(nc(t.error)):s(null,nc(t.data)))}else{const s=fn(this.globalScope)?void 0:[],c=t.hasCallback?(p,g)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:p?tc(p):null,data:tc(g,s)},s)}:p=>{},h=nc(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,c);else if(this.parent.getWorkerSource){const p=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,p[0],h.source)[p[1]](h,c)}else c(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Hm,a.Color=vi,a.ColorMode=Cs,a.CullFaceMode=Qo,a.DEMData=c_,a.DataConstantProperty=Ue,a.DedupedRequest=dS,a.DepthMode=Ju,a.EXTENT=on,a.Elevation=class{isDataAvailableAtPoint(o){const t=this._source();if(!t||o.y<0||o.y>1)return!1;const s=t.getSource().maxzoom,c=1<<s,h=Math.floor(o.x),p=Math.floor((o.x-h)*c),g=Math.floor(o.y*c),x=this.findDEMTileFor(new Cr(s,h,s,p,g));return!(!x||!x.dem)}getAtPointOrZero(o,t=0){return this.getAtPoint(o,t)||0}getAtPoint(o,t,s=!0){t==null&&(t=null);const c=this._source();if(!c||o.y<0||o.y>1)return t;const h=c.getSource().maxzoom,p=1<<h,g=Math.floor(o.x),x=o.x-g,b=new Cr(h,g,h,Math.floor(x*p),Math.floor(o.y*p)),S=this.findDEMTileFor(b);if(!S||!S.dem)return t;const C=S.dem,L=1<<S.tileID.canonical.z,z=(x*L-S.tileID.canonical.x)*C.dim,O=(o.y*L-S.tileID.canonical.y)*C.dim,U=Math.floor(z),X=Math.floor(O);return(s?this.exaggeration():1)*Rn(Rn(C.get(U,X),C.get(U,X+1),O-X),Rn(C.get(U+1,X),C.get(U+1,X+1),O-X),z-U)}getAtTileOffset(o,t,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new Nu(o.wrap+(o.canonical.x+t/on)/c,(o.canonical.y+s/on)/c))}getAtTileOffsetFunc(o,t,s,c){return h=>{const p=this.getAtTileOffset(o,h.x,h.y),g=c.upVector(o.canonical,h.x,h.y);return bs(g,g,p*c.upVectorScale(o.canonical,t,s).metersToTile),g}}getForTilePoints(o,t,s,c){const h=u_.create(this,o,c);return!!h&&(t.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(o){const t=this.findDEMTileFor(o);if(!t||!t.dem)return null;const s=t.dem.tree,c=t.tileID,h=1<<o.canonical.z-c.canonical.z;let p=o.canonical.x/h-c.canonical.x,g=o.canonical.y/h-c.canonical.y,x=0;for(let b=0;b<o.canonical.z-c.canonical.z&&!s.leaves[x];b++){p*=2,g*=2;const S=2*Math.floor(g)+Math.floor(p);x=s.childOffsets[x]+S,p%=1,g%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=Un,a.EvaluationParameters=ae,a.Event=sn,a.Evented=Pn,a.FillExtrusionBucket=rf,a.Frustum=Gy,a.FrustumCorners=Vy,a.GLOBE_METERS_TO_ECEF=l0,a.GLOBE_RADIUS=pc,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_createGrid(o){const t=new en,s=new kn,c=65;for(let h=0;h<c;h++)for(let p=0;p<c;p++)t.emplaceBack(p,h);this._gridSegments=[];for(let h=0,p=0;h<Yu.length;h++){const g=Yu[h];for(let b=0;b<g;b++)for(let S=0;S<64;S++){const C=b*c+S;s.emplaceBack(C+1,C,C+c),s.emplaceBack(C+c,C+c+1,C+1)}const x=64*g*2;this._gridSegments.push(Ii.simpleSegment(0,p,(g+1)*c,x)),p+=x}this._gridBuffer=o.createVertexBuffer(t,hf.members),this._gridIndexBuffer=o.createIndexBuffer(s,!0)}_createPoles(o){const t=new kn;for(let h=0;h<=64;h++)t.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=o.createIndexBuffer(t,!0);const s=new Ga,c=new Ga;this._poleSegments=[];for(let h=0,p=0;h<5;h++){const g=1<<h,x=512*g/Math.PI/2,b=360/g;s.emplaceBack(0,-x,0,0,0,.5,0),c.emplaceBack(0,-x,0,0,0,.5,1);for(let S=0;S<=64;S++){const C=S/64,L=Rn(0,b,C),[z,O,U]=Rb(l3,c3,L,x);s.emplaceBack(z,O,U,0,0,C,0),c.emplaceBack(z,O,U,0,0,C,1)}this._poleSegments.push(Ii.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,Db,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Db,!1)}getGridBuffers(o){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[o]]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,t){if(!this._wireframeSegments){const s=new Ri,c=64,h=c+1;this._wireframeSegments=[];for(let p=0,g=0;p<Yu.length;p++){const x=Yu[p];for(let S=0;S<x;S++)for(let C=0;C<c;C++){const L=S*h+C;s.emplaceBack(L,L+1),s.emplaceBack(L,L+h),s.emplaceBack(L,L+h+1)}const b=x*c*3;this._wireframeSegments.push(Ii.simpleSegment(0,g,(x+1)*h,b)),g+=b}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},a.GlyphManager=Zu,a.ImagePosition=e0,a.LineAtlas=_0,a.LngLat=Yn,a.LngLatBounds=$a,a.LocalGlyphMode=r0,a.MAX_MERCATOR_LATITUDE=vs,a.MercatorCoordinate=Nu,a.ONE_EM=cr,a.OverscaledTileID=Cr,a.Properties=Ke,a.RGBAImage=Qr,a.Ray=Uy,a.RequestManager=class{constructor(o,t,s){this._transformRequestFn=o,this._customAccessToken=t,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let t="";for(let s=0;s<10;s++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,t){return this._transformRequestFn&&this._transformRequestFn(o,t)||{url:o}}normalizeStyleURL(o,t){if(!ge(o))return o;const s=Mt(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeGlyphsURL(o,t){if(!ge(o))return o;const s=Mt(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeSourceURL(o,t,s,c){if(!ge(o))return o;const h=Mt(o);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),s&&h.params.push(`language=${s}`),c&&h.params.push(`worldview=${c}`),this._makeAPIURL(h,this._customAccessToken||t)}normalizeSpriteURL(o,t,s,c){const h=Mt(o);return ge(o)?(h.path=`/styles/v1${h.path}/sprite${t}${s}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${t}${s}`,ze(h))}normalizeTileURL(o,t,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ge(o))return o;const c=Mt(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||s&&c.authority!=="raster"&&s===512?"@2x":""}${zi.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${dn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${dn.TILE_URL_VERSION}${c.path}`);const h=this._customAccessToken||function(p){for(const g of p){const x=g.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||dn.ACCESS_TOKEN;return dn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(o,t){const s=Mt(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${dn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${dn.TILE_URL_VERSION}/`,"")}`;let h=s.params;return t&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(o,t){const s=!!t&&ge(t),c=[];for(const h of o.tiles||[])mt(h)?c.push(this.canonicalizeTileURL(h,s)):c.push(h);return c}_makeAPIURL(o,t){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Mt(dn.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,o.protocol==="http"){const h=o.params.indexOf("secure");h>=0&&o.params.splice(h,1)}if(c.path!=="/"&&(o.path=`${c.path}${o.path}`),!dn.REQUIRE_ACCESS_TOKEN)return ze(o);if(t=t||dn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(h=>h.indexOf("access_token")===-1),o.params.push(`access_token=${t||""}`),ze(o)}},a.ResourceType=xe,a.SegmentVector=Ii,a.SourceCache=_c,a.StencilMode=x0,a.StructArrayLayout1ui2=Po,a.StructArrayLayout2f1f2i16=Wn,a.StructArrayLayout2i4=en,a.StructArrayLayout2ui4=Ri,a.StructArrayLayout3f12=Qi,a.StructArrayLayout3ui6=kn,a.StructArrayLayout4i8=Kt,a.StructArrayLayout5f20=ja,a.Texture=gf,a.Tile=g0,a.Transitionable=pe,a.Uniform1f=Cm,a.Uniform1i=class extends Qs{constructor(o,t){super(o,t),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},a.Uniform2f=class extends Qs{constructor(o,t){super(o,t),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},a.Uniform3f=class extends Qs{constructor(o,t){super(o,t),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},a.Uniform4f=dw,a.UniformColor=fw,a.UniformMatrix2f=class extends Qs{constructor(o,t){super(o,t),this.current=gA}set(o){for(let t=0;t<4;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},a.UniformMatrix3f=class extends Qs{constructor(o,t){super(o,t),this.current=_A}set(o){for(let t=0;t<9;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},a.UniformMatrix4f=class extends Qs{constructor(o,t){super(o,t),this.current=mA}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let t=1;t<16;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},a.UnwrappedTileID=Qw,a.ValidationError=Nt,a.VectorTileWorkerSource=class extends Pn{constructor(o,t,s,c,h){super(),this.actor=o,this.layerIndex=t,this.availableImages=s,this.loadVectorData=h||fS,this.loading={},this.loaded={},this.deduped=new dS(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,t){const s=o.uid,c=o&&o.request,h=c&&c.collectResourceTiming,p=this.loading[s]=new z3(o);p.abort=this.loadVectorData(o,(g,x)=>{const b=!this.loading[s];if(delete this.loading[s],b||g||!x)return p.status="done",b||(this.loaded[s]=p),t(g);const S=x.rawData,C={};x.expires&&(C.expires=x.expires),x.cacheControl&&(C.cacheControl=x.cacheControl),p.vectorTile=x.vectorTile||new fc.VectorTile(new lf(S));const L=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,O)=>{if(z||!O)return t(z);const U={};if(h){const X=bn(c);X.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(X)))}t(null,Fe({rawTileData:S.slice(0)},O,C,U))})};this.isSpriteLoaded?L():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):L()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(o,t){const s=this.loaded,c=o.uid,h=this;if(s&&s[c]){const p=s[c];p.showCollisionBoxes=o.showCollisionBoxes,p.enableTerrain=!!o.enableTerrain,p.projection=o.projection,p.tileTransform=mc(o.tileID.canonical,o.projection);const g=(x,b)=>{const S=p.reloadCallback;S&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,S)),t(x,b)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(o,t){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),t()}removeTile(o,t){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],t()}},a.WritingMode=_o,a.ZoomHistory=mm,a.add=Za,a.addDynamicAttributes=s_,a.adjoint=function(o,t){var s=t[0],c=t[1],h=t[2],p=t[3],g=t[4],x=t[5],b=t[6],S=t[7],C=t[8];return o[0]=g*C-x*S,o[1]=h*S-c*C,o[2]=c*x-h*g,o[3]=x*b-p*C,o[4]=s*C-h*b,o[5]=h*p-s*x,o[6]=p*S-g*b,o[7]=c*b-s*S,o[8]=s*g-c*p,o},a.asyncAll=ee,a.bezier=ne,a.bindAll=tt,a.boundsAttributes=Kb,a.bufferConvexPolygon=function(o,t){const s=[];for(let c=0;c<o.length;c++){const h=Te(c-1,-1,o.length-1),p=Te(c+1,-1,o.length-1),g=o[c],x=o[p],b=o[h].sub(g).unit(),S=x.sub(g).unit(),C=S.angleWithSep(b.x,b.y),L=b.add(S).unit().mult(-1*t/Math.sin(C/2));s.push(g.add(L))}return s},a.cacheEntryPossiblyAdded=function(o){ue++,ue>Vs&&(o.getActor().send("enforceCacheSizeLimit",Ki),ue=0)},a.calculateGlobeLabelMatrix=function(o,t){const{x:s,y:c}=o.point,h=Ob(s,c,o.worldSize/o._projectionScaler,0,0);return qa(h,h,Bb(Ms(t)))},a.calculateGlobeMatrix=function(o){const{x:t,y:s}=o.point,{lng:c,lat:h}=o._center;return Ob(t,s,o.worldSize,c,h)},a.calculateGlobeMercatorMatrix=function(o){const t=o.worldSize,s=o.point,c=Lo(1,o.center.lat)*t,h=o.pixelsPerMeter,p=t/(c/o.pixelsPerMeter),g=Jr(new Float64Array(16));return hc(g,g,[s.x,s.y,0]),ws(g,g,[p,p,h]),Float32Array.from(g)},a.circumferenceAtLatitude=Py,a.clamp=K,a.clearTileCache=function(o){const t=[];for(const s in sr)t.push(T.caches.delete(s)),delete sr[s];o&&Promise.all(t).catch(o).then(()=>o())},a.clipLine=Mb,a.clone=function(o){var t=new Kr(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},a.clone$1=Ze,a.collisionCircleLayout=CI,a.config=dn,a.conjugate=function(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o[3]=t[3],o},a.create=function(){var o=new Kr(16);return Kr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},a.create$1=Ew,a.createExpression=qs,a.createLayout=St,a.createStyleLayer=function(o){return o.type==="custom"?new M3(o):new E3[o.type](o)},a.cross=Ny,a.degToRad=F,a.distance=function(o,t){return Math.hypot(t[0]-o[0],t[1]-o[1],t[2]-o[2])},a.div=function(o,t,s){return o[0]=t[0]/s[0],o[1]=t[1]/s[1],o[2]=t[2]/s[2],o},a.dot=Do,a.ease=me,a.easeCubicInOut=$,a.emitValidationErrors=dm,a.endsWith=ct,a.enforceCacheSizeLimit=function(o){for(const t in sr)he(t),sr[t].then(s=>{s.keys().then(c=>{for(let h=0;h<c.length-o;h++)s.delete(c[h])})})},a.evaluateSizeForFeature=Zm,a.evaluateSizeForZoom=Wu,a.evaluateVariableOffset=Ib,a.evented=oe,a.exactEquals=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]},a.exactEquals$1=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]},a.exported=Zn,a.exported$1=zi,a.extend=Fe,a.extend$1=_i,a.fillExtrusionHeightLift=Yw,a.filterObject=Ne,a.fromMat4=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[4],o[4]=t[5],o[5]=t[6],o[6]=t[8],o[7]=t[9],o[8]=t[10],o},a.fromQuat=function(o,t){var s=t[0],c=t[1],h=t[2],p=t[3],g=s+s,x=c+c,b=h+h,S=s*g,C=c*g,L=c*x,z=h*g,O=h*x,U=h*b,X=p*g,se=p*x,de=p*b;return o[0]=1-L-U,o[1]=C+de,o[2]=z-se,o[3]=0,o[4]=C-de,o[5]=1-S-U,o[6]=O+X,o[7]=0,o[8]=z+se,o[9]=O-X,o[10]=1-S-L,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},a.fromRotation=function(o,t){var s=Math.sin(t),c=Math.cos(t);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},a.fromScaling=function(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},a.furthestTileCorner=function(o){const t=Math.round((o+45+360)%360/90)%4;return G[t]},a.getAABBPointSquareDist=function(o,t,s){let c=0;for(let h=0;h<2;++h){const p=s?s[h]:0;o[h]>p&&(c+=(o[h]-p)*(o[h]-p)),t[h]<p&&(c+=(p-t[h])*(p-t[h]))}return c},a.getAnchorAlignment=i0,a.getAnchorJustification=s0,a.getBounds=function(o){let t=1/0,s=1/0,c=-1/0,h=-1/0;for(const p of o)t=Math.min(t,p.x),s=Math.min(s,p.y),c=Math.max(c,p.x),h=Math.max(h,p.y);return{min:new P(t,s),max:new P(c,h)}},a.getColumn=Wt,a.getGridMatrix=function(o,t,s){const[c,h]=t,p=.015625;return[0,(h[1]-c[1])*p,1<<o.z,(h[0]-c[0])/Yu[s],0,o.y,c[0],c[1],p]},a.getImage=At,a.getJSON=function(o,t){return re(Fe(o,{type:"json"}),t)},a.getLatitudinalLod=function(o){const t=80.051129;o=K(o,-80.051129,t)/t*90;const s=Math.pow(Math.abs(Math.sin(F(o))),3);return Math.round(s*(Yu.length-1))},a.getMapSessionAPI=qn,a.getPerformanceMeasurement=bn,a.getProjection=$b,a.getRTLTextPluginStatus=J,a.getReferrer=H,a.getTilePoint=function(o,{x:t,y:s},c=0){return new P(((t-c)*o.scale-o.x)*on,(s*o.scale-o.y)*on)},a.getTileVec3=function(o,t,s=0){return Vu(((t.x-s)*o.scale-o.x)*on,(t.y*o.scale-o.y)*on,_w(t.z,t.y))},a.getVideo=function(o,t){const s=T.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let c=0;c<o.length;c++){const h=T.document.createElement("source");it(o[c])||(s.crossOrigin="Anonymous"),h.src=o[c],s.appendChild(h)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(o){const t=[0,0,0],s=Jr(new Float64Array(16));return qa(s,o.pixelMatrix,o.globeMatrix),lr(t,t,s),new P(t[0],t[1])},a.globeECEFOrigin=function(o,t){const s=[0,0,0];return lr(s,s,df(Ms(t.canonical))),lr(s,s,o),s},a.globeNormalizeECEF=df,a.globePixelsToTileUnits=function(o,t){return on/(512*Math.pow(2,o))*t_(Ms(t))},a.globePoleMatrixForTile=function(o,t,s){const c=Jr(new Float64Array(16)),h=1<<o,p=360*(t/h-.5),g=s.point,x=s.worldSize/(s.tileSize*h);return hc(c,c,[g.x,g.y,-s.worldSize/Math.PI/2]),ws(c,c,[x,x,x]),zm(c,c,F(-s._center.lat)),km(c,c,F(-s._center.lng+p)),Float32Array.from(c)},a.globeTileBounds=Ms,a.globeTileLatLngCorners=u0,a.globeTiltAtLngLat=Nb,a.globeToMercatorTransition=h0,a.globeUseCustomAntiAliasing=function(o,t,s){const c=h0(s.zoom),h=o.style.map._antialias,p=!!t.extStandardDerivatives,g=t.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return c===0&&!h&&!g&&p},a.identity=Jr,a.identity$1=zw,a.invert=function(o,t){var s=t[0],c=t[1],h=t[2],p=t[3],g=t[4],x=t[5],b=t[6],S=t[7],C=t[8],L=t[9],z=t[10],O=t[11],U=t[12],X=t[13],se=t[14],de=t[15],Me=s*x-c*g,be=s*b-h*g,Ie=s*S-p*g,De=c*b-h*x,ke=c*S-p*x,We=h*S-p*b,$e=C*X-L*U,nt=C*se-z*U,ht=C*de-O*U,Oe=L*se-z*X,Qe=L*de-O*X,dt=z*de-O*se,ft=Me*dt-be*Qe+Ie*Oe+De*ht-ke*nt+We*$e;return ft?(o[0]=(x*dt-b*Qe+S*Oe)*(ft=1/ft),o[1]=(h*Qe-c*dt-p*Oe)*ft,o[2]=(X*We-se*ke+de*De)*ft,o[3]=(z*ke-L*We-O*De)*ft,o[4]=(b*ht-g*dt-S*nt)*ft,o[5]=(s*dt-h*ht+p*nt)*ft,o[6]=(se*Ie-U*We-de*be)*ft,o[7]=(C*We-z*Ie+O*be)*ft,o[8]=(g*Qe-x*ht+S*$e)*ft,o[9]=(c*ht-s*Qe-p*$e)*ft,o[10]=(U*ke-X*Ie+de*Me)*ft,o[11]=(L*Ie-C*ke-O*Me)*ft,o[12]=(x*nt-g*Oe-b*$e)*ft,o[13]=(s*Oe-c*nt+h*$e)*ft,o[14]=(X*be-U*De-se*Me)*ft,o[15]=(C*De-L*be+z*Me)*ft,o):null},a.isLngLatBehindGlobe=function(o,t){return Nb(o,t)>Math.PI/2*1.01},a.isMapAuthenticated=function(o){return zn.has(o)},a.isMapboxURL=ge,a.isSafariWithAntialiasingBug=function(o){const t=o.navigator?o.navigator.userAgent:null;return!!fn(o)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Gi,a.len=kA,a.length=Xd,a.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},a.loadVectorTile=fS,a.makeRequest=re,a.mapValue=function(o,t,s,c,h){return K((o-t)/(s-t)*(h-c)+c,c,h)},a.mercatorXfromLng=ac,a.mercatorYfromLat=lc,a.mercatorZfromAltitude=Lo,a.mul=DA,a.mul$1=zA,a.multiply=qa,a.multiply$1=function(o,t,s){var c=t[0],h=t[1],p=t[2],g=t[3],x=t[4],b=t[5],S=t[6],C=t[7],L=t[8],z=s[0],O=s[1],U=s[2],X=s[3],se=s[4],de=s[5],Me=s[6],be=s[7],Ie=s[8];return o[0]=z*c+O*g+U*S,o[1]=z*h+O*x+U*C,o[2]=z*p+O*b+U*L,o[3]=X*c+se*g+de*S,o[4]=X*h+se*x+de*C,o[5]=X*p+se*b+de*L,o[6]=Me*c+be*g+Ie*S,o[7]=Me*h+be*x+Ie*C,o[8]=Me*p+be*b+Ie*L,o},a.multiply$2=Iw,a.nextPowerOfTwo=je,a.normalize=Er,a.normalize$1=function(o,t){var s=t[0],c=t[1],h=t[2],p=t[3],g=s*s+c*c+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),o[0]=s*g,o[1]=c*g,o[2]=h*g,o[3]=p*g,o},a.number=Rn,a.ortho=function(o,t,s,c,h,p,g){var x=1/(t-s),b=1/(c-h),S=1/(p-g);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*b,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(t+s)*x,o[13]=(h+c)*b,o[14]=(g+p)*S,o[15]=1,o},a.pbf=lf,a.perspective=function(o,t,s,c,h){var p,g=1/Math.tan(t/2);return o[0]=g/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=g,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,h!=null&&h!==1/0?(o[10]=(h+c)*(p=1/(c-h)),o[14]=2*h*c*p):(o[10]=-1,o[14]=-2*c),o},a.pick=function(o,t){const s={};for(let c=0;c<t.length;c++){const h=t[c];h in o&&(s[h]=o[h])}return s},a.plugin=Q,a.pointGeometry=P,a.polygonContainsPoint=uc,a.polygonIntersectsBox=Sw,a.polygonIntersectsPolygon=xw,a.polygonizeBounds=function(o,t,s=0,c=!0){const h=new P(s,s),p=o.sub(h),g=t.add(h),x=[p,new P(g.x,p.y),g,new P(p.x,g.y)];return c&&x.push(p.clone()),x},a.posAttributes=hf,a.postMapLoadEvent=Bt,a.postTurnstileEvent=Ht,a.potpack=Qy,a.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},a.radToDeg=B,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(o){return o({pluginStatus:N,pluginURL:j}),oe.on("pluginStateChange",o),o},a.removeAuthState=function(o){zn.delete(o)},a.renderColorRamp=Wy,a.resample=gw,a.rotateX=zm,a.rotateX$1=kw,a.rotateY=km,a.rotateY$1=Rw,a.rotateZ=function(o,t,s){var c=Math.sin(s),h=Math.cos(s),p=t[0],g=t[1],x=t[2],b=t[3],S=t[4],C=t[5],L=t[6],z=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=p*h+S*c,o[1]=g*h+C*c,o[2]=x*h+L*c,o[3]=b*h+z*c,o[4]=S*h-p*c,o[5]=C*h-g*c,o[6]=L*h-x*c,o[7]=z*h-b*c,o},a.rotateZ$1=function(o,t,s){s*=.5;var c=t[0],h=t[1],p=t[2],g=t[3],x=Math.sin(s),b=Math.cos(s);return o[0]=c*b+h*x,o[1]=h*b-c*x,o[2]=p*b+g*x,o[3]=g*b-p*x,o},a.scale=ws,a.scale$1=Lw,a.scale$2=bs,a.scaleAndAdd=Bm,a.setCacheLimits=function(o,t){Ki=o,Vs=t},a.setColumn=function(o,t,s){o[4*t+0]=s[0],o[4*t+1]=s[1],o[4*t+2]=s[2],o[4*t+3]=s[3]},a.setRTLTextPlugin=function(o,t,s=!1){if(N===M||N===E||N===I)throw new Error("setRTLTextPlugin cannot be called multiple times.");j=Zn.resolveURL(o),N=M,R=t,ie(),s||_e()},a.smoothstep=Ee,a.spec=Re,a.storeAuthState=function(o,t){t?zn.add(o):zn.delete(o)},a.sub=zo,a.subtract=Oy,a.symbolSize=AI,a.tileAABB=function(o,t,s,c,h,p,g,x,b){if(b.name==="globe")return a3(o,t,new Hm(s,c,h));const S=mc({z:s,x:c,y:h},b);return new mo([(p+S.x/S.scale)*t,t*(S.y/S.scale),g],[(p+S.x2/S.scale)*t,t*(S.y2/S.scale),x])},a.tileTransform=mc,a.transformMat3=function(o,t,s){var c=t[0],h=t[1],p=t[2];return o[0]=c*s[0]+h*s[3]+p*s[6],o[1]=c*s[1]+h*s[4]+p*s[7],o[2]=c*s[2]+h*s[5]+p*s[8],o},a.transformMat4=lr,a.transformMat4$1=dc,a.transformQuat=Pw,a.translate=hc,a.transpose=function(o,t){if(o===t){var s=t[1],c=t[2],h=t[5];o[1]=t[3],o[2]=t[6],o[3]=s,o[5]=t[7],o[6]=c,o[7]=h}else o[0]=t[0],o[1]=t[3],o[2]=t[6],o[3]=t[1],o[4]=t[4],o[5]=t[7],o[6]=t[2],o[7]=t[5],o[8]=t[8];return o},a.triggerPluginCompletionEvent=Y,a.uniqueId=Pt,a.updateGlobeVertexNormal=function(o,t,s,c,h){const p=5*t+2;o.float32[p+0]=s,o.float32[p+1]=c,o.float32[p+2]=h},a.validateCustomStyleLayer=function(o){const t=[],s=o.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},a.validateFilter=o=>fo(kd(o)),a.validateFog=o=>fo(lm(o)),a.validateLayer=o=>fo(sm(o)),a.validateLight=o=>fo(Rd(o)),a.validateSource=o=>fo(am(o)),a.validateStyle=um,a.validateTerrain=o=>fo(Fd(o)),a.values=Ae,a.vectorTile=fc,a.version=hn,a.warnOnce=et,a.window=T,a.wrap=Te}),_(["./shared"],function(a){function T(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let q="[";for(const ue of he)q+=`${T(ue)},`;return`${q}]`}let V="{";for(const q of Object.keys(he).sort())V+=`${q}:${T(he[q])},`;return`${V}}`}function A(he){let V="";for(const q of a.refProperties)V+=`/${T(he[q])}`;return V}class D{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,q){for(const xe of V)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=a.createStyleLayer(xe)).compileFilter(),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of q)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ue=function(xe,Pe){const H={};for(let te=0;te<xe.length;te++){const ce=Pe&&Pe[xe[te].id]||A(xe[te]);Pe&&(Pe[xe[te].id]=ce);let Ce=H[ce];Ce||(Ce=H[ce]=[]),Ce.push(xe[te])}const re=[];for(const te in H)re.push(H[te]);return re}(a.values(this._layerConfigs),this.keyCache);for(const xe of ue){const Pe=xe.map(it=>this._layers[it.id]),H=Pe[0];if(H.visibility==="none")continue;const re=H.source||"";let te=this.familiesBySource[re];te||(te=this.familiesBySource[re]={});const ce=H.sourceLayer||"_geojsonTileLayer";let Ce=te[ce];Ce||(Ce=te[ce]=[]),Ce.push(Pe)}}}class P{loadTile(V,q){const{uid:ue,encoding:xe,rawImageData:Pe,padding:H,buildQuadTree:re}=V,te=a.window.ImageBitmap&&Pe instanceof a.window.ImageBitmap?this.getImageData(Pe,H):Pe;q(null,new a.DEMData(ue,te,xe,H<1,re))}getImageData(V,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ue=this.offscreenCanvasContext.getImageData(-q,-q,V.width+2*q,V.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}var k=function he(V,q){var ue,xe=V&&V.type;if(xe==="FeatureCollection")for(ue=0;ue<V.features.length;ue++)he(V.features[ue],q);else if(xe==="GeometryCollection")for(ue=0;ue<V.geometries.length;ue++)he(V.geometries[ue],q);else if(xe==="Feature")he(V.geometry,q);else if(xe==="Polygon")W(V.coordinates,q);else if(xe==="MultiPolygon")for(ue=0;ue<V.coordinates.length;ue++)W(V.coordinates[ue],q);return V};function W(he,V){if(he.length!==0){Z(he[0],V);for(var q=1;q<he.length;q++)Z(he[q],!V)}}function Z(he,V){for(var q=0,ue=0,xe=0,Pe=he.length,H=Pe-1;xe<Pe;H=xe++){var re=(he[xe][0]-he[H][0])*(he[H][1]+he[xe][1]),te=q+re;ue+=Math.abs(q)>=Math.abs(re)?q-te+re:re-te+q,q=te}q+ue>=0!=!!V&&he.reverse()}const F=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class B{constructor(V){this._feature=V,this.extent=a.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const q of this._feature.geometry)V.push([new a.pointGeometry(q[0],q[1])]);return V}{const V=[];for(const q of this._feature.geometry){const ue=[];for(const xe of q)ue.push(new a.pointGeometry(xe[0],xe[1]));V.push(ue)}return V}}toGeoJSON(V,q,ue){return F.call(this,V,q,ue)}}class G{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=V.length,this._features=V}feature(V){return new B(this._features[V])}}var $=a.vectorTile.VectorTileFeature,ne=me;function me(he,V){this.options=V||{},this.features=he,this.length=he.length}function K(he,V){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=V||4096}me.prototype.feature=function(he){return new K(this.features[he],this.options.extent)},K.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var V=0;V<he.length;V++){for(var q=he[V],ue=[],xe=0;xe<q.length;xe++)ue.push(new a.pointGeometry(q[xe][0],q[xe][1]));this.geometry.push(ue)}return this.geometry},K.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,V=1/0,q=-1/0,ue=1/0,xe=-1/0,Pe=0;Pe<he.length;Pe++)for(var H=he[Pe],re=0;re<H.length;re++){var te=H[re];V=Math.min(V,te.x),q=Math.max(q,te.x),ue=Math.min(ue,te.y),xe=Math.max(xe,te.y)}return[V,ue,q,xe]},K.prototype.toGeoJSON=$.prototype.toGeoJSON;var Ee=ee,Te=ne;function ee(he){var V=new a.pbf;return function(q,ue){for(var xe in q.layers)ue.writeMessage(3,Ae,q.layers[xe])}(he,V),V.finish()}function Ae(he,V){var q;V.writeVarintField(15,he.version||1),V.writeStringField(1,he.name||""),V.writeVarintField(5,he.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<he.length;q++)ue.feature=he.feature(q),V.writeMessage(2,Fe,ue);var xe=ue.keys;for(q=0;q<xe.length;q++)V.writeStringField(3,xe[q]);var Pe=ue.values;for(q=0;q<Pe.length;q++)V.writeMessage(4,ut,Pe[q])}function Fe(he,V){var q=he.feature;q.id!==void 0&&V.writeVarintField(1,q.id),V.writeMessage(2,qe,he),V.writeVarintField(3,q.type),V.writeMessage(4,je,q)}function qe(he,V){var q=he.feature,ue=he.keys,xe=he.values,Pe=he.keycache,H=he.valuecache;for(var re in q.properties){var te=q.properties[re],ce=Pe[re];if(te!==null){ce===void 0&&(ue.push(re),Pe[re]=ce=ue.length-1),V.writeVarint(ce);var Ce=typeof te;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(te=JSON.stringify(te));var it=Ce+":"+te,Xe=H[it];Xe===void 0&&(xe.push(te),H[it]=Xe=xe.length-1),V.writeVarint(Xe)}}}function Pt(he,V){return(V<<3)+(7&he)}function xt(he){return he<<1^he>>31}function je(he,V){for(var q=he.loadGeometry(),ue=he.type,xe=0,Pe=0,H=q.length,re=0;re<H;re++){var te=q[re],ce=1;ue===1&&(ce=te.length),V.writeVarint(Pt(1,ce));for(var Ce=ue===3?te.length-1:te.length,it=0;it<Ce;it++){it===1&&ue!==1&&V.writeVarint(Pt(2,Ce-1));var Xe=te[it].x-xe,vt=te[it].y-Pe;V.writeVarint(xt(Xe)),V.writeVarint(xt(vt)),xe+=Xe,Pe+=vt}ue===3&&V.writeVarint(Pt(7,1))}}function ut(he,V){var q=typeof he;q==="string"?V.writeStringField(1,he):q==="boolean"?V.writeBooleanField(7,he):q==="number"&&(he%1!=0?V.writeDoubleField(3,he):he<0?V.writeSVarintField(6,he):V.writeVarintField(5,he))}function tt(he,V,q,ue,xe,Pe){if(xe-ue<=q)return;const H=ue+xe>>1;ct(he,V,H,ue,xe,Pe%2),tt(he,V,q,ue,H-1,Pe+1),tt(he,V,q,H+1,xe,Pe+1)}function ct(he,V,q,ue,xe,Pe){for(;xe>ue;){if(xe-ue>600){const ce=xe-ue+1,Ce=q-ue+1,it=Math.log(ce),Xe=.5*Math.exp(2*it/3),vt=.5*Math.sqrt(it*Xe*(ce-Xe)/ce)*(Ce-ce/2<0?-1:1);ct(he,V,q,Math.max(ue,Math.floor(q-Ce*Xe/ce+vt)),Math.min(xe,Math.floor(q+(ce-Ce)*Xe/ce+vt)),Pe)}const H=V[2*q+Pe];let re=ue,te=xe;for(Be(he,V,ue,q),V[2*xe+Pe]>H&&Be(he,V,ue,xe);re<te;){for(Be(he,V,re,te),re++,te--;V[2*re+Pe]<H;)re++;for(;V[2*te+Pe]>H;)te--}V[2*ue+Pe]===H?Be(he,V,ue,te):(te++,Be(he,V,te,xe)),te<=q&&(ue=te+1),q<=te&&(xe=te-1)}}function Be(he,V,q,ue){Ne(he,q,ue),Ne(V,2*q,2*ue),Ne(V,2*q+1,2*ue+1)}function Ne(he,V,q){const ue=he[V];he[V]=he[q],he[q]=ue}function Ze(he,V,q,ue){const xe=he-q,Pe=V-ue;return xe*xe+Pe*Pe}Ee.fromVectorTileJs=ee,Ee.fromGeojsonVt=function(he,V){V=V||{};var q={};for(var ue in he)q[ue]=new ne(he[ue].features,V),q[ue].name=ue,q[ue].version=V.version,q[ue].extent=V.extent;return ee({layers:q})},Ee.GeoJSONWrapper=Te;const pt=he=>he[0],et=he=>he[1];class gt{constructor(V,q=pt,ue=et,xe=64,Pe=Float64Array){this.nodeSize=xe,this.points=V;const H=V.length<65536?Uint16Array:Uint32Array,re=this.ids=new H(V.length),te=this.coords=new Pe(2*V.length);for(let ce=0;ce<V.length;ce++)re[ce]=ce,te[2*ce]=q(V[ce]),te[2*ce+1]=ue(V[ce]);tt(re,te,xe,0,re.length-1,0)}range(V,q,ue,xe){return function(Pe,H,re,te,ce,Ce,it){const Xe=[0,Pe.length-1,0],vt=[];let bt,At;for(;Xe.length;){const Lt=Xe.pop(),$t=Xe.pop(),sn=Xe.pop();if($t-sn<=it){for(let Re=sn;Re<=$t;Re++)bt=H[2*Re],At=H[2*Re+1],bt>=re&&bt<=ce&&At>=te&&At<=Ce&&vt.push(Pe[Re]);continue}const Un=Math.floor((sn+$t)/2);bt=H[2*Un],At=H[2*Un+1],bt>=re&&bt<=ce&&At>=te&&At<=Ce&&vt.push(Pe[Un]);const Pn=(Lt+1)%2;(Lt===0?re<=bt:te<=At)&&(Xe.push(sn),Xe.push(Un-1),Xe.push(Pn)),(Lt===0?ce>=bt:Ce>=At)&&(Xe.push(Un+1),Xe.push($t),Xe.push(Pn))}return vt}(this.ids,this.coords,V,q,ue,xe,this.nodeSize)}within(V,q,ue){return function(xe,Pe,H,re,te,ce){const Ce=[0,xe.length-1,0],it=[],Xe=te*te;for(;Ce.length;){const vt=Ce.pop(),bt=Ce.pop(),At=Ce.pop();if(bt-At<=ce){for(let Pn=At;Pn<=bt;Pn++)Ze(Pe[2*Pn],Pe[2*Pn+1],H,re)<=Xe&&it.push(xe[Pn]);continue}const Lt=Math.floor((At+bt)/2),$t=Pe[2*Lt],sn=Pe[2*Lt+1];Ze($t,sn,H,re)<=Xe&&it.push(xe[Lt]);const Un=(vt+1)%2;(vt===0?H-te<=$t:re-te<=sn)&&(Ce.push(At),Ce.push(Lt-1),Ce.push(Un)),(vt===0?H+te>=$t:re+te>=sn)&&(Ce.push(Lt+1),Ce.push(bt),Ce.push(Un))}return it}(this.ids,this.coords,V,q,ue,this.nodeSize)}}const jt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},Xt=Math.fround||(ot=new Float32Array(1),he=>(ot[0]=+he,ot[0]));var ot;class Tn{constructor(V){this.options=ii(Object.create(jt),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:q,minZoom:ue,maxZoom:xe,nodeSize:Pe}=this.options;q&&console.time("total time");const H=`prepare ${V.length} points`;q&&console.time(H),this.points=V;let re=[];for(let te=0;te<V.length;te++)V[te].geometry&&re.push(pn(V[te],te));this.trees[xe+1]=new gt(re,ui,mi,Pe,Float32Array),q&&console.timeEnd(H);for(let te=xe;te>=ue;te--){const ce=+Date.now();re=this._cluster(re,te),this.trees[te]=new gt(re,ui,mi,Pe,Float32Array),q&&console.log("z%d: %d clusters in %dms",te,re.length,+Date.now()-ce)}return q&&console.timeEnd("total time"),this}getClusters(V,q){let ue=((V[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,V[1]));let Pe=V[2]===180?180:((V[2]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ue=-180,Pe=180;else if(ue>Pe){const Ce=this.getClusters([ue,xe,180,H],q),it=this.getClusters([-180,xe,Pe,H],q);return Ce.concat(it)}const re=this.trees[this._limitZoom(q)],te=re.range(bn(ue),hn(H),bn(Pe),hn(xe)),ce=[];for(const Ce of te){const it=re.points[Ce];ce.push(it.numPoints?Wt(it):this.points[it.index])}return ce}getChildren(V){const q=this._getOriginId(V),ue=this._getOriginZoom(V),xe="No cluster with the specified id.",Pe=this.trees[ue];if(!Pe)throw new Error(xe);const H=Pe.points[q];if(!H)throw new Error(xe);const re=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),te=Pe.within(H.x,H.y,re),ce=[];for(const Ce of te){const it=Pe.points[Ce];it.parentId===V&&ce.push(it.numPoints?Wt(it):this.points[it.index])}if(ce.length===0)throw new Error(xe);return ce}getLeaves(V,q,ue){const xe=[];return this._appendLeaves(xe,V,q=q||10,ue=ue||0,0),xe}getTile(V,q,ue){const xe=this.trees[this._limitZoom(V)],Pe=Math.pow(2,V),{extent:H,radius:re}=this.options,te=re/H,ce=(ue-te)/Pe,Ce=(ue+1+te)/Pe,it={features:[]};return this._addTileFeatures(xe.range((q-te)/Pe,ce,(q+1+te)/Pe,Ce),xe.points,q,ue,Pe,it),q===0&&this._addTileFeatures(xe.range(1-te/Pe,ce,1,Ce),xe.points,Pe,ue,Pe,it),q===Pe-1&&this._addTileFeatures(xe.range(0,ce,te/Pe,Ce),xe.points,-1,ue,Pe,it),it.features.length?it:null}getClusterExpansionZoom(V){let q=this._getOriginZoom(V)-1;for(;q<=this.options.maxZoom;){const ue=this.getChildren(V);if(q++,ue.length!==1)break;V=ue[0].properties.cluster_id}return q}_appendLeaves(V,q,ue,xe,Pe){const H=this.getChildren(q);for(const re of H){const te=re.properties;if(te&&te.cluster?Pe+te.point_count<=xe?Pe+=te.point_count:Pe=this._appendLeaves(V,te.cluster_id,ue,xe,Pe):Pe<xe?Pe++:V.push(re),V.length===ue)break}return Pe}_addTileFeatures(V,q,ue,xe,Pe,H){for(const re of V){const te=q[re],ce=te.numPoints;let Ce,it,Xe;if(ce)Ce=On(te),it=te.x,Xe=te.y;else{const At=this.points[te.index];Ce=At.properties,it=bn(At.geometry.coordinates[0]),Xe=hn(At.geometry.coordinates[1])}const vt={type:1,geometry:[[Math.round(this.options.extent*(it*Pe-ue)),Math.round(this.options.extent*(Xe*Pe-xe))]],tags:Ce};let bt;ce?bt=te.id:this.options.generateId?bt=te.index:this.points[te.index].id&&(bt=this.points[te.index].id),bt!==void 0&&(vt.id=bt),H.features.push(vt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,q){const ue=[],{radius:xe,extent:Pe,reduce:H,minPoints:re}=this.options,te=xe/(Pe*Math.pow(2,q));for(let ce=0;ce<V.length;ce++){const Ce=V[ce];if(Ce.zoom<=q)continue;Ce.zoom=q;const it=this.trees[q+1],Xe=it.within(Ce.x,Ce.y,te),vt=Ce.numPoints||1;let bt=vt;for(const At of Xe){const Lt=it.points[At];Lt.zoom>q&&(bt+=Lt.numPoints||1)}if(bt>vt&&bt>=re){let At=Ce.x*vt,Lt=Ce.y*vt,$t=H&&vt>1?this._map(Ce,!0):null;const sn=(ce<<5)+(q+1)+this.points.length;for(const Un of Xe){const Pn=it.points[Un];if(Pn.zoom<=q)continue;Pn.zoom=q;const Re=Pn.numPoints||1;At+=Pn.x*Re,Lt+=Pn.y*Re,Pn.parentId=sn,H&&($t||($t=this._map(Ce,!0)),H($t,this._map(Pn)))}Ce.parentId=sn,ue.push(fn(At/bt,Lt/bt,sn,bt,$t))}else if(ue.push(Ce),bt>1)for(const At of Xe){const Lt=it.points[At];Lt.zoom<=q||(Lt.zoom=q,ue.push(Lt))}}return ue}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,q){if(V.numPoints)return q?ii({},V.properties):V.properties;const ue=this.points[V.index].properties,xe=this.options.map(ue);return q&&xe===ue?ii({},xe):xe}}function fn(he,V,q,ue,xe){return{x:Xt(he),y:Xt(V),zoom:1/0,id:q,parentId:-1,numPoints:ue,properties:xe}}function pn(he,V){const[q,ue]=he.geometry.coordinates;return{x:Xt(bn(q)),y:Xt(hn(ue)),zoom:1/0,index:V,parentId:-1}}function Wt(he){return{type:"Feature",id:he.id,properties:On(he),geometry:{type:"Point",coordinates:[(V=he.x,360*(V-.5)),an(he.y)]}};var V}function On(he){const V=he.numPoints,q=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return ii(ii({},he.properties),{cluster:!0,cluster_id:he.id,point_count:V,point_count_abbreviated:q})}function bn(he){return he/360+.5}function hn(he){const V=Math.sin(he*Math.PI/180),q=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return q<0?0:q>1?1:q}function an(he){const V=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function ii(he,V){for(const q in V)he[q]=V[q];return he}function ui(he){return he.x}function mi(he){return he.y}function Zn(he,V,q,ue){for(var xe,Pe=ue,H=q-V>>1,re=q-V,te=he[V],ce=he[V+1],Ce=he[q],it=he[q+1],Xe=V+3;Xe<q;Xe+=3){var vt=Nn(he[Xe],he[Xe+1],te,ce,Ce,it);if(vt>Pe)xe=Xe,Pe=vt;else if(vt===Pe){var bt=Math.abs(Xe-H);bt<re&&(xe=Xe,re=bt)}}Pe>ue&&(xe-V>3&&Zn(he,V,xe,ue),he[xe+2]=Pe,q-xe>3&&Zn(he,xe,q,ue))}function Nn(he,V,q,ue,xe,Pe){var H=xe-q,re=Pe-ue;if(H!==0||re!==0){var te=((he-q)*H+(V-ue)*re)/(H*H+re*re);te>1?(q=xe,ue=Pe):te>0&&(q+=H*te,ue+=re*te)}return(H=he-q)*H+(re=V-ue)*re}function dn(he,V,q,ue){var xe={id:he===void 0?null:he,type:V,geometry:q,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var H=Pe.geometry,re=Pe.type;if(re==="Point"||re==="MultiPoint"||re==="LineString")zi(Pe,H);else if(re==="Polygon"||re==="MultiLineString")for(var te=0;te<H.length;te++)zi(Pe,H[te]);else if(re==="MultiPolygon")for(te=0;te<H.length;te++)for(var ce=0;ce<H[te].length;ce++)zi(Pe,H[te][ce])}(xe),xe}function zi(he,V){for(var q=0;q<V.length;q+=3)he.minX=Math.min(he.minX,V[q]),he.minY=Math.min(he.minY,V[q+1]),he.maxX=Math.max(he.maxX,V[q]),he.maxY=Math.max(he.maxY,V[q+1])}function Se(he,V,q,ue){if(V.geometry){var xe=V.geometry.coordinates,Pe=V.geometry.type,H=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),re=[],te=V.id;if(q.promoteId?te=V.properties[q.promoteId]:q.generateId&&(te=ue||0),Pe==="Point")fe(xe,re);else if(Pe==="MultiPoint")for(var ce=0;ce<xe.length;ce++)fe(xe[ce],re);else if(Pe==="LineString")st(xe,re,H,!1);else if(Pe==="MultiLineString"){if(q.lineMetrics){for(ce=0;ce<xe.length;ce++)st(xe[ce],re=[],H,!1),he.push(dn(te,"LineString",re,V.properties));return}Et(xe,re,H,!1)}else if(Pe==="Polygon")Et(xe,re,H,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(ce=0;ce<V.geometry.geometries.length;ce++)Se(he,{id:te,geometry:V.geometry.geometries[ce],properties:V.properties},q,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ce=0;ce<xe.length;ce++){var Ce=[];Et(xe[ce],Ce,H,!0),re.push(Ce)}}he.push(dn(te,Pe,re,V.properties))}}function fe(he,V){V.push(Rt(he[0])),V.push(qt(he[1])),V.push(0)}function st(he,V,q,ue){for(var xe,Pe,H=0,re=0;re<he.length;re++){var te=Rt(he[re][0]),ce=qt(he[re][1]);V.push(te),V.push(ce),V.push(0),re>0&&(H+=ue?(xe*ce-te*Pe)/2:Math.sqrt(Math.pow(te-xe,2)+Math.pow(ce-Pe,2))),xe=te,Pe=ce}var Ce=V.length-3;V[2]=1,Zn(V,0,Ce,q),V[Ce+2]=1,V.size=Math.abs(H),V.start=0,V.end=V.size}function Et(he,V,q,ue){for(var xe=0;xe<he.length;xe++){var Pe=[];st(he[xe],Pe,q,ue),V.push(Pe)}}function Rt(he){return he/360+.5}function qt(he){var V=Math.sin(he*Math.PI/180),q=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return q<0?0:q>1?1:q}function nn(he,V,q,ue,xe,Pe,H,re){if(ue/=V,Pe>=(q/=V)&&H<ue)return he;if(H<q||Pe>=ue)return null;for(var te=[],ce=0;ce<he.length;ce++){var Ce=he[ce],it=Ce.geometry,Xe=Ce.type,vt=xe===0?Ce.minX:Ce.minY,bt=xe===0?Ce.maxX:Ce.maxY;if(vt>=q&&bt<ue)te.push(Ce);else if(!(bt<q||vt>=ue)){var At=[];if(Xe==="Point"||Xe==="MultiPoint")ge(it,At,q,ue,xe);else if(Xe==="LineString")mt(it,At,q,ue,xe,!1,re.lineMetrics);else if(Xe==="MultiLineString")Mt(it,At,q,ue,xe,!1);else if(Xe==="Polygon")Mt(it,At,q,ue,xe,!0);else if(Xe==="MultiPolygon")for(var Lt=0;Lt<it.length;Lt++){var $t=[];Mt(it[Lt],$t,q,ue,xe,!0),$t.length&&At.push($t)}if(At.length){if(re.lineMetrics&&Xe==="LineString"){for(Lt=0;Lt<At.length;Lt++)te.push(dn(Ce.id,Xe,At[Lt],Ce.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(At.length===1?(Xe="LineString",At=At[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=At.length===3?"Point":"MultiPoint"),te.push(dn(Ce.id,Xe,At,Ce.tags))}}}return te.length?te:null}function ge(he,V,q,ue,xe){for(var Pe=0;Pe<he.length;Pe+=3){var H=he[Pe+xe];H>=q&&H<=ue&&(V.push(he[Pe]),V.push(he[Pe+1]),V.push(he[Pe+2]))}}function mt(he,V,q,ue,xe,Pe,H){for(var re,te,ce=Ut(he),Ce=xe===0?Ft:kt,it=he.start,Xe=0;Xe<he.length-3;Xe+=3){var vt=he[Xe],bt=he[Xe+1],At=he[Xe+2],Lt=he[Xe+3],$t=he[Xe+4],sn=xe===0?vt:bt,Un=xe===0?Lt:$t,Pn=!1;H&&(re=Math.sqrt(Math.pow(vt-Lt,2)+Math.pow(bt-$t,2))),sn<q?Un>q&&(te=Ce(ce,vt,bt,Lt,$t,q),H&&(ce.start=it+re*te)):sn>ue?Un<ue&&(te=Ce(ce,vt,bt,Lt,$t,ue),H&&(ce.start=it+re*te)):ze(ce,vt,bt,At),Un<q&&sn>=q&&(te=Ce(ce,vt,bt,Lt,$t,q),Pn=!0),Un>ue&&sn<=ue&&(te=Ce(ce,vt,bt,Lt,$t,ue),Pn=!0),!Pe&&Pn&&(H&&(ce.end=it+re*te),V.push(ce),ce=Ut(he)),H&&(it+=re)}var Re=he.length-3;vt=he[Re],bt=he[Re+1],At=he[Re+2],(sn=xe===0?vt:bt)>=q&&sn<=ue&&ze(ce,vt,bt,At),Re=ce.length-3,Pe&&Re>=3&&(ce[Re]!==ce[0]||ce[Re+1]!==ce[1])&&ze(ce,ce[0],ce[1],ce[2]),ce.length&&V.push(ce)}function Ut(he){var V=[];return V.size=he.size,V.start=he.start,V.end=he.end,V}function Mt(he,V,q,ue,xe,Pe){for(var H=0;H<he.length;H++)mt(he[H],V,q,ue,xe,Pe,!1)}function ze(he,V,q,ue){he.push(V),he.push(q),he.push(ue)}function Ft(he,V,q,ue,xe,Pe){var H=(Pe-V)/(ue-V);return he.push(Pe),he.push(q+(xe-q)*H),he.push(1),H}function kt(he,V,q,ue,xe,Pe){var H=(Pe-q)/(xe-q);return he.push(V+(ue-V)*H),he.push(Pe),he.push(1),H}function un(he,V){for(var q=[],ue=0;ue<he.length;ue++){var xe,Pe=he[ue],H=Pe.type;if(H==="Point"||H==="MultiPoint"||H==="LineString")xe=Ht(Pe.geometry,V);else if(H==="MultiLineString"||H==="Polygon"){xe=[];for(var re=0;re<Pe.geometry.length;re++)xe.push(Ht(Pe.geometry[re],V))}else if(H==="MultiPolygon")for(xe=[],re=0;re<Pe.geometry.length;re++){for(var te=[],ce=0;ce<Pe.geometry[re].length;ce++)te.push(Ht(Pe.geometry[re][ce],V));xe.push(te)}q.push(dn(Pe.id,H,xe,Pe.tags))}return q}function Ht(he,V){var q=[];q.size=he.size,he.start!==void 0&&(q.start=he.start,q.end=he.end);for(var ue=0;ue<he.length;ue+=3)q.push(he[ue]+V,he[ue+1],he[ue+2]);return q}function rn(he,V){if(he.transformed)return he;var q,ue,xe,Pe=1<<he.z,H=he.x,re=he.y;for(q=0;q<he.features.length;q++){var te=he.features[q],ce=te.geometry,Ce=te.type;if(te.geometry=[],Ce===1)for(ue=0;ue<ce.length;ue+=2)te.geometry.push(Bt(ce[ue],ce[ue+1],V,Pe,H,re));else for(ue=0;ue<ce.length;ue++){var it=[];for(xe=0;xe<ce[ue].length;xe+=2)it.push(Bt(ce[ue][xe],ce[ue][xe+1],V,Pe,H,re));te.geometry.push(it)}}return he.transformed=!0,he}function Bt(he,V,q,ue,xe,Pe){return[Math.round(q*(he*ue-xe)),Math.round(q*(V*ue-Pe))]}function mn(he,V,q,ue,xe){for(var Pe=V===xe.maxZoom?0:xe.tolerance/((1<<V)*xe.extent),H={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:ue,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},re=0;re<he.length;re++){H.numFeatures++,qn(H,he[re],Pe,xe);var te=he[re].minX,ce=he[re].minY,Ce=he[re].maxX,it=he[re].maxY;te<H.minX&&(H.minX=te),ce<H.minY&&(H.minY=ce),Ce>H.maxX&&(H.maxX=Ce),it>H.maxY&&(H.maxY=it)}return H}function qn(he,V,q,ue){var xe=V.geometry,Pe=V.type,H=[];if(Pe==="Point"||Pe==="MultiPoint")for(var re=0;re<xe.length;re+=3)H.push(xe[re]),H.push(xe[re+1]),he.numPoints++,he.numSimplified++;else if(Pe==="LineString")zn(H,xe,he,q,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(re=0;re<xe.length;re++)zn(H,xe[re],he,q,Pe==="Polygon",re===0);else if(Pe==="MultiPolygon")for(var te=0;te<xe.length;te++){var ce=xe[te];for(re=0;re<ce.length;re++)zn(H,ce[re],he,q,!0,re===0)}if(H.length){var Ce=V.tags||null;if(Pe==="LineString"&&ue.lineMetrics){for(var it in Ce={},V.tags)Ce[it]=V.tags[it];Ce.mapbox_clip_start=xe.start/xe.size,Ce.mapbox_clip_end=xe.end/xe.size}var Xe={geometry:H,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:Ce};V.id!==null&&(Xe.id=V.id),he.features.push(Xe)}}function zn(he,V,q,ue,xe,Pe){var H=ue*ue;if(ue>0&&V.size<(xe?H:ue))q.numPoints+=V.length/3;else{for(var re=[],te=0;te<V.length;te+=3)(ue===0||V[te+2]>H)&&(q.numSimplified++,re.push(V[te]),re.push(V[te+1])),q.numPoints++;xe&&function(ce,Ce){for(var it=0,Xe=0,vt=ce.length,bt=vt-2;Xe<vt;bt=Xe,Xe+=2)it+=(ce[Xe]-ce[bt])*(ce[Xe+1]+ce[bt+1]);if(it>0===Ce)for(Xe=0,vt=ce.length;Xe<vt/2;Xe+=2){var At=ce[Xe],Lt=ce[Xe+1];ce[Xe]=ce[vt-2-Xe],ce[Xe+1]=ce[vt-1-Xe],ce[vt-2-Xe]=At,ce[vt-1-Xe]=Lt}}(re,Pe),he.push(re)}}function hi(he,V){var q=(V=this.options=function(xe,Pe){for(var H in Pe)xe[H]=Pe[H];return xe}(Object.create(this.options),V)).debug;if(q&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ue=function(xe,Pe){var H=[];if(xe.type==="FeatureCollection")for(var re=0;re<xe.features.length;re++)Se(H,xe.features[re],Pe,re);else Se(H,xe.type==="Feature"?xe:{geometry:xe},Pe);return H}(he,V);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ue=function(xe,Pe){var H=Pe.buffer/Pe.extent,re=xe,te=nn(xe,1,-1-H,H,0,-1,2,Pe),ce=nn(xe,1,1-H,2+H,0,-1,2,Pe);return(te||ce)&&(re=nn(xe,1,-H,1+H,0,-1,2,Pe)||[],te&&(re=un(te,1).concat(re)),ce&&(re=re.concat(un(ce,-1)))),re}(ue,V)).length&&this.splitTile(ue,0,0,0),q&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ki(he,V,q){return 32*((1<<he)*q+V)+he}function Vs(he,V){const q=he.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const ue=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ue)return V(null,null);const xe=new G(ue.features);let Pe=Ee(xe);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),V(null,{vectorTile:xe,rawData:Pe.buffer})}hi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},hi.prototype.splitTile=function(he,V,q,ue,xe,Pe,H){for(var re=[he,V,q,ue],te=this.options,ce=te.debug;re.length;){ue=re.pop(),q=re.pop(),V=re.pop(),he=re.pop();var Ce=1<<V,it=Ki(V,q,ue),Xe=this.tiles[it];if(!Xe&&(ce>1&&console.time("creation"),Xe=this.tiles[it]=mn(he,V,q,ue,te),this.tileCoords.push({z:V,x:q,y:ue}),ce)){ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,q,ue,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var vt="z"+V;this.stats[vt]=(this.stats[vt]||0)+1,this.total++}if(Xe.source=he,xe){if(V===te.maxZoom||V===xe)continue;var bt=1<<xe-V;if(q!==Math.floor(Pe/bt)||ue!==Math.floor(H/bt))continue}else if(V===te.indexMaxZoom||Xe.numPoints<=te.indexMaxPoints)continue;if(Xe.source=null,he.length!==0){ce>1&&console.time("clipping");var At,Lt,$t,sn,Un,Pn,Re=.5*te.buffer/te.extent,_i=.5-Re,cn=.5+Re,Hi=1+Re;At=Lt=$t=sn=null,Un=nn(he,Ce,q-Re,q+cn,0,Xe.minX,Xe.maxX,te),Pn=nn(he,Ce,q+_i,q+Hi,0,Xe.minX,Xe.maxX,te),he=null,Un&&(At=nn(Un,Ce,ue-Re,ue+cn,1,Xe.minY,Xe.maxY,te),Lt=nn(Un,Ce,ue+_i,ue+Hi,1,Xe.minY,Xe.maxY,te),Un=null),Pn&&($t=nn(Pn,Ce,ue-Re,ue+cn,1,Xe.minY,Xe.maxY,te),sn=nn(Pn,Ce,ue+_i,ue+Hi,1,Xe.minY,Xe.maxY,te),Pn=null),ce>1&&console.timeEnd("clipping"),re.push(At||[],V+1,2*q,2*ue),re.push(Lt||[],V+1,2*q,2*ue+1),re.push($t||[],V+1,2*q+1,2*ue),re.push(sn||[],V+1,2*q+1,2*ue+1)}}},hi.prototype.getTile=function(he,V,q){var ue=this.options,xe=ue.extent,Pe=ue.debug;if(he<0||he>24)return null;var H=1<<he,re=Ki(he,V=(V%H+H)%H,q);if(this.tiles[re])return rn(this.tiles[re],xe);Pe>1&&console.log("drilling down to z%d-%d-%d",he,V,q);for(var te,ce=he,Ce=V,it=q;!te&&ce>0;)ce--,Ce=Math.floor(Ce/2),it=Math.floor(it/2),te=this.tiles[Ki(ce,Ce,it)];return te&&te.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",ce,Ce,it),Pe>1&&console.time("drilling down"),this.splitTile(te.source,ce,Ce,it,he,V,q),Pe>1&&console.timeEnd("drilling down"),this.tiles[re]?rn(this.tiles[re],xe):null):null};class sr extends a.VectorTileWorkerSource{constructor(V,q,ue,xe,Pe){super(V,q,ue,xe,Vs),Pe&&(this.loadGeoJSON=Pe)}loadData(V,q){const ue=V&&V.request,xe=ue&&ue.collectResourceTiming;this.loadGeoJSON(V,(Pe,H)=>{if(Pe||!H)return q(Pe);if(typeof H!="object")return q(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{k(H,!0);try{if(V.filter){const te=a.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));const ce=H.features.filter(Ce=>te.value.evaluate({zoom:0},Ce));H={type:"FeatureCollection",features:ce}}this._geoJSONIndex=V.cluster?new Tn(function({superclusterOptions:te,clusterProperties:ce}){if(!ce||!te)return te;const Ce={},it={},Xe={accumulated:null,zoom:0},vt={properties:null},bt=Object.keys(ce);for(const At of bt){const[Lt,$t]=ce[At],sn=a.createExpression($t),Un=a.createExpression(typeof Lt=="string"?[Lt,["accumulated"],["get",At]]:Lt);Ce[At]=sn.value,it[At]=Un.value}return te.map=At=>{vt.properties=At;const Lt={};for(const $t of bt)Lt[$t]=Ce[$t].evaluate(Xe,vt);return Lt},te.reduce=(At,Lt)=>{vt.properties=Lt;for(const $t of bt)Xe.accumulated=At[$t],At[$t]=it[$t].evaluate(Xe,vt)},te}(V)).load(H.features):function(te,ce){return new hi(te,ce)}(H,V.geojsonVtOptions)}catch(te){return q(te)}this.loaded={};const re={};if(xe){const te=a.getPerformanceMeasurement(ue);te&&(re.resourceTiming={},re.resourceTiming[V.source]=JSON.parse(JSON.stringify(te)))}q(null,re)}})}reloadTile(V,q){const ue=this.loaded;return ue&&ue[V.uid]?super.reloadTile(V,q):this.loadTile(V,q)}loadGeoJSON(V,q){if(V.request)a.getJSON(V.request,q);else{if(typeof V.data!="string")return q(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(V.data))}catch{return q(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ue){q(ue)}}getClusterChildren(V,q){try{q(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ue){q(ue)}}getClusterLeaves(V,q){try{q(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ue){q(ue)}}}class Eo{constructor(V){this.self=V,this.actor=new a.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:sr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,ue)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=ue},this.self.registerRTLTextPlugin=q=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=q.applyArabicShaping,a.plugin.processBidirectionalText=q.processBidirectionalText,a.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(V,q,ue){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],ue()}checkIfReady(V,q,ue){ue()}setReferrer(V,q){this.referrer=q}spriteLoaded(V,q){this.isSpriteLoaded[V]=q;for(const ue in this.workerSources[V]){const xe=this.workerSources[V][ue];for(const Pe in xe)xe[Pe]instanceof a.VectorTileWorkerSource&&(xe[Pe].isSpriteLoaded=q,xe[Pe].fire(new a.Event("isSpriteLoaded")))}}setImages(V,q,ue){this.availableImages[V]=q;for(const xe in this.workerSources[V]){const Pe=this.workerSources[V][xe];for(const H in Pe)Pe[H].availableImages=q}ue()}enableTerrain(V,q,ue){this.terrain=q,ue()}setProjection(V,q){this.projections[V]=a.getProjection(q)}setLayers(V,q,ue){this.getLayerIndex(V).replace(q),ue()}updateLayers(V,q,ue){this.getLayerIndex(V).update(q.layers,q.removedIds),ue()}loadTile(V,q,ue){const xe=this.enableTerrain?a.extend({enableTerrain:this.terrain},q):q;xe.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,q.type,q.source).loadTile(xe,ue)}loadDEMTile(V,q,ue){const xe=this.enableTerrain?a.extend({buildQuadTree:this.terrain},q):q;this.getDEMWorkerSource(V,q.source).loadTile(xe,ue)}reloadTile(V,q,ue){const xe=this.enableTerrain?a.extend({enableTerrain:this.terrain},q):q;xe.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,q.type,q.source).reloadTile(xe,ue)}abortTile(V,q,ue){this.getWorkerSource(V,q.type,q.source).abortTile(q,ue)}removeTile(V,q,ue){this.getWorkerSource(V,q.type,q.source).removeTile(q,ue)}removeSource(V,q,ue){if(!this.workerSources[V]||!this.workerSources[V][q.type]||!this.workerSources[V][q.type][q.source])return;const xe=this.workerSources[V][q.type][q.source];delete this.workerSources[V][q.type][q.source],xe.removeSource!==void 0?xe.removeSource(q,ue):ue()}loadWorkerSource(V,q,ue){try{this.self.importScripts(q.url),ue()}catch(xe){ue(xe.toString())}}syncRTLPluginState(V,q,ue){try{a.plugin.setState(q);const xe=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&xe!=null){this.self.importScripts(xe);const Pe=a.plugin.isParsed();ue(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Pe)}}catch(xe){ue(xe.toString())}}getAvailableImages(V){let q=this.availableImages[V];return q||(q=[]),q}getLayerIndex(V){let q=this.layerIndexes[V];return q||(q=this.layerIndexes[V]=new D),q}getWorkerSource(V,q,ue){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][q]||(this.workerSources[V][q]={}),this.workerSources[V][q][ue]||(this.workerSources[V][q][ue]=new this.workerSourceTypes[q]({send:(xe,Pe,H,re,te,ce)=>{this.actor.send(xe,Pe,H,V,te,ce)},scheduler:this.actor.scheduler},this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])),this.workerSources[V][q][ue]}getDEMWorkerSource(V,q){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][q]||(this.demWorkerSources[V][q]=new P),this.demWorkerSources[V][q]}enforceCacheSizeLimit(V,q){a.enforceCacheSizeLimit(q)}getWorkerPerformanceMetrics(V,q,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Eo(self)),Eo}),_(["./shared"],function(a){function T(f,r){if(Array.isArray(f)){if(!Array.isArray(r)||f.length!==r.length)return!1;for(let u=0;u<f.length;u++)if(!T(f[u],r[u]))return!1;return!0}if(typeof f=="object"&&f!==null&&r!==null){if(typeof r!="object"||Object.keys(f).length!==Object.keys(r).length)return!1;for(const u in f)if(!T(f[u],r[u]))return!1;return!0}return f===r}var A=D;function D(f){return!function(r){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,v=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(v);try{y=new Worker(M),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(M),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===m.width}()?(P[u=r&&r.failIfMajorPerformanceCaveat]===void 0&&(P[u]=function(m){var y,v=function(M){var E=document.createElement("canvas"),I=Object.create(D.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=M,E.getContext("webgl",I)||E.getContext("experimental-webgl",I)}(m);if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),v.getShaderParameter(y,v.COMPILE_STATUS)===!0)}(u)),P[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(f)}var P={};function k(f,r,u){const m=a.window.document.createElement(f);return r!==void 0&&(m.className=r),u&&u.appendChild(m),m}function W(f,r,u){const m=a.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(r))m.setAttributeNS(null,y,r[y]);return u&&u.appendChild(m),m}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Z=a.window.document&&a.window.document.documentElement.style,F=Z&&Z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let B;function G(){Z&&F&&(B=Z[F],Z[F]="none")}function $(){Z&&F&&(Z[F]=B)}function ne(f){f.preventDefault(),f.stopPropagation(),a.window.removeEventListener("click",ne,!0)}function me(){a.window.addEventListener("click",ne,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",ne,!0)},0)}function K(f,r){const u=f.getBoundingClientRect();return ee(f,u,r)}function Ee(f,r){const u=f.getBoundingClientRect(),m=[];for(let y=0;y<r.length;y++)m.push(ee(f,u,r[y]));return m}function Te(f){return a.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function ee(f,r,u){const m=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new a.pointGeometry((u.clientX-r.left)*m,(u.clientY-r.top)*m)}function Ae(f,r){var u=r[0],m=r[1],y=r[2],v=r[3],M=u*v-y*m;return M?(f[0]=v*(M=1/M),f[1]=-m*M,f[2]=-y*M,f[3]=u*M,f):null}function Fe(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class qe extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,u){this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,u){if(!r)return!0;let m=0;for(const y of r){if(y[0]<m||y[1]<y[0]||u<y[1])return!1;m=y[1]}return!0}_validateContent(r,u){return!(r&&(r.length!==4||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){u.version=this.images[r].version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let m=!0;if(!this.isLoaded())for(const y of r)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const m={};for(const y of r){this.images[y]||this.fire(new a.Event("styleimagemissing",{id:y}));const v=this.images[y];v?m[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:a.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],m=this.getImage(r);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new a.ImagePosition(y,m);this.patterns[r]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(r,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:u,h:m}=a.potpack(r),y=this.atlasImage;y.resize({width:u||1,height:m||1});for(const v in this.patterns){const{bin:M}=this.patterns[v],E=M.x+1,I=M.y+1,R=this.images[v].data,N=R.width,j=R.height;a.RGBAImage.copy(R,y,{x:0,y:0},{x:E,y:I},{width:N,height:j}),a.RGBAImage.copy(R,y,{x:0,y:j-1},{x:E,y:I-1},{width:N,height:1}),a.RGBAImage.copy(R,y,{x:0,y:0},{x:E,y:I+j},{width:N,height:1}),a.RGBAImage.copy(R,y,{x:N-1,y:0},{x:E-1,y:I},{width:1,height:j}),a.RGBAImage.copy(R,y,{x:0,y:0},{x:E+N,y:I},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];Fe(m)&&this.updateImage(u,m)}}}const Pt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(f,r){return function([u,m,y]){const v=a.degToRad(m+90),M=a.degToRad(y);return{x:u*Math.cos(v)*Math.sin(M),y:u*Math.sin(v)*Math.sin(M),z:u*Math.cos(M),azimuthal:m,polar:y}}(f.expression.evaluate(r))}interpolate(f,r,u){return{x:a.number(f.x,r.x,u),y:a.number(f.y,r.y,u),z:a.number(f.z,r.z,u),azimuthal:a.number(f.azimuthal,r.azimuthal,u),polar:a.number(f.polar,r.polar,u)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),xt="-transition";class je extends a.Evented{constructor(r){super(),this._transitionable=new a.Transitionable(Pt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(a.validateLight,r,u))for(const m in r){const y=r[m];a.endsWith(m,xt)?this._transitionable.setTransition(m.slice(0,-xt.length),y):this._transitionable.setValue(m,y)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||m.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const ut=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),tt="-transition";class ct extends a.Evented{constructor(r,u){super(),this._transitionable=new a.Transitionable(ut),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(r){for(const u in r){const m=r[u];a.endsWith(u,tt)?this._transitionable.setTransition(u.slice(0,-tt.length),m):this._transitionable.setValue(u,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Be(f,r,u,m){const y=a.smoothstep(45,65,u),[v,M]=Ne(f,m),E=a.length(r);let I=1-Math.min(1,Math.exp((E-v)/(M-v)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*f.alpha}function Ne(f,r){const u=.5/Math.tan(.5*r);return[f.range[0]+u,f.range[1]+u]}const Ze=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),pt="-transition";class et extends a.Evented{constructor(r,u){super(),this._transitionable=new a.Transitionable(Ze),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const r=this._transform,u=r.projection.name==="globe",m=a.globeToMercatorTransition(r.zoom),y=this.properties.get("range"),v=[.5,3];return{range:u?[a.number(v[0],y[0],m),a.number(v[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,u={}){if(!this._validate(a.validateFog,r,u)){for(const m of Object.keys(a.spec.fog))r&&r[m]===void 0&&(r[m]=a.spec.fog[m].default);for(const m in r){const y=r[m];a.endsWith(m,pt)?this._transitionable.setTransition(m.slice(0,-pt.length),y):this._transitionable.setValue(m,y)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,r))*u.a}getOpacityAtLatLng(r,u){return this._transform.projection.supportsFog?function(m,y,v){const M=a.MercatorCoordinate.fromLngLat(y),E=v.elevation?v.elevation.getAtPointOrZero(M):0,I=[M.x,M.y,E];return a.transformMat4(I,I,v.mercatorFogMatrix),Be(m,I,v.pitch,v._fov)}(this.state,r,u):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Ne(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||m.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class gt{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const v=new gt.Actor(m[y],u,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,u,m){a.asyncAll(this.actors,(y,v)=>{y.send(r,u,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function jt(f,r,u){return r*(a.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}gt.Actor=a.Actor;class Xt{constructor(r,u,m,y){this.screenBounds=r,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(r,u){let m,y;if(r instanceof a.pointGeometry||typeof r[0]=="number"){const v=a.pointGeometry.convert(r);m=[a.pointGeometry.convert(r)],y=u.isPointAboveHorizon(v)}else{const v=a.pointGeometry.convert(r[0]),M=a.pointGeometry.convert(r[1]);m=[v,M],y=a.polygonizeBounds(v,M).every(E=>u.isPointAboveHorizon(E))}return new Xt(m,u.getCameraPoint(),y,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],y=a.polygonizeBounds(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(y[3]=this.cameraPoint)),a.bufferConvexPolygon(y,r)}bufferedCameraGeometryGlobe(r){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],y=a.polygonizeBounds(u,m,r),v=this.cameraPoint.clone();switch(3*((v.y>u.y)+(v.y>m.y))+((v.x>u.x)+(v.x>m.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(r,u,m,y=0){const v=r.queryPadding/u._projectionScaler+1,M=m?this._bufferedCameraMercator(v,u):this._bufferedScreenMercator(v,u);let E=r.tileID.wrap+(M.unwrapped?y:0);const I=M.polygon.map(_e=>a.getTilePoint(r.tileTransform,_e,E));if(!a.polygonIntersectsBox(I,0,0,a.EXTENT,a.EXTENT))return;E=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const R=this.screenGeometryMercator.polygon.map(_e=>a.getTileVec3(r.tileTransform,_e,E)),N=R.map(_e=>new a.pointGeometry(_e[0],_e[1])),j=u.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),Y=a.getTileVec3(r.tileTransform,j,E),ie=R.map(_e=>{const Q=a.sub(_e,_e,Y);return a.normalize(Q,Q),new a.Ray(Y,Q)}),oe=jt(r,1,u.zoom)*u._projectionScaler;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:ie,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(J=a.getBounds(I),J.min.x=a.clamp(J.min.x,0,a.EXTENT),J.min.y=a.clamp(J.min.y,0,a.EXTENT),J.max.x=a.clamp(J.max.x,0,a.EXTENT),J.max.y=a.clamp(J.max.y,0,a.EXTENT),J),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:oe};var J}_bufferedScreenMercator(r,u){const m=fn(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),u):{polygon:this.bufferedScreenGeometry(r).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(r,u){const m=fn(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),u):{polygon:this.bufferedCameraGeometry(r).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(r,u){const m=function(v,M){const E=a.multiply([],M.pixelMatrix,M.globeMatrix),I=[0,-a.GLOBE_RADIUS,0,1],R=[0,a.GLOBE_RADIUS,0,1],N=[0,0,0,1];a.transformMat4$1(I,I,E),a.transformMat4$1(R,R,E),a.transformMat4$1(N,N,E);const j=new a.pointGeometry(I[0]/I[3],I[1]/I[3]),Y=new a.pointGeometry(R[0]/R[3],R[1]/R[3]),ie=a.polygonContainsPoint(v,j)&&I[3]<N[3],oe=a.polygonContainsPoint(v,Y)&&R[3]<N[3];if(!ie&&!oe)return null;const J=function(Le,Ve,He){for(let Ge=1;Ge<Le.length;Ge++){const Ue=Tn(Ve.pointCoordinate3D(Le[Ge-1]).x),ve=Tn(Ve.pointCoordinate3D(Le[Ge]).x);if(He<0){if(Ue<ve)return{idx:Ge,t:-Ue/(ve-1-Ue)}}else if(ve<Ue)return{idx:Ge,t:(1-Ue)/(ve+1-Ue)}}return null}(v,M,ie?-1:1);if(!J)return null;const{idx:_e,t:Q}=J;let ae=_e>1?ot(v.slice(0,_e),M):[],le=_e<v.length?ot(v.slice(_e),M):[];ae=ae.map(Le=>new a.pointGeometry(Tn(Le.x),Le.y)),le=le.map(Le=>new a.pointGeometry(Tn(Le.x),Le.y));const we=[...ae];we.length===0&&we.push(le[le.length-1]);const pe=a.number(we[we.length-1].y,(le.length===0?ae[0]:le[0]).y,Q);let ye;return ye=ie?[new a.pointGeometry(0,pe),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,pe)]:[new a.pointGeometry(1,pe),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,pe)],we.push(...ye),le.length===0?we.push(ae[0]):we.push(...le),{polygon:we.map(Le=>new a.MercatorCoordinate(Le.x,Le.y)),unwrapped:!1}}(r,u);if(m)return m;const y=function(v,M){let E=!1,I=-1/0,R=0;for(let j=0;j<v.length-1;j++)v[j].x>I&&(I=v[j].x,R=j);for(let j=0;j<v.length-1;j++){const Y=(R+j)%(v.length-1),ie=v[Y],oe=v[Y+1];Math.abs(ie.x-oe.x)>.5&&(ie.x<oe.x?(ie.x+=1,Y===0&&(v[v.length-1].x+=1)):(oe.x+=1,Y+1===v.length-1&&(v[0].x+=1)),E=!0)}const N=a.mercatorXfromLng(M.center.lng);return E&&N<Math.abs(N-1)&&v.forEach(j=>{j.x-=1}),{polygon:v,unwrapped:E}}(ot(r,u).map(v=>new a.pointGeometry(Tn(v.x),v.y)),u);return{polygon:y.polygon.map(v=>new a.MercatorCoordinate(v.x,v.y)),unwrapped:y.unwrapped}}}function ot(f,r){return a.resample(f,u=>{const m=r.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function Tn(f){return f<0?1+f%1:f%1}function fn(f){return 100*f|0}function pn(f,r,u,m,y){const v=function(M,E){if(M)return y(M);if(E){const I=a.pick(a.extend(E,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(I.vectorLayers=E.vector_layers,I.vectorLayerIds=I.vectorLayers.map(R=>R.id)),E.language_options&&(I.languageOptions=E.language_options),E.language&&E.language[E.id]&&(I.language=E.language[E.id]),E.worldview_options&&(I.worldviewOptions=E.worldview_options),E.worldview?I.worldview=E.worldview[E.id]:E.worldview_default&&(I.worldview=E.worldview_default),I.tiles=r.canonicalizeTileset(I,f.url),y(null,I)}};return f.url?a.getJSON(r.transformRequest(r.normalizeSourceURL(f.url,null,u,m),a.ResourceType.Source),v):a.exported.frame(()=>v(null,f))}class Wt{constructor(r,u,m){this.bounds=a.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),m=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*u),y=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*u),v=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*u),M=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=m&&r.x<v&&r.y>=y&&r.y<M}}class On{constructor(r,u,m){this.context=r;const y=r.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hn{constructor(r,u,m,y){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let m=0;m<this.attributes.length;m++){const y=u.attributes[this.attributes[m].name];y!==void 0&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,u,m){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],M=u.attributes[v.name];M!==void 0&&r.vertexAttribPointer(M,v.components,r[bn[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class an{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ii extends an{getDefault(){return a.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ui extends an{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class mi extends an{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Zn extends an{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Nn extends an{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class dn extends an{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class zi extends an{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Se extends an{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class fe extends an{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class st extends an{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Et extends an{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class Rt extends an{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class qt extends an{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class nn extends an{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class ge extends an{getDefault(){return a.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class mt extends an{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Ut extends an{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class Mt extends an{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class ze extends an{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Ft extends an{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class kt extends an{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class un extends an{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ht extends an{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class rn extends an{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Bt extends an{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class mn extends an{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class qn extends an{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class zn extends an{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class hi extends an{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Ki extends an{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Vs extends an{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class sr extends an{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class Eo extends sr{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class he extends sr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class V extends he{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class q{constructor(r,u,m,y){this.context=r,this.width=u,this.height=m;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Eo(r,v),y&&(this.depthAttachment=new he(r,v))}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class ue{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ii(this),this.clearDepth=new ui(this),this.clearStencil=new mi(this),this.colorMask=new Zn(this),this.depthMask=new Nn(this),this.stencilMask=new dn(this),this.stencilFunc=new zi(this),this.stencilOp=new Se(this),this.stencilTest=new fe(this),this.depthRange=new st(this),this.depthTest=new Et(this),this.depthFunc=new Rt(this),this.blend=new qt(this),this.blendFunc=new nn(this),this.blendColor=new ge(this),this.blendEquation=new mt(this),this.cullFace=new Ut(this),this.cullFaceSide=new Mt(this),this.frontFace=new ze(this),this.program=new Ft(this),this.activeTexture=new kt(this),this.viewport=new un(this),this.bindFramebuffer=new Ht(this),this.bindRenderbuffer=new rn(this),this.bindTexture=new Bt(this),this.bindVertexBuffer=new mn(this),this.bindElementBuffer=new qn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new zn(this),this.pixelStoreUnpack=new hi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ki(this),this.pixelStoreUnpackFlipY=new Vs(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new On(this,r,u)}createVertexBuffer(r,u,m){return new hn(this,r,u,m)}createRenderbuffer(r,u,m){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,r,u,m),this.bindRenderbuffer.set(null),v}createFramebuffer(r,u,m){return new q(this,r,u,m)}clear({color:r,depth:u,stencil:m}){const y=this.gl;let v=0;r&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(v)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){T(r.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class xe extends a.Evented{constructor(r,u,m,y){super(),this.id=r,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},u),a.extend(this,a.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pn(this._options,this.map._requestManager,null,null,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):u&&(a.extend(this,u),u.bounds&&(this.tileBounds=new Wt(u.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(u.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const m=a.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=a.getImage(this.map._requestManager.transformRequest(y,a.ResourceType.Tile),(v,M,E,I)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):v?(r.state="errored",u(v)):M?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:I}),r.setTexture(M,this.map.painter),r.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(r,u,m){r.setTexture(u,m)}static unloadTileData(r,u){r.texture&&u.saveTileTexture(r.texture)}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}}let Pe;function H(f,r,u,m,y,v,M,E){const I=[f,u,y,r,m,v,1,1,1],R=[M,E,1],N=a.adjoint([],I),[j,Y,ie]=a.transformMat3(R,R,a.transpose(N,N));return a.multiply$1(I,[j,0,0,0,Y,0,0,0,ie],I)}class re extends a.Evented{constructor(r,u,m,y){super(),this.id=r,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=u}load(r,u){this._loaded=u||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(m,y)=>{if(this._loaded=!0,m)this.fire(new a.ErrorEvent(m));else if(y){const{HTMLImageElement:v}=a.window;this.image=y instanceof v?a.exported.getImageData(y):y,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const u=r.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,v=1/0,M=-1/0,E=-1/0;for(const j of m)y=Math.min(y,j.x),v=Math.min(v,j.y),M=Math.max(M,j.x),E=Math.max(E,j.y);const I=Math.max(M-y,E-v),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),N=Math.pow(2,R);return new a.CanonicalTileID(R,Math.floor((y+M)/2*N),Math.floor((v+E)/2*N))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const I in this.tiles){const R=this.tiles[I];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const u=a.tileTransform(this.tileID,this.map.transform.projection),[m,y,v,M]=this.coordinates.map(I=>{const R=u.projection.project(I[0],I[1]);return a.getTilePoint(u,R)._round()});this.perspectiveTransform=function(I,R,N,j,Y,ie,oe,J,_e,Q){const ae=H(0,0,I,0,0,R,I,R),le=H(N,j,Y,ie,oe,J,_e,Q);return a.multiply$1(le,a.adjoint(ae,ae),le),[le[6]/le[8]*I/a.EXTENT,le[7]/le[8]*R/a.EXTENT]}(this.width,this.height,m.x,m.y,y.x,y.y,M.x,M.y,v.x,v.y);const E=this._boundsArray=new a.StructArrayLayout4i8;E.emplaceBack(m.x,m.y,0,0),E.emplaceBack(y.x,y.y,a.EXTENT,0),E.emplaceBack(M.x,M.y,0,a.EXTENT),E.emplaceBack(v.x,v.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(E,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,u=r.gl;this.texture?this.texture.update(this.image):(this.texture=new a.Texture(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const te={vector:class extends a.Evented{constructor(f,r,u,m){if(super(),this.id=f,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(r,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(f){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,u=this.worldview||this.map._worldview;this._tileJSONRequest=pn(this._options,this.map._requestManager,r,u,(m,y)=>{this._tileJSONRequest=null,this._loaded=!0,m?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new a.ErrorEvent(m))):y&&(a.extend(this,y),y.bounds&&(this.tileBounds=new Wt(y.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(y.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(m)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const u of r)u.clearTiles()})}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}_setLanguage(f){return f===this.language||this.setSourceProperty(()=>{this.language=f}),this}_setWorldview(f){return f===this.worldview?this:this.worldviewOptions&&f&&!this.worldviewOptions[f]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${f}".`),this):(this.setSourceProperty(()=>{this.worldview=f}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(f,r){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,a.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired")f.state==="loading"?f.reloadCallback=r:f.request=f.actor.send("reloadTile",m,y.bind(this));else if(f.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",m,y.bind(this),void 0,!0);else{const v=a.loadVectorTile.call({deduped:this._deduped},m,(M,E)=>{M||!E?y.call(this,M):(m.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},f.actor&&f.actor.send("loadTile",m,y.bind(this),void 0,!0))},!0);f.request={cancel:v}}function y(v,M){return delete f.request,f.aborted?r(null):v&&v.status!==404?r(v):(M&&M.resourceTiming&&(f.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&f.setExpiryData(M),f.loadVectorData(M,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:xe,"raster-dem":class extends xe{constructor(f,r,u,m){super(f,r,u,m),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,v){y&&(f.state="errored",r(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=a.getImage(this.map._requestManager.transformRequest(u,a.ResourceType.Tile),function(y,v,M,E){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(y)f.state="errored",r(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:M,expires:E});const I=a.window.ImageBitmap&&v instanceof a.window.ImageBitmap&&(Pe==null&&(Pe=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),Pe),R=1-(v.width-a.prevPowerOfTwo(v.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const N=I?v:a.exported.getImageData(v,R),j={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:R};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",j,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const r=f.canonical,u=Math.pow(2,r.z),m=(r.x-1+u)%u,y=r.x===0?f.wrap-1:f.wrap,v=(r.x+1+u)%u,M=r.x+1===u?f.wrap+1:f.wrap,E={};return E[new a.OverscaledTileID(f.overscaledZ,y,r.z,m,r.y).key]={backfilled:!1},E[new a.OverscaledTileID(f.overscaledZ,M,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(E[new a.OverscaledTileID(f.overscaledZ,y,r.z,m,r.y-1).key]={backfilled:!1},E[new a.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new a.OverscaledTileID(f.overscaledZ,M,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<u&&(E[new a.OverscaledTileID(f.overscaledZ,y,r.z,m,r.y+1).key]={backfilled:!1},E[new a.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new a.OverscaledTileID(f.overscaledZ,M,r.z,v,r.y+1).key]={backfilled:!1}),E}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends a.Evented{constructor(f,r,u,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=r.data,this._options=a.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*y,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*y,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},r),this}getClusterLeaves(f,r,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:r,offset:u},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=a.extend({},this.workerOptions),r=this._data;typeof r=="string"?(f.request=this.map._requestManager.transformRequest(a.exported.resolveURL(r),a.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new a.ErrorEvent(u));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new a.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,r){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete f.request,f.unloadVectorData(),f.aborted?r(null):m?r(m):(f.loadVectorData(y,this.map.painter,u==="reloadTile"),r(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends re{constructor(f,r,u,m){super(f,r,u,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,a.ResourceType.Source).url);a.getVideo(this.urls,(r,u)=>{this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(f,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:re,canvas:class extends re{constructor(f,r,u,m){super(f,r,u,m),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends a.Evented{constructor(f,r,u,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Wt(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:u,z:m}=f.canonical;return this._implementation.hasTile({x:r,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:u,y:m,z:y}=f.tileID.canonical,v=new a.window.AbortController,M=this._implementation.loadTile({x:u,y:m,z:y},{signal:v.signal});if(!M)return this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null);M.cancel=()=>v.abort(),f.request=M.then(function(E){return delete f.request,f.aborted?(f.state="unloaded",r(null)):E?function(I){return I instanceof a.window.ImageData||I instanceof a.window.ImageBitmap||I instanceof a.window.HTMLCanvasElement}(E)?(this.loadTileData(f,E),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null))}.bind(this)).catch(E=>{E.code!==20&&(f.state="errored",r(E))})}loadTileData(f,r){xe.loadTileData(f,r,this._map.painter)}unloadTileData(f){xe.unloadTileData(f,this._map.painter)}prepareTile(f){if(!this._implementation.prepareTile)return null;const{x:r,y:u,z:m}=f.tileID.canonical,y=this._implementation.prepareTile({x:r,y:u,z:m});return y?(this.loadTileData(f,y),f.state="loaded",y):null}unloadTile(f,r){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:u,y:m,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:y})}r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ce=function(f,r,u,m){const y=new te[r.type](f,r,u,m);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Ce(f,r){const u=a.identity([]);return a.scale(u,u,[.5*f.width,.5*-f.height,1]),a.translate(u,u,[1,-1,0]),a.multiply(u,u,f.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(u)}function it(f,r,u,m,y,v,M,E=!1){const I=f.tilesIn(m,M,E);I.sort(vt);const R=[];for(const j of I)R.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(r,u,f._state,j,y,v,Ce(f.transform,j.tile.tileID),E)});const N=function(j){const Y={},ie={};for(const oe of j){const J=oe.queryResults,_e=oe.wrappedTileID,Q=ie[_e]=ie[_e]||{};for(const ae in J){const le=J[ae],we=Q[ae]=Q[ae]||{},pe=Y[ae]=Y[ae]||[];for(const ye of le)we[ye.featureIndex]||(we[ye.featureIndex]=!0,pe.push(ye))}}return Y}(R);for(const j in N)N[j].forEach(Y=>{const ie=Y.feature,oe=ie.layer;oe&&oe.type!=="background"&&oe.type!=="sky"&&(ie.source=oe.source,oe["source-layer"]&&(ie.sourceLayer=oe["source-layer"]),ie.state=ie.id!==void 0?f.getFeatureState(oe["source-layer"],ie.id):{})});return N}function Xe(f,r){const u=f.getRenderableIds().map(v=>f.getTileByID(v)),m=[],y={};for(let v=0;v<u.length;v++){const M=u[v],E=M.tileID.canonical.key;y[E]||(y[E]=!0,M.querySourceFeatures(m,r))}return m}function vt(f,r){const u=f.tileID,m=r.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function bt(){return Bu.workerClass!=null?new Bu.workerClass:new a.window.Worker(Bu.workerUrl)}const At="mapboxgl_preloaded_worker_pool";class Lt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Lt.workerCount;)this.workers.push(new bt);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[At]}numActive(){return Object.keys(this.active).length}}let $t;function sn(){return $t||($t=new Lt),$t}function Un(f,r){const u={};for(const m in f)m!=="ref"&&(u[m]=f[m]);return a.refProperties.forEach(m=>{m in r&&(u[m]=r[m])}),u}function Pn(f){f=f.slice();const r=Object.create(null);for(let u=0;u<f.length;u++)r[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=Un(f[u],r[f[u].ref]));return f}Lt.workerCount=2;const Re={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function _i(f,r,u){u.push({command:Re.addSource,args:[f,r[f]]})}function cn(f,r,u){r.push({command:Re.removeSource,args:[f]}),u[f]=!0}function Hi(f,r,u,m){cn(f,u,m),_i(f,r,u)}function Ei(f,r,u){let m;for(m in f[u])if(f[u].hasOwnProperty(m)&&m!=="data"&&!T(f[u][m],r[u][m]))return!1;for(m in r[u])if(r[u].hasOwnProperty(m)&&m!=="data"&&!T(f[u][m],r[u][m]))return!1;return!0}function gi(f,r,u,m,y,v){let M;for(M in r=r||{},f=f||{})f.hasOwnProperty(M)&&(T(f[M],r[M])||u.push({command:v,args:[m,M,r[M],y]}));for(M in r)r.hasOwnProperty(M)&&!f.hasOwnProperty(M)&&(T(f[M],r[M])||u.push({command:v,args:[m,M,r[M],y]}))}function Fr(f){return f.id}function _s(f,r){return f[r.id]=r,f}class Wo{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.clamp(r,0,1);let u=1,m=this._distances[u];const y=r*this.paddedLength+this.padding;for(;m<y&&u<this._distances.length;)m=this._distances[++u];const v=u-1,M=this._distances[v],E=m-M,I=E>0?(y-M)/E:0;return this.points[v].mult(1-I).add(this.points[u].mult(I))}}class wt{constructor(r,u,m){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(u/m);for(let M=0;M<this.xCellCount*this.yCellCount;M++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,m,y,v){this._forEachCell(u,m,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(r,u,m,y){this._forEachCell(u-y,m-y,u+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(m),this.circles.push(y)}_insertBoxCell(r,u,m,y,v,M){this.boxCells[v].push(M)}_insertCircleCell(r,u,m,y,v,M){this.circleCells[v].push(M)}_query(r,u,m,y,v,M){if(m<0||r>this.width||y<0||u>this.height)return!v&&[];const E=[];if(r<=0&&u<=0&&this.width<=m&&this.height<=y){if(v)return!0;for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const R=this.circles[3*I],N=this.circles[3*I+1],j=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:R-j,y1:N-j,x2:R+j,y2:N+j})}return M?E.filter(M):E}return this._forEachCell(r,u,m,y,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},M),v?E.length>0:E}_queryCircle(r,u,m,y,v){const M=r-m,E=r+m,I=u-m,R=u+m;if(E<0||M>this.width||R<0||I>this.height)return!y&&[];const N=[];return this._forEachCell(M,I,E,R,this._queryCellCircle,N,{hitTest:y,circle:{x:r,y:u,radius:m},seenUids:{box:{},circle:{}}},v),y?N.length>0:N}query(r,u,m,y,v){return this._query(r,u,m,y,!1,v)}hitTest(r,u,m,y,v){return this._query(r,u,m,y,!0,v)}hitTestCircle(r,u,m,y){return this._queryCircle(r,u,m,!0,y)}_queryCell(r,u,m,y,v,M,E,I){const R=E.seenUids,N=this.boxCells[v];if(N!==null){const Y=this.bboxes;for(const ie of N)if(!R.box[ie]){R.box[ie]=!0;const oe=4*ie;if(r<=Y[oe+2]&&u<=Y[oe+3]&&m>=Y[oe+0]&&y>=Y[oe+1]&&(!I||I(this.boxKeys[ie]))){if(E.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[ie],x1:Y[oe],y1:Y[oe+1],x2:Y[oe+2],y2:Y[oe+3]})}}}const j=this.circleCells[v];if(j!==null){const Y=this.circles;for(const ie of j)if(!R.circle[ie]){R.circle[ie]=!0;const oe=3*ie;if(this._circleAndRectCollide(Y[oe],Y[oe+1],Y[oe+2],r,u,m,y)&&(!I||I(this.circleKeys[ie]))){if(E.hitTest)return M.push(!0),!0;{const J=Y[oe],_e=Y[oe+1],Q=Y[oe+2];M.push({key:this.circleKeys[ie],x1:J-Q,y1:_e-Q,x2:J+Q,y2:_e+Q})}}}}}_queryCellCircle(r,u,m,y,v,M,E,I){const R=E.circle,N=E.seenUids,j=this.boxCells[v];if(j!==null){const ie=this.bboxes;for(const oe of j)if(!N.box[oe]){N.box[oe]=!0;const J=4*oe;if(this._circleAndRectCollide(R.x,R.y,R.radius,ie[J+0],ie[J+1],ie[J+2],ie[J+3])&&(!I||I(this.boxKeys[oe])))return M.push(!0),!0}}const Y=this.circleCells[v];if(Y!==null){const ie=this.circles;for(const oe of Y)if(!N.circle[oe]){N.circle[oe]=!0;const J=3*oe;if(this._circlesCollide(ie[J],ie[J+1],ie[J+2],R.x,R.y,R.radius)&&(!I||I(this.circleKeys[oe])))return M.push(!0),!0}}}_forEachCell(r,u,m,y,v,M,E,I){const R=this._convertToXCellCoord(r),N=this._convertToYCellCoord(u),j=this._convertToXCellCoord(m),Y=this._convertToYCellCoord(y);for(let ie=R;ie<=j;ie++)for(let oe=N;oe<=Y;oe++)if(v.call(this,r,u,m,y,this.xCellCount*oe+ie,M,E,I))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,m,y,v,M){const E=y-r,I=v-u,R=m+M;return R*R>E*E+I*I}_circleAndRectCollide(r,u,m,y,v,M,E){const I=(M-y)/2,R=Math.abs(r-(y+I));if(R>I+m)return!1;const N=(E-v)/2,j=Math.abs(u-(v+N));if(j>N+m)return!1;if(R<=I||j<=N)return!0;const Y=R-I,ie=j-N;return Y*Y+ie*ie<=m*m}}const Sn=Math.tan(85*Math.PI/180);function _n(f,r,u,m,y,v,M){const E=a.create();if(u)if(v.name==="globe"){const I=a.calculateGlobeLabelMatrix(y,r);a.multiply(E,E,I)}else{const I=Ae([],M);E[0]=I[0],E[1]=I[1],E[4]=I[2],E[5]=I[3],m||a.rotateZ(E,E,y.angle)}else a.multiply(E,y.labelPlaneMatrix,f);return E}function Ci(f,r,u,m,y,v,M){const E=_n(f,r,u,m,y,v,M);return v.name==="globe"&&u||(E[2]=E[6]=E[10]=E[14]=0),E}function Gs(f,r,u,m,y,v,M){if(u){if(v.name==="globe"){const E=_n(f,r,u,m,y,v,M);return a.invert(E,E),a.multiply(E,f,E),E}{const E=a.clone(f),I=a.identity([]);return I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],a.multiply(E,E,I),m||a.rotateZ(E,E,-y.angle),E}}return y.glCoordMatrix}function xn(f,r,u=0){const m=[f.x,f.y,u,1];u?a.transformMat4$1(m,m,r):vi(m,m,r);const y=m[3];return{point:[m[0]/y,m[1]/y,m[2]/y],signedDistanceFromCamera:y}}function Ho(f,r){const u=[f[0],f[1],f[2],1];a.transformMat4$1(u,u,r);const m=u[3];return{point:[u[0]/m,u[1]/m,u[2]/m],signedDistanceFromCamera:m}}function Ta(f,r){return Math.min(.5+f/r*.5,1.5)}function Fl(f,r){const u=f[0]/f[3],m=f[1]/f[3];return u>=-r[0]&&u<=r[0]&&m>=-r[1]&&m<=r[1]}function $r(f,r,u,m,y,v,M,E,I,R){const N=u.transform,j=m?f.textSizeData:f.iconSizeData,Y=a.evaluateSizeForZoom(j,u.transform.zoom),ie=N.projection.name==="globe",oe=[256/u.width*2+1,256/u.height*2+1],J=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;J.clear();let _e=null;ie&&(_e=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Q=f.lineVertexArray,ae=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,le=u.transform.width/u.transform.height;let we=!1;for(let pe=0;pe<ae.length;pe++){const ye=ae.get(pe);if(ye.writingMode!==a.WritingMode.vertical||we||pe!==0&&ae.get(pe-1).writingMode===a.WritingMode.horizontal||(we=!0),(ye.hidden||ye.writingMode===a.WritingMode.vertical)&&!we){Vi(ye.numGlyphs,J);continue}we=!1;const Le=new a.pointGeometry(ye.tileAnchorX,ye.tileAnchorY),Ve=I?I(Le):[0,0,0],He=N.projection.projectTilePoint(Le.x,Le.y,R.canonical),Ge=[He.x+Ve[0],He.y+Ve[1],He.z+Ve[2]],Ue=[...Ge,1];if(a.transformMat4$1(Ue,Ue,r),!Fl(Ue,oe)){Vi(ye.numGlyphs,J);continue}const ve=Ta(u.transform.cameraToCenterDistance,Ue[3]),at=a.evaluateSizeForFeature(j,Y,ye),rt=M?at/ve:at*ve,It=xn(new a.pointGeometry(Ge[0],Ge[1]),y,Ge[2]);if(It.signedDistanceFromCamera<=0){Vi(ye.numGlyphs,J);continue}let Ke={};const Jt=M?null:I,Ct=Ea(ye,rt,!1,E,r,y,v,f.glyphOffsetArray,Q,J,_e,It.point,Le,Ke,le,Jt,N.projection,R,M);we=Ct.useVertical,Jt&&Ct.needsFlipping&&(Ke={}),(Ct.notEnoughRoom||we||Ct.needsFlipping&&Ea(ye,rt,!0,E,r,y,v,f.glyphOffsetArray,Q,J,_e,It.point,Le,Ke,le,Jt,N.projection,R,M).notEnoughRoom)&&Vi(ye.numGlyphs,J)}m?(f.text.dynamicLayoutVertexBuffer.updateData(J),_e&&f.text.globeExtVertexBuffer.updateData(_e)):(f.icon.dynamicLayoutVertexBuffer.updateData(J),_e&&f.icon.globeExtVertexBuffer.updateData(_e))}function di(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J){const _e=E.glyphStartIndex+E.numGlyphs,Q=E.lineStartIndex,ae=E.lineStartIndex+E.lineLength,le=r.getoffsetX(E.glyphStartIndex),we=r.getoffsetX(_e-1),pe=Aa(f*le,u,m,y,v,M,E.segment,Q,ae,I,R,N,j,Y,!0,ie,oe,J);if(!pe)return null;const ye=Aa(f*we,u,m,y,v,M,E.segment,Q,ae,I,R,N,j,Y,!0,ie,oe,J);return ye?{first:pe,last:ye}:null}function zp(f,r,u,m){return f.writingMode===a.WritingMode.horizontal&&Math.abs(u.y-r.y)>Math.abs(u.x-r.x)*m?{useVertical:!0}:f.writingMode===a.WritingMode.vertical?r.y<u.y?{needsFlipping:!0}:null:f.flipState!==0&&function(y,v,M){const E=(v.x-y.x)*M;return E===0||Math.abs((v.y-y.y)/E)>Sn}(r,u,m)?f.flipState===1?{needsFlipping:!0}:null:r.x>u.x?{needsFlipping:!0}:null}function Ea(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J,_e,Q,ae){const le=r/24,we=f.lineOffsetX*le,pe=f.lineOffsetY*le;let ye;if(f.numGlyphs>1){const Le=f.glyphStartIndex+f.numGlyphs,Ve=f.lineStartIndex,He=f.lineStartIndex+f.lineLength,Ge=di(le,E,we,pe,u,j,Y,f,I,v,ie,J,!1,_e,Q,ae);if(!Ge)return{notEnoughRoom:!0};const Ue=Ho(Ge.first.point,M).point,ve=Ho(Ge.last.point,M).point,at=new a.pointGeometry(Ue[0],Ue[1]),rt=new a.pointGeometry(ve[0],ve[1]);if(m&&!u){const It=zp(f,at,rt,oe);if(f.flipState=It&&It.needsFlipping?1:2,It)return It}ye=[Ge.first];for(let It=f.glyphStartIndex+1;It<Le-1;It++)ye.push(Aa(le*E.getoffsetX(It),we,pe,u,j,Y,f.segment,Ve,He,I,v,ie,J,!1,!1,_e,Q,ae));ye.push(Ge.last)}else{if(m&&!u){const Ve=xn(Y,y).point,He=f.lineStartIndex+f.segment+1,Ge=new a.pointGeometry(I.getx(He),I.gety(He)),Ue=xn(Ge,y),ve=Ue.signedDistanceFromCamera>0?Ue.point:Ca(Y,Ge,Ve,1,y,void 0,_e,Q.canonical),at=zp(f,new a.pointGeometry(Ve[0],Ve[1]),new a.pointGeometry(ve[0],ve[1]),oe);if(f.flipState=at&&at.needsFlipping?1:2,at)return at}const Le=Aa(le*E.getoffsetX(f.glyphStartIndex),we,pe,u,j,Y,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,I,v,ie,J,!1,!1,_e,Q,ae);if(!Le)return{notEnoughRoom:!0};ye=[Le]}if(N)for(const Le of ye)a.updateGlobeVertexNormal(N,R.length+0,Le.up[0],Le.up[1],Le.up[2]),a.updateGlobeVertexNormal(N,R.length+1,Le.up[0],Le.up[1],Le.up[2]),a.updateGlobeVertexNormal(N,R.length+2,Le.up[0],Le.up[1],Le.up[2]),a.updateGlobeVertexNormal(N,R.length+3,Le.up[0],Le.up[1],Le.up[2]),a.addDynamicAttributes(R,Le.point[0],Le.point[1],Le.point[2],Le.angle);else for(const Le of ye)a.addDynamicAttributes(R,Le.point[0],Le.point[1],Le.point[2],Le.angle);return{}}function Jc(f,r,u,m,y){const v=m.projectTilePoint(f.x,f.y,r);if(!y)return xn(v,u,v.z);const M=y(f);return xn(new a.pointGeometry(v.x+M[0],v.y+M[1]),u,v.z+M[2])}function Ca(f,r,u,m,y,v,M,E){const I=Jc(f.add(f.sub(r)._unit()),E,y,M,v).point,R=a.sub([],u,I);return a.scaleAndAdd([],u,R,m/a.length(R))}function Aa(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J,_e,Q){const ae=m?f-r:f+r;let le=ae>0?1:-1,we=0;m&&(le*=-1,we=Math.PI),le<0&&(we+=Math.PI);let pe=le>0?E+M:E+M+1,ye=y,Le=y,Ve=0,He=0;const Ge=Math.abs(ae),Ue=[],ve=[];let at=v;const rt=()=>{const Kt=pe-le;return Ve===0?v:new a.pointGeometry(R.getx(Kt),R.gety(Kt))},It=()=>Ca(rt(),at,Le,Ge-Ve+1,N,Y,J,_e.canonical);for(;Ve+He<=Ge;){if(pe+=le,pe<E||pe>=I)return null;if(Le=ye,Ue.push(ye),ie&&ve.push(at||rt()),ye=j[pe],ye===void 0){at=new a.pointGeometry(R.getx(pe),R.gety(pe));const Kt=Jc(at,_e.canonical,N,J,Y);ye=Kt.signedDistanceFromCamera>0?j[pe]=Kt.point:It()}else at=null;Ve+=He,He=a.distance(Le,ye)}at=at||new a.pointGeometry(R.getx(pe),R.gety(pe));const Ke=rt();oe&&Y&&(j[pe]=ye=j[pe]===void 0?ye:It(),He=a.distance(Le,ye));const Jt=(Ge-Ve)/He,Ct=at.sub(Ke).mult(Jt)._add(Ke),Tt=a.sub([],ye,Le),_t=a.scaleAndAdd([],Le,Tt,Jt);let St=[0,0,1],ln=Tt[0],en=Tt[1];if(Q&&(St=J.upVector(_e.canonical,Ct.x,Ct.y),St[0]!==0||St[1]!==0||St[2]!==1)){const Kt=[1,0,0],gn=[0,1,0];Kt[0]=St[2],Kt[1]=0,Kt[2]=-St[0],a.cross(gn,St,Kt),a.normalize(Kt,Kt),a.normalize(gn,gn),ln=a.dot(Tt,Kt),en=a.dot(Tt,gn)}if(u){const Kt=a.cross([],St,Tt);a.normalize(Kt,Kt),a.scaleAndAdd(_t,_t,Kt,u*le)}const vn=we+Math.atan2(en,ln);return Ue.push(_t),ie&&ve.push(Ct),{point:_t,angle:vn,path:Ue,tilePath:ve,up:St}}const kp=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Vi(f,r){for(let u=0;u<f;u++){const m=r.length;r.resize(m+4),r.float32.set(kp,4*m)}}function vi(f,r,u){const m=r[0],y=r[1];return f[0]=u[0]*m+u[4]*y+u[12],f[1]=u[1]*m+u[5]*y+u[13],f[3]=u[3]*m+u[7]*y+u[15],f}const qr=100;class ad{constructor(r,u,m=new wt(r.width+200,r.height+200,25),y=new wt(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+qr,this.screenBottomBoundary=r.height+qr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=u}placeCollisionBox(r,u,m,y,v,M,E,I){let R=m.projectedAnchorX,N=m.projectedAnchorY,j=m.projectedAnchorZ;const Y=m.elevation,ie=m.tileID;if(Y&&ie){const pe=r.getProjection().upVector(ie.canonical,m.tileAnchorX,m.tileAnchorY),ye=r.getProjection().upVectorScale(ie.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=pe[0]*Y*ye,N+=pe[1]*Y*ye,j+=pe[2]*Y*ye}const oe=this.projectAndGetPerspectiveRatio(E,[R,N,j],m.tileID,r.projection.name==="globe"||!!Y||this.transform.pitch>0,r.getProjection()),J=M*oe.perspectiveRatio,_e=(m.x1*u+y.x-m.padding)*J+oe.point.x,Q=(m.y1*u+y.y-m.padding)*J+oe.point.y,ae=(m.x2*u+y.x+m.padding)*J+oe.point.x,le=(m.y2*u+y.y+m.padding)*J+oe.point.y,we=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(_e,Q,ae,le)||!v&&this.grid.hitTest(_e,Q,ae,le,I)||we?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[_e,Q,ae,le],offscreen:this.isOffscreen(_e,Q,ae,le),occluded:!1}}placeCollisionCircles(r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J){const _e=[],Q=this.transform.elevation,ae=Q?Q.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,r.getProjection()):Ke=>[0,0,0],le=new a.pointGeometry(m.tileAnchorX,m.tileAnchorY),we=r.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,J.canonical),pe=ae(le),ye=[we.x+pe[0],we.y+pe[1],we.z+pe[2]],Le=r.projection.name==="globe",Ve=this.projectAndGetPerspectiveRatio(E,[ye[0],ye[1],ye[2]],J,Le||!!Q||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:He}=Ve,Ge=(j?M/He:M*He)/a.ONE_EM,Ue=xn(new a.pointGeometry(ye[0],ye[1]),I,ye[2]).point,ve=Ve.signedDistanceFromCamera>0?di(Ge,v,m.lineOffsetX*Ge,m.lineOffsetY*Ge,!1,Ue,le,m,y,I,{},Q&&!j?ae:null,j&&!!Q,r.getProjection(),J,j):null;let at=!1,rt=!1,It=!0;if(ve&&!Ve.occluded){const Ke=.5*ie*He+oe,Jt=new a.pointGeometry(-100,-100),Ct=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Tt=new Wo,_t=ve.first,St=ve.last;let ln=[];for(let Kt=_t.path.length-1;Kt>=1;Kt--)ln.push(_t.path[Kt]);for(let Kt=1;Kt<St.path.length;Kt++)ln.push(St.path[Kt]);const en=2.5*Ke;if(R){const Kt=ln.map(Q&&!Le?(gn,Gn)=>{const Xn=ae(Gn<_t.path.length-1?_t.tilePath[_t.path.length-1-Gn]:St.tilePath[Gn-_t.path.length+2]);return gn[2]=Xn[2],Ho(gn,R)}:gn=>Ho(gn,R));ln=Kt.some(gn=>gn.signedDistanceFromCamera<=0)?[]:Kt.map(gn=>gn.point)}let vn=[];if(ln.length>0){const Kt=ln.map(Qn=>new a.pointGeometry(Qn[0],Qn[1]));let gn=1/0,Gn=-1/0,Xn=1/0,Ai=-1/0;for(let Qn=0;Qn<Kt.length;Qn++)gn=Math.min(gn,Kt[Qn].x),Xn=Math.min(Xn,Kt[Qn].y),Gn=Math.max(Gn,Kt[Qn].x),Ai=Math.max(Ai,Kt[Qn].y);vn=gn>=Jt.x&&Gn<=Ct.x&&Xn>=Jt.y&&Ai<=Ct.y?[Kt]:Gn<Jt.x||gn>Ct.x||Ai<Jt.y||Xn>Ct.y?[]:a.clipLine([Kt],Jt.x,Jt.y,Ct.x,Ct.y)}for(const Kt of vn){Tt.reset(Kt,.25*Ke);let gn=0;gn=Tt.length<=.5*Ke?1:Math.ceil(Tt.paddedLength/en)+1;for(let Gn=0;Gn<gn;Gn++){const Xn=Gn/Math.max(gn-1,1),Ai=Tt.lerp(Xn),Qn=Ai.x+qr,Br=Ai.y+qr;_e.push(Qn,Br,Ke,0);const Io=Qn-Ke,Xo=Br-Ke,ri=Qn+Ke,li=Br+Ke;if(It=It&&this.isOffscreen(Io,Xo,ri,li),rt=rt||this.isInsideGrid(Io,Xo,ri,li),!u&&this.grid.hitTestCircle(Qn,Br,Ke,Y)&&(at=!0,!N))return{circles:[],offscreen:!1,collisionDetected:at,occluded:!1}}}}return{circles:!N&&at||!rt?[]:_e,offscreen:It,collisionDetected:at,occluded:Ve.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let m=1/0,y=1/0,v=-1/0,M=-1/0;for(const N of r){const j=new a.pointGeometry(N.x+qr,N.y+qr);m=Math.min(m,j.x),y=Math.min(y,j.y),v=Math.max(v,j.x),M=Math.max(M,j.y),u.push(j)}const E=this.grid.query(m,y,v,M).concat(this.ignoredGrid.query(m,y,v,M)),I={},R={};for(const N of E){const j=N.key;if(I[j.bucketInstanceId]===void 0&&(I[j.bucketInstanceId]={}),I[j.bucketInstanceId][j.featureIndex])continue;const Y=[new a.pointGeometry(N.x1,N.y1),new a.pointGeometry(N.x2,N.y1),new a.pointGeometry(N.x2,N.y2),new a.pointGeometry(N.x1,N.y2)];a.polygonIntersectsPolygon(u,Y)&&(I[j.bucketInstanceId][j.featureIndex]=!0,R[j.bucketInstanceId]===void 0&&(R[j.bucketInstanceId]=[]),R[j.bucketInstanceId].push(j.featureIndex))}return R}insertCollisionBox(r,u,m,y,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,m,y,v){const M=u?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:y,collisionGroupID:v};for(let I=0;I<r.length;I+=4)M.insertCircle(E,r[I],r[I+1],r[I+2])}projectAndGetPerspectiveRatio(r,u,m,y,v){const M=[u[0],u[1],u[2],1];let E=!1;if(u[2]||this.transform.pitch>0){a.transformMat4$1(M,M,r);const I=v.name==="globe";this.fogState&&m&&!I&&(E=function(R,N,j,Y,ie,oe){const J=oe.calculateFogTileMatrix(ie),_e=[N,j,Y];return a.transformMat4(_e,_e,J),Be(R,_e,oe.pitch,oe._fov)}(this.fogState,u[0],u[1],u[2],m.toUnwrapped(),this.transform)>.9)}else vi(M,M,r);return{point:new a.pointGeometry((M[0]/M[3]+1)/2*this.transform.width+qr,(-M[1]/M[3]+1)/2*this.transform.height+qr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/M[3]*.5,1.5),signedDistanceFromCamera:M[3],occluded:y&&M[2]>M[3]||E}}isOffscreen(r,u,m,y){return m<qr||r>=this.screenRightBoundary||y<qr||u>this.screenBottomBoundary}isInsideGrid(r,u,m,y){return m>=0&&r<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=a.identity([]);return a.translate(r,r,[-100,-100,0]),r}}function ar(f,r,u){const m=r.createTileMatrix(f,f.worldSize,u.toUnwrapped());return a.multiply(new Float32Array(16),f.projMatrix,m)}function Zr(f,r,u){if(r.projection.name===u.projection.name)return f.projMatrix;const m=u.clone();return m.setProjection(r.projection),ar(m,r.getProjection(),f)}function Qc(f,r,u){return r.name===u.projection.name?f.projMatrix:ar(u,r,f)}class Bl{constructor(r,u,m,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class yi{constructor(r,u,m,y,v,M=!1){this.text=new Bl(r?r.text:null,u,m,v),this.icon=new Bl(r?r.icon:null,u,y,v),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class js{constructor(r,u,m,y=!1){this.text=r,this.icon=u,this.skipFade=m,this.clipped=y}}class ld{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ol{constructor(r,u,m,y,v){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=v}}class Ji{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[r]}}function eu(f,r,u,m,y){const{horizontalAlign:v,verticalAlign:M}=a.getAnchorAlignment(f),E=-(v-.5)*r,I=-(M-.5)*u,R=a.evaluateVariableOffset(f,m);return new a.pointGeometry(E+R[0]*y,I+R[1]*y)}function Nl(f,r,u,m,y){const v=new a.pointGeometry(f,r);return u&&v._rotate(m?y:-y),v}class $o{constructor(r,u,m,y,v){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ad(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ji(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,m,y){const v=m.getBucket(u),M=m.latestFeatureIndex;if(!v||!M||u.id!==v.layerIds[0])return;const E=v.layers[0].layout,I=m.collisionBoxArray,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),N=m.tileSize/a.EXTENT,j=m.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Y=(ie=m.tileID,oe=v.getProjection(),J=this.transform,oe.name===this.projection?J.calculateProjMatrix(ie.toUnwrapped()):ar(J,oe,ie));var ie,oe,J;const _e=E.get("text-pitch-alignment")==="map",Q=E.get("text-rotation-alignment")==="map";u.compileFilter();const ae=u.dynamicFilter(),le=u.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(m),pe=Ci(Y,m.tileID.canonical,_e,Q,this.transform,v.getProjection(),we);let ye=null;if(_e){const He=Gs(Y,m.tileID.canonical,_e,Q,this.transform,v.getProjection(),we);ye=a.multiply([],this.transform.labelPlaneMatrix,He)}let Le=null;ae&&m.latestFeatureIndex&&(Le={unwrappedTileID:j,dynamicFilter:ae,dynamicFilterNeedsFeature:le,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Ol(v.bucketInstanceId,M,v.sourceLayerIndex,v.index,m.tileID);const Ve={bucket:v,layout:E,posMatrix:Y,textLabelPlaneMatrix:pe,labelToScreenMatrix:ye,clippingData:Le,scale:R,textPixelRatio:N,holdingForFade:m.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const He of v.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:Ue,symbolInstanceEnd:ve}=He;r.push({sortKey:Ge,symbolInstanceStart:Ue,symbolInstanceEnd:ve,parameters:Ve})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J,_e,Q,ae){const le=[Y.textOffset0,Y.textOffset1],we=eu(r,m,y,le,v),pe=this.collisionIndex.placeCollisionBox(oe,v,u,Nl(we.x,we.y,M,E,this.transform.angle),j,I,R,N.predicate);if((!_e||this.collisionIndex.placeCollisionBox(oe,oe.getSymbolInstanceIconSize(ae,this.transform.zoom,ie),_e,Nl(we.x,we.y,M,E,this.transform.angle),j,I,R,N.predicate).box.length!==0)&&pe.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(ye=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),this.variableOffsets[Y.crossTileID]={textOffset:le,width:m,height:y,anchor:r,textScale:v,prevAnchor:ye},this.markUsedJustification(oe,r,Y,J),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,J,Y),this.placedOrientations[Y.crossTileID]=J),{shift:we,placedGlyphBoxes:pe}}}placeLayerBucketPart(r,u,m,y){const{bucket:v,layout:M,posMatrix:E,textLabelPlaneMatrix:I,labelToScreenMatrix:R,clippingData:N,textPixelRatio:j,holdingForFade:Y,collisionBoxArray:ie,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:J,collisionGroup:_e}=r.parameters,Q=M.get("text-optional"),ae=M.get("icon-optional"),le=M.get("text-allow-overlap"),we=M.get("icon-allow-overlap"),pe=M.get("text-rotation-alignment")==="map",ye=M.get("text-pitch-alignment")==="map",Le=M.get("icon-text-fit")!=="none",Ve=M.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let He=le&&(we||!v.hasIconData()||ae),Ge=we&&(le||!v.hasTextData()||Q);!v.collisionArrays&&ie&&v.deserializeCollisionBoxes(ie),m&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,ie);const Ue=(ve,at,rt)=>{if(N){const ri={zoom:this.transform.zoom,pitch:this.transform.pitch};let li=null;if(N.dynamicFilterNeedsFeature){const Wn=this.retainedQueryData[v.bucketInstanceId];li=N.featureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:Wn.bucketIndex,sourceLayerIndex:Wn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(ri,li,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new a.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[ve.crossTileID]=new js(!1,!1,!1,!0),void(u[ve.crossTileID]=!0)}if(u[ve.crossTileID])return;if(Y)return void(this.placements[ve.crossTileID]=new js(!1,!1,!1));let It=!1,Ke=!1,Jt=!0,Ct=!1,Tt=!1,_t=null,St={box:null,offscreen:null,occluded:null},ln={box:null,offscreen:null,occluded:null},en=null,vn=null,Kt=null,gn=0,Gn=0,Xn=0;rt.textFeatureIndex?gn=rt.textFeatureIndex:ve.useRuntimeCollisionCircles&&(gn=ve.featureIndex),rt.verticalTextFeatureIndex&&(Gn=rt.verticalTextFeatureIndex);const Ai=ri=>{ri.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||ri.elevation)&&(ri.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,ri.tileAnchorX,ri.tileAnchorY):0)},Qn=rt.textBox;if(Qn){Ai(Qn);const ri=Wn=>{let ki=a.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Wn&&this.prevPlacement){const Qi=this.prevPlacement.placedOrientations[ve.crossTileID];Qi&&(this.placedOrientations[ve.crossTileID]=Qi,ki=Qi,this.markUsedOrientation(v,ki,ve))}return ki},li=(Wn,ki)=>{if(v.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const Qi of v.writingModes)if(Qi===a.WritingMode.vertical?(St=ki(),ln=St):St=Wn(),St&&St.box&&St.box.length)break}else St=Wn()};if(M.get("text-variable-anchor")){let Wn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]){const kn=this.prevPlacement.variableOffsets[ve.crossTileID];Wn.indexOf(kn.anchor)>0&&(Wn=Wn.filter(Mr=>Mr!==kn.anchor),Wn.unshift(kn.anchor))}const ki=(kn,Mr,Js)=>{const po=v.getSymbolInstanceTextSize(oe,ve,this.transform.zoom,at),Ga=(kn.x2-kn.x1)*po+2*kn.padding,ja=(kn.y2-kn.y1)*po+2*kn.padding,xs=Le&&!we?Mr:null;xs&&Ai(xs);let Ri={box:[],offscreen:!1,occluded:!1};const Po=le?2*Wn.length:Wn.length;for(let Yo=0;Yo<Po;++Yo){const oc=this.attemptAnchorPlacement(Wn[Yo%Wn.length],kn,Ga,ja,po,pe,ye,j,E,_e,Yo>=Wn.length,ve,at,v,Js,xs,oe,J);if(oc&&(Ri=oc.placedGlyphBoxes,Ri&&Ri.box&&Ri.box.length)){It=!0,_t=oc.shift;break}}return Ri};li(()=>ki(Qn,rt.iconBox,a.WritingMode.horizontal),()=>{const kn=rt.verticalTextBox;return kn&&Ai(kn),v.allowVerticalPlacement&&!(St&&St.box&&St.box.length)&&ve.numVerticalGlyphVertices>0&&kn?ki(kn,rt.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),St&&(It=St.box,Jt=St.offscreen,Ct=St.occluded);const Qi=ri(St&&St.box);if(!It&&this.prevPlacement){const kn=this.prevPlacement.variableOffsets[ve.crossTileID];kn&&(this.variableOffsets[ve.crossTileID]=kn,this.markUsedJustification(v,kn.anchor,ve,Qi))}}else{const Wn=(ki,Qi)=>{const kn=v.getSymbolInstanceTextSize(oe,ve,this.transform.zoom,at),Mr=this.collisionIndex.placeCollisionBox(v,kn,ki,new a.pointGeometry(0,0),le,j,E,_e.predicate);return Mr&&Mr.box&&Mr.box.length&&(this.markUsedOrientation(v,Qi,ve),this.placedOrientations[ve.crossTileID]=Qi),Mr};li(()=>Wn(Qn,a.WritingMode.horizontal),()=>{const ki=rt.verticalTextBox;return v.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&ki?(Ai(ki),Wn(ki,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ri(St&&St.box&&St.box.length)}}if(en=St,It=en&&en.box&&en.box.length>0,Jt=en&&en.offscreen,Ct=en&&en.occluded,ve.useRuntimeCollisionCircles){const ri=v.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex>=0?ve.centerJustifiedTextSymbolIndex:ve.verticalPlacedTextSymbolIndex),li=a.evaluateSizeForFeature(v.textSizeData,oe,ri),Wn=M.get("text-padding");vn=this.collisionIndex.placeCollisionCircles(v,le,ri,v.lineVertexArray,v.glyphOffsetArray,li,E,I,R,m,ye,_e.predicate,ve.collisionCircleDiameter*li/a.ONE_EM,Wn,this.retainedQueryData[v.bucketInstanceId].tileID),It=le||vn.circles.length>0&&!vn.collisionDetected,Jt=Jt&&vn.offscreen,Ct=vn.occluded}if(rt.iconFeatureIndex&&(Xn=rt.iconFeatureIndex),rt.iconBox){const ri=li=>{Ai(li);const Wn=Le&&_t?Nl(_t.x,_t.y,pe,ye,this.transform.angle):new a.pointGeometry(0,0),ki=v.getSymbolInstanceIconSize(J,this.transform.zoom,at);return this.collisionIndex.placeCollisionBox(v,ki,li,Wn,we,j,E,_e.predicate)};ln&&ln.box&&ln.box.length&&rt.verticalIconBox?(Kt=ri(rt.verticalIconBox),Ke=Kt.box.length>0):(Kt=ri(rt.iconBox),Ke=Kt.box.length>0),Jt=Jt&&Kt.offscreen,Tt=Kt.occluded}const Br=Q||ve.numHorizontalGlyphVertices===0&&ve.numVerticalGlyphVertices===0,Io=ae||ve.numIconVertices===0;if(Br||Io?Io?Br||(Ke=Ke&&It):It=Ke&&It:Ke=It=Ke&&It,It&&en&&en.box&&this.collisionIndex.insertCollisionBox(en.box,M.get("text-ignore-placement"),v.bucketInstanceId,ln&&ln.box&&Gn?Gn:gn,_e.ID),Ke&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,M.get("icon-ignore-placement"),v.bucketInstanceId,Xn,_e.ID),vn&&(It&&this.collisionIndex.insertCollisionCircles(vn.circles,M.get("text-ignore-placement"),v.bucketInstanceId,gn,_e.ID),m)){const ri=v.bucketInstanceId;let li=this.collisionCircleArrays[ri];li===void 0&&(li=this.collisionCircleArrays[ri]=new ld);for(let Wn=0;Wn<vn.circles.length;Wn+=4)li.circles.push(vn.circles[Wn+0]),li.circles.push(vn.circles[Wn+1]),li.circles.push(vn.circles[Wn+2]),li.circles.push(vn.collisionDetected?1:0)}const Xo=v.projection.name!=="globe";He=He&&(Xo||!Ct),Ge=Ge&&(Xo||!Tt),this.placements[ve.crossTileID]=new js(It||He,Ke||Ge,Jt||v.justReloaded),u[ve.crossTileID]=!0};if(Ve){const ve=v.getSortedSymbolIndexes(this.transform.angle);for(let at=ve.length-1;at>=0;--at){const rt=ve[at];Ue(v.symbolInstances.get(rt),rt,v.collisionArrays[rt])}}else for(let ve=r.symbolInstanceStart;ve<r.symbolInstanceEnd;ve++)Ue(v.symbolInstances.get(ve),ve,v.collisionArrays[ve]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[v.bucketInstanceId];a.invert(ve.invProjMatrix,E),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,u,m,y){let v;v=y===a.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(u)];const M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const E of M)E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=v>=0&&E!==v?0:m.crossTileID)}markUsedOrientation(r,u,m){const y=u===a.WritingMode.horizontal||u===a.WritingMode.horizontalOnly?u:0,v=u===a.WritingMode.vertical?u:0,M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const E of M)r.text.placedSymbolArray.get(E).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(r):1,v=u?u.opacities:{},M=u?u.variableOffsets:{},E=u?u.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],N=v[I];N?(this.opacities[I]=new yi(N,y,R.text,R.icon,null,R.clipped),m=m||R.text!==N.text.placed||R.icon!==N.icon.placed):(this.opacities[I]=new yi(null,y,R.text,R.icon,R.skipFade,R.clipped),m=m||R.text||R.icon)}for(const I in v){const R=v[I];if(!this.opacities[I]){const N=new yi(R,y,!1,!1);N.isHidden()||(this.opacities[I]=N,m=m||R.text.placed||R.icon.placed)}}for(const I in M)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=M[I]);for(const I in E)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=E[I]);m?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const m={};for(const y of u){const v=y.getBucket(r);v&&y.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,m,y.collisionBoxArray)}}updateBucketOpacities(r,u,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const y=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),M=new yi(null,0,!1,!1,!0),E=y.get("text-allow-overlap"),I=y.get("icon-allow-overlap"),R=y.get("text-variable-anchor"),N=y.get("text-rotation-alignment")==="map",j=y.get("text-pitch-alignment")==="map",Y=y.get("icon-text-fit")!=="none",ie=new yi(null,0,E&&(I||!r.hasIconData()||y.get("icon-optional")),I&&(E||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const oe=(_e,Q,ae)=>{for(let le=0;le<Q/4;le++)_e.opacityVertexArray.emplaceBack(ae)};let J=0;for(let _e=0;_e<r.symbolInstances.length;_e++){const Q=r.symbolInstances.get(_e),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:le,crossTileID:we}=Q;let pe=this.opacities[we];u[we]?pe=M:pe||(pe=ie,this.opacities[we]=pe),u[we]=!0;const ye=ae>0||le>0,Le=Q.numIconVertices>0,Ve=this.placedOrientations[Q.crossTileID],He=Ve===a.WritingMode.vertical,Ge=Ve===a.WritingMode.horizontal||Ve===a.WritingMode.horizontalOnly;if(!ye&&!Le||pe.isHidden()||J++,ye){const Ue=qo(pe.text);oe(r.text,ae,He?Ws:Ue),oe(r.text,le,Ge?Ws:Ue);const ve=pe.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(It=>{It>=0&&(r.text.placedSymbolArray.get(It).hidden=ve||He?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=ve||Ge?1:0);const at=this.variableOffsets[Q.crossTileID];at&&this.markUsedJustification(r,at.anchor,Q,Ve);const rt=this.placedOrientations[Q.crossTileID];rt&&(this.markUsedJustification(r,"left",Q,rt),this.markUsedOrientation(r,rt,Q))}if(Le){const Ue=qo(pe.icon);Q.placedIconSymbolIndex>=0&&(oe(r.icon,Q.numIconVertices,He?Ws:Ue),r.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=pe.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(oe(r.icon,Q.numVerticalIconVertices,Ge?Ws:Ue),r.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ue=r.collisionArrays[_e];if(Ue){let ve=new a.pointGeometry(0,0),at=!0;if(Ue.textBox||Ue.verticalTextBox){if(R){const It=this.variableOffsets[we];It?(ve=eu(It.anchor,It.width,It.height,It.textOffset,It.textScale),N&&ve._rotate(j?this.transform.angle:-this.transform.angle)):at=!1}v&&(at=!pe.clipped),Ue.textBox&&gs(r.textCollisionBox.collisionVertexArray,pe.text.placed,!at||He,ve.x,ve.y),Ue.verticalTextBox&&gs(r.textCollisionBox.collisionVertexArray,pe.text.placed,!at||Ge,ve.x,ve.y)}const rt=at&&Boolean(!Ge&&Ue.verticalIconBox);Ue.iconBox&&gs(r.iconCollisionBox.collisionVertexArray,pe.icon.placed,rt,Y?ve.x:0,Y?ve.y:0),Ue.verticalIconBox&&gs(r.iconCollisionBox.collisionVertexArray,pe.icon.placed,!rt,Y?ve.x:0,Y?ve.y:0)}}}if(r.fullyClipped=J===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=_e.invProjMatrix,r.placementViewportMatrix=_e.viewportMatrix,r.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function gs(f,r,u,m,y){f.emplaceBack(r?1:0,u?1:0,m||0,y||0),f.emplaceBack(r?1:0,u?1:0,m||0,y||0),f.emplaceBack(r?1:0,u?1:0,m||0,y||0),f.emplaceBack(r?1:0,u?1:0,m||0,y||0)}const tu=Math.pow(2,25),ay=Math.pow(2,24),cd=Math.pow(2,17),Ia=Math.pow(2,16),ly=Math.pow(2,9),Rp=Math.pow(2,8),Pa=Math.pow(2,1);function qo(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const r=f.placed?1:0,u=Math.floor(127*f.opacity);return u*tu+r*ay+u*cd+r*Ia+u*ly+r*Rp+u*Pa+r}const Ws=0;class ys{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,u,m,y,v){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(M,y,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((E,I)=>E.sortKey-I.sortKey));this._currentPartIndex<M.length;){const E=M[this._currentPartIndex];if(u.placeLayerBucketPart(E,this._seenCrossTileIDs,m,E.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class ud{constructor(r,u,m,y,v,M,E,I){this.placement=new $o(r,v,M,E,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,u,m){const y=a.exported.now(),v=()=>{const M=a.exported.now()-y;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[r[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=E)&&(!M.maxzoom||M.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new ys(M)),this._inProgressLayer.continuePlacement(m[M.source],this.placement,this._showCollisionBoxes,M,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const nu=512/a.EXTENT/2;class cy{constructor(r,u,m){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let y=0;y<u.length;y++){const v=u.get(y),M=v.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,u){const m=nu/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*a.EXTENT+r.tileAnchorX)*m),y:Math.floor((u.canonical.y*a.EXTENT+r.tileAnchorY)*m)}}findMatches(r,u,m){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let v=0;v<r.length;v++){const M=r.get(v);if(M.crossTileID)continue;const E=this.indexedSymbolInstances[M.key];if(!E)continue;const I=this.getScaledCoordinates(M,u);for(const R of E)if(Math.abs(R.coord.x-I.x)<=y&&Math.abs(R.coord.y-I.y)<=y&&!m[R.crossTileID]){m[R.crossTileID]=!0,M.crossTileID=R.crossTileID;break}}}}class uy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(u!==0)for(const m in this.indexes){const y=this.indexes[m],v={};for(const M in y){const E=y[M];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),v[E.tileID.key]=E}this.indexes[m]=v}this.lng=r}addBucket(r,u,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<u.symbolInstances.length;v++)u.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const y=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const M=this.indexes[v];if(Number(v)>r.overscaledZ)for(const E in M){const I=M[E];I.tileID.isChildOf(r)&&I.findMatches(u.symbolInstances,r,y)}else{const E=M[r.scaledTo(Number(v)).key];E&&E.findMatches(u.symbolInstances,r,y)}}for(let v=0;v<u.symbolInstances.length;v++){const M=u.symbolInstances.get(v);M.crossTileID||(M.crossTileID=m.generate(),y[M.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new cy(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const m in u.indexedSymbolInstances)for(const y of u.indexedSymbolInstances[m])delete this.usedCrossTileIDs[r][y.crossTileID]}removeStaleBuckets(r){let u=!1;for(const m in this.indexes){const y=this.indexes[m];for(const v in y)r[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[v]),delete y[v],u=!0)}return u}}class Fp{constructor(){this.layerIndexes={},this.crossTileIDs=new uy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,m,y){let v=this.layerIndexes[r.id];v===void 0&&(v=this.layerIndexes[r.id]=new hd);let M=!1;const E={};y.name!=="globe"&&v.handleWrapJump(m);for(const I of u){const R=I.getBucket(r);R&&r.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(I.tileID,R,this.crossTileIDs)&&(M=!0),E[R.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(M=!0),M}pruneUnusedLayers(r){const u={};r.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const Ul=(f,r)=>a.emitValidationErrors(f,r&&r.filter(u=>u.identifier!=="source.canvas")),hy=a.pick(Re,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Bp=a.pick(Re,["setCenter","setZoom","setBearing","setPitch"]),dy={version:8,layers:[],sources:{}},dd={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ho extends a.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new gt(sn(),this),this.imageManager=new qe,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(r._requestManager,u.localFontFamily?a.LocalGlyphMode.all:u.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new Fp,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const m=this;this._rtlTextPluginCallback=ho.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,M)=>{if(a.triggerPluginCompletionEvent(v),M&&M.every(E=>E))for(const E in m._sourceCaches){const I=m._sourceCaches[E],R=I.getSource().type;R!=="vector"&&R!=="geojson"||I.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const M in this._layers){const E=this._layers[M];E.source===v.id&&this._validateLayer(E)}})}loadURL(r,u={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const m=typeof u.validate=="boolean"?u.validate:!a.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,u.accessToken);const y=this.map._requestManager.transformRequest(r,a.ResourceType.Style);this._request=a.getJSON(y,(v,M)=>{this._request=null,v?this.fire(new a.ErrorEvent(v)):M&&this._load(M,m)})}loadJSON(r,u={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(r,u.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(dy,!1)}_updateLayerCount(r,u){const m=u?1:-1;r.is3D()&&(this._num3DLayers+=m),r.type==="circle"&&(this._numCircleLayers+=m),r.type==="symbol"&&(this._numSymbolLayers+=m)}_load(r,u){if(u&&Ul(this,a.validateStyle(r)))return;this._loaded=!0,this.stylesheet=a.clone$1(r),this._updateMapProjection();for(const y in r.sources)this.addSource(y,r.sources[y],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=Pn(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m)y=a.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new je(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(r){this._spriteRequest=function(u,m,y){let v,M,E;const I=a.exported.devicePixelRatio>1?"@2x":"";let R=a.getJSON(m.transformRequest(m.normalizeSpriteURL(u,I,".json"),a.ResourceType.SpriteJSON),(Y,ie)=>{R=null,E||(E=Y,v=ie,j())}),N=a.getImage(m.transformRequest(m.normalizeSpriteURL(u,I,".png"),a.ResourceType.SpriteImage),(Y,ie)=>{N=null,E||(E=Y,M=ie,j())});function j(){if(E)y(E);else if(v&&M){const Y=a.exported.getImageData(M),ie={};for(const oe in v){const{width:J,height:_e,x:Q,y:ae,sdf:le,pixelRatio:we,stretchX:pe,stretchY:ye,content:Le}=v[oe],Ve=new a.RGBAImage({width:J,height:_e});a.RGBAImage.copy(Y,Ve,{x:Q,y:ae},{x:0,y:0},{width:J,height:_e}),ie[oe]={data:Ve,pixelRatio:we,sdf:le,stretchX:pe,stretchY:ye,content:Le}}y(null,ie)}}return{cancel(){R&&(R.cancel(),R=null),N&&(N.cancel(),N=null)}}}(r,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new a.ErrorEvent(u));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.getSource(r.source);if(!u)return;const m=r.sourceLayer;m&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const m of r){const y=this._layers[m];y.type!=="custom"&&u.push(y.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&dd[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const M in this._updatedSources){const E=this._updatedSources[M];E==="reload"?this._reloadSource(M):E==="clear"&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];m[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){const E=this._getLayerSourceCache(v);E&&(E.used=!0)}const M=this.map.painter;if(M){const E=v.getProgramIds();if(!E)continue;const I=v.getProgramConfiguration(r.zoom);for(const R of E)M.useProgram(R,I)}}for(const y in m){const v=this._sourceCaches[y];m[y]!==v.used&&v.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Ul(this,a.validateStyle(r)))return!1;(r=a.clone$1(r)).layers=Pn(r.layers);const u=function(y,v){if(!y)return[{command:Re.setStyle,args:[v]}];let M=[];try{if(!T(y.version,v.version))return[{command:Re.setStyle,args:[v]}];T(y.center,v.center)||M.push({command:Re.setCenter,args:[v.center]}),T(y.zoom,v.zoom)||M.push({command:Re.setZoom,args:[v.zoom]}),T(y.bearing,v.bearing)||M.push({command:Re.setBearing,args:[v.bearing]}),T(y.pitch,v.pitch)||M.push({command:Re.setPitch,args:[v.pitch]}),T(y.sprite,v.sprite)||M.push({command:Re.setSprite,args:[v.sprite]}),T(y.glyphs,v.glyphs)||M.push({command:Re.setGlyphs,args:[v.glyphs]}),T(y.transition,v.transition)||M.push({command:Re.setTransition,args:[v.transition]}),T(y.light,v.light)||M.push({command:Re.setLight,args:[v.light]}),T(y.fog,v.fog)||M.push({command:Re.setFog,args:[v.fog]}),T(y.projection,v.projection)||M.push({command:Re.setProjection,args:[v.projection]});const E={},I=[];(function(j,Y,ie,oe){let J;for(J in Y=Y||{},j=j||{})j.hasOwnProperty(J)&&(Y.hasOwnProperty(J)||cn(J,ie,oe));for(J in Y)Y.hasOwnProperty(J)&&(j.hasOwnProperty(J)?T(j[J],Y[J])||(j[J].type==="geojson"&&Y[J].type==="geojson"&&Ei(j,Y,J)?ie.push({command:Re.setGeoJSONSourceData,args:[J,Y[J].data]}):Hi(J,Y,ie,oe)):_i(J,Y,ie))})(y.sources,v.sources,I,E);const R=[];y.layers&&y.layers.forEach(j=>{j.source&&E[j.source]?M.push({command:Re.removeLayer,args:[j.id]}):R.push(j)});let N=y.terrain;N&&E[N.source]&&(M.push({command:Re.setTerrain,args:[void 0]}),N=void 0),M=M.concat(I),T(N,v.terrain)||M.push({command:Re.setTerrain,args:[v.terrain]}),function(j,Y,ie){Y=Y||[];const oe=(j=j||[]).map(Fr),J=Y.map(Fr),_e=j.reduce(_s,{}),Q=Y.reduce(_s,{}),ae=oe.slice(),le=Object.create(null);let we,pe,ye,Le,Ve,He,Ge;for(we=0,pe=0;we<oe.length;we++)ye=oe[we],Q.hasOwnProperty(ye)?pe++:(ie.push({command:Re.removeLayer,args:[ye]}),ae.splice(ae.indexOf(ye,pe),1));for(we=0,pe=0;we<J.length;we++)ye=J[J.length-1-we],ae[ae.length-1-we]!==ye&&(_e.hasOwnProperty(ye)?(ie.push({command:Re.removeLayer,args:[ye]}),ae.splice(ae.lastIndexOf(ye,ae.length-pe),1)):pe++,He=ae[ae.length-we],ie.push({command:Re.addLayer,args:[Q[ye],He]}),ae.splice(ae.length-we,0,ye),le[ye]=!0);for(we=0;we<J.length;we++)if(ye=J[we],Le=_e[ye],Ve=Q[ye],!le[ye]&&!T(Le,Ve))if(T(Le.source,Ve.source)&&T(Le["source-layer"],Ve["source-layer"])&&T(Le.type,Ve.type)){for(Ge in gi(Le.layout,Ve.layout,ie,ye,null,Re.setLayoutProperty),gi(Le.paint,Ve.paint,ie,ye,null,Re.setPaintProperty),T(Le.filter,Ve.filter)||ie.push({command:Re.setFilter,args:[ye,Ve.filter]}),T(Le.minzoom,Ve.minzoom)&&T(Le.maxzoom,Ve.maxzoom)||ie.push({command:Re.setLayerZoomRange,args:[ye,Ve.minzoom,Ve.maxzoom]}),Le)Le.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?gi(Le[Ge],Ve[Ge],ie,ye,Ge.slice(6),Re.setPaintProperty):T(Le[Ge],Ve[Ge])||ie.push({command:Re.setLayerProperty,args:[ye,Ge,Ve[Ge]]}));for(Ge in Ve)Ve.hasOwnProperty(Ge)&&!Le.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?gi(Le[Ge],Ve[Ge],ie,ye,Ge.slice(6),Re.setPaintProperty):T(Le[Ge],Ve[Ge])||ie.push({command:Re.setLayerProperty,args:[ye,Ge,Ve[Ge]]}))}else ie.push({command:Re.removeLayer,args:[ye]}),He=ae[ae.lastIndexOf(ye)+1],ie.push({command:Re.addLayer,args:[Ve,He]})}(R,v.layers,M)}catch(E){console.warn("Unable to compute style diff:",E),M=[{command:Re.setStyle,args:[v]}]}return M}(this.serialize(),r).filter(y=>!(y.command in Bp));if(u.length===0)return!1;const m=u.filter(y=>!(y.command in hy));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return u.forEach(y=>{y.command!=="setTransition"&&this[y.command].apply(this,y.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,u){return this.getImage(r)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,u),this._afterImageUpdated(r),this)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,u,m={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(a.validateSource,`sources.${r}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=ce(r,u,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:y.serialize(),sourceId:r}));const v=M=>{const E=(M?"symbol:":"other:")+r,I=this._sourceCaches[E]=new a.SourceCache(E,y,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[r]=I,I.style=this,I.onAdd(this.map)};v(!1),u.type!=="vector"&&u.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const u=this.getSource(r);if(!u)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,u){this._checkLoaded(),this.getSource(r).setData(u),this._changed=!0}getSource(r){const u=this._getSourceCache(r);return u&&u.getSource()}addLayer(r,u,m={}){this._checkLoaded();const y=r.id;if(this.getLayer(y))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(r.type==="custom"){if(Ul(this,a.validateCustomStyleLayer(r)))return;v=a.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(y,r.source),r=a.clone$1(r),r=a.extend(r,{source:y})),this._validate(a.validateLayer,`layers.${y}`,r,{arrayIndex:-1},m))return;v=a.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const M=u?this._order.indexOf(u):this._order.length;if(u&&M===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(M,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const E=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&E&&v.type!=="custom"){const I=this._removedLayers[y];delete this._removedLayers[y],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",E.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const m=this._order.indexOf(r);this._order.splice(m,1);const y=u?this._order.indexOf(u):this._order.length;u&&y===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(y,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const u in this._layers)if(this._layers[u].type===r)return!0;return!1}setLayerZoomRange(r,u,m){this._checkLoaded();const y=this.getLayer(r);y?y.minzoom===u&&y.maxzoom===m||(u!=null&&(y.minzoom=u),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,u,m={}){this._checkLoaded();const y=this.getLayer(r);if(y){if(!T(y.filter,u))return u==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.validateFilter,`layers.${y.id}.filter`,u,{layerType:y.type},m)||(y.filter=a.clone$1(u),this._updateLayer(y)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const u=this.getLayer(r);return u&&a.clone$1(u.filter)}setLayoutProperty(r,u,m,y={}){this._checkLoaded();const v=this.getLayer(r);v?T(v.getLayoutProperty(u),m)||(v.setLayoutProperty(u,m,y),this._updateLayer(v)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,u){const m=this.getLayer(r);if(m)return m.getLayoutProperty(u);this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,u,m,y={}){this._checkLoaded();const v=this.getLayer(r);v?T(v.getPaintProperty(u),m)||(v.setPaintProperty(u,m,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,u){const m=this.getLayer(r);return m&&m.getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const m=r.source,y=r.sourceLayer,v=this.getSource(m);if(!v)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const M=v.type;if(M==="geojson"&&y)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!y)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(m);for(const I of E)I.setFeatureState(y,r.id,u)}removeFeatureState(r,u){this._checkLoaded();const m=r.source,y=this.getSource(m);if(!y)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const v=y.type,M=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!M)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(m);for(const I of E)I.removeFeatureState(M,r.id,u)}getFeatureState(r){this._checkLoaded();const u=r.source,m=r.sourceLayer,y=this.getSource(u);if(y){if(y.type!=="vector"||m)return r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(m,r.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();r[m.id]||(r[m.id]=m.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const u=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&u&&u.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",u.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const u=M=>this._layers[M].type==="fill-extrusion",m={},y=[];for(let M=this._order.length-1;M>=0;M--){const E=this._order[M];if(u(E)){m[E]=M;for(const I of r){const R=I[E];if(R)for(const N of R)y.push(N)}}}y.sort((M,E)=>E.intersectionZ-M.intersectionZ);const v=[];for(let M=this._order.length-1;M>=0;M--){const E=this._order[M];if(u(E))for(let I=y.length-1;I>=0;I--){const R=y[I].feature;if(m[R.layer.id]<M)break;v.push(R),y.pop()}else for(const I of r){const R=I[E];if(R)for(const N of R)v.push(N.feature)}}return v}queryRenderedFeatures(r,u,m){u&&u.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const y={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of u.layers){const R=this._layers[I];if(!R)return this.fire(new a.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];y[R.source]=!0}}const v=[];u.availableImages=this._availableImages;const M=u&&u.layers?u.layers.some(I=>{const R=this.getLayer(I);return R&&R.is3D()}):this.has3DLayers(),E=Xt.createFromScreenPoints(r,m);for(const I in this._sourceCaches){const R=this._sourceCaches[I].getSource().id;u.layers&&!y[R]||v.push(it(this._sourceCaches[I],this._layers,this._serializedLayers,E,u,m,M,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(I,R,N,j,Y,ie,oe){const J={},_e=ie.queryRenderedSymbols(j),Q=[];for(const ae of Object.keys(_e).map(Number))Q.push(oe[ae]);Q.sort(vt);for(const ae of Q){const le=ae.featureIndex.lookupSymbolFeatures(_e[ae.bucketInstanceId],R,ae.bucketIndex,ae.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,I);for(const we in le){const pe=J[we]=J[we]||[],ye=le[we];ye.sort((Le,Ve)=>{const He=ae.featureSortOrder;if(He){const Ge=He.indexOf(Le.featureIndex);return He.indexOf(Ve.featureIndex)-Ge}return Ve.featureIndex-Le.featureIndex});for(const Le of ye)pe.push(Le)}}for(const ae in J)J[ae].forEach(le=>{const we=le.feature,pe=N(I[ae]).getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=pe});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,u){u&&u.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const m=this._getSourceCaches(r);let y=[];for(const v of m)y=y.concat(Xe(v,u));return y}addSourceType(r,u,m){return ho.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(ho.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const M in r)if(!T(r[M],m[M])){y=!0;break}if(!y)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,u),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,u=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(u===1){if(typeof r.source=="object"){const m="terrain-dem-src";this.addSource(m,r.source),r=a.clone$1(r),r=a.extend(r,{source:m})}if(this._validate(a.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(r,u);else{const m=this.terrain,y=m.get();for(const v of Object.keys(a.spec.terrain))!r.hasOwnProperty(v)&&a.spec.terrain[v].default&&(r[v]=a.spec.terrain[v].default);for(const v in r)if(!T(r[v],y[v])){m.set(r),this.stylesheet.terrain=r;const M=this._setTransitionParameters({duration:0});m.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const u=this.fog=new et(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,m=u.get();Object.keys(r).length===0&&u.set(r);for(const y in r)if(!T(r[y],m[y])){u.set(r),this.stylesheet.fog=r;const v=this._setTransitionParameters({duration:0});u.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:a.exported.now(),transition:a.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),u=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...u)}_createTerrain(r,u){const m=this.terrain=new ct(r,u);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(const r in this._layers){const u=this._layers[r];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const u=this._layers[r];u.type==="symbol"&&this._updateLayer(u)}}_validate(r,u,m,y,v={}){return(!v||v.validate!==!1)&&Ul(this,r.call(a.validateStyle,a.extend({key:u,style:this.serialize(),value:m,styleSpec:a.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const u=this._getSourceCaches(r);for(const m of u)m.clearTiles()}_reloadSource(r){const u=this._getSourceCaches(r);for(const m of u)m.resume(),m.reload()}_updateSources(r){for(const u in this._sourceCaches)this._sourceCaches[u].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const u=this._sourceCaches[r];u.resume(),u.reload()}}_updatePlacement(r,u,m,y,v=!1){let M=!1,E=!1;const I={};for(const R of this._order){const N=this._layers[R];if(N.type!=="symbol")continue;if(!I[N.source]){const Y=this._getLayerSourceCache(N);if(!Y)continue;I[N.source]=Y.getRenderableIds(!0).map(ie=>Y.getTileByID(ie)).sort((ie,oe)=>oe.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(oe.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(N,I[N.source],r.center.lng,r.projection);M=M||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),r.zoom))&&(this.pauseablePlacement=new ud(r,this._order,v,u,m,y,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),E=!0),M&&this.pauseablePlacement.placement.setStale()),E||M)for(const R of this._order){const N=this._layers[R];N.type==="symbol"&&this.placement.updateLayerOpacities(N,I[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(u.tileID.key,u.type,u.icons)};y(this._otherSourceCaches[u.source]),y(this._symbolSourceCaches[u.source])}getGlyphs(r,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(r,u,m){return a.makeRequest(u,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const u=[];return this._otherSourceCaches[r]&&u.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&u.push(this._symbolSourceCaches[r]),u}_isSourceCacheLoaded(r){const u=this._getSourceCaches(r);return u.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ho.getSourceType=function(f){return te[f]},ho.setSourceType=function(f,r){te[f]=r},ho.registerForPluginStateChange=a.registerForPluginStateChange;var fd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,pd="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Vl={},Zo={};Vl=Vn("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Zo=Vn(`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const iu=Vn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),La=fd,Da=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ru={background:Vn(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Vn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Vn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Vn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Vn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Vn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Vn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Vn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Vn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Vn(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Vn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Vn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Vn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Vn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Vn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Vn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Vn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Vn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Vn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Vn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Vn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,pd),skyboxGradient:Vn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,pd),skyboxCapture:Vn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Vn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Vn(f,r,u){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),M=f.match(y),E=r.match(y),I=fd.match(y);let R=E?E.concat(M):M;u||(Vl.staticUniforms&&(R=Vl.staticUniforms.concat(R)),Zo.staticUniforms&&(R=Zo.staticUniforms.concat(R))),R&&(R=R.concat(I));const N={};return{fragmentSource:f=f.replace(m,(j,Y,ie,oe,J)=>(N[J]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${ie} ${oe} ${J};
#else
uniform ${ie} ${oe} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${ie} ${oe} ${J} = u_${J};
#endif
`)),vertexSource:r=r.replace(m,(j,Y,ie,oe,J)=>{const _e=oe==="float"?"vec2":"vec4",Q=J.match(/color/)?"color":_e;return N[J]?Y==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${ie} ${_e} a_${J};
varying ${ie} ${oe} ${J};
#else
uniform ${ie} ${oe} u_${J};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${ie} ${oe} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${Q}(a_${J}, u_${J}_t);
#else
    ${ie} ${oe} ${J} = u_${J};
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${ie} ${_e} a_${J};
#else
uniform ${ie} ${oe} u_${J};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${ie} ${oe} ${J} = a_${J};
#else
    ${ie} ${oe} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${ie} ${oe} ${J} = unpack_mix_${Q}(a_${J}, u_${J}_t);
#else
    ${ie} ${oe} ${J} = u_${J};
#endif
`}),staticAttributes:v,staticUniforms:R}}class Op{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,u,m,y,v,M,E,I,R){this.context=r;let N=this.boundPaintVertexBuffers.length!==y.length;for(let j=0;!N&&j<y.length;j++)this.boundPaintVertexBuffers[j]!==y[j]&&(N=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===m&&!N&&this.boundIndexBuffer===v&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===R?(r.bindVertexArrayOES.set(this.vao),E&&E.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),R&&R.bind()):this.freshBind(u,m,y,v,M,E,I,R)}freshBind(r,u,m,y,v,M,E,I){let R;const N=r.numAttributes,j=this.context,Y=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=I;else{R=j.currentNumAttributes||0;for(let ie=N;ie<R;ie++)Y.disableVertexAttribArray(ie)}u.enableAttributes(Y,r);for(const ie of m)ie.enableAttributes(Y,r);M&&M.enableAttributes(Y,r),E&&E.enableAttributes(Y,r),I&&I.enableAttributes(Y,r),u.bind(),u.setVertexAttribPointers(Y,r,v);for(const ie of m)ie.bind(),ie.setVertexAttribPointers(Y,r,v);M&&(M.bind(),M.setVertexAttribPointers(Y,r,v)),y&&y.bind(),E&&(E.bind(),E.setVertexAttribPointers(Y,r,v)),I&&(I.bind(),I.setVertexAttribPointers(Y,r,v)),j.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function md(f,r){const u=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new a.MercatorCoordinate(0,m/u).toLngLat().lat,new a.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}function Np(f,r,u,m,y,v,M){const E=f.context,I=E.gl,R=u.fbo;if(!R)return;f.prepareDrawTile();const N=f.useProgram("hillshade");E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get());const j=((J,_e,Q,ae)=>{const le=Q.paint.get("hillshade-shadow-color"),we=Q.paint.get("hillshade-highlight-color"),pe=Q.paint.get("hillshade-accent-color");let ye=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=J.transform.angle);const Le=!J.options.moving;return{u_matrix:ae||J.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),Le),u_image:0,u_latrange:md(0,_e.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),ye],u_shadow:le,u_highlight:we,u_accent:pe}})(f,u,m,f.terrain?r.projMatrix:null);f.prepareDrawProgram(E,N,r.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ie,tileBoundsSegments:oe}=f.getTileBoundsBuffers(u);N.draw(E,I.TRIANGLES,y,v,M,a.CullFaceMode.disabled,j,m.id,Y,ie,oe)}function ou(f,r,u){if(!r.needsDEMTextureUpload)return;const m=f.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(u.stride);const v=u.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new a.Texture(m,v,y.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function su(f,r,u,m,y,v){const M=f.context,E=M.gl;if(!r.dem)return;const I=r.dem;if(M.activeTexture.set(E.TEXTURE1),ou(f,r,I),!r.demTexture)return;r.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const R=I.dim;M.activeTexture.set(E.TEXTURE0);let N=r.fbo;if(!N){const oe=new a.Texture(M,{width:R,height:R,data:null},E.RGBA);oe.bind(E.LINEAR,E.CLAMP_TO_EDGE),N=r.fbo=M.createFramebuffer(R,R,!0),N.colorAttachment.set(oe.texture)}M.bindFramebuffer.set(N.framebuffer),M.viewport.set([0,0,R,R]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Y,tileBoundsSegments:ie}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(M,E.TRIANGLES,m,y,v,a.CullFaceMode.disabled,((oe,J)=>{const _e=J.stride,Q=a.create();return a.ortho(Q,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(Q,Q,[0,-a.EXTENT,0]),{u_matrix:Q,u_image:1,u_dimension:[_e,_e],u_zoom:oe.overscaledZ,u_unpack:J.unpackVector}})(r.tileID,I),u.id,j,Y,ie),r.needsHillshadePrepare=!1}const au=(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_image0:new a.Uniform1i(f,r.u_image0),u_skirt_height:new a.Uniform1f(f,r.u_skirt_height)}),lu=(f,r)=>({u_matrix:f,u_image0:0,u_skirt_height:r}),Rn=(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:M,u_frustum_tr:E,u_frustum_br:I,u_frustum_bl:R,u_globe_pos:N,u_globe_radius:j,u_viewport:Y,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9)});function Gl(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}const Hs=new class{constructor(){this.operations={}}newMorphing(f,r,u,m,y){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==u.tileID.key&&(v.queued=u)}else this.operations[f]={startTime:m,phase:0,duration:y,from:r,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const u=this.operations[r];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},jl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Up(f,r){const u=1<<f.z;return!r&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}const Wl=f=>({u_matrix:f});function _d(f,r,u,m,y){if(y>0){const v=a.exported.now(),M=(v-f.timeAdded)/y,E=r?(v-r.timeAdded)/y:-1,I=u.getSource(),R=m.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),N=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),j=N&&f.refreshedUponExpiration?1:a.clamp(N?M:1-E,0,1);return f.refreshedUponExpiration&&M>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class fy extends a.SourceCache{constructor(r){const u={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new gt(sn(),null),y=ce("mock-dem",u,m,r.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,u){r.state="loaded",u(null)}}class py extends a.SourceCache{constructor(r){const u=ce("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new gt(sn(),null),r.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,u,m){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,M)=>{if(v[M.key]="",!this._tiles[M.key]){const E=new a.Tile(M,this._source.tileSize*M.overscaleFactor(),r.tileZoom);E.state="loaded",this._tiles[M.key]=E}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const u=this.proxyCachedFBO[r];if(u!==void 0){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class cu extends a.OverscaledTileID{constructor(r,u,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class gd extends a.Elevation{constructor(r,u){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,v]=function(I){const R=new a.StructArrayLayout4i8,N=new a.StructArrayLayout3ui6,j=131;R.reserve(17161),N.reserve(33800);const Y=a.EXTENT/128,ie=a.EXTENT+Y/2,oe=ie+Y;for(let _e=-Y;_e<oe;_e+=Y)for(let Q=-Y;Q<oe;Q+=Y){const ae=Q<0||Q>ie||_e<0||_e>ie?24575:0,le=a.clamp(Math.round(Q),0,a.EXTENT),we=a.clamp(Math.round(_e),0,a.EXTENT);R.emplaceBack(le+ae,we,le,we)}const J=(_e,Q)=>{const ae=Q*j+_e;N.emplaceBack(ae+1,ae,ae+j),N.emplaceBack(ae+j,ae+j+1,ae+1)};for(let _e=1;_e<129;_e++)for(let Q=1;Q<129;Q++)J(Q,_e);return[0,129].forEach(_e=>{for(let Q=0;Q<130;Q++)J(Q,_e),J(_e,Q)}),[R,N,32768]}(),M=r.context;this.gridBuffer=M.createVertexBuffer(m,a.boundsAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(y),this.gridSegments=a.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new py(u.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const E=M.gl;this._overlapStencilMode=new a.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fy(u.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,u,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const y=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(u,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),u.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=u.getIds().map(I=>{const R=u.getTileByID(I).tileID;return R.projMatrix=m.calculateProjMatrix(R.toUnwrapped()),R});(function(I,R){const N=R.transform.pointCoordinate(R.transform.getCameraPoint()),j=new a.pointGeometry(N.x,N.y);I.sort((Y,ie)=>{if(ie.overscaledZ-Y.overscaledZ)return ie.overscaledZ-Y.overscaledZ;const oe=new a.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),J=new a.pointGeometry(ie.canonical.x+(1<<ie.canonical.z)*ie.wrap,ie.canonical.y),_e=j.mult(1<<Y.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(oe)-_e.distSqr(J)})})(y,this.painter),this._previousZoom=m.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const I in M){const R=M[I];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[I],v),R.usedForTerrain))continue;const N=r[I];R.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[u.id]=y.map(I=>new cu(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const E={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const R=this.terrainTileForTile[I.key];if(!R)continue;const N=R.tileID.key;N in E||(this._visibleDemTiles.push(R),E[N]=N)}}_assignTerrainTiles(r){this._initializing||r.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,u=r.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(u.TEXTURE1),ou(this.painter,y,v))}}_prepareDemTileUniforms(r,u,m,y){if(!u||u.demTexture==null)return!1;const v=r.tileID.canonical,M=Math.pow(2,u.tileID.canonical.z-v.z),E=y||"";return m[`u_dem_tl${E}`]=[v.x*M%1,v.y*M%1],m[`u_dem_scale${E}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,u=r.gl;if(!this._emptyDepthBufferTexture){const m=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(r,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const u=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const v=y.dem.tree.minimums[0];return v>0&&r++,m+v},0);return r?u/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,u=r.gl;r.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),y=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new a.Texture(r,y,u.RGBA,{premultiply:!1}),v}setupElevationDraw(r,u,m){const y=this.painter.context,v=y.gl,M=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();const I=this.painter.transform,R=I.projection,N=r.tileID.canonical;M.u_tile_tl_up=R.upVector(N,0,0),M.u_tile_tr_up=R.upVector(N,a.EXTENT,0),M.u_tile_br_up=R.upVector(N,a.EXTENT,a.EXTENT),M.u_tile_bl_up=R.upVector(N,0,a.EXTENT),M.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?a.GLOBE_METERS_TO_ECEF:R.upVectorScale(N,I.center.lat,I.worldSize).metersToTile;let j=null,Y=null,ie=1;if(m&&m.morphing&&this._useVertexMorphing){const oe=m.morphing.srcDemTile,J=m.morphing.dstDemTile;ie=m.morphing.phase,oe&&J&&(this._prepareDemTileUniforms(r,oe,M,"_prev")&&(Y=oe),this._prepareDemTileUniforms(r,J,M)&&(j=J))}if(Y&&j?(y.activeTexture.set(v.TEXTURE2),j.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),Y.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),M.u_dem_lerp=ie):(j=this.terrainTileForTile[r.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,j,M)?j.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),y.activeTexture.set(v.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&j){const oe=(1<<j.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=oe}m&&m.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(y,M)}renderToBackBuffer(r){const u=this.painter,m=this.painter.context;r.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,M,E,I){if(y.transform.projection.name==="globe")(function(R,N,j,Y,ie){const oe=R.context,J=oe.gl;let _e,Q;const ae=R.options.showTerrainWireframe?2:0,le=R.transform,we=a.globeUseCustomAntiAliasing(R,oe,le),pe=(ve,at)=>{if(Q===ve)return;const rt=[jl[ve],"PROJECTION_GLOBE_VIEW"];we&&rt.push("CUSTOM_ANTIALIASING"),at&&rt.push(jl[ae]),_e=R.useProgram("globeRaster",null,rt),Q=ve},ye=R.colorModeForRenderPass(),Le=new a.DepthMode(J.LEQUAL,a.DepthMode.ReadWrite,R.depthRangeFor3D);Hs.update(ie);const Ve=a.calculateGlobeMercatorMatrix(le),He=[a.mercatorXfromLng(le.center.lng),a.mercatorYfromLat(le.center.lat)],Ge=R.globeSharedBuffers,Ue=[le.width*a.exported.devicePixelRatio,le.height*a.exported.devicePixelRatio];if((ae?[!1,!0]:[!1]).forEach(ve=>{Q=-1;const at=ve?J.LINES:J.TRIANGLES;for(const rt of Y){const It=j.getTile(rt),Ke=a.StencilMode.disabled,Jt=N.prevTerrainTileForTile[rt.key],Ct=N.terrainTileForTile[rt.key];Gl(Jt,Ct)&&Hs.newMorphing(rt.key,Jt,Ct,ie,250),oe.activeTexture.set(J.TEXTURE0),It.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Tt=Hs.getMorphValuesForProxy(rt.key),_t=Tt?1:0,St={useDenormalizedUpVectorScale:!0};Tt&&a.extend$1(St,{morphing:{srcDemTile:Tt.from,dstDemTile:Tt.to,phase:a.easeCubicInOut(Tt.phase)}});const ln=Float32Array.from(le.globeMatrix),en=a.globeTileLatLngCorners(rt.canonical),vn=a.getLatitudinalLod((en[0][0]+en[1][0])/2),Kt=a.getGridMatrix(rt.canonical,en,vn),gn=a.globeNormalizeECEF(a.globeTileBounds(rt.canonical)),Gn=Rn(le.projMatrix,ln,Ve,gn,a.globeToMercatorTransition(le.zoom),He,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Ue,Kt);if(pe(_t,ve),N.setupElevationDraw(It,_e,St),R.prepareDrawProgram(oe,_e,rt.toUnwrapped()),Ge){const[Xn,Ai,Qn]=ve?Ge.getWirefameBuffers(R.context,vn):Ge.getGridBuffers(vn);_e.draw(oe,at,Le,Ke,ye,a.CullFaceMode.backCCW,Gn,"globe_raster",Xn,Ai,Qn)}}}),Ge){const ve=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];we&&ve.push("CUSTOM_ANTIALIASING"),_e=R.useProgram("globeRaster",null,ve);for(const at of Y){const{x:rt,y:It,z:Ke}=at.canonical,Jt=It===0,Ct=It===(1<<Ke)-1,[Tt,_t,St,ln]=Ge.getPoleBuffers(Ke);if(ln&&(Jt||Ct)){const en=j.getTile(at);oe.activeTexture.set(J.TEXTURE0),en.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let vn=a.globePoleMatrixForTile(Ke,rt,le);const Kt=a.globeNormalizeECEF(a.globeTileBounds(at.canonical)),gn=(Gn,Xn)=>Gn.draw(oe,J.TRIANGLES,Le,a.StencilMode.disabled,ye,a.CullFaceMode.disabled,Rn(le.projMatrix,vn,vn,Kt,0,He,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Ue),"globe_pole_raster",Xn,St,ln);N.setupElevationDraw(en,_e,{}),R.prepareDrawProgram(oe,_e,at.toUnwrapped()),Jt&&gn(_e,Tt),Ct&&(vn=a.scale(a.create(),vn,[1,-1,1]),gn(_e,_t))}}}})(y,v,M,E,I);else{const R=y.context,N=R.gl;let j,Y;const ie=y.options.showTerrainWireframe?2:0,oe=(le,we)=>{if(Y===le)return;const pe=[jl[le]];we&&pe.push(jl[ie]),j=y.useProgram("terrainRaster",null,pe),Y=le},J=y.colorModeForRenderPass(),_e=new a.DepthMode(N.LEQUAL,a.DepthMode.ReadWrite,y.depthRangeFor3D);Hs.update(I);const Q=y.transform,ae=6*Math.pow(1.5,22-Q.zoom)*v.exaggeration();(ie?[!1,!0]:[!1]).forEach(le=>{Y=-1;const we=le?N.LINES:N.TRIANGLES,[pe,ye]=le?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const Le of E){const Ve=M.getTile(Le),He=a.StencilMode.disabled,Ge=v.prevTerrainTileForTile[Le.key],Ue=v.terrainTileForTile[Le.key];Gl(Ge,Ue)&&Hs.newMorphing(Le.key,Ge,Ue,I,250),R.activeTexture.set(N.TEXTURE0),Ve.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const ve=Hs.getMorphValuesForProxy(Le.key),at=ve?1:0;let rt;ve&&(rt={morphing:{srcDemTile:ve.from,dstDemTile:ve.to,phase:a.easeCubicInOut(ve.phase)}});const It=lu(Le.projMatrix,Up(Le.canonical,Q.renderWorldCopies)?ae/10:ae);oe(at,le),v.setupElevationDraw(Ve,j,rt),y.prepareDrawProgram(R,j,Le.toUnwrapped()),j.draw(R,we,_e,He,J,a.CullFaceMode.backCCW,It,"terrain_raster",v.gridBuffer,pe,ye)}})}}(u,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],M=this._drapedRenderBatches.shift(),E=[],I=u.style.order;let R=0;for(const N of v){const j=y.getTileByID(N.proxyTileKey),Y=y.proxyCachedFBO[N.key]?y.proxyCachedFBO[N.key][r]:void 0,ie=Y!==void 0?y.renderCache[Y]:this.pool[R++],oe=Y!==void 0;if(j.texture=ie.tex,oe&&!ie.dirty){E.push(j.tileID);continue}let J;m.bindFramebuffer.set(ie.fb.framebuffer),this.renderedToTile=!1,ie.dirty&&(m.clear({color:a.Color.transparent,stencil:0}),ie.dirty=!1);for(let _e=M.start;_e<=M.end;++_e){const Q=u.style._layers[I[_e]];if(Q.isHidden(u.transform.zoom))continue;const ae=u.style._getLayerSourceCache(Q),le=ae?this.proxyToSource[N.key][ae.id]:[N];if(!le)continue;const we=le;m.viewport.set([0,0,ie.fb.width,ie.fb.height]),J!==(ae?ae.id:null)&&(this._setupStencil(ie,le,Q,ae),J=ae?ae.id:null),u.renderLayer(u,ae,Q,we)}this.renderedToTile?(ie.dirty=!0,E.push(j.tileID)):oe||--R,R===5&&(R=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),M.end+1}postRender(){}renderCacheEfficiency(r){const u=r.order.length;if(u===0)return{efficiency:100};let m,y=0,v=0,M=!1;for(let E=0;E<u;++E){const I=r._layers[r.order[E]];this._style.isLayerDraped(I)?(M&&++y,++v):M||(M=!0,m=I.id)}return v===0?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{r=Math.min(r,u.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,u,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const M=v.tileID,E=Math.pow(2,M.overscaledZ),{x:I,y:R}=M.canonical,N=I/E,j=(I+1)/E,Y=R/E,ie=(R+1)/E;return{minx:N,miny:Y,maxx:j,maxy:ie,t:v.dem.tree.raycastRoot(N,Y,j,ie,r,u,m),tile:v}});y.sort((v,M)=>(v.t!==null?v.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const v of y){if(v.t==null)return null;const M=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,u,m);if(M!=null)return M}return null}_createFBO(){const r=this.painter.context,u=r.gl,m=this.drapeBufferSize;r.activeTexture.set(u.TEXTURE0);const y=new a.Texture(r,{width:m[0],height:m[1],data:null},u.RGBA);y.bind(u.LINEAR,u.CLAMP_TO_EDGE);const v=r.createFramebuffer(m[0],m[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new V(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const u=this._style._layers[r],m=u.isHidden(this.painter.transform.zoom),y=u.getCrossfadeParameters(),v=!!y&&y.t!==1,M=u.hasTransition();return u.type!=="custom"&&!m&&(v||M)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof xe){r=!0;break}if(r)for(let u=0;u<this._style.order.length;++u){const m=this._style._layers[this._style.order[u]],y=m.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(m);if(m.type!=="raster"||y||!v)continue;const M=m.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const I=this.proxyToSource[E.key][v.id];if(I)for(const R of I){const N=_d(v.getTile(R),v.findLoadedParent(R,0),v,this.painter.transform,M);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(v.id,R)}}}}_setupDrapedRenderBatches(){const r=this._style.order,u=r.length;if(u===0)return;const m=[];let y,v=0,M=this._style._layers[r[v]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++v<u;)M=this._style._layers[r[v]];for(;v<u;++v){const E=this._style._layers[r[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?y===void 0&&(y=v):y!==void 0&&(m.push({start:y,end:v-1}),y=void 0))}y!==void 0&&m.push({start:y,end:v-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const M=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let E=0;E<M.length;++E){const I=Object.values(M[E]);u.renderCachePool.push(...I)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let M=m.length-1;M>=0;M--){const E=m[M];if(u.getTileByID(E.key),u.proxyCachedFBO[E.key]!==void 0){const I=r[E.key],R=this.proxyToSource[E.key];let N=0;for(const j in R){const Y=R[j],ie=I[j];if(!ie||ie.length!==Y.length||Y.some((oe,J)=>oe!==ie[J]||y[j]&&y[j].hasOwnProperty(oe.key))){N=-1;break}++N}for(const j in u.proxyCachedFBO[E.key])u.renderCache[u.proxyCachedFBO[E.key][j]].dirty=N<0||N!==Object.values(I).length}}const v=[...this._drapedRenderBatches];v.sort((M,E)=>E.end-E.start-(M.end-M.start));for(const M of v)for(const E of m){if(u.proxyCachedFBO[E.key])continue;let I=u.renderCachePool.pop();I===void 0&&u.renderCache.length<50&&(I=u.renderCache.length,u.renderCache.push(this._createFBO())),I!==void 0&&(u.proxyCachedFBO[E.key]={},u.proxyCachedFBO[E.key][M.start]=I,u.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(r,u,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,M=v.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let E;if(m.isTileClipped())E=u.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(r,u){const m=this.painter,y=this.painter.context,v=y.gl;m._tileClippingMaskIDs={},y.setColorMode(a.ColorMode.disabled),y.setDepthMode(a.DepthMode.disabled);const M=m.useProgram("clippingMask");for(const E of r){const I=m._tileClippingMaskIDs[E.key]=--u;M.draw(y,v.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:v.ALWAYS,mask:0},I,255,v.KEEP,v.KEEP,v.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Wl(E.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const u=this.painter.transform;if(r.x<0||r.x>u.width||r.y<0||r.y>u.height)return null;const m=[r.x,r.y,1,1];a.transformMat4$1(m,m,u.pixelMatrixInverse),a.scale$1(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const y=u._camera.position,v=a.mercatorZfromAltitude(1,u.center.lat),M=[y[0],y[1],y[2]/v,0],E=a.subtract([],m.slice(0,3),M);a.normalize(E,E);const I=this.raycast(M,E,this._exaggeration);return I!==null&&I?(a.scaleAndAdd(M,M,E,I),M[3]=M[2],M[2]*=v,M):null}drawDepth(){const r=this.painter,u=r.context,m=this.proxySourceCache,y=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=u.gl,E=u.createFramebuffer(y,v,!0);u.activeTexture.set(M.TEXTURE0);const I=new a.Texture(u,{width:y,height:v,data:null},M.RGBA);I.bind(M.NEAREST,M.CLAMP_TO_EDGE),E.colorAttachment.set(I.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,y,v);E.depthAttachment.set(R),this._depthFBO=E,this._depthTexture=I}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,y,v]),function(M,E,I,R){if(M.transform.projection.name==="globe")return;const N=M.context,j=N.gl;N.clear({depth:1});const Y=M.useProgram("terrainDepth"),ie=new a.DepthMode(j.LESS,a.DepthMode.ReadWrite,M.depthRangeFor3D);for(const oe of R){const J=I.getTile(oe),_e=lu(oe.projMatrix,0);E.setupElevationDraw(J,Y),Y.draw(N,j.TRIANGLES,ie,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,_e,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,u,m){if(r.getSource()instanceof re)return this._setupProxiedCoordsForImageSource(r,u,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let E=0;E<v.length;E++){const I=v[E],R=this._findTileCoveringTileID(I,r);if(R){const N=this._createProxiedId(I,R,m[I.key]&&m[I.key][r.id]);y.push(N),this.proxyToSource[I.key][r.id]=[N]}}let M=!1;for(let E=0;E<u.length;E++){const I=r.getTile(u[E]);if(!I||!I.hasData())continue;const R=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==I.tileID.canonical.z){const N=this.proxyToSource[R.tileID.key][r.id],j=this._createProxiedId(R.tileID,I,m[R.tileID.key]&&m[R.tileID.key][r.id]);N?N.splice(N.length-1,0,j):this.proxyToSource[R.tileID.key][r.id]=[j],y.push(j),M=!0}}this._sourceTilesOverlap[r.id]=M}_setupProxiedCoordsForImageSource(r,u,m){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords,M=r.getSource(),E=new a.pointGeometry(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),I=M.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((N,j)=>(N.min.x=Math.min(N.min.x,j.x-E.x),N.min.y=Math.min(N.min.y,j.y-E.y),N.max.x=Math.max(N.max.x,j.x-E.x),N.max.y=Math.max(N.max.y,j.y-E.y),N),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(N,j)=>{const Y=N.wrap+N.canonical.x/(1<<N.canonical.z),ie=N.canonical.y/(1<<N.canonical.z),oe=a.EXTENT/(1<<N.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),_e=j.canonical.y/(1<<j.canonical.z);return Y+oe<J+I.min.x||Y>J+I.max.x||ie+oe<_e+I.min.y||ie>_e+I.max.y};for(let N=0;N<v.length;N++){const j=v[N];for(let Y=0;Y<u.length;Y++){const ie=r.getTile(u[Y]);if(!ie||!ie.hasData()||R(j,ie.tileID))continue;const oe=this._createProxiedId(j,ie,m[j.key]&&m[j.key][r.id]),J=this.proxyToSource[j.key][r.id];J?J.push(oe):this.proxyToSource[j.key][r.id]=[oe],y.push(oe)}}}_createProxiedId(r,u,m){let y=this.orthoMatrix;if(m){const v=m.find(M=>M.key===u.tileID.key);if(v)return v}if(u.tileID.key!==r.key){const v=r.canonical.z-u.tileID.canonical.z;let M,E,I;y=a.create();const R=u.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(M=a.EXTENT>>v,E=M*((u.tileID.canonical.x<<v)-r.canonical.x+R),I=M*((u.tileID.canonical.y<<v)-r.canonical.y)):(M=a.EXTENT<<-v,E=a.EXTENT*(u.tileID.canonical.x-(r.canonical.x+R<<-v)),I=a.EXTENT*(u.tileID.canonical.y-(r.canonical.y<<-v))),a.ortho(y,0,M,0,M,0,1),a.translate(y,y,[E,I,0])}return new cu(u.tileID,r.key,y)}_findTileCoveringTileID(r,u){let m=u.getTile(r);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[u.id],v=y[r.key];if(m=v?u.getTileByID(v):null,m&&m.hasData()||v===null)return m;let M=m?m.tileID:r,E=M.overscaledZ;const I=u.getSource().minzoom,R=[];if(!v){const j=u.getSource().maxzoom;if(r.canonical.z>=j){const Y=r.canonical.z-j;u.getSource().reparseOverscaled?(E=Math.max(r.canonical.z+2,u.transform.tileZoom),M=new a.OverscaledTileID(E,r.wrap,j,r.canonical.x>>Y,r.canonical.y>>Y)):Y!==0&&(E=j,M=new a.OverscaledTileID(E,r.wrap,j,r.canonical.x>>Y,r.canonical.y>>Y))}M.key!==r.key&&(R.push(M.key),m=u.getTile(M))}const N=j=>{R.forEach(Y=>{y[Y]=j}),R.length=0};for(E-=1;E>=I&&(!m||!m.hasData());E--){m&&N(m.tileID.key);const j=M.calculateScaledKey(E);if(m=u.getTileByID(j),m&&m.hasData())break;const Y=y[j];if(Y===null)break;Y===void 0?R.push(j):m=u.getTileByID(Y)}return N(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,u){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(u){let m=0;const y=new a.StructArrayLayout2ui4,v=131;for(let M=1;M<129;M++){for(let E=1;E<129;E++)m=M*v+E,y.emplaceBack(m,m+1),y.emplaceBack(m,m+v),y.emplaceBack(m+1,m+v),M===128&&y.emplaceBack(m+v,m+v+1);y.emplaceBack(m+1,m+1+v)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function uu(f){const r=[];for(let u=0;u<f.length;u++){if(f[u]===null)continue;const m=f[u].split(" ");r.push(m.pop())}return r}class hu{static cacheKey(r,u,m){let y=`${r}${m?m.cacheKey:""}`;for(const v of u)y+=`/${v}`;return y}constructor(r,u,m,y,v,M){const E=r.gl;this.program=E.createProgram();const I=uu(m.staticAttributes),R=y?y.getBinderAttributes():[],N=I.concat(R),j=m.staticUniforms?uu(m.staticUniforms):[],Y=y?y.getBinderUniforms():[],ie=j.concat(Y),oe=[];for(const pe of ie)oe.indexOf(pe)<0&&oe.push(pe);let J=y?y.defines():[];J=J.concat(M.map(pe=>`#define ${pe}`));const _e=J.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Da):Da,Da,La,iu.fragmentSource,Zo.fragmentSource,m.fragmentSource).join(`
`),Q=J.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,La,iu.vertexSource,Zo.vertexSource,Vl.vertexSource,m.vertexSource).join(`
`),ae=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(ae,_e),E.compileShader(ae),E.attachShader(this.program,ae);const le=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(le,Q),E.compileShader(le),E.attachShader(this.program,le),this.attributes={};const we={};this.numAttributes=N.length;for(let pe=0;pe<this.numAttributes;pe++)N[pe]&&(E.bindAttribLocation(this.program,pe,N[pe]),this.attributes[N[pe]]=pe);E.linkProgram(this.program),E.deleteShader(le),E.deleteShader(ae);for(let pe=0;pe<oe.length;pe++){const ye=oe[pe];if(ye&&!we[ye]){const Le=E.getUniformLocation(this.program,ye);Le&&(we[ye]=Le)}}this.fixedUniforms=v(r,we),this.binderUniforms=y?y.getUniforms(r,we):[],M.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((pe,ye)=>({u_dem:new a.Uniform1i(pe,ye.u_dem),u_dem_prev:new a.Uniform1i(pe,ye.u_dem_prev),u_dem_unpack:new a.Uniform4f(pe,ye.u_dem_unpack),u_dem_tl:new a.Uniform2f(pe,ye.u_dem_tl),u_dem_scale:new a.Uniform1f(pe,ye.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(pe,ye.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(pe,ye.u_dem_scale_prev),u_dem_size:new a.Uniform1f(pe,ye.u_dem_size),u_dem_lerp:new a.Uniform1f(pe,ye.u_dem_lerp),u_exaggeration:new a.Uniform1f(pe,ye.u_exaggeration),u_depth:new a.Uniform1i(pe,ye.u_depth),u_depth_size_inv:new a.Uniform2f(pe,ye.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(pe,ye.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(pe,ye.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(pe,ye.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(pe,ye.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(pe,ye.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(pe,ye.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(pe,ye.u_tile_up_scale)}))(r,we)),M.indexOf("FOG")!==-1&&(this.fogUniforms=((pe,ye)=>({u_fog_matrix:new a.UniformMatrix4f(pe,ye.u_fog_matrix),u_fog_range:new a.Uniform2f(pe,ye.u_fog_range),u_fog_color:new a.Uniform4f(pe,ye.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(pe,ye.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(pe,ye.u_fog_temporal_offset),u_frustum_tl:new a.Uniform3f(pe,ye.u_frustum_tl),u_frustum_tr:new a.Uniform3f(pe,ye.u_frustum_tr),u_frustum_br:new a.Uniform3f(pe,ye.u_frustum_br),u_frustum_bl:new a.Uniform3f(pe,ye.u_frustum_bl),u_globe_pos:new a.Uniform3f(pe,ye.u_globe_pos),u_globe_radius:new a.Uniform1f(pe,ye.u_globe_radius),u_globe_transition:new a.Uniform1f(pe,ye.u_globe_transition),u_is_globe:new a.Uniform1i(pe,ye.u_is_globe),u_viewport:new a.Uniform2f(pe,ye.u_viewport)}))(r,we))}setTerrainUniformValues(r,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in u)m[y].set(u[y])}}setFogUniformValues(r,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in u)m[y].location&&m[y].set(u[y])}}draw(r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J,_e,Q){const ae=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(y),r.setColorMode(v),r.setCullFace(M);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(E[we]);oe&&oe.setUniforms(r,this.binderUniforms,Y,{zoom:ie});const le={[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[u];for(const we of j.get()){const pe=we.vaos||(we.vaos={});(pe[I]||(pe[I]=new Op)).bind(r,this,R,oe?oe.getPaintVertexBuffers():[],N,we.vertexOffset,J,_e,Q),ae.drawElements(u,we.primitiveLength*le,ae.UNSIGNED_SHORT,we.primitiveOffset*le*2)}}}function yd(f,r,u){const m=1/jt(u,1,r.transform.tileZoom),y=Math.pow(2,u.tileID.overscaledZ),v=u.tileSize*Math.pow(2,r.transform.tileZoom)/y,M=v*(u.tileID.canonical.x+u.tileID.wrap*y),E=v*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[m,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[M>>16,E>>16],u_pixel_coord_lower:[65535&M,65535&E]}}const Vp=a.create(),Gp=(f,r,u,m,y,v,M,E,I)=>{const R=r.style.light,N=R.properties.get("position"),j=[N.x,N.y,N.z],Y=a.create$1();R.properties.get("anchor")==="viewport"&&(a.fromRotation(Y,-r.transform.angle),a.transformMat3(j,j,Y));const ie=R.properties.get("color"),oe=r.transform,J={u_matrix:f,u_lightpos:j,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return oe.projection.name==="globe"&&(J.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],J.u_zoom_transition=M,J.u_inv_rot_matrix=I,J.u_merc_center=E,J.u_up_dir=oe.projection.upVector(new a.CanonicalTileID(0,0,0),E[0]*a.EXTENT,E[1]*a.EXTENT),J.u_height_lift=v),J},Hl=(f,r,u,m,y,v,M,E,I,R,N)=>{const j=Gp(f,r,u,m,y,E,I,R,N),Y={u_height_factor:-Math.pow(2,y.overscaledZ)/M.tileSize/8};return a.extend(j,yd(v,r,M),Y)},za=f=>({u_matrix:f}),xd=(f,r,u,m)=>a.extend(za(f),yd(u,r,m)),du=(f,r)=>({u_matrix:f,u_world:r}),vd=(f,r,u,m,y)=>a.extend(xd(f,r,u,m),{u_world:y}),Co=a.create(),wd=(f,r,u,m,y,v)=>{const M=f.transform,E=M.projection.name==="globe";let I;if(v.paint.get("circle-pitch-alignment")==="map")if(E){const N=a.globePixelsToTileUnits(M.zoom,r.canonical)*M._projectionScaler;I=Float32Array.from([N,0,0,N])}else I=M.calculatePixelsToTileUnitsMatrix(u);else I=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:f.translatePosMatrix(r.projMatrix,u,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:Co,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){R.u_inv_rot_matrix=m,R.u_merc_center=y,R.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],R.u_zoom_transition=a.globeToMercatorTransition(M.zoom);const N=y[0]*a.EXTENT,j=y[1]*a.EXTENT;R.u_up_dir=M.projection.upVector(new a.CanonicalTileID(0,0,0),N,j)}return R},jp=f=>{const r=[];return f.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},bd=(f,r,u,m)=>{const y=a.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/y,r.pixelsToGLUnits[1]/y]}},Sd=(f,r,u=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:u}),Md=a.create(),my=(f,r,u,m,y,v,M)=>{const E=f.transform,I=E.projection.name==="globe",R=I?a.globePixelsToTileUnits(E.zoom,r.canonical)*E._projectionScaler:jt(u,1,v),N={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:M,u_inv_rot_matrix:Md,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){N.u_inv_rot_matrix=m,N.u_merc_center=y,N.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],N.u_zoom_transition=a.globeToMercatorTransition(E.zoom);const j=y[0]*a.EXTENT,Y=y[1]*a.EXTENT;N.u_up_dir=E.projection.upVector(new a.CanonicalTileID(0,0,0),j,Y)}return N},Td=(f,r,u,m,y,v,M,E)=>{const I=f.transform,R=I.calculatePixelsToTileUnitsMatrix(r),N={u_matrix:Wp(f,r,u,y),u_pixels_to_tile_units:R,u_device_pixel_ratio:M,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:E};if(fu(u)){const j=$l(r,f.transform);N.u_texsize=r.lineAtlasTexture.size,N.u_scale=[j,m.fromScale,m.toScale],N.u_mix=m.t}return N},_y=(f,r,u,m,y,v)=>{const M=f.transform,E=$l(r,M);return{u_matrix:Wp(f,r,u,y),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:v,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function $l(f,r){return 1/jt(f,1,r.tileZoom)}function Wp(f,r,u,m){return f.translatePosMatrix(m||r.tileID.projMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function fu(f){const r=f.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const gy=(f,r,u,m,y,v)=>{return{u_matrix:f,u_tl_parent:r,u_scale_parent:u,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(E=y.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(M=y.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Ed(y.paint.get("raster-hue-rotate")),u_perspective_transform:v};var M,E};function Ed(f){f*=Math.PI/180;const r=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const Hp=a.create(),ql=(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J)=>{const _e=y.transform,Q={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:_e.width/_e.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:M,u_coord_matrix:E,u_is_text:+I,u_pitch_with_map:+m,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hp,u_up_vector:[0,-1,0]};return J.name==="globe"&&(Q.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],Q.u_zoom_transition=j,Q.u_inv_rot_matrix=ie,Q.u_merc_center=Y,Q.u_camera_forward=_e._camera.forward(),Q.u_ecef_origin=a.globeECEFOrigin(_e.globeMatrix,N.toUnwrapped()),Q.u_tile_matrix=Float32Array.from(_e.globeMatrix),Q.u_up_vector=oe),Q},$p=(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J,_e)=>a.extend(ql(f,r,u,m,y,v,M,E,I,R,j,Y,ie,oe,J,_e),{u_gamma_scale:m?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+N}),qp=(f,r,u,m,y,v,M,E,I,R,N,j,Y,ie,oe,J)=>a.extend($p(f,r,u,m,y,v,M,E,!0,I,!0,N,j,Y,ie,oe,J),{u_texsize_icon:R,u_texture_icon:1}),Zp=(f,r,u)=>({u_matrix:f,u_opacity:r,u_color:u}),ka=(f,r,u,m,y,v)=>a.extend(function(M,E,I,R){const N=I.imageManager.getPattern(M.from.toString()),j=I.imageManager.getPattern(M.to.toString()),{width:Y,height:ie}=I.imageManager.getPixelSize(),oe=Math.pow(2,R.tileID.overscaledZ),J=R.tileSize*Math.pow(2,I.transform.tileZoom)/oe,_e=J*(R.tileID.canonical.x+R.tileID.wrap*oe),Q=J*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[Y,ie],u_mix:E.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/jt(R,1,I.transform.tileZoom),u_pixel_coord_upper:[_e>>16,Q>>16],u_pixel_coord_lower:[65535&_e,65535&Q]}}(m,v,u,y),{u_matrix:f,u_opacity:r}),yy={fillExtrusion:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_lightpos:new a.Uniform3f(f,r.u_lightpos),u_lightintensity:new a.Uniform1f(f,r.u_lightintensity),u_lightcolor:new a.Uniform3f(f,r.u_lightcolor),u_vertical_gradient:new a.Uniform1f(f,r.u_vertical_gradient),u_opacity:new a.Uniform1f(f,r.u_opacity),u_tile_id:new a.Uniform3f(f,r.u_tile_id),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_up_dir:new a.Uniform3f(f,r.u_up_dir),u_height_lift:new a.Uniform1f(f,r.u_height_lift)}),fillExtrusionPattern:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_lightpos:new a.Uniform3f(f,r.u_lightpos),u_lightintensity:new a.Uniform1f(f,r.u_lightintensity),u_lightcolor:new a.Uniform3f(f,r.u_lightcolor),u_vertical_gradient:new a.Uniform1f(f,r.u_vertical_gradient),u_height_factor:new a.Uniform1f(f,r.u_height_factor),u_tile_id:new a.Uniform3f(f,r.u_tile_id),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_up_dir:new a.Uniform3f(f,r.u_up_dir),u_height_lift:new a.Uniform1f(f,r.u_height_lift),u_image:new a.Uniform1i(f,r.u_image),u_texsize:new a.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(f,r.u_scale),u_fade:new a.Uniform1f(f,r.u_fade),u_opacity:new a.Uniform1f(f,r.u_opacity)}),fill:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix)}),fillPattern:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_image:new a.Uniform1i(f,r.u_image),u_texsize:new a.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(f,r.u_scale),u_fade:new a.Uniform1f(f,r.u_fade)}),fillOutline:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_world:new a.Uniform2f(f,r.u_world)}),fillOutlinePattern:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_world:new a.Uniform2f(f,r.u_world),u_image:new a.Uniform1i(f,r.u_image),u_texsize:new a.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(f,r.u_scale),u_fade:new a.Uniform1f(f,r.u_fade)}),circle:(f,r)=>({u_camera_to_center_distance:new a.Uniform1f(f,r.u_camera_to_center_distance),u_extrude_scale:new a.UniformMatrix2f(f,r.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(f,r.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_inv_rot_matrix:new a.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_tile_id:new a.Uniform3f(f,r.u_tile_id),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_up_dir:new a.Uniform3f(f,r.u_up_dir)}),collisionBox:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_camera_to_center_distance:new a.Uniform1f(f,r.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(f,r.u_extrude_scale)}),collisionCircle:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_inv_matrix:new a.UniformMatrix4f(f,r.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(f,r.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(f,r.u_viewport_size)}),debug:(f,r)=>({u_color:new a.UniformColor(f,r.u_color),u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_overlay:new a.Uniform1i(f,r.u_overlay),u_overlay_scale:new a.Uniform1f(f,r.u_overlay_scale)}),clippingMask:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix)}),heatmap:(f,r)=>({u_extrude_scale:new a.Uniform1f(f,r.u_extrude_scale),u_intensity:new a.Uniform1f(f,r.u_intensity),u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_inv_rot_matrix:new a.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_tile_id:new a.Uniform3f(f,r.u_tile_id),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_up_dir:new a.Uniform3f(f,r.u_up_dir)}),heatmapTexture:(f,r)=>({u_image:new a.Uniform1i(f,r.u_image),u_color_ramp:new a.Uniform1i(f,r.u_color_ramp),u_opacity:new a.Uniform1f(f,r.u_opacity)}),hillshade:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_image:new a.Uniform1i(f,r.u_image),u_latrange:new a.Uniform2f(f,r.u_latrange),u_light:new a.Uniform2f(f,r.u_light),u_shadow:new a.UniformColor(f,r.u_shadow),u_highlight:new a.UniformColor(f,r.u_highlight),u_accent:new a.UniformColor(f,r.u_accent)}),hillshadePrepare:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_image:new a.Uniform1i(f,r.u_image),u_dimension:new a.Uniform2f(f,r.u_dimension),u_zoom:new a.Uniform1f(f,r.u_zoom),u_unpack:new a.Uniform4f(f,r.u_unpack)}),line:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_pixels_to_tile_units:new a.UniformMatrix2f(f,r.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(f,r.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(f,r.u_units_to_pixels),u_dash_image:new a.Uniform1i(f,r.u_dash_image),u_gradient_image:new a.Uniform1i(f,r.u_gradient_image),u_image_height:new a.Uniform1f(f,r.u_image_height),u_texsize:new a.Uniform2f(f,r.u_texsize),u_scale:new a.Uniform3f(f,r.u_scale),u_mix:new a.Uniform1f(f,r.u_mix),u_alpha_discard_threshold:new a.Uniform1f(f,r.u_alpha_discard_threshold),u_trim_offset:new a.Uniform2f(f,r.u_trim_offset)}),linePattern:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_texsize:new a.Uniform2f(f,r.u_texsize),u_pixels_to_tile_units:new a.UniformMatrix2f(f,r.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(f,r.u_device_pixel_ratio),u_image:new a.Uniform1i(f,r.u_image),u_units_to_pixels:new a.Uniform2f(f,r.u_units_to_pixels),u_scale:new a.Uniform3f(f,r.u_scale),u_fade:new a.Uniform1f(f,r.u_fade),u_alpha_discard_threshold:new a.Uniform1f(f,r.u_alpha_discard_threshold)}),raster:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_tl_parent:new a.Uniform2f(f,r.u_tl_parent),u_scale_parent:new a.Uniform1f(f,r.u_scale_parent),u_fade_t:new a.Uniform1f(f,r.u_fade_t),u_opacity:new a.Uniform1f(f,r.u_opacity),u_image0:new a.Uniform1i(f,r.u_image0),u_image1:new a.Uniform1i(f,r.u_image1),u_brightness_low:new a.Uniform1f(f,r.u_brightness_low),u_brightness_high:new a.Uniform1f(f,r.u_brightness_high),u_saturation_factor:new a.Uniform1f(f,r.u_saturation_factor),u_contrast_factor:new a.Uniform1f(f,r.u_contrast_factor),u_spin_weights:new a.Uniform3f(f,r.u_spin_weights),u_perspective_transform:new a.Uniform2f(f,r.u_perspective_transform)}),symbolIcon:(f,r)=>({u_is_size_zoom_constant:new a.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(f,r.u_size_t),u_size:new a.Uniform1f(f,r.u_size),u_camera_to_center_distance:new a.Uniform1f(f,r.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(f,r.u_fade_change),u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new a.Uniform1i(f,r.u_is_text),u_pitch_with_map:new a.Uniform1i(f,r.u_pitch_with_map),u_texsize:new a.Uniform2f(f,r.u_texsize),u_tile_id:new a.Uniform3f(f,r.u_tile_id),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_camera_forward:new a.Uniform3f(f,r.u_camera_forward),u_tile_matrix:new a.UniformMatrix4f(f,r.u_tile_matrix),u_up_vector:new a.Uniform3f(f,r.u_up_vector),u_ecef_origin:new a.Uniform3f(f,r.u_ecef_origin),u_texture:new a.Uniform1i(f,r.u_texture)}),symbolSDF:(f,r)=>({u_is_size_zoom_constant:new a.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(f,r.u_size_t),u_size:new a.Uniform1f(f,r.u_size),u_camera_to_center_distance:new a.Uniform1f(f,r.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(f,r.u_fade_change),u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new a.Uniform1i(f,r.u_is_text),u_pitch_with_map:new a.Uniform1i(f,r.u_pitch_with_map),u_texsize:new a.Uniform2f(f,r.u_texsize),u_texture:new a.Uniform1i(f,r.u_texture),u_gamma_scale:new a.Uniform1f(f,r.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(f,r.u_device_pixel_ratio),u_tile_id:new a.Uniform3f(f,r.u_tile_id),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_camera_forward:new a.Uniform3f(f,r.u_camera_forward),u_tile_matrix:new a.UniformMatrix4f(f,r.u_tile_matrix),u_up_vector:new a.Uniform3f(f,r.u_up_vector),u_ecef_origin:new a.Uniform3f(f,r.u_ecef_origin),u_is_halo:new a.Uniform1i(f,r.u_is_halo)}),symbolTextAndIcon:(f,r)=>({u_is_size_zoom_constant:new a.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(f,r.u_size_t),u_size:new a.Uniform1f(f,r.u_size),u_camera_to_center_distance:new a.Uniform1f(f,r.u_camera_to_center_distance),u_rotate_symbol:new a.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(f,r.u_fade_change),u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new a.Uniform1i(f,r.u_is_text),u_pitch_with_map:new a.Uniform1i(f,r.u_pitch_with_map),u_texsize:new a.Uniform2f(f,r.u_texsize),u_texsize_icon:new a.Uniform2f(f,r.u_texsize_icon),u_texture:new a.Uniform1i(f,r.u_texture),u_texture_icon:new a.Uniform1i(f,r.u_texture_icon),u_gamma_scale:new a.Uniform1f(f,r.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(f,r.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(f,r.u_is_halo)}),background:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_opacity:new a.Uniform1f(f,r.u_opacity),u_color:new a.UniformColor(f,r.u_color)}),backgroundPattern:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_opacity:new a.Uniform1f(f,r.u_opacity),u_image:new a.Uniform1i(f,r.u_image),u_pattern_tl_a:new a.Uniform2f(f,r.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(f,r.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(f,r.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(f,r.u_pattern_br_b),u_texsize:new a.Uniform2f(f,r.u_texsize),u_mix:new a.Uniform1f(f,r.u_mix),u_pattern_size_a:new a.Uniform2f(f,r.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(f,r.u_pattern_size_b),u_scale_a:new a.Uniform1f(f,r.u_scale_a),u_scale_b:new a.Uniform1f(f,r.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(f,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(f,r.u_tile_units_to_pixels)}),terrainRaster:au,terrainDepth:au,skybox:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_sun_direction:new a.Uniform3f(f,r.u_sun_direction),u_cubemap:new a.Uniform1i(f,r.u_cubemap),u_opacity:new a.Uniform1f(f,r.u_opacity),u_temporal_offset:new a.Uniform1f(f,r.u_temporal_offset)}),skyboxGradient:(f,r)=>({u_matrix:new a.UniformMatrix4f(f,r.u_matrix),u_color_ramp:new a.Uniform1i(f,r.u_color_ramp),u_center_direction:new a.Uniform3f(f,r.u_center_direction),u_radius:new a.Uniform1f(f,r.u_radius),u_opacity:new a.Uniform1f(f,r.u_opacity),u_temporal_offset:new a.Uniform1f(f,r.u_temporal_offset)}),skyboxCapture:(f,r)=>({u_matrix_3f:new a.UniformMatrix3f(f,r.u_matrix_3f),u_sun_direction:new a.Uniform3f(f,r.u_sun_direction),u_sun_intensity:new a.Uniform1f(f,r.u_sun_intensity),u_color_tint_r:new a.Uniform4f(f,r.u_color_tint_r),u_color_tint_m:new a.Uniform4f(f,r.u_color_tint_m),u_luminance:new a.Uniform1f(f,r.u_luminance)}),globeRaster:(f,r)=>({u_proj_matrix:new a.UniformMatrix4f(f,r.u_proj_matrix),u_globe_matrix:new a.UniformMatrix4f(f,r.u_globe_matrix),u_normalize_matrix:new a.UniformMatrix4f(f,r.u_normalize_matrix),u_merc_matrix:new a.UniformMatrix4f(f,r.u_merc_matrix),u_zoom_transition:new a.Uniform1f(f,r.u_zoom_transition),u_merc_center:new a.Uniform2f(f,r.u_merc_center),u_image0:new a.Uniform1i(f,r.u_image0),u_grid_matrix:new a.UniformMatrix3f(f,r.u_grid_matrix),u_frustum_tl:new a.Uniform3f(f,r.u_frustum_tl),u_frustum_tr:new a.Uniform3f(f,r.u_frustum_tr),u_frustum_br:new a.Uniform3f(f,r.u_frustum_br),u_frustum_bl:new a.Uniform3f(f,r.u_frustum_bl),u_globe_pos:new a.Uniform3f(f,r.u_globe_pos),u_globe_radius:new a.Uniform1f(f,r.u_globe_radius),u_viewport:new a.Uniform2f(f,r.u_viewport)}),globeAtmosphere:(f,r)=>({u_frustum_tl:new a.Uniform3f(f,r.u_frustum_tl),u_frustum_tr:new a.Uniform3f(f,r.u_frustum_tr),u_frustum_br:new a.Uniform3f(f,r.u_frustum_br),u_frustum_bl:new a.Uniform3f(f,r.u_frustum_bl),u_horizon:new a.Uniform1f(f,r.u_horizon),u_transition:new a.Uniform1f(f,r.u_transition),u_fadeout_range:new a.Uniform1f(f,r.u_fadeout_range),u_color:new a.Uniform4f(f,r.u_color),u_high_color:new a.Uniform4f(f,r.u_high_color),u_space_color:new a.Uniform4f(f,r.u_space_color),u_star_intensity:new a.Uniform1f(f,r.u_star_intensity),u_star_density:new a.Uniform1f(f,r.u_star_density),u_star_size:new a.Uniform1f(f,r.u_star_size),u_temporal_offset:new a.Uniform1f(f,r.u_temporal_offset),u_horizon_angle:new a.Uniform1f(f,r.u_horizon_angle),u_rotation_matrix:new a.UniformMatrix4f(f,r.u_rotation_matrix)})};let pu;function Xp(f,r,u,m,y,v,M){const E=f.context,I=E.gl,R=f.transform,N=f.useProgram("collisionBox"),j=[];let Y=0,ie=0;for(let we=0;we<m.length;we++){const pe=m[we],ye=r.getTile(pe),Le=ye.getBucket(u);if(!Le)continue;const Ve=Zr(pe,Le,R);let He=Ve;y[0]===0&&y[1]===0||(He=f.translatePosMatrix(Ve,ye,y,v));const Ge=M?Le.textCollisionBox:Le.iconCollisionBox,Ue=Le.collisionCircleArray;if(Ue.length>0){const ve=a.create(),at=He;a.mul(ve,Le.placementInvProjMatrix,R.glCoordMatrix),a.mul(ve,ve,Le.placementViewportMatrix),j.push({circleArray:Ue,circleOffset:ie,transform:at,invTransform:ve,projection:Le.getProjection()}),Y+=Ue.length/4,ie=Y}Ge&&(f.terrain&&f.terrain.setupElevationDraw(ye,N),N.draw(E,I.LINES,a.DepthMode.disabled,a.StencilMode.disabled,f.colorModeForRenderPass(),a.CullFaceMode.disabled,bd(He,R,ye,Le.getProjection()),u.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,R.zoom,null,Ge.collisionVertexBuffer,Ge.collisionVertexBufferExt))}if(!M||!j.length)return;const oe=f.useProgram("collisionCircle"),J=new a.StructArrayLayout2f1f2i16;J.resize(4*Y),J._trim();let _e=0;for(const we of j)for(let pe=0;pe<we.circleArray.length/4;pe++){const ye=4*pe,Le=we.circleArray[ye+0],Ve=we.circleArray[ye+1],He=we.circleArray[ye+2],Ge=we.circleArray[ye+3];J.emplace(_e++,Le,Ve,He,Ge,0),J.emplace(_e++,Le,Ve,He,Ge,1),J.emplace(_e++,Le,Ve,He,Ge,2),J.emplace(_e++,Le,Ve,He,Ge,3)}(!pu||pu.length<2*Y)&&(pu=function(we){const pe=2*we,ye=new a.StructArrayLayout3ui6;ye.resize(pe),ye._trim();for(let Le=0;Le<pe;Le++){const Ve=6*Le;ye.uint16[Ve+0]=4*Le+0,ye.uint16[Ve+1]=4*Le+1,ye.uint16[Ve+2]=4*Le+2,ye.uint16[Ve+3]=4*Le+2,ye.uint16[Ve+4]=4*Le+3,ye.uint16[Ve+5]=4*Le+0}return ye}(Y));const Q=E.createIndexBuffer(pu,!0),ae=E.createVertexBuffer(J,a.collisionCircleLayout.members,!0);for(const we of j){const pe={u_matrix:we.transform,u_inv_matrix:we.invTransform,u_camera_to_center_distance:(le=R).getCameraToCenterDistance(we.projection),u_viewport_size:[le.width,le.height]};oe.draw(E,I.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,f.colorModeForRenderPass(),a.CullFaceMode.disabled,pe,u.id,ae,Q,a.SegmentVector.simpleSegment(0,2*we.circleOffset,we.circleArray.length,we.circleArray.length/2),null,R.zoom)}var le;ae.destroy(),Q.destroy()}const Yp=a.create();function xy(f,r,u,m,y,v){const{horizontalAlign:M,verticalAlign:E}=a.getAnchorAlignment(f),I=-(M-.5)*r,R=-(E-.5)*u,N=a.evaluateVariableOffset(f,m);return new a.pointGeometry((I/y+N[0])*v,(R/y+N[1])*v)}function vy(f,r,u,m,y,v,M,E,I,R,N){const j=f.text.placedSymbolArray,Y=f.text.dynamicLayoutVertexArray,ie=f.icon.dynamicLayoutVertexArray,oe={},J=Qc(E,f.getProjection(),v),_e=v.elevation,Q=f.getProjection().upVectorScale(E.canonical,v.center.lat,v.worldSize);Y.clear();for(let ae=0;ae<j.length;ae++){const le=j.get(ae),we=f.allowVerticalPlacement&&!le.placedOrientation,pe=le.hidden||!le.crossTileID||we?null:m[le.crossTileID];if(pe){const ye=new a.pointGeometry(le.tileAnchorX,le.tileAnchorY),Le=f.getProjection().upVector(E.canonical,ye.x,ye.y),Ve=_e?_e.getAtTileOffset(E,ye.x,ye.y):0,He=Ho([le.projectedAnchorX+Ve*Le[0]*Q.metersToTile,le.projectedAnchorY+Ve*Le[1]*Q.metersToTile,le.projectedAnchorZ+Ve*Le[2]*Q.metersToTile],u?J:M),Ge=Ta(v.getCameraToCenterDistance(f.getProjection()),He.signedDistanceFromCamera);let Ue=y.evaluateSizeForFeature(f.textSizeData,R,le)*Ge/a.ONE_EM;u&&(Ue*=f.tilePixelRatio/I);const{width:ve,height:at,anchor:rt,textOffset:It,textScale:Ke}=pe,Jt=xy(rt,ve,at,It,Ke,Ue);let Ct;if(u){const _t=ye.add(Jt),{x:St,y:ln,z:en}=f.getProjection().projectTilePoint(_t.x,_t.y,E.canonical);Ct=Ho([St+Ve*Le[0]*Q.metersToTile,ln+Ve*Le[1]*Q.metersToTile,en+Ve*Le[2]*Q.metersToTile],M).point}else{const _t=r?Jt.rotate(-v.angle):Jt;Ct=[He.point[0]+_t.x,He.point[1]+_t.y,0]}const Tt=f.allowVerticalPlacement&&le.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<le.numGlyphs;_t++)a.addDynamicAttributes(Y,Ct[0],Ct[1],Ct[2],Tt);N&&le.associatedIconIndex>=0&&(oe[le.associatedIconIndex]={shiftedAnchor:Ct,angle:Tt})}else Vi(le.numGlyphs,Y)}if(N){ie.clear();const ae=f.icon.placedSymbolArray;for(let le=0;le<ae.length;le++){const we=ae.get(le);if(we.hidden)Vi(we.numGlyphs,ie);else{const pe=oe[le];if(pe)for(let ye=0;ye<we.numGlyphs;ye++)a.addDynamicAttributes(ie,pe.shiftedAnchor[0],pe.shiftedAnchor[1],pe.shiftedAnchor[2],pe.angle);else Vi(we.numGlyphs,ie)}}f.icon.dynamicLayoutVertexBuffer.updateData(ie)}f.text.dynamicLayoutVertexBuffer.updateData(Y)}function Cd(f,r,u){return u.iconsInText&&r?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function mu(f,r,u,m,y,v,M,E,I,R,N,j){const Y=f.context,ie=Y.gl,oe=f.transform,J=E==="map",_e=I==="map",Q=J&&u.layout.get("symbol-placement")!=="point",ae=J&&!_e&&!Q,le=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let we=!1;const pe=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),ye=[a.mercatorXfromLng(oe.center.lng),a.mercatorYfromLat(oe.center.lat)],Le=u.layout.get("text-variable-anchor"),Ve=oe.projection.name==="globe",He=[],Ge=[0,-1,0];let Ue=Ge;!Ve&&!oe.mercatorFromTransition||J||(Ue=function(ve){const at=ve._camera.getWorldToCamera(ve.worldSize,1),rt=a.multiply([],at,ve.globeMatrix);a.invert(rt,rt);const It=[0,0,0],Ke=[0,1,0,0];return a.transformMat4$1(Ke,Ke,rt),It[0]=Ke[0],It[1]=Ke[1],It[2]=Ke[2],a.normalize(It,It),It}(oe));for(const ve of m){const at=r.getTile(ve),rt=at.getBucket(u);if(!rt||rt.projection.name==="mercator"&&Ve)continue;const It=y?rt.text:rt.icon;if(!It||rt.fullyClipped||!It.segments.get().length)continue;const Ke=It.programConfigurations.get(u.id),Jt=y||rt.sdfIcons,Ct=y?rt.textSizeData:rt.iconSizeData,Tt=_e||oe.pitch!==0,_t=a.evaluateSizeForZoom(Ct,oe.zoom);let St,ln,en,vn,Kt=[0,0],gn=null;if(y){if(ln=at.glyphAtlasTexture,en=ie.LINEAR,St=at.glyphAtlasTexture.size,rt.iconsInText){Kt=at.imageAtlasTexture.size,gn=at.imageAtlasTexture;const Ri=Ct.kind==="composite"||Ct.kind==="camera";vn=Tt||f.options.rotating||f.options.zooming||Ri?ie.LINEAR:ie.NEAREST}}else{const Ri=u.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;ln=at.imageAtlasTexture,en=Jt||f.options.rotating||f.options.zooming||Ri||Tt?ie.LINEAR:ie.NEAREST,St=at.imageAtlasTexture.size}const Gn=rt.projection.name==="globe",Xn=Gn?Ue:Ge,Ai=Gn?a.globeToMercatorTransition(oe.zoom):0,Qn=Qc(ve,rt.getProjection(),oe),Br=oe.calculatePixelsToTileUnitsMatrix(at),Io=_n(Qn,at.tileID.canonical,_e,J,oe,rt.getProjection(),Br),Xo=f.terrain&&_e&&Q?a.invert(a.create(),Io):Yp,ri=Gs(Qn,at.tileID.canonical,_e,J,oe,rt.getProjection(),Br),li=Le&&rt.hasTextData(),Wn=u.layout.get("icon-text-fit")!=="none"&&li&&rt.hasIconData();if(Q){const Ri=oe.elevation,Po=Ri?Ri.getAtTileOffsetFunc(ve,oe.center.lat,oe.worldSize,rt.getProjection()):oc=>[0,0,0],Yo=Ci(Qn,at.tileID.canonical,_e,J,oe,rt.getProjection(),Br);$r(rt,Qn,f,y,Yo,ri,_e,R,Po,ve)}const ki=Q||y&&Le||Wn,Qi=f.translatePosMatrix(Qn,at,v,M),kn=ki?Yp:Io,Mr=f.translatePosMatrix(ri,at,v,M,!0),Js=rt.getProjection().createInversionMatrix(oe,ve.canonical),po=[];f.terrain&&_e&&po.push("PITCH_WITH_MAP_TERRAIN"),Gn&&po.push("PROJECTION_GLOBE_VIEW"),ki&&po.push("PROJECTED_POS_ON_VIEWPORT");const Ga=Jt&&u.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ja;ja=Jt?rt.iconsInText?qp(Ct.kind,_t,ae,_e,f,Qi,kn,Mr,St,Kt,ve,Ai,ye,Js,Xn,rt.getProjection()):$p(Ct.kind,_t,ae,_e,f,Qi,kn,Mr,y,St,!0,ve,Ai,ye,Js,Xn,rt.getProjection()):ql(Ct.kind,_t,ae,_e,f,Qi,kn,Mr,y,St,ve,Ai,ye,Js,Xn,rt.getProjection());const xs={program:f.useProgram(Cd(Jt,y,rt),Ke,po),buffers:It,uniformValues:ja,atlasTexture:ln,atlasTextureIcon:gn,atlasInterpolation:en,atlasInterpolationIcon:vn,isSDF:Jt,hasHalo:Ga,tile:at,labelPlaneMatrixInv:Xo};if(le&&rt.canOverlap){we=!0;const Ri=It.segments.get();for(const Po of Ri)He.push({segments:new a.SegmentVector([Po]),sortKey:Po.sortKey,state:xs})}else He.push({segments:It.segments,sortKey:0,state:xs})}we&&He.sort((ve,at)=>ve.sortKey-at.sortKey);for(const ve of He){const at=ve.state;if(f.terrain&&f.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:!Ve,labelPlaneMatrixInv:at.labelPlaneMatrixInv}),Y.activeTexture.set(ie.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,ie.CLAMP_TO_EDGE),at.atlasTextureIcon&&(Y.activeTexture.set(ie.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),at.isSDF){const rt=at.uniformValues;at.hasHalo&&(rt.u_is_halo=1,Ad(at.buffers,ve.segments,u,f,at.program,pe,N,j,rt)),rt.u_is_halo=0}Ad(at.buffers,ve.segments,u,f,at.program,pe,N,j,at.uniformValues)}}function Ad(f,r,u,m,y,v,M,E,I){const R=m.context;y.draw(R,R.gl.TRIANGLES,v,M,E,a.CullFaceMode.disabled,I,u.id,f.layoutVertexBuffer,f.indexBuffer,r,u.paint,m.transform.zoom,f.programConfigurations.get(u.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer)}function Id(f,r,u,m,y,v,M){const E=f.context.gl,I=u.paint.get("fill-pattern"),R=I&&I.constantOr(1),N=u.getCrossfadeParameters();let j,Y,ie,oe,J;M?(Y=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=E.LINES):(Y=R?"fillPattern":"fill",j=E.TRIANGLES);for(const _e of m){const Q=r.getTile(_e);if(R&&!Q.patternsLoaded())continue;const ae=Q.getBucket(u);if(!ae)continue;f.prepareDrawTile();const le=ae.programConfigurations.get(u.id),we=f.useProgram(Y,le);R&&(f.context.activeTexture.set(E.TEXTURE0),Q.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),le.updatePaintBuffers(N));const pe=I.constantOr(null);if(pe&&Q.imageAtlas){const Le=Q.imageAtlas,Ve=Le.patternPositions[pe.to.toString()],He=Le.patternPositions[pe.from.toString()];Ve&&He&&le.setConstantPatternPositions(Ve,He)}const ye=f.translatePosMatrix(_e.projMatrix,Q,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(M){oe=ae.indexBuffer2,J=ae.segments2;const Le=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];ie=Y==="fillOutlinePattern"&&R?vd(ye,f,N,Q,Le):du(ye,Le)}else oe=ae.indexBuffer,J=ae.segments,ie=R?xd(ye,f,N,Q):za(ye);f.prepareDrawProgram(f.context,we,_e.toUnwrapped()),we.draw(f.context,j,y,f.stencilModeForClipping(_e),v,a.CullFaceMode.disabled,ie,u.id,ae.layoutVertexBuffer,oe,J,u.paint,f.transform.zoom,le)}}function _u(f,r,u,m,y,v,M){const E=f.context,I=E.gl,R=f.transform,N=u.paint.get("fill-extrusion-pattern"),j=N.constantOr(1),Y=u.getCrossfadeParameters(),ie=u.paint.get("fill-extrusion-opacity"),oe=R.projection.name==="globe"?a.fillExtrusionHeightLift():0,J=R.projection.name==="globe",_e=J?a.globeToMercatorTransition(R.zoom):0,Q=[a.mercatorXfromLng(R.center.lng),a.mercatorYfromLat(R.center.lat)],ae=[];J&&ae.push("PROJECTION_GLOBE_VIEW");for(const le of m){const we=r.getTile(le),pe=we.getBucket(u);if(!pe||pe.projection.name!==R.projection.name)continue;const ye=pe.programConfigurations.get(u.id),Le=f.useProgram(j?"fillExtrusionPattern":"fillExtrusion",ye,ae);if(f.terrain){const at=f.terrain;if(f.style.terrainSetForDrapingOnly())at.setupElevationDraw(we,Le,{useMeterToDem:!0});else{if(!pe.enableTerrain)continue;if(at.setupElevationDraw(we,Le,{useMeterToDem:!0}),Pd(E,r,le,pe,u,at),!pe.centroidVertexBuffer){const rt=Le.attributes.a_centroid_pos;rt!==void 0&&I.vertexAttrib2f(rt,0,0)}}}j&&(f.context.activeTexture.set(I.TEXTURE0),we.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ye.updatePaintBuffers(Y));const Ve=N.constantOr(null);if(Ve&&we.imageAtlas){const at=we.imageAtlas,rt=at.patternPositions[Ve.to.toString()],It=at.patternPositions[Ve.from.toString()];rt&&It&&ye.setConstantPatternPositions(rt,It)}const He=f.translatePosMatrix(le.projMatrix,we,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ge=R.projection.createInversionMatrix(R,le.canonical),Ue=u.paint.get("fill-extrusion-vertical-gradient"),ve=j?Hl(He,f,Ue,ie,le,Y,we,oe,_e,Q,Ge):Gp(He,f,Ue,ie,le,oe,_e,Q,Ge);f.prepareDrawProgram(E,Le,le.toUnwrapped()),Le.draw(E,E.gl.TRIANGLES,y,v,M,a.CullFaceMode.backCCW,ve,u.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,u.paint,f.transform.zoom,ye,f.terrain?pe.centroidVertexBuffer:null,J?pe.layoutVertexExtBuffer:null)}}function Pd(f,r,u,m,y,v){const M=[Q=>{let ae=Q.canonical.x-1,le=Q.wrap;return ae<0&&(ae=(1<<Q.canonical.z)-1,le--),new a.OverscaledTileID(Q.overscaledZ,le,Q.canonical.z,ae,Q.canonical.y)},Q=>{let ae=Q.canonical.x+1,le=Q.wrap;return ae===1<<Q.canonical.z&&(ae=0,le++),new a.OverscaledTileID(Q.overscaledZ,le,Q.canonical.z,ae,Q.canonical.y)},Q=>new a.OverscaledTileID(Q.overscaledZ,Q.wrap,Q.canonical.z,Q.canonical.x,(Q.canonical.y===0?1<<Q.canonical.z:Q.canonical.y)-1),Q=>new a.OverscaledTileID(Q.overscaledZ,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y===(1<<Q.canonical.z)-1?0:Q.canonical.y+1)],E=Q=>{const ae=r.getSource().minzoom,le=pe=>{const ye=r.getTileByID(pe);if(ye&&ye.hasData())return ye.getBucket(y)},we=[0,-1,1];for(const pe of we){if(Q.overscaledZ+pe<ae)continue;const ye=le(Q.calculateScaledKey(Q.overscaledZ+pe));if(ye)return ye}},I=[0,0,0],R=(Q,ae)=>(I[0]=Math.min(Q.min.y,ae.min.y),I[1]=Math.max(Q.max.y,ae.max.y),I[2]=a.EXTENT-ae.min.x>Q.max.x?ae.min.x-a.EXTENT:Q.max.x,I),N=(Q,ae)=>(I[0]=Math.min(Q.min.x,ae.min.x),I[1]=Math.max(Q.max.x,ae.max.x),I[2]=a.EXTENT-ae.min.y>Q.max.y?ae.min.y-a.EXTENT:Q.max.y,I),j=[(Q,ae)=>R(Q,ae),(Q,ae)=>R(ae,Q),(Q,ae)=>N(Q,ae),(Q,ae)=>N(ae,Q)],Y=new a.pointGeometry(0,0);let ie,oe,J;const _e=(Q,ae,le,we,pe)=>{const ye=[[we?le:Q,we?Q:le,0],[we?le:ae,we?ae:le,0]],Le=pe<0?a.EXTENT+pe:pe,Ve=[we?Le:(Q+ae)/2,we?(Q+ae)/2:Le,0];return le===0&&pe<0||le!==0&&pe>0?v.getForTilePoints(J,[Ve],!0,oe):ye.push(Ve),v.getForTilePoints(u,ye,!0,ie),Math.max(ye[0][2],ye[1][2],Ve[2])/v.exaggeration()};for(let Q=0;Q<4;Q++){const ae=(Q<2?1:5)-Q,le=m.borders[Q];if(le.length===0)continue;const we=J=M[Q](u),pe=E(we);if(!(pe&&pe instanceof a.FillExtrusionBucket&&pe.enableTerrain)||m.borderDoneWithNeighborZ[Q]===pe.canonical.z&&pe.borderDoneWithNeighborZ[ae]===m.canonical.z||(oe=v.findDEMTileFor(we),!oe||!oe.dem))continue;if(!ie){const He=v.findDEMTileFor(u);if(!He||!He.dem)return;ie=He}const ye=pe.borders[ae];let Le=0;const Ve=pe.borderDoneWithNeighborZ[ae]!==m.canonical.z;if(m.canonical.z===pe.canonical.z){for(let He=0;He<le.length;He++){const Ge=m.featuresOnBorder[le[He]],Ue=Ge.borders[Q];let ve;for(;Le<ye.length&&(ve=pe.featuresOnBorder[ye[Le]],!(ve.borders[ae][1]>Ue[0]+3));)Ve&&pe.encodeCentroid(void 0,ve,!1),Le++;if(ve&&Le<ye.length){const at=Le;let rt=0;for(;!(ve.borders[ae][0]>Ue[1]-3)&&(rt++,++Le!==ye.length);)ve=pe.featuresOnBorder[ye[Le]];if(ve=pe.featuresOnBorder[ye[at]],Ge.intersectsCount()>1||ve.intersectsCount()>1||rt!==1){rt!==1&&(Le=at),m.encodeCentroid(void 0,Ge,!1),Ve&&pe.encodeCentroid(void 0,ve,!1);continue}const It=j[Q](Ge,ve),Ke=Q%2?a.EXTENT-1:0;Y.x=_e(It[0],Math.min(a.EXTENT-1,It[1]),Ke,Q<2,It[2]),Y.y=0,m.encodeCentroid(Y,Ge,!1),Ve&&pe.encodeCentroid(Y,ve,!1)}else m.encodeCentroid(void 0,Ge,!1)}m.borderDoneWithNeighborZ[Q]=pe.canonical.z,m.needsCentroidUpdate=!0,Ve&&(pe.borderDoneWithNeighborZ[ae]=m.canonical.z,pe.needsCentroidUpdate=!0)}else{for(const He of le)m.encodeCentroid(void 0,m.featuresOnBorder[He],!1);if(Ve){for(const He of ye)pe.encodeCentroid(void 0,pe.featuresOnBorder[He],!1);pe.borderDoneWithNeighborZ[ae]=m.canonical.z,pe.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[Q]=pe.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}const $s=new a.Color(1,0,0,1),Zl=new a.Color(0,1,0,1),Kp=new a.Color(0,0,1,1),Ra=new a.Color(1,0,1,1),Fa=new a.Color(0,1,1,1);function Ld(f,r,u,m){Fn(f,0,r+u/2,f.transform.width,u,m)}function gu(f,r,u,m){Fn(f,r-u/2,0,u,f.transform.height,m)}function Fn(f,r,u,m,y,v){const M=f.context,E=M.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*a.exported.devicePixelRatio,u*a.exported.devicePixelRatio,m*a.exported.devicePixelRatio,y*a.exported.devicePixelRatio),M.clear({color:v}),E.disable(E.SCISSOR_TEST)}function yu(f,r,u){const m=f.context,y=m.gl,v=f.transform.projection.name==="globe",M=u.projMatrix,E=f.useProgram("debug",null,v?["PROJECTION_GLOBE_VIEW"]:null),I=r.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(I,E);const R=a.DepthMode.disabled,N=a.StencilMode.disabled,j=f.colorModeForRenderPass(),Y="$debug";m.activeTexture.set(y.TEXTURE0),f.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),v?I._makeGlobeTileDebugBuffers(f.context,f.transform.projection):I._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const ie=I._tileDebugBuffer||f.debugBuffer,oe=I._tileDebugIndexBuffer||f.debugIndexBuffer,J=I._tileDebugSegments||f.debugSegments;E.draw(m,y.LINE_STRIP,R,N,j,a.CullFaceMode.disabled,Sd(M,a.Color.red),Y,ie,oe,J,null,null,null,I._globeTileDebugBorderBuffer);const _e=I.latestRawTileData,Q=Math.floor((_e&&_e.byteLength||0)/1024),ae=r.getTile(u).tileSize,le=512/Math.min(ae,512)*(u.overscaledZ/f.transform.zoom)*.5;let we=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(we+=` => ${u.overscaledZ}`),function(Ve,He){Ve.initDebugOverlayCanvas();const Ge=Ve.debugOverlayCanvas,Ue=Ve.context.gl,ve=Ve.debugOverlayCanvas.getContext("2d");ve.clearRect(0,0,Ge.width,Ge.height),ve.shadowColor="white",ve.shadowBlur=2,ve.lineWidth=1.5,ve.strokeStyle="white",ve.textBaseline="top",ve.font="bold 36px Open Sans, sans-serif",ve.fillText(He,5,5),ve.strokeText(He,5,5),Ve.debugOverlayTexture.update(Ge),Ve.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(f,`${we} ${Q}kb`);const pe=I._tileDebugTextBuffer||f.debugBuffer,ye=I._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Le=I._tileDebugTextSegments||f.debugSegments;E.draw(m,y.TRIANGLES,R,N,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Sd(M,a.Color.transparent,le),Y,pe,ye,Le,null,null,null,I._globeTileDebugTextBuffer)}const wy=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Jp}=wy;function Xr(f,r,u,m){f.emplaceBack(r,u,m)}class Qp{constructor(r){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Xr(this.vertexArray,-1,-1,1),Xr(this.vertexArray,1,-1,1),Xr(this.vertexArray,-1,1,1),Xr(this.vertexArray,1,1,1),Xr(this.vertexArray,-1,-1,-1),Xr(this.vertexArray,1,-1,-1),Xr(this.vertexArray,-1,1,-1),Xr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Jp),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Ba(f,r,u,m,y,v){const M=f.gl,E=r.paint.get("sky-atmosphere-color"),I=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),N=((j,Y,ie,oe,J)=>({u_matrix_3f:j,u_sun_direction:Y,u_sun_intensity:ie,u_color_tint_r:[oe.r,oe.g,oe.b,oe.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),m),y,R,E,I);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),u.draw(f,M.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,N,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const em=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class by{constructor(r){const u=new a.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new a.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(u,em.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xu={symbol:function(f,r,u,m,y){if(f.renderPass!=="translucent")return;const v=a.StencilMode.disabled,M=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(E,I,R,N,j,Y,ie){const oe=I.transform,J=j==="map",_e=Y==="map";for(const Q of E){const ae=N.getTile(Q),le=ae.getBucket(R);if(!le||!le.text||!le.text.segments.get().length)continue;const we=a.evaluateSizeForZoom(le.textSizeData,oe.zoom),pe=Qc(Q,le.getProjection(),oe),ye=oe.calculatePixelsToTileUnitsMatrix(ae),Le=_n(pe,ae.tileID.canonical,_e,J,oe,le.getProjection(),ye),Ve=R.layout.get("icon-text-fit")!=="none"&&le.hasIconData();if(we){const He=Math.pow(2,oe.zoom-ae.tileID.overscaledZ);vy(le,J,_e,ie,a.symbolSize,oe,Le,Q,He,we,Ve)}}}(m,f,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y),u.paint.get("icon-opacity").constantOr(1)!==0&&mu(f,r,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),v,M),u.paint.get("text-opacity").constantOr(1)!==0&&mu(f,r,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),v,M),r.map.showCollisionBoxes&&(Xp(f,r,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Xp(f,r,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,u,m){if(f.renderPass!=="translucent")return;const y=u.paint.get("circle-opacity"),v=u.paint.get("circle-stroke-width"),M=u.paint.get("circle-stroke-opacity"),E=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(v.constantOr(1)===0||M.constantOr(1)===0))return;const I=f.context,R=I.gl,N=f.transform,j=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),Y=a.StencilMode.disabled,ie=f.colorModeForRenderPass(),oe=N.projection.name==="globe",J=[a.mercatorXfromLng(N.center.lng),a.mercatorYfromLat(N.center.lat)],_e=[];for(let ae=0;ae<m.length;ae++){const le=m[ae],we=r.getTile(le),pe=we.getBucket(u);if(!pe||pe.projection.name!==N.projection.name)continue;const ye=pe.programConfigurations.get(u.id),Le=jp(u);oe&&Le.push("PROJECTION_GLOBE_VIEW");const Ve=f.useProgram("circle",ye,Le),He=pe.layoutVertexBuffer,Ge=pe.globeExtVertexBuffer,Ue=pe.indexBuffer,ve=N.projection.createInversionMatrix(N,le.canonical),at={programConfiguration:ye,program:Ve,layoutVertexBuffer:He,globeExtVertexBuffer:Ge,indexBuffer:Ue,uniformValues:wd(f,le,we,ve,J,u),tile:we};if(E){const rt=pe.segments.get();for(const It of rt)_e.push({segments:new a.SegmentVector([It]),sortKey:It.sortKey,state:at})}else _e.push({segments:pe.segments,sortKey:0,state:at})}E&&_e.sort((ae,le)=>ae.sortKey-le.sortKey);const Q={useDepthForOcclusion:!oe};for(const ae of _e){const{programConfiguration:le,program:we,layoutVertexBuffer:pe,globeExtVertexBuffer:ye,indexBuffer:Le,uniformValues:Ve,tile:He}=ae.state,Ge=ae.segments;f.terrain&&f.terrain.setupElevationDraw(He,we,Q),f.prepareDrawProgram(I,we,He.tileID.toUnwrapped()),we.draw(I,R.TRIANGLES,j,Y,ie,a.CullFaceMode.disabled,Ve,u.id,pe,Le,Ge,u.paint,N.zoom,le,oe?ye:null)}},heatmap:function(f,r,u,m){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,v=y.gl,M=a.StencilMode.disabled,E=new a.ColorMode([v.ONE,v.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(ie,oe,J,_e){const Q=ie.gl,ae=oe.width*_e,le=oe.height*_e;ie.activeTexture.set(Q.TEXTURE1),ie.viewport.set([0,0,ae,le]);let we=J.heatmapFbo;if(!we||we&&(we.width!==ae||we.height!==le)){we&&we.destroy();const pe=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,pe),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),we=J.heatmapFbo=ie.createFramebuffer(ae,le,!1),function(ye,Le,Ve,He,Ge,Ue){const ve=ye.gl;ve.texImage2D(ve.TEXTURE_2D,0,ve.RGBA,Ge,Ue,0,ve.RGBA,ye.extRenderToTextureHalfFloat?ye.extTextureHalfFloat.HALF_FLOAT_OES:ve.UNSIGNED_BYTE,null),He.colorAttachment.set(Ve)}(ie,0,pe,we,ae,le)}else Q.bindTexture(Q.TEXTURE_2D,we.colorAttachment.get()),ie.bindFramebuffer.set(we.framebuffer)})(y,f,u,f.transform.projection.name==="globe"?.5:.25),y.clear({color:a.Color.transparent});const I=f.transform,R=I.projection.name==="globe",N=R?["PROJECTION_GLOBE_VIEW"]:null,j=R?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,Y=[a.mercatorXfromLng(I.center.lng),a.mercatorYfromLat(I.center.lat)];for(let ie=0;ie<m.length;ie++){const oe=m[ie];if(r.hasRenderableParent(oe))continue;const J=r.getTile(oe),_e=J.getBucket(u);if(!_e||_e.projection.name!==I.projection.name)continue;const Q=_e.programConfigurations.get(u.id),ae=f.useProgram("heatmap",Q,N),{zoom:le}=f.transform;f.terrain&&f.terrain.setupElevationDraw(J,ae),f.prepareDrawProgram(y,ae,oe.toUnwrapped());const we=I.projection.createInversionMatrix(I,oe.canonical);ae.draw(y,v.TRIANGLES,a.DepthMode.disabled,M,E,j,my(f,oe,J,we,Y,le,u.paint.get("heatmap-intensity")),u.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,u.paint,f.transform.zoom,Q,R?_e.globeExtVertexBuffer:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,v){const M=y.context,E=M.gl,I=v.heatmapFbo;if(!I)return;M.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment.get()),M.activeTexture.set(E.TEXTURE1);let R=v.colorRampTexture;R||(R=v.colorRampTexture=new a.Texture(M,v.colorRamp,E.RGBA)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(M,E.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,y.colorModeForRenderPass(),a.CullFaceMode.disabled,((N,j,Y,ie)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(f,u))},line:function(f,r,u,m){if(f.renderPass!=="translucent")return;const y=u.paint.get("line-opacity"),v=u.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),I=f.terrain&&f.terrain.renderingToTexture?1:a.exported.devicePixelRatio,R=u.paint.get("line-dasharray"),N=R.constantOr(1),j=u.layout.get("line-cap"),Y=u.paint.get("line-pattern"),ie=Y.constantOr(1),oe=u.paint.get("line-gradient"),J=u.getCrossfadeParameters(),_e=ie?"linePattern":"line",Q=f.context,ae=Q.gl,le=(pe=>{const ye=[];fu(pe)&&ye.push("RENDER_LINE_DASH"),pe.paint.get("line-gradient")&&ye.push("RENDER_LINE_GRADIENT");const Le=pe.paint.get("line-trim-offset");Le[0]===0&&Le[1]===0||ye.push("RENDER_LINE_TRIM_OFFSET");const Ve=pe.paint.get("line-pattern").constantOr(1),He=pe.paint.get("line-opacity").constantOr(1)!==1;return!Ve&&He&&ye.push("RENDER_LINE_ALPHA_DISCARD"),ye})(u);let we=le.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(we=!1);for(const pe of m){const ye=r.getTile(pe);if(ie&&!ye.patternsLoaded())continue;const Le=ye.getBucket(u);if(!Le)continue;f.prepareDrawTile();const Ve=Le.programConfigurations.get(u.id),He=f.useProgram(_e,Ve,le),Ge=Y.constantOr(null);if(Ge&&ye.imageAtlas){const Ct=ye.imageAtlas,Tt=Ct.patternPositions[Ge.to.toString()],_t=Ct.patternPositions[Ge.from.toString()];Tt&&_t&&Ve.setConstantPatternPositions(Tt,_t)}const Ue=R.constantOr(null),ve=j.constantOr(null);if(!ie&&Ue&&ve&&ye.lineAtlas){const Ct=ye.lineAtlas,Tt=Ct.getDash(Ue.to,ve),_t=Ct.getDash(Ue.from,ve);Tt&&_t&&Ve.setConstantPatternPositions(Tt,_t)}let[at,rt]=u.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&at!==rt&&(at===0&&(at-=1),rt===1&&(rt+=1));const It=f.terrain?pe.projMatrix:null,Ke=ie?_y(f,ye,u,J,It,I):Td(f,ye,u,J,It,Le.lineClipsArray.length,I,[at,rt]);if(oe){const Ct=Le.gradients[u.id];let Tt=Ct.texture;if(u.gradientVersion!==Ct.version){let _t=256;if(u.stepInterpolant){const St=r.getSource().maxzoom,ln=pe.canonical.z===St?Math.ceil(1<<f.transform.maxZoom-pe.canonical.z):1;_t=a.clamp(a.nextPowerOfTwo(Le.maxLineLength/a.EXTENT*1024*ln),256,Q.maxTextureSize)}Ct.gradient=a.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:Ct.gradient||void 0,clips:Le.lineClipsArray}),Ct.texture?Ct.texture.update(Ct.gradient):Ct.texture=new a.Texture(Q,Ct.gradient,ae.RGBA),Ct.version=u.gradientVersion,Tt=Ct.texture}Q.activeTexture.set(ae.TEXTURE1),Tt.bind(u.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}N&&(Q.activeTexture.set(ae.TEXTURE0),ye.lineAtlasTexture.bind(ae.LINEAR,ae.REPEAT),Ve.updatePaintBuffers(J)),ie&&(Q.activeTexture.set(ae.TEXTURE0),ye.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ve.updatePaintBuffers(J)),f.prepareDrawProgram(Q,He,pe.toUnwrapped());const Jt=Ct=>{He.draw(Q,ae.TRIANGLES,M,Ct,E,a.CullFaceMode.disabled,Ke,u.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,u.paint,f.transform.zoom,Ve,Le.layoutVertexBuffer2)};if(we){const Ct=f.stencilModeForClipping(pe).ref;Ct===0&&f.terrain&&Q.clear({stencil:0});const Tt={func:ae.EQUAL,mask:255};Ke.u_alpha_discard_threshold=.8,Jt(new a.StencilMode(Tt,Ct,255,ae.KEEP,ae.KEEP,ae.INVERT)),Ke.u_alpha_discard_threshold=0,Jt(new a.StencilMode(Tt,Ct,255,ae.KEEP,ae.KEEP,ae.KEEP))}else Jt(f.stencilModeForClipping(pe))}we&&(f.resetStencilClippingMasks(),f.terrain&&Q.clear({stencil:0}))},fill:function(f,r,u,m){const y=u.paint.get("fill-color"),v=u.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),E=u.paint.get("fill-pattern"),I=f.opaquePassEnabledForLayer()&&!E.constantOr(1)&&y.constantOr(a.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===I){const R=f.depthModeForSublayer(1,f.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Id(f,r,u,m,R,M,!1)}if(f.renderPass==="translucent"&&u.paint.get("fill-antialias")){const R=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Id(f,r,u,m,R,M,!0)}},"fill-extrusion":function(f,r,u,m){const y=u.paint.get("fill-extrusion-opacity");if(y!==0&&f.renderPass==="translucent"){const v=new a.DepthMode(f.context.gl.LEQUAL,a.DepthMode.ReadWrite,f.depthRangeFor3D);if(y!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))_u(f,r,u,m,v,a.StencilMode.disabled,a.ColorMode.disabled),_u(f,r,u,m,v,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const M=f.colorModeForRenderPass();_u(f,r,u,m,v,a.StencilMode.disabled,M)}}},hillshade:function(f,r,u,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const y=f.context,v=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),M=f.colorModeForRenderPass(),E=f.terrain&&f.terrain.renderingToTexture,[I,R]=f.renderPass!=="translucent"||E?[{},m]:f.stencilConfigForOverlap(m);for(const N of R){const j=r.getTile(N);if(j.needsHillshadePrepare&&f.renderPass==="offscreen")su(f,j,u,v,a.StencilMode.disabled,M);else if(f.renderPass==="translucent"){const Y=E&&f.terrain?f.terrain.stencilModeForRTTOverlap(N):I[N.overscaledZ];Np(f,N,j,u,v,Y,M)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,u,m,y,v){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!m.length)return;const M=f.context,E=M.gl,I=r.getSource(),R=f.useProgram("raster"),N=f.colorModeForRenderPass(),j=f.terrain&&f.terrain.renderingToTexture,[Y,ie]=I instanceof re||j?[{},m]:f.stencilConfigForOverlap(m),oe=ie[ie.length-1].overscaledZ,J=!f.options.moving;for(const _e of ie){const Q=j?a.DepthMode.disabled:f.depthModeForSublayer(_e.overscaledZ-oe,u.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,E.LESS),ae=_e.toUnwrapped(),le=r.getTile(_e);if(j&&(!le||!le.hasData()))continue;const we=j?_e.projMatrix:f.transform.calculateProjMatrix(ae,J),pe=f.terrain&&j?f.terrain.stencilModeForRTTOverlap(_e):Y[_e.overscaledZ],ye=v?0:u.paint.get("raster-fade-duration");le.registerFadeDuration(ye);const Le=r.findLoadedParent(_e,0),Ve=_d(le,Le,r,f.transform,ye);let He,Ge;f.terrain&&f.terrain.prepareDrawTile();const Ue=u.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;M.activeTexture.set(E.TEXTURE0),le.texture.bind(Ue,E.CLAMP_TO_EDGE),M.activeTexture.set(E.TEXTURE1),Le?(Le.texture.bind(Ue,E.CLAMP_TO_EDGE),He=Math.pow(2,Le.tileID.overscaledZ-le.tileID.overscaledZ),Ge=[le.tileID.canonical.x*He%1,le.tileID.canonical.y*He%1]):le.texture.bind(Ue,E.CLAMP_TO_EDGE);const ve=gy(we,Ge||[0,0],He||1,Ve,u,I instanceof re?I.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(M,R,ae),I instanceof re)I.boundsBuffer&&I.boundsSegments&&R.draw(M,E.TRIANGLES,Q,a.StencilMode.disabled,N,a.CullFaceMode.disabled,ve,u.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:at,tileBoundsIndexBuffer:rt,tileBoundsSegments:It}=f.getTileBoundsBuffers(le);R.draw(M,E.TRIANGLES,Q,pe,N,a.CullFaceMode.disabled,ve,u.id,at,rt,It)}}f.resetStencilClippingMasks()},background:function(f,r,u,m){const y=u.paint.get("background-color"),v=u.paint.get("background-opacity");if(v===0)return;const M=f.context,E=M.gl,I=f.transform,R=I.tileSize,N=u.paint.get("background-pattern");if(f.isPatternMissing(N))return;const j=!N&&y.a===1&&v===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==j)return;const Y=a.StencilMode.disabled,ie=f.depthModeForSublayer(0,j==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),oe=f.colorModeForRenderPass(),J=f.useProgram(N?"backgroundPattern":"background");let _e,Q=m;Q||(_e=f.getBackgroundTiles(),Q=Object.values(_e).map(le=>le.tileID)),N&&(M.activeTexture.set(E.TEXTURE0),f.imageManager.bind(f.context));const ae=u.getCrossfadeParameters();for(const le of Q){const we=le.toUnwrapped(),pe=m?le.projMatrix:f.transform.calculateProjMatrix(we);f.prepareDrawTile();const ye=r?r.getTile(le):_e?_e[le.key]:new a.Tile(le,R,I.zoom,f),Le=N?ka(pe,v,f,N,{tileID:le,tileSize:R},ae):Zp(pe,v,y);f.prepareDrawProgram(M,J,we);const{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:He,tileBoundsSegments:Ge}=f.getTileBoundsBuffers(ye);J.draw(M,E.TRIANGLES,ie,Y,oe,a.CullFaceMode.disabled,Le,u.id,Ve,He,Ge)}},sky:function(f,r,u){const m=f.transform,y=m.projection.name==="mercator"||m.projection.name==="globe"?1:a.smoothstep(7,8,m.zoom),v=u.paint.get("sky-opacity")*y;if(v===0)return;const M=f.context,E=u.paint.get("sky-type"),I=new a.DepthMode(M.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&(function(N,j,Y,ie){const oe=N.context,J=oe.gl;let _e=j.skyboxFbo;if(!_e){_e=j.skyboxFbo=oe.createFramebuffer(32,32,!1),j.skyboxGeometry=new Qp(oe),j.skyboxTexture=oe.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let we=0;we<6;++we)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+we,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(_e.framebuffer),oe.viewport.set([0,0,32,32]);const Q=j.getCenter(N,!0),ae=N.useProgram("skyboxCapture"),le=new Float64Array(16);a.identity(le),a.rotateY(le,le,.5*-Math.PI),Ba(oe,j,ae,le,Q,0),a.identity(le),a.rotateY(le,le,.5*Math.PI),Ba(oe,j,ae,le,Q,1),a.identity(le),a.rotateX(le,le,.5*-Math.PI),Ba(oe,j,ae,le,Q,2),a.identity(le),a.rotateX(le,le,.5*Math.PI),Ba(oe,j,ae,le,Q,3),a.identity(le),Ba(oe,j,ae,le,Q,4),a.identity(le),a.rotateY(le,le,Math.PI),Ba(oe,j,ae,le,Q,5),oe.viewport.set([0,0,N.width,N.height])}(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&function(N,j,Y,ie,oe){const J=N.context,_e=J.gl,Q=N.transform,ae=N.useProgram("skybox");J.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,j.skyboxTexture);const le=((we,pe,ye,Le,Ve)=>({u_matrix:we,u_sun_direction:pe,u_cubemap:0,u_opacity:Le,u_temporal_offset:Ve}))(Q.skyboxMatrix,j.getCenter(N,!1),0,ie,oe);N.prepareDrawProgram(J,ae),ae.draw(J,_e.TRIANGLES,Y,a.StencilMode.disabled,N.colorModeForRenderPass(),a.CullFaceMode.backCW,le,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,u,I,v,R):E==="gradient"&&f.renderPass==="sky"&&function(N,j,Y,ie,oe){const J=N.context,_e=J.gl,Q=N.transform,ae=N.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Qp(J)),J.activeTexture.set(_e.TEXTURE0);let le=j.colorRampTexture;le||(le=j.colorRampTexture=new a.Texture(J,j.colorRamp,_e.RGBA)),le.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const we=((pe,ye,Le,Ve,He)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:ye,u_radius:a.degToRad(Le),u_opacity:Ve,u_temporal_offset:He}))(Q.skyboxMatrix,j.getCenter(N,!1),j.paint.get("sky-gradient-radius"),ie,oe);N.prepareDrawProgram(J,ae),ae.draw(J,_e.TRIANGLES,Y,a.StencilMode.disabled,N.colorModeForRenderPass(),a.CullFaceMode.backCW,we,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,u,I,v,R)},debug:function(f,r,u){for(let m=0;m<u.length;m++)yu(f,r,u[m])},custom:function(f,r,u){const m=f.context,y=u.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(f.renderPass==="offscreen"){const v=y.prerender;v&&(f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),v.call(y,m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),m.setStencilMode(a.StencilMode.disabled);const v=y.renderingMode==="3d"?new a.DepthMode(f.context.gl.LEQUAL,a.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,a.DepthMode.ReadOnly);m.setDepthMode(v),y.render(m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState(),m.bindFramebuffer.set(null)}}};class vu{constructor(r,u){this.context=new ue(r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fp,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,u){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gd(this,r));const y=this._terrain;this.transform.elevation=m?y:null,y.update(r,this.transform,u)}_updateFog(r){const u=r.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=u.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const v=m+.78*(y-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,u){if(this.width=r*a.exported.devicePixelRatio,this.height=u*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,u=new a.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(a.EXTENT,0),u.emplaceBack(0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const m=new a.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(a.EXTENT,0),m.emplaceBack(0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=r.createVertexBuffer(m,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const y=new a.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const v=new a.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(a.EXTENT,0,a.EXTENT,0),v.emplaceBack(0,a.EXTENT,0,a.EXTENT),v.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(v,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const M=new a.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M);const E=new a.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])E.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(E),this.emptyTexture=new a.Texture(r,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=a.create();const I=this.context.gl;this.stencilClearMode=new a.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new by(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,u.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Wl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,u,m){if(!u||this.currentStencilSource===u.id||!r.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const I of m)if(this._tileClippingMaskIDs[I.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=u.id;const y=this.context,v=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(a.ColorMode.disabled),y.setDepthMode(a.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of m){const I=u.getTile(E),R=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:j,tileBoundsSegments:Y}=this.getTileBoundsBuffers(I);M.draw(y,v.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Wl(E.projMatrix),"$clipping",N,j,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new a.StencilMode({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const u=this.context.gl;return new a.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,m=r.sort((M,E)=>E.overscaledZ-M.overscaledZ),y=m[m.length-1].overscaledZ,v=m[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const M={};for(let E=0;E<v;E++)M[E+y]=new a.StencilMode({func:u.GEQUAL,mask:255},E+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=v,[M,m]}return[{[y]:a.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([r.CONSTANT_COLOR,r.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(r,u,m){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new a.DepthMode(m||this.context.gl.LEQUAL,u,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const I in y){const R=y[I];R.used&&R.prepare(this.context)}const v={},M={},E={};for(const I in y){const R=y[I];v[I]=R.getVisibleCoordinates(),M[I]=v[I].slice().reverse(),E[I]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<m.length;I++)if(this.style._layers[m[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of m){const R=this.style._layers[I],N=r._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const j=N?M[N.id]:void 0;(R.type==="custom"||R.isSky()||j&&j.length)&&this.renderLayer(this,N,R,j)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[m[this.currentLayer]],R=r._getLayerSourceCache(I);if(I.isSky())continue;const N=R?M[R.id]:void 0;this._renderTileClippingMasks(I,R,N),this.renderLayer(this,R,I,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,R){const N=I.context,j=N.gl,Y=I.transform,ie=new a.DepthMode(j.LEQUAL,a.DepthMode.ReadOnly,[0,1]),oe=I.useProgram("globeAtmosphere",null,Y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),J=a.globeToMercatorTransition(Y.zoom),_e=R.properties.get("color").toArray01(),Q=R.properties.get("high-color").toArray01(),ae=R.properties.get("space-color").toArray01PremultipliedAlpha(),le=a.identity$1([]);a.rotateY$1(le,le,-a.degToRad(Y._center.lng)),a.rotateX$1(le,le,a.degToRad(Y._center.lat)),a.rotateZ$1(le,le,Y.angle),a.rotateX$1(le,le,-Y._pitch);const we=a.fromQuat(new Float32Array(16),le),pe=a.mapValue(R.properties.get("star-intensity"),0,1,0,.25),ye=5e-4,Le=a.mapValue(R.properties.get("horizon-blend"),0,1,ye,.25),Ve=a.globeUseCustomAntiAliasing(I,N,Y)&&Le===ye?Y.worldSize/(2*Math.PI*1.025)-1:Y.globeRadius,He=I.frameCounter/1e3%1,Ge=a.length(Y.globeCenterInViewSpace),Ue=Math.sqrt(Math.pow(Ge,2)-Math.pow(Ve,2)),ve=Math.acos(Ue/Ge),at=((It,Ke,Jt,Ct,Tt,_t,St,ln,en,vn,Kt,gn,Gn,Xn)=>({u_frustum_tl:It,u_frustum_tr:Ke,u_frustum_br:Jt,u_frustum_bl:Ct,u_horizon:Tt,u_transition:_t,u_fadeout_range:St,u_color:ln,u_high_color:en,u_space_color:vn,u_star_intensity:Kt,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:gn,u_horizon_angle:Gn,u_rotation_matrix:Xn}))(Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.frustumCorners.horizon,J,Le,_e,Q,ae,pe,He,ve,we);I.prepareDrawProgram(N,oe);const rt=I.atmosphereBuffer;rt&&oe.draw(N,j.TRIANGLES,ie,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,at,"skybox",rt.vertexBuffer,rt.indexBuffer,rt.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const I=this.style._layers[m[this.currentLayer]],R=r._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,R,I,R?M[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const I=this.style._layers[m[this.currentLayer]],R=r._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=R?(I.type==="symbol"?E:M)[R.id]:void 0;this._renderTileClippingMasks(I,R,R?v[R.id]:void 0),this.renderLayer(this,R,I,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;a.values(this.style._layers).forEach(R=>{const N=r._getLayerSourceCache(R);N&&!R.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<N.getSource().maxzoom)&&(I=N)}),I&&this.options.showTileBoundaries&&xu.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const R=I.transform.padding;Ld(I,I.transform.height-(R.top||0),3,$s),Ld(I,R.bottom||0,3,Zl),gu(I,R.left||0,3,Kp),gu(I,I.transform.width-(R.right||0),3,Ra);const N=I.transform.centerPoint;(function(j,Y,ie,oe){Fn(j,Y-1,ie-10,2,20,oe),Fn(j,Y-10,ie-1,20,2,oe)})(I,N.x,I.transform.height-N.y,Fa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,u,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(m.type)||xu[m.type](r,u,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,u=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),r.beginQueryEXT(r.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const u={};for(const m in r){const y=r[m],v=this.context.extTimerQuery,M=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),u[m]=M}return u}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let m=0;for(const y of r)m+=u.getQueryObjectEXT(y,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(y);return m}translatePosMatrix(r,u,m,y,v){if(!m[0]&&!m[1])return r;const M=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(M){const R=Math.sin(M),N=Math.cos(M);m=[m[0]*N-m[1]*R,m[0]*R+m[1]*N]}const E=[v?m[0]:jt(u,m[0],this.transform.zoom),v?m[1]:jt(u,m[1],this.transform.zoom),0],I=new Float32Array(16);return a.translate(I,r,E),I}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const u=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!u||!m}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),u&&!r&&u.getOpacity(this.transform.pitch)!==0&&m.push("FOG"),r&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(r,u,m){this.cache=this.cache||{};const y=m||[],v=this.currentGlobalDefines().concat(y),M=hu.cacheKey(r,v,u);return this.cache[M]||(this.cache[M]=new hu(this.context,r,ru[r],u,yy[r],v)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,u,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch),M=((E,I,R,N,j,Y,ie,oe,J,_e,Q)=>{const ae=E.transform,le=I.properties.get("color").toArray01();le[3]=N;const we=E.frameCounter/1e3%1;return{u_fog_matrix:R?ae.calculateFogTileMatrix(R):E.identityMat,u_fog_range:I.getFovAdjustedRange(ae._fov),u_fog_color:le,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:we,u_frustum_tl:j,u_frustum_tr:Y,u_frustum_br:ie,u_frustum_bl:oe,u_globe_pos:J,u_globe_radius:_e,u_viewport:Q,u_globe_transition:a.globeToMercatorTransition(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,y,m,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);u.setFogUniformValues(r,M)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,u=r.createTexture();return r.bindTexture(r.TEXTURE_2D,u),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)u[y.key]=r[y.key]||new a.Tile(y,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class qs{constructor(r=0,u=0,m=0,y=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=m,this.right=y}interpolate(r,u,m){return u.top!=null&&r.top!=null&&(this.top=a.number(r.top,u.top,m)),u.bottom!=null&&r.bottom!=null&&(this.bottom=a.number(r.bottom,u.bottom,m)),u.left!=null&&r.left!=null&&(this.left=a.number(r.left,u.left,m)),u.right!=null&&r.right!=null&&(this.right=a.number(r.right,u.right,m)),this}getCenter(r,u){const m=a.clamp((this.left+r-this.right)/2,0,r),y=a.clamp((this.top+u-this.bottom)/2,0,u);return new a.pointGeometry(m,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new qs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function wu(f,r){const u=a.getColumn(f,3);a.fromQuat(f,r),a.setColumn(f,3,u)}function Xl(f,r){const u=a.identity$1([]);return a.rotateZ$1(u,u,-r),a.rotateX$1(u,u,-f),u}function bu(f,r){const u=[f[0],f[1],0],m=[r[0],r[1],0];if(a.length(u)>=1e-15){const M=a.normalize([],u);a.scale$2(m,M,a.dot(m,M)),r[0]=m[0],r[1]=m[1]}const y=a.cross([],r,f);if(a.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return Xl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}class Yl{constructor(r,u){this.position=r,this.orientation=u}get position(){return this._position}set position(r){if(r){const u=r instanceof a.MercatorCoordinate?r:new a.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(u.x=a.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(r,u){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(r)):0,y=this.position,v=a.MercatorCoordinate.fromLngLat(r,m),M=[v.x-y.x,v.y-y.y,v.z-y.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=bu(M,u)}setPitchBearing(r,u){this.orientation=Xl(a.degToRad(r),a.degToRad(-u))}}class Oa{constructor(r,u){this._transform=a.identity([]),this.orientation=u,this.position=r}get mercatorPosition(){const r=this.position;return new a.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=a.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var u;r&&a.setColumn(this._transform,3,[(u=r)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||a.identity$1([]),r&&wu(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,u){this._orientation=Xl(r,u),wu(this._transform,this._orientation)}forward(){const r=a.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=a.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=a.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,u){const m=new Float64Array(16);return a.invert(m,this.getWorldToCamera(r,u)),m}getWorldToCameraPosition(r,u,m){const y=this.position;a.scale$2(y,y,-r);const v=new Float64Array(16);return a.fromScaling(v,[m,m,m]),a.translate(v,v,y),v[10]*=u,v}getWorldToCamera(r,u){const m=new Float64Array(16),y=new Float64Array(4),v=this.position;return a.conjugate(y,this._orientation),a.scale$2(v,v,-r),a.fromQuat(m,y),a.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(r,u,m,y){const v=new Float64Array(16);return a.perspective(v,r,u,m,y),v}getDistanceToElevation(r){const u=r===0?0:a.mercatorZfromAltitude(r,this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new Oa([...this.position],[...this.orientation])}}function Nt(f,r){const u=Kl(f.projection,f.zoom,f.width,f.height),m=function(v,M,E,I,R){const N=new a.LngLat(E.lng-180*Zs,E.lat),j=new a.LngLat(E.lng+180*Zs,E.lat),Y=v.project(N.lng,N.lat),ie=v.project(j.lng,j.lat),oe=-Math.atan2(ie.y-Y.y,ie.x-Y.x),J=a.MercatorCoordinate.fromLngLat(E);J.y=a.clamp(J.y,-.999975,.999975);const _e=J.toLngLat(),Q=v.project(_e.lng,_e.lat),ae=a.MercatorCoordinate.fromLngLat(_e);ae.x+=Zs;const le=ae.toLngLat(),we=v.project(le.lng,le.lat),pe=Xs(we.x-Q.x,we.y-Q.y,oe),ye=a.MercatorCoordinate.fromLngLat(_e);ye.y+=Zs;const Le=ye.toLngLat(),Ve=v.project(Le.lng,Le.lat),He=Xs(Ve.x-Q.x,Ve.y-Q.y,oe),Ge=Math.abs(pe.x)/Math.abs(He.y),Ue=a.identity([]);a.rotateZ(Ue,Ue,-oe*(1-(R?0:I)));const ve=a.identity([]);return a.scale(ve,ve,[1,1-(1-Ge)*I,1]),ve[4]=-He.x/He.y*I,a.rotateZ(ve,ve,oe),a.multiply(ve,Ue,ve),ve}(f.projection,0,f.center,u,r),y=Yr(f);return a.scale(m,m,[y,y,1]),m}function Yr(f){const r=f.projection,u=Kl(f.projection,f.zoom,f.width,f.height),m=Dd(r,f.center),y=Dd(r,a.LngLat.convert(r.center));return Math.pow(2,m*u+(1-u)*y)}function Kl(f,r,u,m,y=1/0){const v=f.range;if(!v)return 0;const M=Math.min(y,Math.max(u,m)),E=Math.log(M/1024)/Math.LN2;return a.smoothstep(v[0]+E,v[1]+E,r)}const Zs=1/4e4;function Dd(f,r){const u=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=new a.LngLat(r.lng-180*Zs,u),y=new a.LngLat(r.lng+180*Zs,u),v=f.project(m.lng,u),M=f.project(y.lng,u),E=a.MercatorCoordinate.fromLngLat(m),I=a.MercatorCoordinate.fromLngLat(y),R=M.x-v.x,N=M.y-v.y,j=I.x-E.x,Y=I.y-E.y,ie=Math.sqrt((j*j+Y*Y)/(R*R+N*N));return Math.log(ie)/Math.LN2}function Xs(f,r,u){const m=Math.cos(u),y=Math.sin(u);return{x:f*m-r*y,y:f*y+r*m}}class Su{constructor(r,u,m,y,v,M,E){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=m==null?0:m,this._maxPitch=y==null?60:y,this.setProjection(M),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Oa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Su(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(r||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const m=!T(u,this.getProjection());return m&&this._calcMatrices(),m}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const u=-r*Math.PI/180;var m;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(y,v,M){var E=v[0],I=v[1],R=v[2],N=v[3],j=Math.sin(M),Y=Math.cos(M);y[0]=E*Y+R*j,y[1]=I*Y+N*j,y[2]=E*-j+R*Y,y[3]=I*-j+N*Y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=a.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,v=0;for(let M=0;M<u.length;M++){const E=new a.pointGeometry(u[M][0]*this.width,m+u[M][1]*(this.height-m)),I=r.pointCoordinate(E);if(!I)continue;const R=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);y+=I[3]*R,v+=R}return v===0?NaN:y/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,y=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),M=Math.max(y-m,v);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[u.x,u.y,u.z]:[r.x,r.y,r.z];const y=a.length(a.sub([],this._camera.position,m));return a.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let u=!1;if(r.orientation&&!a.exactEquals(r.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];a.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,u=new Yl;return u.position=new a.MercatorCoordinate(r[0],r[1],r[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(r){if(!a.length$1(r))return!1;a.normalize$1(r,r);const u=a.transformQuat([],[0,0,-1],r),m=a.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const y=bu(u,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=a.clamp(r[2],y/m,y/u),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,m){this._unmodified=!1,this._edgeInsets.interpolate(r,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new a.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new a.pointGeometry(0,0)),y=this.pointCoordinate(new a.pointGeometry(this.width,0)),v=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new a.pointGeometry(0,this.height)),E=Math.floor(Math.min(m.x,y.x,v.x,M.x)),I=Math.floor(Math.max(m.x,y.x,v.x,M.x)),R=1;for(let N=E-R;N<=I+R;N++)N!==0&&u.push(new a.UnwrappedTileID(N,r))}return u}coveringTiles(r){let u=this.coveringZoomLevel(r);const m=u,y=this.elevation&&!r.isTerrainDEM,v=this.projection.name==="mercator";if(r.minzoom!==void 0&&u<r.minzoom)return[];r.maxzoom!==void 0&&u>r.maxzoom&&(u=r.maxzoom);const M=this.locationCoordinate(this.center),E=this.center.lat,I=1<<u,R=[I*M.x,I*M.y,0],N=this.projection.name==="globe",j=!N,Y=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,j),ie=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=I*a.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),_e=[I*ie.x,I*ie.y,J*(j?1:oe)],Q=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,le=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,we=r.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=this.projection.isReprojectedInTileSpace?Yr(this):1,ye=Ke=>{const Ct=new a.MercatorCoordinate(Ke.x+25e-6,Ke.y,Ke.z),Tt=new a.MercatorCoordinate(Ke.x,Ke.y+25e-6,Ke.z),_t=Ke.toLngLat(),St=Ct.toLngLat(),ln=Tt.toLngLat(),en=this.locationCoordinate(_t),vn=this.locationCoordinate(St),Kt=this.locationCoordinate(ln),gn=Math.hypot(vn.x-en.x,vn.y-en.y),Gn=Math.hypot(Kt.x-en.x,Kt.y-en.y);return Math.sqrt(gn*Gn)*pe/25e-6},Le=Ke=>{const Jt=le,Ct=we;return{aabb:a.tileAABB(this,I,0,0,0,Ke,Ct,Jt,this.projection),zoom:0,x:0,y:0,minZ:Ct,maxZ:Jt,wrap:Ke,fullyVisible:!1}},Ve=[];let He=[];const Ge=u,Ue=r.reparseOverscaled?m:u,ve=Ke=>Ke*Ke,at=ve((J-this._centerAltitude)*oe),rt=Ke=>{if(!this._elevation||!Ke.tileID||!v)return;const Jt=this._elevation.getMinMaxForTile(Ke.tileID),Ct=Ke.aabb;Jt?(Ct.min[2]=Jt.min,Ct.max[2]=Jt.max,Ct.center[2]=(Ct.min[2]+Ct.max[2])/2):(Ke.shouldSplit=It(Ke),Ke.shouldSplit||(Ct.min[2]=Ct.max[2]=Ct.center[2]=this._centerAltitude))},It=Ke=>{if(Ke.zoom<ae)return!0;if(Ke.zoom===Ge)return!1;if(Ke.shouldSplit!=null)return Ke.shouldSplit;const Jt=Ke.aabb.distanceX(_e),Ct=Ke.aabb.distanceY(_e);let Tt=at,_t=1;if(N){Tt=ve(Ke.aabb.distanceZ(_e));const ln=Math.pow(2,Ke.zoom),en=a.latFromMercatorY((Ke.y+1)/ln),vn=a.latFromMercatorY(Ke.y/ln),Kt=Math.min(Math.max(E,en),vn),gn=a.circumferenceAtLatitude(Kt)/a.circumferenceAtLatitude(E);if(_t=Kt===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,gn/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Ke.zoom===Ge-1&&gn>=.9)return!0}else if(y&&(Tt=ve(Ke.aabb.distanceZ(_e)*oe)),this.projection.isReprojectedInTileSpace&&m<=5){const ln=Math.pow(2,Ke.zoom),en=ye(new a.MercatorCoordinate((Ke.x+.5)/ln,(Ke.y+.5)/ln));_t=en>.85?1:en}const St=Jt*Jt+Ct*Ct+Tt;return St<ve((1<<Ge-Ke.zoom)*Q*_t*((ln,en)=>{if(en*ve(.707)<ln)return 1;const vn=Math.sqrt(en/ln);return vn/(1.4144271570014144+(Math.pow(1.1,vn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Tt,at),St))};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)Ve.push(Le(-Ke)),Ve.push(Le(Ke));for(Ve.push(Le(0));Ve.length>0;){const Ke=Ve.pop(),Jt=Ke.x,Ct=Ke.y;let Tt=Ke.fullyVisible;if(!Tt){const _t=Ke.aabb.intersects(Y);if(_t===0)continue;Tt=_t===2}if(Ke.zoom!==Ge&&It(Ke))for(let _t=0;_t<4;_t++){const St=(Jt<<1)+_t%2,ln=(Ct<<1)+(_t>>1),en={aabb:v?Ke.aabb.quadrant(_t):a.tileAABB(this,I,Ke.zoom+1,St,ln,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:St,y:ln,wrap:Ke.wrap,fullyVisible:Tt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};y&&!N&&(en.tileID=new a.OverscaledTileID(Ke.zoom+1===Ge?Ue:Ke.zoom+1,Ke.wrap,Ke.zoom+1,St,ln),rt(en)),Ve.push(en)}else{const _t=Ke.zoom===Ge?Ue:Ke.zoom;if(r.minzoom&&r.minzoom>_t)continue;const St=R[0]-(.5+Jt+(Ke.wrap<<Ke.zoom))*(1<<u-Ke.zoom),ln=R[1]-.5-Ct,en=Ke.tileID?Ke.tileID:new a.OverscaledTileID(_t,Ke.wrap,Ke.zoom,Jt,Ct);He.push({tileID:en,distanceSq:St*St+ln*ln})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Jt=this.horizonLineFromTop();He=He.filter(Ct=>{const Tt=[0,0,0,1],_t=[a.EXTENT,a.EXTENT,0,1],St=this.calculateFogTileMatrix(Ct.tileID.toUnwrapped());a.transformMat4$1(Tt,Tt,St),a.transformMat4$1(_t,_t,St);const ln=a.getAABBPointSquareDist(Tt,_t);if(ln===0)return!0;let en=!1;const vn=this._elevation;if(vn&&ln>Ke&&Jt!==0){const Kt=this.calculateProjMatrix(Ct.tileID.toUnwrapped());let gn;r.isTerrainDEM||(gn=vn.getMinMaxForTile(Ct.tileID)),gn||(gn={min:we,max:le});const Gn=a.furthestTileCorner(this.rotation),Xn=[Gn[0]*a.EXTENT,Gn[1]*a.EXTENT,gn.max];a.transformMat4(Xn,Xn,Kt),en=(1-Xn[1])*this.height*.5<Jt}return ln<Ke||en})}return He.sort((Ke,Jt)=>Ke.distanceSq-Jt.distanceSq).map(Ke=>Ke.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,u);return new a.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,u){let m,y;const v=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;m=(u.x-v.x)/E,y=(u.y-v.y)/E}else{const E=this.pointCoordinate(u),I=this.pointCoordinate(v);m=E.x-I.x,y=E.y-I.y}const M=this.locationCoordinate(r);this.setLocation(new a.MercatorCoordinate(M.x-m,M.y-y))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,u){const m=u?a.mercatorZfromAltitude(u,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new a.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,u){const m=u!=null?u:this._centerAltitude,y=[r.x,r.y,0,1],v=[r.x,r.y,1,1];a.transformMat4$1(y,y,this.pixelMatrixInverse),a.transformMat4$1(v,v,this.pixelMatrixInverse);const M=v[3];a.scale$1(y,y,1/y[3]),a.scale$1(v,v,1/M);const E=y[2],I=v[2];return{p0:y,p1:v,t:E===I?0:(m-E)/(I-E)}}screenPointToMercatorRay(r){const u=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return a.transformMat4$1(u,u,this.pixelMatrixInverse),a.transformMat4$1(m,m,this.pixelMatrixInverse),a.scale$1(u,u,1/u[3]),a.scale$1(m,m,1/m[3]),u[2]=a.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,m[2]=a.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,a.scale$1(u,u,1/this.worldSize),a.scale$1(m,m,1/this.worldSize),new a.Ray([u[0],u[1],u[2]],a.normalize([],a.sub([],m,u)))}rayIntersectionCoordinate(r){const{p0:u,p1:m,t:y}=r,v=a.mercatorZfromAltitude(u[2],this._center.lat),M=a.mercatorZfromAltitude(m[2],this._center.lat);return new a.MercatorCoordinate(a.number(u[0],m[0],y)/this.worldSize,a.number(u[1],m[1],y)/this.worldSize,a.number(v,M,y))}pointCoordinate(r,u=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,u)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let u=this.projection.pointCoordinate3D(this,r.x,r.y);if(u)return new a.MercatorCoordinate(u[0],u[1],u[2]);let m=0,y=this.horizonLineFromTop();if(r.y>y)return this.pointCoordinate(r);const v=.02*y,M=r.clone();for(let E=0;E<10&&y-m>v;E++){M.y=a.number(m,y,.66);const I=this.projection.pointCoordinate3D(this,M.x,M.y);I?(y=M.y,u=I):m=M.y}return u?new a.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return a.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new a.pointGeometry(y[0]/y[3],y[1]/y[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,u){const m=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),M=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(m,r),I=this.pointCoordinate(y,r);const R=this.pointCoordinate(v,u),N=this.pointCoordinate(M,u),j=(Y,ie)=>(ie.y-Y.y)/(ie.x-Y.x);return E.y>1&&I.y>=0?E=new a.MercatorCoordinate((1-N.y)/j(N,E)+N.x,1):E.y<0&&I.y<=1&&(E=new a.MercatorCoordinate(-N.y/j(N,E)+N.x,0)),I.y>1&&E.y>=0?I=new a.MercatorCoordinate((1-R.y)/j(R,I)+R.x,1):I.y<0&&E.y<=1&&(I=new a.MercatorCoordinate(-R.y/j(R,I)+R.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(R))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const u=r.visibleDemTiles.reduce((m,y)=>{if(y.dem){const v=y.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*r.exaggeration(),u.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,u){return this.projection.createTileMatrix(this,u,r)}calculateDistanceTileData(r){const u=r.key,m=this._distanceTileDataCache;if(m[u])return m[u];const y=r.canonical,v=1/this.height,M=this.cameraWorldSize/this.zoomScale(y.z),E=(y.x+Math.pow(2,y.z)*r.wrap)*M,I=y.y*M,R=this.point,N=this.angle,j=Math.sin(-N),Y=-Math.cos(-N);return m[u]={bearing:[j,Y],center:[(R.x-E)*v,(R.y-I)*v],scale:M/a.EXTENT*v},m[u]}calculateFogTileMatrix(r){const u=r.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const y=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return a.multiply(y,this.worldToFogMatrix,y),m[u]=new Float32Array(y),m[u]}calculateProjMatrix(r,u=!1){const m=r.key,y=u?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const v=this.calculatePosMatrix(r,this.worldSize);return a.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,v),y[m]=new Float32Array(v),y[m]}calculatePixelsToTileUnitsMatrix(r){const u=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const y=function(v,M){const{scale:E}=v.tileTransform,I=E*a.EXTENT/(v.tileSize*Math.pow(2,M.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return R=new Float32Array(4),Y=(N=M.inverseAdjustmentMatrix)[1],ie=N[2],oe=N[3],_e=(j=[I,I])[1],R[0]=N[0]*(J=j[0]),R[1]=Y*J,R[2]=ie*_e,R[3]=oe*_e,R;var R,N,j,Y,ie,oe,J,_e}(r,this);return m[u]=y,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const u=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),y=this._camera.forward(),v=a.mercatorZfromAltitude(1,this._center.lat);m[2]/=v,y[2]/=v,a.normalize(y,y);const M=r.raycast(m,y,r.exaggeration());if(M){const E=a.scaleAndAdd([],m,y,M),I=new a.MercatorCoordinate(E[0],E[1],a.mercatorZfromAltitude(E[2],a.latFromMercatorY(E[1]))),R=(I.z+a.length([I.x-m[0],I.y-m[1],I.z-m[2]*v]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const u=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),y=r.getAtPointOrZero(new a.MercatorCoordinate(...m)),v=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),M=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(M<v){const E=this.locationCoordinate(this._center,this._centerAltitude),I=[E.x-m[0],E.y-m[1],E.z-m[2]],R=a.length(I);I[2]-=(v-M)/this._projectionScaler;const N=a.length(I);if(N===0)return;a.scale$2(I,I,R/N*this._projectionScaler),this._camera.position=[E.x-I[0],E.y-I[1],E.z*this._projectionScaler-I[2]],this._camera.orientation=bu(I,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const j=this.center;return j.lat=a.clamp(j.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(j.lng=a.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const r=this._unmodified,{x:u,y:m}=this.point;let y=0,v=u,M=m;const E=this.width/2,I=this.height/2,R=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(m-I<R&&(M=R+I),m+I>N&&(M=N-I),N-R<this.height&&(y=Math.max(y,this.height/(N-R)),M=(N+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,ie=this.worldSize/2-(j+Y)/2;v=(u+ie+this.worldSize)%this.worldSize-ie,v-E<j&&(v=j+E),v+E>Y&&(v=Y-E),Y-j<this.width&&(y=Math.max(y,this.width/(Y-j)),v=(Y+j)/2)}v===u&&M===m||(this.center=this.unproject(new a.pointGeometry(v,M))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.pixelsPerMeter;if(this.projection.name==="globe"){const pe=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,ye=a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=pe/ye}const m=Kl(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?u:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-r.x/this.width,v[9]=2*r.y/this.height;let M=a.mul([],v,y);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),ye=a.identity([]);a.translate(ye,ye,[pe.x*this.worldSize,pe.y*this.worldSize,0]),a.multiply(ye,ye,Nt(this)),a.translate(ye,ye,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),a.multiply(M,M,ye),this.inverseAdjustmentMatrix=function(Le){const Ve=Nt(Le,!0);return Ae([],[Ve[0],Ve[1],Ve[4],Ve[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],M,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=M,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const E=a.invert([],v);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const I=new Float32Array(16);a.identity(I),a.scale(I,I,[1,-1,1]),a.rotateX(I,I,this._pitch),a.rotateZ(I,I,this.angle);const R=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-r.x/this.width,R[9]=2*(r.y+N)/this.height,this.skyboxMatrix=a.multiply(I,R,I);const j=this.point,Y=j.x,ie=j.y,oe=this.width%2/2,J=this.height%2/2,_e=Math.cos(this.angle),Q=Math.sin(this.angle),ae=Y-Math.round(Y)+_e*oe+Q*J,le=ie-Math.round(ie)+_e*J+Q*oe,we=new Float64Array(M);if(a.translate(we,we,[ae>.5?ae-1:ae,le>.5?le-1:le,0]),this.alignedProjMatrix=we,M=a.create(),a.scale(M,M,[this.width/2,-this.height/2,1]),a.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=a.create(),a.scale(M,M,[1,-1,1]),a.translate(M,M,[-1,-1,0]),a.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=a.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(pe,pe,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,u=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._projectionScaler,v=[r,r,u];a.scale$2(v,v,y),a.scale$2(m,m,-1),a.multiply$2(m,m,v);const M=a.create();a.translate(M,M,m),a.scale(M,M,v),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,u,y)}_computeCameraPosition(r){const u=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-r/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*v,y.y/this.worldSize-m[1]*v,r/this.worldSize*this._centerAltitude-m[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=r[2];let y=1;m>0&&(y=Math.min((u-this._camera.position[2])/m,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,r,y),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),v=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),E=Math.max((r[2]-v)/Math.cos(m),M),I=this._zoomFromMercatorZ(E);a.scaleAndAdd(r,r,u,E),this._pitch=a.clamp(m,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(y,-Math.PI,Math.PI),this._setZoom(a.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,u){const m=Math.min(r.x,u.x),y=Math.max(r.x,u.x),v=Math.min(r.y,u.y),M=Math.max(r.y,u.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new a.pointGeometry(m,v),new a.pointGeometry(y,M),new a.pointGeometry(m,M),new a.pointGeometry(y,v)],I=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const N of E){const j=this.pointRayIntersection(N);if(j.t<0)return!0;const Y=this.rayIntersectionCoordinate(j);if(Y.x<I||Y.y<0||Y.x>R||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,u){const m=a.length(a.sub([],this._camera.position,r)),y=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const r=function(u,m){const y=[u[0],u[1],u[2],1];a.transformMat4$1(y,y,m);const v=Math.max(y[3],1e-6);return[y[0]/v,y[1]/v,y[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,r))}}getCameraToCenterDistance(r){const u=Kl(r,this.zoom,this.width,this.height,1024),m=r.pixelSpaceConversion(this.center.lat,this.worldSize,u);return .5/Math.tan(.5*this._fov)*this.height*m}}function Jl(f,r){let u=!1,m=null;const y=()=>{m=null,u&&(f(),m=setTimeout(y,r),u=!1)};return()=>(u=!0,m||y(),m)}class zd{constructor(r){this._hashName=r&&encodeURIComponent(r),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jl(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,a.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(r){const u=this._map;if(!u)return"";const m=u.getCenter(),y=Math.round(100*u.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,v),E=Math.round(m.lng*M)/M,I=Math.round(m.lat*M)/M,R=u.getBearing(),N=u.getPitch();let j="";if(j+=r?`/${E}/${I}/${y}`:`${y}/${I}/${E}`,(R||N)&&(j+="/"+Math.round(10*R)/10),N&&(j+=`/${Math.round(N)}`),this._hashName){const Y=this._hashName;let ie=!1;const oe=a.window.location.hash.slice(1).split("&").map(J=>{const _e=J.split("=")[0];return _e===Y?(ie=!0,`${_e}=${j}`):J}).filter(J=>J);return ie||oe.push(`${Y}=${j}`),`#${oe.join("&")}`}return`#${j}`}_getCurrentHash(){const r=a.window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(u[3]||0):r.getBearing();return r.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,r)}}const Ys={linearity:.3,easing:a.bezier(0,0,.3,1)},tm=a.extend({deceleration:2500,maxSpeed:1400},Ys),nm=a.extend({deceleration:20,maxSpeed:1400},Ys),Na=a.extend({deceleration:1e3,maxSpeed:360},Ys),Sy=a.extend({deceleration:1e3,maxSpeed:90},Ys);class My{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=a.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)u.zoom+=v.zoomDelta||0,u.bearing+=v.bearingDelta||0,u.pitch+=v.pitchDelta||0,v.panDelta&&u.pan._add(v.panDelta),v.around&&(u.around=v.around),v.pinchAround&&(u.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const v=Ks(u.pan.mag(),m,a.extend({},tm,r||{}));y.offset=u.pan.mult(v.amount/u.pan.mag()),y.center=this._map.transform.center,Ql(y,v)}if(u.zoom){const v=Ks(u.zoom,m,nm);y.zoom=this._map.transform.zoom+v.amount,Ql(y,v)}if(u.bearing){const v=Ks(u.bearing,m,Na);y.bearing=this._map.transform.bearing+a.clamp(v.amount,-179,179),Ql(y,v)}if(u.pitch){const v=Ks(u.pitch,m,Sy);y.pitch=this._map.transform.pitch+v.amount,Ql(y,v)}if(y.zoom||y.bearing){const v=u.pinchAround===void 0?u.around:u.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Ql(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Ks(f,r,u){const{maxSpeed:m,linearity:y,deceleration:v}=u,M=a.clamp(f*y/(r/1e3),-m,m),E=Math.abs(M)/(v*y);return{easing:u.easing,duration:1e3*E,amount:M*(E/2)}}class _r extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m,y={}){const v=K(u.getCanvasContainer(),m),M=u.unproject(v);super(r,a.extend({point:v,lngLat:M,originalEvent:m},y)),this._defaultPrevented=!1,this.target=u}}class ec extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){const y=r==="touchend"?m.changedTouches:m.touches,v=Ee(u.getCanvasContainer(),y),M=v.map(I=>u.unproject(I)),E=v.reduce((I,R,N,j)=>I.add(R.div(j.length)),new a.pointGeometry(0,0));super(r,{points:v,point:E,lngLats:M,lngLat:u.unproject(E),originalEvent:m}),this._defaultPrevented=!1}}class im extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Mu{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new im(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new _r(r.type,this._map,r))}mouseup(r){this._map.fire(new _r(r.type,this._map,r))}preclick(r){const u=a.extend({},r);u.type="preclick",this._map.fire(new _r(u.type,this._map,u))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(r),this._map.fire(new _r(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new _r(r.type,this._map,r))}mouseover(r){this._map.fire(new _r(r.type,this._map,r))}mouseout(r){this._map.fire(new _r(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ec(r.type,this._map,r))}touchmove(r){this._map.fire(new ec(r.type,this._map,r))}touchend(r){this._map.fire(new ec(r.type,this._map,r))}touchcancel(r){this._map.fire(new ec(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kd{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new _r(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new _r(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rm{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&r.button===0&&(G(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const m=u;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=k("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(y.x,m.x),M=Math.max(y.x,m.x),E=Math.min(y.y,m.y),I=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${E}px)`,this._box.style.width=M-v+"px",this._box.style.height=I-E+"px")})}mouseupWindow(r,u){if(!this._active||r.button!==0)return;const m=this._startPos,y=u;if(this.reset(),me(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new a.Event(r,{originalEvent:u}))}}function Tu(f,r){const u={};for(let m=0;m<f.length;m++)u[f[m].identifier]=r[m];return u}class om{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const v=new a.pointGeometry(0,0);for(const M of y)v._add(M);return v.div(y.length)}(u),this.touches=Tu(m,u)))}touchmove(r,u,m){if(this.aborted||!this.centroid)return;const y=Tu(m,u);for(const v in this.touches){const M=this.touches[v],E=y[v];(!E||E.dist(M)>30)&&(this.aborted=!0)}}touchend(r,u,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Eu{constructor(r){this.singleTap=new om(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,u,m){this.singleTap.touchstart(r,u,m)}touchmove(r,u,m){this.singleTap.touchmove(r,u,m)}touchend(r,u,m){const y=this.singleTap.touchend(r,u,m);if(y){const v=r.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(y)<30;if(v&&M||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class sm{constructor(){this._zoomIn=new Eu({numTouches:1,numTaps:2}),this._zoomOut=new Eu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,m){this._zoomIn.touchstart(r,u,m),this._zoomOut.touchstart(r,u,m)}touchmove(r,u,m){this._zoomIn.touchmove(r,u,m),this._zoomOut.touchmove(r,u,m)}touchend(r,u,m){const y=this._zoomIn.touchend(r,u,m),v=this._zoomOut.touchend(r,u,m);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(y)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ua={0:1,2:2};class Cu{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const m=Te(r);this._correctButton(r,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(r,u){const m=this._lastPoint;if(m){if(r.preventDefault(),this._eventButton!=null&&function(y,v){const M=Ua[v];return y.buttons===void 0||(y.buttons&M)!==M}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}}mouseupWindow(r){this._lastPoint&&Te(r)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class am extends Cu{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return u===0&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class Rd extends Cu{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const m=.8*(u.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Fd extends Cu{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const m=-.5*(u.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class lm{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(r,u,m){return this._calculateTransform(r,u,m)}touchmove(r,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.preventDefault(),this._calculateTransform(r,u,m)}}touchend(r,u,m){this._calculateTransform(r,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,m){m.length>0&&(this._active=!0);const y=Tu(m,u),v=new a.pointGeometry(0,0),M=new a.pointGeometry(0,0);let E=0;for(const R in y){const N=y[R],j=this._touches[R];j&&(v._add(N),M._add(N.sub(j)),E++,y[R]=N)}if(this._touches=y,E<this._minTouches||!M.mag())return;const I=M.div(E);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Au{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,u,m){return{}}touchstart(r,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,m){const y=this._firstTwoTouches;if(!y)return;r.preventDefault();const[v,M]=y,E=$i(m,u,v),I=$i(m,u,M);if(!E||!I)return;const R=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],R,r)}touchend(r,u,m){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,M=$i(m,u,y),E=$i(m,u,v);M&&E||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $i(f,r,u){for(let m=0;m<f.length;m++)if(f[m].identifier===u)return r[m]}function cm(f,r){return Math.log(f/r)/Math.LN2}class um extends Au{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(cm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cm(this._distance,m),pinchAround:u}}}function hm(f,r){return 180*f.angleWith(r)/Math.PI}class Ty extends Au{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hm(this._vector,m),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,m=hm(r,this._startVector);return Math.abs(m)<u}}function fo(f){return Math.abs(f.y)>Math.abs(f.x)}class dm extends Au{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,fo(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,m){const y=this._lastPoints;if(!y)return;const v=r[0].sub(y[0]),M=r[1].sub(y[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(v,M,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+M.y)/2*-.5})}gestureBeginsVertically(r,u,m){if(this._valid!==void 0)return this._valid;const y=r.mag()>=2,v=u.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const M=r.y>0==u.y>0;return fo(r)&&fo(u)&&M}}const Va={panStep:100,bearingStep:15,pitchStep:10};class Ao{constructor(){const r=Va;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,m=0,y=0,v=0,M=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),M=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:E=>{const I=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Iu,zoom:u?Math.round(I)+u*(r.shiftKey?2:1):I,bearing:E.getBearing()+m*this._bearingStep,pitch:E.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-M*this._panStep],center:E.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Iu(f){return f*(2-f)}const Vt=4.000244140625;class fm{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=r.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=a.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%Vt==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=K(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,u=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Vt?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&R!==0&&(R=1/R);const N=u(),j=Math.pow(2,N),Y=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Y*R))),this._type==="wheel"&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:u(),y=this._startZoom,v=this._easing;let M,E=!1;if(this._type==="wheel"&&y&&v){const I=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),R=v(I);M=a.number(y,m,R),I<1?this._frameId||(this._frameId=!0):E=!0}else M=m,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:M-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=a.ease;if(this._prevEase){const m=this._prevEase,y=(a.exported.now()-m.start)/m.duration,v=m.easing(y+.01)-m.easing(y),M=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-M*M);u=a.bezier(M,E,.25,1)}return this._prevEase={start:a.exported.now(),duration:r,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!a.window.document.fullscreenElement||!!a.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class pm{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,u){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nc{constructor(){this._tap=new Eu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,u,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,u,m))}touchmove(r,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=u[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,u,m)}touchend(r,u,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(r,u,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mm{constructor(r,u,m){this._el=r,this._mousePan=u,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _m{constructor(r,u,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gm{constructor(r,u,m,y){this._el=r,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ic=f=>f.zoom||f.drag||f.pitch||f.rotate;class ym extends a.Event{}class xm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,u){const m=a.sub([],u,r);this.radius=a.length(m[2]<0?a.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){a.div(r,r,this.constants),a.normalize(r,r),a.mul$1(r,r,this.constants);const u=a.scale$2([],r,this.radius);if(u[2]>0){const m=a.scale$2([],[0,0,1],a.dot(u,[0,0,1])),y=a.scale$2([],a.normalize([],[u[0],u[1],0]),this.radius),v=a.add([],u,a.scale$2([],a.sub([],a.add([],y,m),u),2));u[0]=v[0],u[1]=v[1]}return u}}function rc(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Pu{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new My(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),a.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[y,v,M]of this._listeners)y.addEventListener(v,y===a.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[r,u,m]of this._listeners)r.removeEventListener(u,r===a.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Mu(u,r));const y=u.boxZoom=new rm(u,r);this._add("boxZoom",y);const v=new sm,M=new tc;u.doubleClickZoom=new pm(M,v),this._add("tapZoom",v),this._add("clickZoom",M);const E=new nc;this._add("tapDragZoom",E);const I=u.touchPitch=new dm(u);this._add("touchPitch",I);const R=new Rd(r),N=new Fd(r);u.dragRotate=new _m(r,R,N),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const j=new am(r),Y=new lm(u,r);u.dragPan=new mm(m,j,Y),this._add("mousePan",j),this._add("touchPan",Y,["touchZoom","touchRotate"]);const ie=new Ty,oe=new um;u.touchZoomRotate=new gm(m,oe,ie,E),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new kd(u));const J=u.scrollZoom=new fm(u,this);this._add("scrollZoom",J,["mousePan"]);const _e=u.keyboard=new Ao;this._add("keyboard",_e);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Q]&&u[Q].enable(r[Q])}_add(r,u,m){this._handlers.push({handlerName:r,handler:u,allowed:m}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ic(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,u,m){for(const y in r)if(y!==m&&(!u||u.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const m of r)this._el.contains(m.target)&&u.push(m);return u}handleEvent(r,u){this._updatingCamera=!0;const m=r.type==="renderFrame",y=m?void 0:r,v={needsRenderFrame:!1},M={},E={},I=r.touches?this._getMapTouches(r.touches):void 0,R=I?Ee(this._el,I):m?void 0:K(this._el,r);for(const{handlerName:Y,handler:ie,allowed:oe}of this._handlers){if(!ie.isEnabled())continue;let J;this._blockedByActive(E,oe,Y)?ie.reset():ie[u||r.type]&&(J=ie[u||r.type](r,R,I),this.mergeHandlerResult(v,M,J,Y,y),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||ie.isActive())&&(E[Y]=ie)}const N={};for(const Y in this._previousActiveHandlers)E[Y]||(N[Y]=y);this._previousActiveHandlers=E,(Object.keys(N).length||rc(v))&&(this._changes.push([v,M,N]),this._triggerRenderFrame()),(Object.keys(E).length||rc(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=v;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(r,u,m,y,v){if(!m)return;a.extend(r,m);const M={handlerName:y,originalEvent:m.originalEvent||v};m.zoomDelta!==void 0&&(u.zoom=M),m.panDelta!==void 0&&(u.drag=M),m.pitchDelta!==void 0&&(u.pitch=M),m.bearingDelta!==void 0&&(u.rotate=M)}_applyChanges(){const r={},u={},m={};for(const[y,v,M]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new a.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(r.around=y.around),y.aroundCoord!==void 0&&(r.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),a.extend(u,v),a.extend(m,M);this._updateMapTransform(r,u,m),this._changes=[]}_updateMapTransform(r,u,m){const y=this._map,v=y.transform,M=ae=>[ae.x,ae.y,ae.z];if((ae=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!rc(r)){const ae=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ae!==v.zoom&&this._map._update(!0)}if(!rc(r))return void this._fireEvents(u,m,!0);let{panDelta:E,zoomDelta:I,bearingDelta:R,pitchDelta:N,around:j,aroundCoord:Y,pinchAround:ie}=r;ie!==void 0&&(j=ie),(ae=>u.drag&&!this._eventsInProgress.drag)()&&j&&(this._dragOrigin=M(v.pointCoordinate3D(j)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),j=j||y.transform.centerPoint,R&&(v.bearing+=R),N&&(v.pitch+=N),v._updateCameraState();const oe=[0,0,0];if(E){const ae=v.pointCoordinate(j);if(v.projection.name==="globe"){const le=a.latFromMercatorY(ae.y),we=v.center.lat,pe=Math.min(a.mercatorZfromAltitude(1,le)/a.mercatorZfromAltitude(1,we),2);E=E.rotate(-v.angle),oe[0]=-E.x/v.worldSize*pe,oe[1]=-E.y/v.worldSize*pe}else{const le=v.pointCoordinate(j.sub(E));ae&&le&&(oe[0]=le.x-ae.x,oe[1]=le.y-ae.y)}}const J=v.zoom,_e=[0,0,0];if(I){const ae=M(Y||v.pointCoordinate3D(j)),le={dir:a.normalize([],a.sub([],ae,v._camera.position))};if(le.dir[2]<0){const we=v.zoomDeltaToMovement(ae,I);a.scale$2(_e,le.dir,we)}}const Q=a.add(oe,oe,_e);v._translateCameraConstrained(Q),I&&Math.abs(v.zoom-J)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,m,!0)}_fireEvents(r,u,m){const y=ic(this._eventsInProgress),v=ic(r),M={};for(const N in r){const{originalEvent:j}=r[N];this._eventsInProgress[N]||(M[`${N}start`]=j),this._eventsInProgress[N]=r[N]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const N in M)this._fireEvent(N,M[N]);v&&this._fireEvent("move",v.originalEvent);for(const N in r){const{originalEvent:j}=r[N];this._fireEvent(N,j)}const E={};let I;for(const N in this._eventsInProgress){const{handlerName:j,originalEvent:Y}=this._eventsInProgress[N];this._handlersById[j].isActive()||(delete this._eventsInProgress[N],I=u[j]||Y,E[`${N}end`]=I)}for(const N in E)this._fireEvent(N,E[N]);const R=ic(this._eventsInProgress);if(m&&(y||v)&&!R){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;N?(j(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:I})):(this._map.fire(new a.Event("moveend",{originalEvent:I})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new a.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new ym("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Lu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Du extends a.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,m){return r=a.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,a.extend({offset:r},u),m)}panTo(r,u,m){return this.easeTo(a.extend({center:r},u),m)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,m){return this.easeTo(a.extend({zoom:r},u),m)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,m){return this.easeTo(a.extend({bearing:r},u),m)}resetNorth(r,u){return this.rotateTo(0,a.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=a.LngLatBounds.convert(r);const m=u&&u.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,u)}_extendCameraOptions(r){const u={top:0,bottom:0,right:0,left:0};if(typeof(r=a.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=a.extend(u,r.padding),r}_cameraForBoxAndBearing(r,u,m,y){const v=this._extendCameraOptions(y),M=this.transform,E=M.padding,I=M.project(a.LngLat.convert(r)),R=M.project(a.LngLat.convert(u)),N=new a.pointGeometry(I.x,R.y),j=new a.pointGeometry(R.x,I.y),Y=-a.degToRad(m),ie=I.rotate(Y),oe=R.rotate(Y),J=N.rotate(Y),_e=j.rotate(Y),Q=new a.pointGeometry(Math.max(ie.x,oe.x,J.x,_e.x),Math.max(ie.y,oe.y,J.y,_e.y)),ae=new a.pointGeometry(Math.min(ie.x,oe.x,J.x,_e.x),Math.min(ie.y,oe.y,J.y,_e.y)),le=Q.sub(ae),we=(M.width-((E.left||0)+(E.right||0)+v.padding.left+v.padding.right))/le.x,pe=(M.height-((E.top||0)+(E.bottom||0)+v.padding.top+v.padding.bottom))/le.y;if(pe<0||we<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ye=Math.min(M.scaleZoom(M.scale*Math.min(we,pe)),v.maxZoom),Le=typeof v.offset.x=="number"&&typeof v.offset.y=="number"?new a.pointGeometry(v.offset.x,v.offset.y):a.pointGeometry.convert(v.offset),Ve=new a.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),He=Le.add(Ve).mult(M.scale/M.zoomScale(ye));return{center:M.unproject(I.add(R).div(2).sub(He)),zoom:ye,bearing:m}}_cameraForBox(r,u,m,y,v){const M=this._extendCameraOptions(v);m=m||0,y=y||0,r=a.LngLat.convert(r),u=a.LngLat.convert(u);const E=this.transform.clone();E.padding=M.padding;const I=this.getFreeCameraOptions(),R=new a.LngLat(.5*(r.lng+u.lng),.5*(r.lat+u.lat)),N=.5*(m+y);if(E._camera.position[2]<a.mercatorZfromAltitude(N,R.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");I.lookAtPoint(R),E.setFreeCameraOptions(I);const j=a.MercatorCoordinate.fromLngLat(r),Y=a.MercatorCoordinate.fromLngLat(u),ie=E.pointRayIntersection(E.centerPoint,N),oe=[(J=E.rayIntersectionCoordinate(ie)).x,J.y,J.z];var J;const _e=E.screenPointToMercatorRay(E.centerPoint),Q=E.projection.name!=="globe";let ae,le=0;do{const we=Math.floor(E.zoom),pe=1<<we,ye=Math.min(pe*j.x,pe*Y.x),Le=Math.min(pe*j.y,pe*Y.y),Ve=Math.max(pe*j.x,pe*Y.x),He=Math.max(pe*j.y,pe*Y.y),Ge=new a.Aabb([ye,Le,m],[Ve,He,y]),Ue=a.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,we,Q);if(Ge.intersects(Ue)!==2){ae&&(E._camera.position=a.scaleAndAdd([],E._camera.position,_e.dir,-ae),E._updateStateFromCamera());break}const ve=a.sub([],E._camera.position,oe);ae=.5*a.length(ve),E._camera.position=a.scaleAndAdd([],E._camera.position,_e.dir,ae);try{E._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++le<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(r,u,m){return this.transform.projection.name==="globe"&&a.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,u),u,m)}_raycastElevationBox(r,u){const m=this.transform.elevation;if(!m)return;const y=new a.pointGeometry(r.x,u.y),v=new a.pointGeometry(u.x,r.y),M=m.pointCoordinate(r);if(!M)return;const E=m.pointCoordinate(u);if(!E)return;const I=m.pointCoordinate(y);if(!I)return;const R=m.pointCoordinate(v);if(!R)return;const N=new a.MercatorCoordinate(M[0],M[1]).toLngLat(),j=new a.MercatorCoordinate(E[0],E[1]).toLngLat(),Y=new a.MercatorCoordinate(I[0],I[1]).toLngLat(),ie=new a.MercatorCoordinate(R[0],R[1]).toLngLat(),oe=Math.min(N.lng,Math.min(j.lng,Math.min(Y.lng,ie.lng))),J=Math.min(N.lat,Math.min(j.lat,Math.min(Y.lat,ie.lat))),_e=Math.max(N.lng,Math.max(j.lng,Math.max(Y.lng,ie.lng))),Q=Math.max(N.lat,Math.max(j.lat,Math.max(Y.lat,ie.lat))),ae=Math.min(M[3],Math.min(E[3],Math.min(I[3],R[3]))),le=Math.max(M[3],Math.max(E[3],Math.max(I[3],R[3])));return{minLngLat:new a.LngLat(oe,J),maxLngLat:new a.LngLat(_e,Q),minAltitude:ae,maxAltitude:le}}fitScreenCoordinates(r,u,m,y,v){let M,E,I,R;this.transform.projection.name==="globe"&&a.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const N=a.pointGeometry.convert(r),j=a.pointGeometry.convert(u),Y=this._raycastElevationBox(N,j);if(Y)M=Y.minLngLat,E=Y.maxLngLat,I=Y.minAltitude,R=Y.maxAltitude;else{if(this.transform.anyCornerOffEdge(N,j))return this;M=this.transform.pointLocation(N),E=this.transform.pointLocation(j)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(r)),this.transform.pointLocation(a.pointGeometry.convert(u)),m,y):this._cameraForBox(M,E,I,R,y),y,v)}_fitInternal(r,u,m){return r?(delete(u=a.extend(r,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(r,u){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,M=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(y=!0,m.zoom=+r.zoom),r.center!==void 0&&(m.center=a.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(v=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(M=!0,m.pitch=+r.pitch),r.padding==null||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),y&&this.fire(new a.Event("zoomstart",u)).fire(new a.Event("zoom",u)).fire(new a.Event("zoomend",u)),v&&this.fire(new a.Event("rotatestart",u)).fire(new a.Event("rotate",u)).fire(new a.Event("rotateend",u)),M&&this.fire(new a.Event("pitchstart",u)).fire(new a.Event("pitch",u)).fire(new a.Event("pitchend",u)),this.fire(new a.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Lu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return a.warnOnce(Lu),this;this.stop();const y=m.zoom,v=m.pitch,M=m.bearing;m.setFreeCameraOptions(r);const E=y!==m.zoom,I=v!==m.pitch,R=M!==m.bearing;return this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),E&&this.fire(new a.Event("zoomstart",u)).fire(new a.Event("zoom",u)).fire(new a.Event("zoomend",u)),R&&this.fire(new a.Event("rotatestart",u)).fire(new a.Event("rotate",u)).fire(new a.Event("rotateend",u)),I&&this.fire(new a.Event("pitchstart",u)).fire(new a.Event("pitch",u)).fire(new a.Event("pitchend",u)),this.fire(new a.Event("moveend",u)),this}easeTo(r,u){this._stop(!1,r.easeId),((r=a.extend({offset:[0,0],duration:500,easing:a.ease},r)).animate===!1||!r.essential&&a.exported.prefersReducedMotion)&&(r.duration=0);const m=this.transform,y=this.getZoom(),v=this.getBearing(),M=this.getPitch(),E=this.getPadding(),I="zoom"in r?+r.zoom:y,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,N="pitch"in r?+r.pitch:M,j="padding"in r?r.padding:m.padding,Y=a.pointGeometry.convert(r.offset);let ie,oe,J;if(m.projection.name==="globe"){const He=a.MercatorCoordinate.fromLngLat(m.center),Ge=Y.rotate(-m.angle);He.x+=Ge.x/m.worldSize,He.y+=Ge.y/m.worldSize;const Ue=He.toLngLat(),ve=a.LngLat.convert(r.center||Ue);this._normalizeCenter(ve),ie=m.centerPoint.add(Ge),oe=new a.pointGeometry(He.x,He.y).mult(m.worldSize),J=new a.pointGeometry(a.mercatorXfromLng(ve.lng),a.mercatorYfromLat(ve.lat)).mult(m.worldSize).sub(oe)}else{ie=m.centerPoint.add(Y);const He=m.pointLocation(ie),Ge=a.LngLat.convert(r.center||He);this._normalizeCenter(Ge),oe=m.project(He),J=m.project(Ge).sub(oe)}const _e=m.zoomScale(I-y);let Q,ae;r.around&&(Q=a.LngLat.convert(r.around),ae=m.locationPoint(Q));const le=this._zooming||I!==y,we=this._rotating||v!==R,pe=this._pitching||N!==M,ye=!m.isPaddingEqual(j),Le=He=>Ge=>{if(le&&(He.zoom=a.number(y,I,Ge)),we&&(He.bearing=a.number(v,R,Ge)),pe&&(He.pitch=a.number(M,N,Ge)),ye&&(He.interpolatePadding(E,j,Ge),ie=He.centerPoint.add(Y)),Q)He.setLocationAtPoint(Q,ae);else{const Ue=He.zoomScale(He.zoom-y),ve=I>y?Math.min(2,_e):Math.max(.5,_e),at=Math.pow(ve,1-Ge),rt=He.unproject(oe.add(J.mult(Ge*at)).mult(Ue));He.setLocationAtPoint(He.renderWorldCopies?rt.wrap():rt,ie)}return r.preloadOnly||this._fireMoveEvents(u),He};if(r.preloadOnly){const He=this._emulate(Le,r.duration,m);return this._preloadTiles(He),this}const Ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=we,this._pitching=pe,this._padding=ye,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,Ve),this._ease(Le(m),He=>{m.recenterOnTerrain(),this._afterEase(u,He)},r),this}_prepareEase(r,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||m.moving||this.fire(new a.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new a.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new a.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new a.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new a.Event("move",r)),this._zooming&&this.fire(new a.Event("zoom",r)),this._rotating&&this.fire(new a.Event("rotate",r)),this._pitching&&this.fire(new a.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new a.Event("zoomend",r)),y&&this.fire(new a.Event("rotateend",r)),v&&this.fire(new a.Event("pitchend",r)),this.fire(new a.Event("moveend",r))}flyTo(r,u){if(!r.essential&&a.exported.prefersReducedMotion){const Tt=a.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Tt,u)}this.stop(),r=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},r);const m=this.transform,y=this.getZoom(),v=this.getBearing(),M=this.getPitch(),E=this.getPadding(),I="zoom"in r?a.clamp(+r.zoom,m.minZoom,m.maxZoom):y,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,N="pitch"in r?+r.pitch:M,j="padding"in r?r.padding:m.padding,Y=m.zoomScale(I-y),ie=a.pointGeometry.convert(r.offset);let oe=m.centerPoint.add(ie);const J=m.pointLocation(oe),_e=a.LngLat.convert(r.center||J);this._normalizeCenter(_e);const Q=m.project(J),ae=m.project(_e).sub(Q);let le=r.curve;const we=Math.max(m.width,m.height),pe=we/Y,ye=ae.mag();if("minZoom"in r){const Tt=a.clamp(Math.min(r.minZoom,y,I),m.minZoom,m.maxZoom),_t=we/m.zoomScale(Tt-y);le=Math.sqrt(_t/ye*2)}const Le=le*le;function Ve(Tt){const _t=(pe*pe-we*we+(Tt?-1:1)*Le*Le*ye*ye)/(2*(Tt?pe:we)*Le*ye);return Math.log(Math.sqrt(_t*_t+1)-_t)}function He(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function Ge(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}const Ue=Ve(0);let ve=function(Tt){return Ge(Ue)/Ge(Ue+le*Tt)},at=function(Tt){return we*((Ge(Ue)*(He(_t=Ue+le*Tt)/Ge(_t))-He(Ue))/Le)/ye;var _t},rt=(Ve(1)-Ue)/le;if(Math.abs(ye)<1e-6||!isFinite(rt)){if(Math.abs(we-pe)<1e-6)return this.easeTo(r,u);const Tt=pe<we?-1:1;rt=Math.abs(Math.log(pe/we))/le,at=function(){return 0},ve=function(_t){return Math.exp(Tt*le*_t)}}r.duration="duration"in r?+r.duration:1e3*rt/("screenSpeed"in r?+r.screenSpeed/le:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const It=v!==R,Ke=N!==M,Jt=!m.isPaddingEqual(j),Ct=Tt=>_t=>{const St=_t*rt,ln=1/ve(St);Tt.zoom=_t===1?I:y+Tt.scaleZoom(ln),It&&(Tt.bearing=a.number(v,R,_t)),Ke&&(Tt.pitch=a.number(M,N,_t)),Jt&&(Tt.interpolatePadding(E,j,_t),oe=Tt.centerPoint.add(ie));const en=_t===1?_e:Tt.unproject(Q.add(ae.mult(at(St))).mult(ln));return Tt.setLocationAtPoint(Tt.renderWorldCopies?en.wrap():en,oe),Tt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(u),Tt};if(r.preloadOnly){const Tt=this._emulate(Ct,r.duration,m);return this._preloadTiles(Tt),this}return this._zooming=!0,this._rotating=It,this._pitching=Ke,this._padding=Jt,this._prepareEase(u,!1),this._ease(Ct(m),()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,u,m){m.animate===!1||m.duration===0?(r(1),u()):(this._easeStart=a.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=a.wrap(r,-180,180);const m=Math.abs(r-u);return Math.abs(r-360-u)<m&&(r-=360),Math.abs(r+360-u)<m&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const m=r.lng-u.center.lng;r.lng+=m>180?-360:m<-180?360:0}_emulate(r,u,m){const y=Math.ceil(15*u/1e3),v=[],M=r(m.clone());for(let E=0;E<=y;E++){const I=M(E/y);v.push(I.clone())}return v}}class Bd{constructor(r={}){this.options=r,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const u=this.options&&this.options.compact;return this._map=r,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k("button","mapboxgl-ctrl-attrib-button",this._container),k("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const m=this._map._getUIString(`AttributionControl.${u}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(r){const m=u.reduce((y,v,M)=>(v.value&&(y+=`${v.key}=${v.value}${M<u.length-1?"&":""}`),y),"?");r.href=`${a.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style._sourceCaches;for(const y in u){const v=u[y];if(v.used){const M=v.getSource();M.attribution&&r.indexOf(M.attribution)<0&&r.push(M.attribution)}}r.sort((y,v)=>y.length-v.length),r=r.filter((y,v)=>{for(let M=v+1;M<r.length;M++)if(r[M].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Od{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=k("div","mapboxgl-ctrl");const u=k("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const u in r){const m=r[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Nd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const y of m)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ud(f,r,u){if(f=new a.LngLat(f.lng,f.lat),r){const m=new a.LngLat(f.lng-360,f.lat),y=new a.LngLat(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),M=u.locationPoint(f).distSqr(r),E=r.x<0||r.y<0||r.x>u.width||r.y>u.height;u.locationPoint(m).distSqr(r)<M&&(E||Math.abs(m.lng-u.center.lng)<v)?f=m:u.locationPoint(y).distSqr(r)<M&&(E||Math.abs(y.lng-u.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-u.center.lng)>180;){const m=u.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const zu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ku extends a.Evented{constructor(r,u){if(super(),(r instanceof a.window.HTMLElement||u)&&(r=a.extend({element:r},u)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=a.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=k("div");const y=41,v=27,M=W("svg",{display:"block",height:y*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${y}`},this._element),E=W("radialGradient",{id:"shadowGradient"},W("defs",{},M));W("stop",{offset:"10%","stop-opacity":.4},E),W("stop",{offset:"100%","stop-opacity":.05},E),W("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),W("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),W("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),W("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=a.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in zu)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const u=r.code,m=r.charCode||r.keyCode;u!=="Space"&&u!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const u=r.unproject(this._pos),m=r.getFreeCameraOptions();if(!m.position)return!1;const y=m.position.toLngLat();return y.distanceTo(u)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const u=this._pos;if(!u||u.x<0||u.x>r.transform.width||u.y<0||u.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(u);let y;r._usingGlobe()&&a.isLngLatBehindGlobe(r.transform,this._lngLat)?y=0:(y=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(y*=.2)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const u=this._calculateXYTransform()+this._calculateZTransform(),m=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px) ${zu[this._anchor]}
            ${u}
            translate(${m.x}px,${m.y}px)
        `}_calculateXYTransform(){const r=this._pos,u=this._map;if(this.getPitchAlignment()!=="map"||!u||!r)return"";if(!u._usingGlobe()){const I=u.getPitch();return I?`rotateX(${I}deg)`:""}const m=a.radToDeg(a.globeTiltAtLngLat(u.transform,this._lngLat)),y=r.sub(a.globeCenterToScreenPoint(u.transform)),v=m/(Math.abs(y.x)+Math.abs(y.y)),M=y.x*v,E=-y.y*v;return E||M?`rotateX(${E}deg) rotateY(${M}deg)`:""}_calculateZTransform(){const r=this._calculateRotation();return r?`rotateZ(${r}deg)`:""}_calculateRotation(){if(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto")return this._rotation;if(this._map&&this._rotationAlignment==="map"){const r=this._map;if(this._pos&&r&&r._usingGlobe()){const u=r.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),m=r.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);return this._rotation+a.radToDeg(Math.atan2(m.y,m.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(r){a.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Ud(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),r===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._usingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=a.pointGeometry.convert(r),this._update(),this}_onMove(r){const u=this._map;if(u){if(!this._isDragging){const m=this._clickTolerance||u._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(r){const u=this._map;u&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const u=this._map;return u&&(r?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class vm{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const u=a.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,u,m){this._start=this.getValue(u),this._end=r,this._startTime=u,this._endTime=u+m}}const Vd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},wm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ru(f){f.parentNode&&f.parentNode.removeChild(f)}const bm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sm{constructor(r,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Rd({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Fd({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),G()}move(r,u){const m=this.map,y=this.mouseRotate.mousemoveWindow(r,u),v=y&&y.bearingDelta;if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const M=this.mousePitch.mousemoveWindow(r,u),E=M&&M.pitchDelta;E&&m.setPitch(m.getPitch()+E)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(a.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),K(this.element,r)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,K(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ee(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Ee(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Gd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mm={maxWidth:100,unit:"metric"};function jd(f,r,u){const m=Wd(r),y=m/r,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[u];this._map._requestDomTask(()=>{this._container.style.width=f*y+"px",this._container.innerHTML=`${m}&nbsp;${v}`})}function Wd(f){const r=Math.pow(10,`${Math.floor(f)}`.length-1);let u=f/r;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(m){const y=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*y)/y}(u),r*u}const Hd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$d=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fu(f=new a.pointGeometry(0,0),r="bottom"){if(typeof f=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new a.pointGeometry(0,f);case"top-left":return new a.pointGeometry(u,u);case"top-right":return new a.pointGeometry(-u,u);case"bottom":return new a.pointGeometry(0,-f);case"bottom-left":return new a.pointGeometry(u,-u);case"bottom-right":return new a.pointGeometry(-u,-u);case"left":return new a.pointGeometry(f,0);case"right":return new a.pointGeometry(-f,0)}return new a.pointGeometry(0,0)}return f instanceof a.pointGeometry||Array.isArray(f)?a.pointGeometry.convert(f):a.pointGeometry.convert(f[r]||[0,0])}const Bu={version:a.version,supported:A,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Du{constructor(f){if((f=a.extend({},wm,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(f.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Su(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=f.language==="auto"?a.window.navigator.language:f.language,this._worldview=f.worldview,this._renderTaskQueue=new Nd,this._domRenderTaskQueue=new Nd,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Vd,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vm(0),this._explicitProjection=null,this._requestManager=new a.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=a.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Pu(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new zd(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,a.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Bd({customAttribution:f.customAttribution})),this._logoControl=new Od,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[r];return r.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new a.Event("movestart",f)).fire(new a.Event("move",f)),this.fire(new a.Event("resize",f)),r&&this.fire(new a.Event("moveend",f)),this}getBounds(){return this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(a.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f==null?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f==null?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f==null?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f==null?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getLanguage(){return this._language}setLanguage(f){if(this._language=f==="auto"?a.window.navigator.language:f,this.style)for(const r in this.style._sourceCaches){const u=this.style._sourceCaches[r]._source;u._setLanguage&&u._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){if(this._worldview=f,this.style)for(const r in this.style._sourceCaches){const u=this.style._sourceCaches[r]._source;u._setWorldview&&u._setWorldview(f)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._updateProjection(f)}_updateProjection(f){const r=this.getProjection();f===null&&(this._explicitProjection=null);const u=f||this.getProjection();let m;if(u&&u.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(m=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(m=this.transform.setProjection(u),this.transform.mercatorFromTransition=!1),f&&(this._explicitProjection=f.name==="globe"?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),m){if(r.name==="globe"&&this.getProjection().name==="globe")this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const y in this.style._sourceCaches)this.style._sourceCaches[y].clearTiles()}this._update(!0)}return this}project(f){return this.transform.locationPoint3D(a.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(a.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(f,r,u){if(f==="mouseenter"||f==="mouseover"){let m=!1;const y=M=>{const E=r.filter(R=>this.getLayer(R)),I=E.length?this.queryRenderedFeatures(M.point,{layers:E}):[];I.length?m||(m=!0,u.call(this,new _r(f,this,M.originalEvent,{features:I}))):m=!1},v=()=>{m=!1};return{layers:new Set(r),listener:u,delegates:{mousemove:y,mouseout:v}}}if(f==="mouseleave"||f==="mouseout"){let m=!1;const y=M=>{const E=r.filter(I=>this.getLayer(I));(E.length?this.queryRenderedFeatures(M.point,{layers:E}):[]).length?m=!0:m&&(m=!1,u.call(this,new _r(f,this,M.originalEvent)))},v=M=>{m&&(m=!1,u.call(this,new _r(f,this,M.originalEvent)))};return{layers:new Set(r),listener:u,delegates:{mousemove:y,mouseout:v}}}{const m=y=>{const v=r.filter(E=>this.getLayer(E)),M=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];M.length&&(y.features=M,u.call(this,y),delete y.features)};return{layers:new Set(r),listener:u,delegates:{[f]:m}}}}on(f,r,u){if(u===void 0)return super.on(f,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(f,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(f,r,u){if(u===void 0)return super.once(f,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(f,r,u);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(f,r,u){if(u===void 0)return super.off(f,r);r=new Set(Array.isArray(r)?r:[r]);const m=(v,M)=>{if(v.size!==M.size)return!1;for(const E of v)if(!M.has(E))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(v=>{for(let M=0;M<v.length;M++){const E=v[M];if(E.listener===u&&m(E.layers,r)){for(const I in E.delegates)this.off(I,E.delegates[I]);return v.splice(M,1),this}}})(y),this}queryRenderedFeatures(f,r){return this.style?(r!==void 0||f===void 0||f instanceof a.pointGeometry||Array.isArray(f)||(r=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(f,r){return this.style.querySourceFeatures(f,r)}queryTerrainElevation(f,r){const u=this.transform.elevation;return u?(r=a.extend({},{exaggerated:!0},r),u.getAtPoint(a.MercatorCoordinate.fromLngLat(f),null,r.exaggerated)):null}setStyle(f,r){return(r=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new ho(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ho(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,r){if(typeof f=="string"){const u=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(u,a.ResourceType.Style);a.getJSON(m,(y,v)=>{y?this.fire(new a.ErrorEvent(y)):v&&this._updateDiff(v,r)})}else typeof f=="object"&&this._updateDiff(f,r)}_updateDiff(f,r){try{this.style.setState(f)&&this._update(!0)}catch(u){a.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(f,r){return this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const r in f){const u=f[r]._tiles;for(const m in u){const y=u[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(f,r,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,r,{pixelRatio:u=1,sdf:m=!1,stretchX:y,stretchY:v,content:M}={}){if(this._lazyInitEmptyStyle(),r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap){const{width:E,height:I,data:R}=a.exported.getImageData(r);this.style.addImage(f,{data:new a.RGBAImage({width:E,height:I},R),pixelRatio:u,stretchX:y,stretchY:v,content:M,sdf:m,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:I}=r,R=r;this.style.addImage(f,{data:new a.RGBAImage({width:E,height:I},new Uint8Array(R.data)),pixelRatio:u,stretchX:y,stretchY:v,content:M,sdf:m,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}updateImage(f,r){const u=this.style.getImage(f);if(!u)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap?a.exported.getImageData(r):r,{width:y,height:v}=m;y!==void 0&&v!==void 0?y===u.data.width&&v===u.data.height?(u.data.replace(m.data,!(r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap)),this.style.updateImage(f,u)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){a.getImage(this._requestManager.transformRequest(f,a.ResourceType.Image),(u,m)=>{r(u,m instanceof a.window.HTMLImageElement?a.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,r){return this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)}moveLayer(f,r){return this.style.moveLayer(f,r),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,r,u){return this.style.setLayerZoomRange(f,r,u),this._update(!0)}setFilter(f,r,u={}){return this.style.setFilter(f,r,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,r,u,m={}){return this.style.setPaintProperty(f,r,u,m),this._update(!0)}getPaintProperty(f,r){return this.style.getPaintProperty(f,r)}setLayoutProperty(f,r,u,m={}){return this.style.setLayoutProperty(f,r,u,m),this._update(!0)}getLayoutProperty(f,r){return this.style.getLayoutProperty(f,r)}setLight(f,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(f),this.transform):0}setFeatureState(f,r){return this.style.setFeatureState(f,r),this._update()}removeFeatureState(f,r){return this.style.removeFeatureState(f,r),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let u,m,y,v=this._container;for(;v&&(!m||!y);){const M=a.window.getComputedStyle(v).transform;M&&M!=="none"&&(u=M.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(m=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(y=u[3])),v=v.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=y?Math.abs(r/y):r}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=k("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=k("div","mapboxgl-canvas-container",f);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=k("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=k("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=k("div",`mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const u=a.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_setupPainter(){const f=a.extend({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);r?(a.storeAuthState(r,!0),this.painter=new vu(r,this.transform),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(r)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;const u=this.painter.context.extTimerQuery,m=a.exported.now();if(this.listens("gpu-timing-frame")&&(r=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this.getProjection().name==="globe"&&(this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.projection.name==="globe"&&this._updateProjection():this.transform.projection.name==="mercator"&&this._updateProjection());let y=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,R=this.transform.pitch,N=a.exported.now();this.style.zoomHistory.update(I,N);const j=new a.EvaluationParameters(I,{now:N,fadeDuration:v,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=j.crossFadingFactor();Y===1&&Y===this._crossFadingFactor||(y=!0,this._crossFadingFactor=Y),this.style.update(j)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):M=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const I=a.exported.now()-m;u.endQueryEXT(u.TIME_ELAPSED_EXT,r),setTimeout(()=>{const R=u.getQueryObjectEXT(r,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(r),this.fire(new a.Event("gpu-timing-frame",{cpuTime:I,gpuTime:R})),a.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(I);this.fire(new a.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(I);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(E||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(M=this._updateAverageElevation(m,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,r=!1){const u=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);if((r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const M=Math.abs(m-y);if(M>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(y),u(y);this._averageElevation.easeTo(y,f,300)}else if(M>1e-4)return this._averageElevation.jumpTo(y),u(y)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===a.AUTH_ERR_MSG||f.status===401)){const r=this.painter.context.gl;a.storeAuthState(r,!1),this._logoControl instanceof Od&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function y(v){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,v,0);const M=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,M),M}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(y(f),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(f,r,u){let m=u[1]-u[0];const y=f.length/4;for(let v=0;v<r.length;v++){const M=r[v];let E=0;for(let I=0;I<M.length;I+=4)M[I]===f[I]&&M[I+1]===f[I+1]&&M[I+2]===f[I+2]&&M[I+3]===f[I+3]&&(E+=1);m+=(u[v+2]-u[v+1])*(1-E/y)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),Ru(this._canvasContainer),Ru(this._controlContainer),Ru(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=a.exported.frame(r=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(r)}))}_preloadTiles(f){const r=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(r,(u,m)=>u._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,r){a.setCacheLimits(f,r)}get version(){return a.version}},NavigationControl:class{constructor(f){this.options=a.extend({},bm,f),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),k("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),k("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:r}):u.resetNorth({},{originalEvent:r}))}),this._compassIcon=k("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),u=r===f.getMaxZoom(),m=r===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sm(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const u=k("button",f,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(f,r){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends a.Evented{constructor(f){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},Gd,f),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){this._supportsGeolocation!==void 0?f(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation=r.state!=="denied",f(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,f(this._supportsGeolocation))}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),u=f.coords;return!!r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",f)),this._finish()}}_updateCamera(f){const r=new a.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,m=this._map.getBearing(),y=a.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),y,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new a.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=a.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=k("button","mapboxgl-ctrl-geolocate",this._container),k("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k("div","mapboxgl-user-location"),this._dotElement.appendChild(k("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(k("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ku({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=k("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ku({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bd,ScaleControl:class{constructor(f){this.options=a.extend({},Mm,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=jd.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,u=r._containerHeight/2,m=r._containerWidth/2-f/2,y=r.unproject([m,u]),v=r.unproject([m+f,u]),M=y.distanceTo(v);if(this.options.unit==="imperial"){const E=3.2808*M;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else this.options.unit==="nautical"?this._setScale(f,M/1852,"nautical-mile"):M>=1e3?this._setScale(f,M/1e3,"kilometer"):this._setScale(f,M,"meter")}_setScale(f,r,u){const m=Wd(r),y=m/r;this._map._requestDomTask(()=>{this._container.style.width=f*y+"px",this._container.innerHTML=u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:u}).format(m):`${m}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof a.window.HTMLElement?this._container=f.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=k("button","mapboxgl-ctrl-fullscreen",this._controlContainer);k("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(f){super(),this.options=a.extend(Object.create(Hd),f),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=a.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(a.window.document.createTextNode(f))}setHTML(f){const r=a.window.document.createDocumentFragment(),u=a.window.document.createElement("body");let m;for(u.innerHTML=f;m=u.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=k("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const u=this._closeButton=k("button","mapboxgl-popup-close-button",r);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,u=this._container,m=this._pos;if(!r||!u||!m)return"bottom";const y=u.offsetWidth,v=u.offsetHeight,M=m.x<y/2,E=m.x>r.transform.width-y/2;if(m.y+f<v)return M?"top-left":E?"top-right":"top";if(m.y>r.transform.height-v){if(M)return"bottom-left";if(E)return"bottom-right"}return M?"left":E?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,u=this._content;if(!r||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=k("div","mapboxgl-popup",r.getContainer()),this._tip=k("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ud(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f?f:r.project(this._lngLat),v=Fu(this.options.offset),M=this._anchor=this._getAnchor(v.y),E=Fu(this.options.offset,M),I=y.add(E).round();r._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${zu[M]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&r._usingGlobe()){const y=a.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector($d);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:ku,Style:ho,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Yl,Evented:a.Evented,config:a.config,prewarm:function(){sn().acquire(At)},clearPrewarmedResources:function(){const f=$t;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(At),$t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(f){a.config.ACCESS_TOKEN=f},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(f){a.config.API_URL=f},get workerCount(){return Lt.workerCount},set workerCount(f){Lt.workerCount=f},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){a.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){a.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Bu});var w=d;return w})})(lA);var uA=lA.exports;uA.accessToken="pk.eyJ1IjoidGlubmVpIiwiYSI6ImNsNG1xNGJxMzAwOHQzam1jcTlqd2FtZXUifQ.6OUTbV6SvN668iZOJAoCGQ";function S4(){const i=si.exports.useRef(null),e=si.exports.useRef(null),[n,l]=si.exports.useState(-70.9),[d,_]=si.exports.useState(42.35),[w,a]=si.exports.useState(9);return si.exports.useEffect(()=>{e.current||(e.current=new uA.Map({container:i.current,style:"mapbox://styles/mapbox/streets-v11",center:[n,d],zoom:w}))}),An("div",{children:An("div",{ref:i,className:"map-container"})})}function M4(){return An("div",{className:"wrapper",children:An(TD,{children:vh(MD,{children:[An(cg,{path:"/",element:An(b4,{})}),An(cg,{path:"/grassfield",element:An(w4,{})}),An(cg,{path:"/map",element:An(S4,{})})]})})})}Fx.createRoot(document.getElementById("root")).render(An(J3.StrictMode,{children:An(M4,{})}));
